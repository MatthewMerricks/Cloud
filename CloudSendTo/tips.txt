o Ruby 1.9.3 requires a different C compiler:
    - rvm install 1.9.3  --with-gcc=clang
o RubyMine doesn't debug
    - curl -OL http://rubyforge.org/frs/download.php/75414/linecache19-0.5.13.gem
  - gem install linecache19-0.5.13.gem
  - gem install --pre ruby-debug-base19x
o .rvmrc file: specifies the ruby environment and the gem set to use.
o gemsets:
  - $ rvm use 1.8.7  <== switch to the Ruby interpreter you want to use.
  - $ rvm gemset create rails3
  - $ rvm gemset list
  - $ rvm gemset use rails2
  - gem install rails
    - rvm gemset use rails3
    - gem install --pre rails
    - rvm gemset delete rails3
    - gem list
    - http://ruby.about.com/gi/o.htm?zi=1/XJ&zTi=1&sdn=ruby&cdn=compute&tm=634&f=00&su=p284.13.342.ip_p504.6.342.ip_&tt=2&bt=0&bts=0&zu=http%3A//rvm.beginrescueend.com/gemsets/
    - rvm use 1.9.2-head@albinochipmunk --create
  - rvm use 1.9.2-head@albinochipmunk --default
  - rvm gemdir
  - rvm gemset list
  - rvm gemset list_all
  - rvm gemset delete albinochipmunk
  - rvm gemset empty albinochipmunk
o (2/8/12) Test Application
  - MovieVision
  - Model
    . Movie
      o Title
      o Rating
      o Year
      o Has_many Artists
      o Has_many Media
      o Belongs_to Artist
    . Artist
      o Name
      o Has_many Movies
      o Belongs_to Movie
    . Site
      o Name
      o Has_many Machines
    . Machine
      o Name
      o Belongs_to Site
      o Has many bins
    . Bin
      o Number
      o Belongs_to Machine
      o Has_One (or none) Disk
    . Media
      o Type (DVD, BlueRay, MemoryStick)
      o SerialNumber
      o Has_one Movie
      o Belongs_to Movie
      o May Belong_to Bin
  - Build the model
    . Use shell scripts to build and destroy the model until it is right.
  - Build the scaffold
    . Use shell scripts to build and destroy the scaffold until it is right.
o (2/8/12) Run tests in the rails console
    ruby-1.9.2-p290 :001 > require 'rake'
    ruby-1.9.2-p290 :002 > r = Rake.application
    ruby-1.9.2-p290 :003 > r.init
    ruby-1.9.2-p290 :004 > r.load_rakefile
    ruby-1.9.2-p290 :005 > r['test:units'].invoke
o (2/8/12) Debugging Functional Tests
  - These tests create records in the database from the
    Fixtures.
  - One of the tests was trying to create a record (box) that
    was already in the database from the fixture, and the
    model had a uniqueness requirement.  The test was failing.
  - Insert a "puts @response.body" after the HTML GET/POST.
  - You will see the HTML response text that will help with
    the debugging.
o (2/10/12) RubyMine Keyboard Operations
  - Alt-L - Highlight line at cursor
  - Alt-Del - Delete from cursor to beginning of word.
  - Alt-Fn-Del - Delete from cursor to end of word.
  - Alt-RightArrow - Move cursor to next word.
  - Alt-LeftArrow - Move cursor to previous word.
  - Alt-UpArrow - Select more and more logical text "up".
  - Alt-DownArrow - Select less and less logical text "down".
  - Alt-Shift-Arrows - As above, but select the text.
  - Alt-P - Page down.
  - Alt-Ctrl-P - Page up.
  - Cmd-D - Duplicate line at cursor, below.
  - Cmd-Del - Delete the line at the cursor.
  - Cmd-[ - Cursor to start of block up.
  - Cmd-] - Cursor to end of block down.
  - Cmd-{[]} - As above, but select text moved over.
  - Cmd-Z - Undo
  - Cmd-RightArrow - Cursor to end of line text.
  - Cmd-LeftArrow - Cursor to start of line text.
  - Cmd-Shift-U - Toggle case of selection.
  - Cmd-Alt-U - Toggle Camel/Snake case.
  - Fn-RightArrow - Cursor to end of line text.
  - Fn-LeftArrow - Cursor to start of line text.
  - Fn-UpArrow - Top of file text.
  - Fn-DownArrow - Bottom of file text.
  - Shift-Cmd-Arrows(left, right) - Same as above, but select text.
  - Shift-Fn-Arrows - Same as above, but select text.
  - Shift-Enter - New line below.
  - Ctrl-UpArrow - Show the desktop.
  - Ctrl-DownArrow - Unshow the desktop.
  - Ctrl-Shift-J - Join the selected lines into a single line.
  - Ctrl-Enter - Split the line at the cursor.
  - Shift-DownArrow - Move the selected text down.
  - Shift-UpArrow - Move the selected text up.
  - Shift-LeftArrow - Move the selected text left.
  - Shift-RightArrow - Move the selected text right.
  - Tab - Indent selection
  - Shift-Tab - Unindent selection.
o (2/18/12) Code Camp Davie
  - TDD: Barry S. Stahl
    . Use VS.  Add class.  Queue.cs.  He uses FxCop a lot.  Has his own FxCop template on his blog.
    . Use moq for the mock tool.
    . Cognitiveinheritance.com
  - Buildig HTML5 and JS Apps with MVVM and KnockOut, John Papa
    . johnpapa.net
    . KnockOut.js, Steve Sanderson put it together.  Sustainable JS apps.
    . Sep of concerns, UI patterns, Structured JS, Data & Bindings.
    . Rich client-side interactivity
    . MVVM-like pattern
    . Wide browser support
    . 3 steps:
      <input data-bind="value: firstName" />  Declarative binding
      library looks for data- 
      var myViewModel = {
        firstName: ko.observable("John")  Create an observable
      };
      ko.applyBindings(myViewModel);  Bind the ViewModel to the view.
      jsfiddle scratchpad  jsfiddlt.net/johnpapa/BEXJc/
      One-way binding if not using observables.
      ko.observable(); 2-way binding.
      product: {
        id: ko.observable(1001),
        model: ko.observable("Taylor
      ko.applyBindings(myViewModel);
      Computed Observables: Define a function to veal a value, and use it for binding.
      When its boservables change, it also notifies that change occurred.
      Manage "this".  Pass in an owner for "this", if needed.  Don't assume "this" means something.  It doesn't.  It's weird in JS.
      vm.etended price = ko.comuted(function () {
         return this.product() ? this.salePrice() * parstInt("0" + this.qty(), 10) : 0;
      }, vm);    That's a ViewModel (vm).  The vm says what the "this" is.  It's called the Owner properter.
      Can have multiple of these "computed values".  One at the product level, and another at the total level.
      Can also have read/write "computed values".  Allows you to use extended price to buy as many as I have money for.
      Knockout is client-side.
      Observale Arrays:
      Tracks which object are in the array, not their state.  Track the state with ko.observable()
      var myViewModel = {
         products: koobservableArray([
              { model: "Taloy ", price: 1749, id=321 },
              next item…
      }
      <span data=bind to that…
      Built-in Bindings:
        Text & html
        Value bindings
        etc.
      Facilitate inding to attributes for eleents
      May use multiple binding expressions separated by commas.
      Click event binding
      ValueUpdate.  Input area's value changes (default).  e.g., blur.  Or keyup, key press or afterkeydown.
      <input type = "tesxt" data-bind="value.price" valueUpdate=afterkeydown
      Templates, used with Knockout.
      Control of Flow.  if, if not, foreach, with
      All these apply to Knockout data-bindings.
      with customer.address   then refer to street1, street2, etc.
      Can also use query templates, underscore and others.
      data-bind="template: {name: 'products,  for-each…
      Can change scope.  $data current, $parent, my parent  $root.  the root
      Knockout has a native template engine  implicit definitons if, etc.
      Containerless bindingns.
      Custom binding handlers.  A little more involved.
      How do you integrate with jquery-ui?
      ko.bindingHandlers.fadeVisible (extension).  init: runs first.  update:  runs when the binding is accessed.
      Custom binding.  data-bind="fadeVisible: canShowDetails(), fadeDuration="2000"
      Tip 1: self-closing spans.  Must close the span.  not <span   …. />, but <span  … >dddd</span>
      Tip 2: ko.toJson().  Will spit out everything for debugging.
  - Techniques, strategies, and patterns for structuring JS code, John papa.  Great patterns.
  - Intro to interactive web pages with Knockout JS, CoffeeScript and SCSS
    . Quent Hershelman
    . QuentHershelman@hotmail.com
    . www.quentnet
    . See www.IsaGlobal.org (certified Architect)
    . Knockout is amazingly close to the Xaml data binding support.
    . Also coffee script and SCSS.
    . Knockout: Steve Sanderson.  Good docs.  MIT open source.  All browsers.  Easy and tutorialsl
    . View-ViwModel data binding.
    . Observables.
    . Fine-grained dependency chaining (View changes triggers to update to ViewModel.  ViewModel changes triggers to update View.
    . Inluclde <srcipt src="knockout-2.0.0.js"></script>
    . Write your view: <span data-bind="text: first name"></span>  This is a "text" binding.  Tons more.
    . Write your JS viewModel
        var viewModel=:\{
          firstname: ko.observale("Quent")  Also ko.observaleArray() and ko.computed().
         };
    . Wire up the runtime in the $.ready function
        ko.applyBindings(viewModel);
    . Bindings: text: html: css: style: attar: click: text: visible: and lots more…
    . Add a comment reference /// <reference … to JS to turn on Intellisense in a JS file inside VS.
    . Can use <script type="html/text"> x…..x.   </script>  to include template HTML stuff.
    . A comment <!-- ko jdkjkdjj --> will invoke the html snippet and substitute data.
  - Linq to objects, Advanced topics, Amir Liberman.
    . projecteuler.net: tough math problems.  Some can be solved by linq.
    . linqlib open source.
    . linq extensions library on codeplex.com
    . codeplex.com linqlib.codeplex.com
o (2/22/12) First day with Gus' team
  - Demo for March 13th.
  - 
  - moch inject  insoe finder.  Extend folder structure with a badge.  
  - Michael.  bootstrap css project to handle css.  Leverage bootstrap for the back-end (from twitter).  Working on authentication with web app.
    What does metadata server need.  Some kind of cache?  App has the same id on a device every time.  UdId already registered.  If linking another device
    just override the device?  Steve:  Will look at it.  If the UdId belongs to the user of that device, just overlay it.  Must transfer the ownership
    of the device to a new user.  Must scrub the ID.  Scrub is new registration, a…  Unique elements are user and device.  If the user already exists, don't' let it
    reregister.  Refresh the access token for the device?  What about multiple users on a computer?  Today, device has hash and serial number.  Will add a
    user ID.  Token based on shot key?  and time and random number.  Register a device goes to a default location.  What does an account represent?  Generate
    ID, not necessarily tied to the hardware.  Can be multiple users on a device.  The token should include the app id, user ID and device ID.  
    If the user ID and the device ID match, this guy is just trying to reconnect, and we should let it happen.  If a user recreates a device, then logs in and
    tries to resync the device, must ask the user.  Allow the user to resync, or blow it away.  
o (2/21/12) Badges over Finder file icons:
  - How to superimpose an image:  http://stackoverflow.com/questions/2281177/how-to-overlap-superimpose-an-image-over-a-file-icon-using-cocoa
  - More: http://stackoverflow.com/questions/3181145/add-an-icon-mac-pc-to-a-file-with-cocoa
  - It is possible to put a badge onto a file icon using Quick-Look icons, but I think only for certain file types.  This link says
    it is impossible to use this method to put badges on all files: http://lists.apple.com/archives/quicklook-dev/2011/Sep/msg00003.html
  - Use NsWorkspace setIconForFile to set the icon: http://www.cimgf.com/2008/06/16/cocoa-tutorial-custom-folder-icons/
  - Getting the icon data? From: http://gears.googlecode.com/svn/trunk/third_party/growl/CFGrowlAdditions.c 
DATA_TYPE copyIconDataForURL(URL_TYPE URL)
{
	CFDataRef data = NULL;

	if (URL) {
		FSRef ref;
		if (CFURLGetFSRef(URL, &ref)) {
			IconRef icon = NULL;
			SInt16 label_noOneCares;
			OSStatus err = GetIconRefFromFileInfo(&ref,
												  /*inFileNameLength*/ 0U, /*inFileName*/ NULL,
												  kFSCatInfoNone, /*inCatalogInfo*/ NULL,
												  kIconServicesNoBadgeFlag | kIconServicesUpdateIfNeededFlag,
												  &icon,
												  &label_noOneCares);
			if (err != noErr) {
				NSLog(CFSTR("in copyIconDataForURL in CFGrowlAdditions: could not get icon for %@: GetIconRefFromFileInfo returned %li\n"), URL, (long)err);
			} else {
				IconFamilyHandle fam = NULL;
				err = IconRefToIconFamily(icon, kSelectorAllAvailableData, &fam);
				if (err != noErr) {
					NSLog(CFSTR("in copyIconDataForURL in CFGrowlAdditions: could not get icon for %@: IconRefToIconFamily returned %li\n"), URL, (long)err);
				} else {
					HLock((Handle)fam);
					data = CFDataCreate(kCFAllocatorDefault, (const UInt8 *)*(Handle)fam, GetHandleSize((Handle)fam));
					HUnlock((Handle)fam);
					DisposeHandle((Handle)fam);
				}
				ReleaseIconRef(icon);
			}
		}
	}

	return data;
}
  - Can get icon data and use CompositeIconRef to superimpose one image on top of another.  Supported in the Cocoa framework.
    See http://fossies.org/unix/misc/fpcbuild-2.6.0.tar.gz:a/fpcbuild-2.6.0/fpcsrc/packages/univint/src/IconsCore.pas.
  - May use FSEvents framework to watch for changes to the file system.
  - QuickLook docs: https://developer.apple.com/library/mac/#documentation/userexperience/conceptual/Quicklook_Programming_Guide/Articles/QLImplementationOverview.html
  - Static QuickLook pproach: If you want to specify static thumbnail and preview images for a bundled document, you can take the easiest approach—it 
    doesn’t even require a generator. Just have your application place the images inside the document bundle in a subfolder named QuickLook; 
    the image file for thumbnails should be named Thumbnail.ext and the file for previews should be named Preview.ext (where ext is an 
    extension such as tiff, png, or jpg). If you decide on this approach, you should not create a generator.
  - DB implements this via a Finder Context Menu Extension: http://forums.DB.com/topic.php?id=13858
  - Interesting comment: There is no official or supported plugin system for the Finder. Starting with OS X 10.6, you will need to inject code into the Finder process and override objective C methods in the Finder process.
          I've done this for a proprietary project. I can tell you that the reason that there are no examples or tutorials for this is because it is a significantly difficult and time consuming development task. For this reason, there's plenty of incentive for individuals or organizations who have accomplished this to guard the specifics of their process closely.
          If there's any way at all that you can accomplish your goal using the Services API, do it. Writing a Finder plugin will take you 1-2 solid months of painstaking development and reasonably deep knowledge of C and Objective-C internals.
          If you're still convinced that you want do to this, grab mach_star. Good luck.
  - Seems to be definitive: http://stackoverflow.com/questions/1294335/how-to-write-os-x-finder-plugin
  - I could use the SCPlugin, but that was developed with the Carbon framework, and probably does not have support in Cocoa.
  - All about swizzling: http://www.mikeash.com/pyblog/friday-qa-2010-01-29-method-replacement-for-fun-and-profit.html
  - Source code for GetIconRefFromFileInfo: http://fossies.org/unix/misc/fpcbuild-2.6.0.tar.gz:a/fpcbuild-2.6.0/fpcsrc/packages/univint/src/IconsCore.pas
  - Very good info on badging: http://www.cocoabuilder.com/archive/cocoa/95797-finder-icon-badging.html
  - F-Script injection (like SPY++): http://pmougin.wordpress.com/2010/01/05/the-revenge-of-f-script-anywhere/
  - About IconRefs: https://developer.apple.com/legacy/mac/library/documentation/Carbon/Conceptual/Icon_Service_nd_Utilities/IconServUtili.pdf
  - DB does it via Context Menu plugin???: http://forums.DB.com/topic.php?id=13858
  - MachStar: https://github.com/rentzsch/mach_star#readme
  - Add an item to Finder's right-click menu: http://stackoverflow.com/questions/8809256/how-do-i-get-information-about-the-file-folder-that-has-been-right-clicked-befor
  - Debugging mach_inject with file output: http://stackoverflow.com/questions/8179946/mach-inject-kick-start
  - In Lion, apparently attaching XCode4 Instruments to Finder will allow reverse engineering.
  - class-dump: command line tool to dump a bundle's code in recompilable format.
  - The Mack Hacker's Handbook: http://translated.by/you/the-mac-hacker-s-handbook-part-3-poslednyaya/into-be/trans/?page=92
  - Patch to fix mach_override on intel machines: http://mabblog.com/blog/category/cocoa-programming-osx/
  - Add a user to the procmod group:
    . groups robertstevens  <== list the groups that the user is in.
    . sudo dscl localhost -append /Local/Default/Groups/procmod GroupMembership robertstevens
    . Instructions here: http://0x0005.blogspot.com/2008/08/it-appeared-difficult-to-add-user-to.html
  - Add the debug executable to the procmod group:
    . Find the file by clicking on the target under products.  Then right-click and select Show in Finder.
    . A file like /Users/robertstevens/Library/Developer/Xcode/DerivedData/mach_inject_test-agmaofynhaoajmfbwlnewmbujorx/Build/Products/Development/mach_inject_test_injector.app.
    . sudo chgrp procmod
  - Find the debug bundle file output location.  Drop-down products.  Right-click the .app file.  Click Show in Finder.
  - Find the path of the program file programmatically: [NSBundle mainBundle] bundlePath].
  - Programmatically authorizing: https://blogs.oracle.com/dns/entry/understanding_the_authorization_framework_on
  - Old Tiger code using task gated to get proceed membership via code: http://superuser.com/questions/352388/sudo-sysctl-w-kern-tfp-policy-1-fails
  - task_for_pid() restriction explained: http://books.google.com/books?id=WAPxyIorYM0C&pg=PT52&lpg=PT52&dq=mac+os+x+add+user+to+procmod+group&source=bl&ots=w3b-A0ThY2&sig=KCRrNWYzH1mjwYAAV8Sgkx-gk1c&hl=en&sa=X&ei=EltFT8uMK8betgfT-cGZAw&ved=0CFUQ6AEwBw#v=onepage&q=mac%20os%20x%20add%20user%20to%20procmod%20group&f=false
  - Possible programmatic code to get authorization to inject:  http://lists.apple.com/archives/darwin-userlevel/2008/Jul/msg00002.html
  - An example of programmatic authorization with signed executable and a .plist file: http://www.os-tres.net/
  - Confirmation that I need signed code, and a .plist entry: http://osdir.com/ml/apple-cdsa/2010-01/msg00022.html
  - More on the task_for_pid() problem:
    . http://osdir.com/ml/apple-cdsa/2010-01/msg00022.html
    . http://lists.apple.com/archives/apple-cdsa/2008/Feb/msg00014.html
    . http://web.archiveorange.com/archive/v/M1Kj9CciXUo0RNWl7N3z  (authoratative!)
  - Tutorial on how to code sign: http://os-tres.net/blog/2010/02/17/mac-os-x-and-task-for-pid-mach-call/
  - Great code signing guide: http://www.filibeto.org/unix/macos/lib/dev/documentation/Security/Conceptual/CodeSigningGuide/CodeSigningGuide.pdf
  - Interesting comment: "This is an intentional security feature in task_for_pid() and in ptrace() to preclude you using the debugger to debug a program with escalated privilege and thus access code, data, or interfaces which you would otherwise not be privileged to access or execute as a privileged user or group.  It doesn't matter that the group is the same as gdb itself is running as, what matters is that the credential for that user has been adulterated away from the identity given to the system by DirectoryServices or whatever authentication database you are using to establish the credential in the first place.  Credentials are established by escalating privilege, setting up the credential, and dropping privilege.  If you run a program that re-escalates privilege, unless it does the little dance to establish its rights to establish a new kernel credential authoritatively, privilege is revoked.  In your case, your gdb is only sgid, so it's incapable of obtaining root privilege in order to become an authoritative source of credential information for the kernel.  This is also generally why we ask people to rely on login as a gatekeeper, rather than writing their own credential establishing code."  From : http://lists.apple.com/archives/darwin-dev/2009/Jul/msg00015.html
  - (2/23/12) Requiring root privilege is OK.
  - Write a program that becomes a daemon with root privileges.
  - How to request root privileges in code: http://stackoverflow.com/questions/6659527/task-for-pid-always-returns-os-kern-failure-on-darwin-in-c
  - Launch_dev man page: http://www.manpagez.com/man/5/launchd.plist/
  - LaunchCtl tutorial: http://www.afp548.com/article.php?story=20050620071558293
  - Change the owner on a file: sudo chown root /Library/LaunchAgent/foo.plist
  - Debugging tip for .plist loading: 
        <key>StandardOutPath</key> 
     <string>/var/root/NightlyRSyncBackup.out</string>
     <key>StandardErrorPath</key>
     <string>/var/root/NightlyRSyncBackup.err</string>
  - Another tip:
	Note that per-user configuration files (LaunchAgents) must be owned by the user loading them. All system-wide daemons (LaunchDaemons) must be owned by root. Configuration files must not be group- or world-	writable. These restrictions are in place for security reasons, as allowing writability to a launchd configuration file allows one to specify which executable will be launched.  So, if your rsync should be stared as root:		
		chown root  /Library/LaunchDaemons/your.plist 
		chgrp wheel /Library/LaunchDaemons/your.plist 
		chmod 644   /Library/LaunchDaemons/your.plist
	and after these:
		launchctl load /Library/LaunchDaemons/your.plist
  - Mac Debugging Magic Tech Note: https://developer.apple.com/library/mac/#technotes/tn2124/_index.html
  - (2/26/12) Enhancing rights so task_for_pid() will work?: http://guiheneuf.org/cross-task%20control%20on%20intel.html
  - Good info on code injection: http://www.mikeash.com/pyblog/friday-qa-2009-01-30-code-injection.html
  - Paint icon for every file beginning with "A": http://stackoverflow.com/questions/1294335/how-to-write-os-x-finder-plugin
  - Overview of insertion and APE: http://stackoverflow.com/questions/2689348/is-it-possible-to-hook-api-calls-on-mac-os
  - Convert executable console app to bundle: http://stackoverflow.com/questions/4636572/building-mac-os-x-app-instead-of-console
  - More on converting to bundle, and LSUIElement: http://stackoverflow.com/questions/2226749/gui-less-app-bundle
  - NIBLess project: http://lapcatsoftware.com/blog/2007/06/
  - (2/27/12) I have a NibLess app with initialization and full AppKit support.  Now actually place a hook.
  - I need Finder's proper headers.  Use class-dump to get them.  Download it from here: http://www.codethecode.com/projects/class-dump/
    . Show all files in Finder
    . The class-dump download is a DMG.
    . When double-clicked in the Downloads folder it loads the disk image.  You can see it in the left Finder pane.
    . Use two Finder windows to drag the class-dump executable to /usr/bin.
  - Problem: Show in Finder doesn't work: https://discussions.apple.com/thread/2801693?start=0&tstart=0
  - Show all files in Finder: 
    . defaults write com.apple.finder AppleShowAllFiles TRUE?    . killall Finder
  - (2/27/12) Staff meeting.
    . Logo discussion.  Won't be using the gray circle cloud.
    . Felipe: No.  Had 1-hour interview prior to this meeting.
    . Need to hire someone in March because req will go away.
  - Class-dump:
    . class-dump -H /System/Library/frameworks/appkit.framework
  - find files:
    . find . -name "*run*.h" -print    <== case sensitive!
  - find strings in files:
    .grep -r  --include="*.h" "Method" *
    .grep -rwi  --include="*.h" "Method" *  <== find words only, ignoring case.
  - Interesting snip with nodeWithFEIcon: http://pastebin.com/et1kmGVY/etc/social/index.html
       AAA = [(TNodeIconAndNameCell *)self node];  // Get my own node.  Treat myself as a TNodeIconAndNameCell.
       BBB = [NSClassFromString(@"FINode") nodeWithFENode:AAA];  // form a runtime class from the string "FINode" + my own node ID.
       NSString *path = [BBB fullPath];    // Get the full path from that runtime class.
  - Get the full path of a TFENode in Lion: http://stackoverflow.com/questions/8861503/getting-the-full-path-of-a-tfenode-in-lion
                 From a TFENode, you can get an OpaqueNodeRef, and use that with FINode's nodeFromNodeRef: method. 
                After that, you can get the NSURL to the item with FINode's previewItemURL method.
  - Lots of references to icon modification and context menu adds in Finder: http://loopingrecursion.com/index.php?t=finder
  - Test TNodeIconAndNameCell with TFENode definition: https://llvm.org/svn/llvm-project/cfe/tags/Apple/clang-114.1/src/tools/clang/test/CodeGenObjCXX/property-dot-reference.mm
  - Lion context menu support links: http://www.assembla.com/wiki/show/macintosh-svn-client/LionSupport
  - (2/28/12) Finder.app is located in /System/Library/CoreServices/.
  - Add methods to an object at runtime: http://www.developers-life.com/add-methods-to-obejct-at-runtime-in-objective-c.html
  - runtime.h is in /usr/include/objc/runtime.h
  - (2/28/12) List of classes in memory is in IconBadge/ListOfClassesInMemory.rtf.
  - There are two references that I can't find anywhere: OpaqueNodeRef and FINode.  Hopefully, the runtime will make up for it.
  - Current problem: The code looks for the TIconAndTextCell class which is the class driven by Finder.  However, that class is not in the current process.  I listed out all of the
    currently registered names.  it's not there.  How do I find the class used by Finder if it is not registered?  Do I need to look in another process somehow?  Duh!  I think the answer to
    this is that I haven't injected the code yet.  The swizzling that I am trying to do should be done by the injection process???
  -  Installing, authorizing and patching finder?  https://github.com/snielsen/DeathToDSStore/blob/master/source/DeathToDSStoreAppDelegate.m
  - I got the DeathToDSStore programs working and rebranded.
  - Now I need to do the swizzling.
  - Neat command to search for symbols: /usr/bin/nm /System/Library/PrivateFrameworks/FinderKit.framework/FinderKit | c++filt | grep TIconAnd
  - C++filt man page: https://developer.apple.com/library/mac/#documentation/Darwin/Reference/ManPages/man1/c++filt.1.html
  - Book: Design Patterns in Ruby.
  - Kill the finder: killall -KILL Finder
  - (2//29/12) Open Finder at a particular path: In terminal, "open <path>".
  - Swizzle package: http://github.com/rentzsch/jrswizzle.
  - Really good article on swizzling: http://cocoadev.com/index.pl?MethodSwizzling
  - Working without a NIB: http://lapcatsoftware.com/blog/2007/06/
  - Example of mach_override(): http://www.core.dk/~lp/2009/08/mac-os-x-code-injection.html
  - Finally got the C function to drive from the Finder Objective C environment!!!!  I used this web page: http://www.developers-life.com/add-methods-to-obejct-at-runtime-in-objective-c.html
  - That page (http://www.developers-life.com/add-methods-to-obejct-at-runtime-in-objective-c.html) also shows how to get into the full Objective C environment if I need to!
  - It works!!!!!!
  - Now look at the API.
  - Lion supports XPC (enhanced IPC).  https://developer.apple.com/library/mac/#documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingXPCServices.html#//apple_ref/doc/uid/10000172i-SW6
  - About XPC sandboxing: https://developer.apple.com/library/mac/#documentation/Security/Conceptual/AppSandboxDesignGuide/AppSandboxInDepth/AppSandboxInDepth.html#//apple_ref/doc/uid/TP40011183-CH3-SW2
  - More on the sandbox: http://lacquer.fi/pauli/blog/2011/11/why-the-mac-app-sandbox-makes-me-sad/
  - XPCKit: https://github.com/amazingsyco/XPCKit
  - XPC .plist man page: http://www.manpagez.com/man/5/xpcservice.plist/
  - Research item: When I change a model state in real time (e.g., from syncing to synced), how do I signal Finder to change the icon?
  - Forms of IPC on Mac OS x: http://www.puredarwin.org/curious/ipc
  - (3/1/12) I realized that XPC won't work.  That only works in a launched process, but we need the Finder process to receive these messages.
  - I found a simple solution that works with Objective C: http://www.gnustep.org/resources/documentation/Developer/Base/ProgrammingManual/manual_7.html
    . I need to create a full Objective C environment with a run loop in the finder process.
    . Create a thread (using the Finder process context) to drive this run loop.
    . The thread will be the server, and will use socket communication to accept requests and send responses.
    . Another good example of the client/server code: http://www.cocoadev.com/index.pl?DistributedObjectsSampleCode
    . Runloops are thread-based: http://cocoadev.com/forums/discussion/256/nsrunloop-behaviour-in-leopard/p1
    . More on Distributed Objects with protocols: http://cocoadevcentral.com/articles/000062.php
    . This works now with a simple telephone directory lookup method.
    . I designed the initial API.  See "ICONBADGE API" below.
  - I installed F-Script.  This tool injects into Finder and allows me to inspect Finder's object model.
    . It looks like "drawInlinePreview" is the method that draws a preview image in the TFlowView Finder view.
    . It looks like that same method is used in the TIconView Finder view.
    . F-Script page: http://pmougin.wordpress.com/2010/01/05/the-revenge-of-f-script-anywhere/
    . F-Script documentation: http://www.fscript.org/documentation/index.htm
    . F-Script fix for Lion: http://groups.google.com/group/f-script/browse_thread/thread/8899f236501a1980
  - I looked for a trace tool like Windows procmon.  I want to trace all Objective C messages generated by Finder.
    . I found DTrace.  I'll look into it.  I hope it will do the job.
    . Using Xcode and DTrace to trace file accesses: http://www.symantec.com/business/support/index?page=content&id=HOWTO36824
    . More on DTrace to capture file accesses: http://www.symantec.com/business/support/index?page=content&id=TECH145293
    . YES!  DTrace has an Objective C message provider: http://www.mactech.com/articles/mactech/Vol.23/23.11/ExploringLeopardwithDTrace/index.html
    . nlist utility can look up private symbols (DTrace with mods in your program): http://www.dribin.org/dave/blog/archives/2006/04/22/tracing_objc/
    . That same page also shows how to hook the logObjcMessageSends() function and replace it with any logging function.  That allows tracing of ObjC msg sends.
    . Simple D-Trace instructions for tracing ObjC msgs: http://snippets.aktagon.com/snippets/342-How-to-trace-Objective-C-messages-with-dtrace-in-OSX
    . Using Xcode Instruments with DTrace for tracing particular ObjC msgs: http://www.friday.com/bbum/2008/01/04/objective-c-using-instruments-to-trace-messages-to-nil/
    . A great DTrace tutorial:  http://www.1729.us/cocoasamurai/Debugging%20Cocoa%20with%20DTrace.pdf
    . Mack hacking presentation: http://www.blackhat.com/presentations/bh-jp-08/bh-jp-08-Miller/BlackHat-Japan-08-Miller-Hacking-OSX.pdf
    . A tutorial on objc_msgsend: http://www.friday.com/bbum/2009/12/18/objc_msgsend-part-1-the-road-map/
    . You can't DTrace the objc_msgsend return code: http://stackoverflow.com/questions/7047097/is-it-possible-to-get-the-result-of-objc-method-in-dtrace
    . Tracing objc_msgsend calls to nil: http://www.friday.com/bbum/2008/01/03/objective-c-using-dtrace-to-trace-messages-to-nil/
    . setenv DYLD_SHARED_REGION avoid  <==== allows us to print the selector name.
    . Printing class names being forwarded to (not for 64-bit): http://www.friday.com/bbum/2008/01/26/objective-c-printing-class-name-from-dtrace/
    . More on printing class names: http://lists.apple.com/archives/xcode-users/2009/Jul/msg00356.html
    . (3/5/12) Running DTrace: In the Projects/DTrace folder:  ./TestDTrace.sh 6466 >log.txt
    . 
  - Returning multiple errors:
    . NSError is the standard way to represent an error.  Read one way to use it here: http://www.cimgf.com/2008/04/04/cocoa-tutorial-using-nserror-to-great-effect/
    . Another NSError example: http://stackoverflow.com/questions/4654653/how-to-use-nserror-in-my-iphone-app
  - A list of tools for reverse engineering, and obj conference notes?  https://gist.github.com/297037
  - Where are Xcode substitution variables discussed?: https://developer.apple.com/library/mac/#documentation/DeveloperTools/Reference/XcodeBuildSettingRef/1-Build_Setting_Reference/build_setting_ref.html
  - Print all of the methods for an objective c class instance: http://labs.distriqt.com/post/863
  - More of the above, another method: http://stackoverflow.com/questions/754824/get-an-object-attributes-list-in-objective-c
  - String encodings of argument types: http://pj.freefaculty.org/ps905/ObjC.pdf
  - Allow more console log messages per second: http://superuser.com/questions/168727/mac-extend-or-disable-500-messages-limit-of-console
  - Mono - Objective C project: http://api.monobjc.net/html/T_Monobjc_Foundation_NSURL.htm
  - QuickLook processing with previewItemURL: http://development.christopherdrum.com/blog/?p=109
  - (3/4/12) Saved code to print ObjectiveC class hierarchy: /Users/robertstevens/Source/Projects/SavedSource/FinderOverride20120304PrintObjcClassHierarchy.m.
  - NSLock example: http://alienryderflex.com/NSLock.html
  - I got the unit tests running.  You have to delete the automatically produced target and add a new one: http://stackoverflow.com/questions/5057951/test-driven-development-tdd-writing-unit-tests-in-xcode-4
  - Unit testing macros: https://developer.apple.com/library/ios/#documentation/DeveloperTools/Conceptual/UnitTesting/AB-Unit-Test_Result_Macro_Reference/result_macro_reference.html#//apple_ref/doc/uid/TP40002143-CH9-SW1
  - SenTest open source: http://www.sente.ch/software/ocunit/
  - SenTest runs tests randomly!!!!   I proved it!
  - Apparently, SenTest (OCUnit) runs the tests in alphabetic order.  Make the test names like test000*, test001*, etc.
  - NSLog format specifiers: https://developer.apple.com/library/mac/#documentation/cocoa/Conceptual/Strings/Articles/formatSpecifiers.html#//apple_ref/doc/uid/TP40004265
  - (3/5/12) Project to find hook to allow QuickLook icons to be badged:
    . Interesting article on hacking Leopard: http://securityevaluators.com/files/papers/hackingleopard.pdf
    . Try DTrace on DB.
    . Browse through the Finder class-dump .h files.
    . Try DTrace on Finder.
    . Use Automator to do something repetitive with Finder so the relevant code could be exposed: http://www.macosxautomation.com/automator/  (Won't work).
    . Run Finder under GDB and set some breakpoints to see what info I can see.
    . Promising: FI_TGroupIconView.h drawNode:atAnchor:inContext.  However, the only "drawnode" in the DTrace is shouldDrawNode:atIndex: from FI_TIconViewController.h.
    . Also promising: FI_TIconView.h drawRect.  Maybe our current swizzled class (TIconAndTextCell) is related in some way?  Try this because it is easy to change.
    . (3/8/12) Modulle IKImageBrowserDatasourceItemPrivate-Protocol.h.  quickLookContentFrameForImageSize imageToDrawForCell
    .  NSBrowserProtocol-Delegate.h: NSBrowserDelegate willDisplayCell
    . NSImage-NSImageAdditions.h:  drawInRectFE
    . QLPreviewViewDelegate-Protocol.h:  didShowPreviewItem
    . TBrowserViewController.h iconFrameForNode frameForNode ensureCGSurfaceUpdateOnDraw iconSize getCellForNode
    . TChooseImageController.h shouldShowNode
    . TColumnViewController.h browser:willDisplayCell quickLookSharedPreviewViewForPreviewNode currentNode 
    . TDesktopIcon.h:  drawIconInContext
    . TDesktopIconUIElement.h:  frame 
    . TDesktopIconView.h: drawRect
    . TDesktopViewController.h:  quickLookSharedPreviewViewForPreviewNode extendedDesktopIconFrameForNode desktopIconFrameForNode iconFrameForNode desktopFrameForNode frameForNode draw prepareToDrawNode iconForNode nodes iconRegionForNode setShowIconPreview iconView
    . TFlowViewController.h: quickLookSharedPreviewViewForPreviewNode ensureCGSurfaceUpdateOnDraw 
    . TIconImageView.h: drawRect
    . TIconView.h:  drawRect drawBackgroundOverhangInRect shouldDrawCell drawBackground caNeedsDisplay              
    . (3/9/12) TIconViewCell.h: imageFrame frame
    . TIconViewController.h: imageOfCell quickLookSharedPreviewViewForPreviewNode restoreImageForNode currentSingleIconBounds anchoredIconBounds anchoredBoundsForIconCellPart anchoredBoundsForIconCellPart setShowIconPreview 
    . TIconViewScrollView.h drawRect
    . TIconViewSettings.h: showIconPreview 
    . TListGroupRowView.h: drawRect
    . TListView.h: drawRect drawRect
    . TListViewController.h: imageForRow idealViewSize iconFrameForNode frameForNode 
    . TListViewIconAndTextCell.h: drawIconWithFrame
    . TNodeViewSettings.h: BOOL iconViewShowIconPreview 
    . TPreviewWindowController.h: Manages the preview window.
    . TQLPreviewWindowControllerProtocol-Protocol.h: quickLookSharedPreviewViewForPreviewNode 
    . TThumbnailImageRep.h: initWithCGImage
    . TView.h: drawRect 
    . TIconImageView::drawRect didn't hit.  Try TIconViewScrollView::drawRect.
    . No hits from TIconViewScrollView::drawRect.  Try TView::drawRect
    . That didn't hit either.
    . Maybe none of the calls from Finder will work?  Do I need to only use the FinderKit executable?
    . I think the objects are in the Finder (not FinderKit) process, because TIcon* is found, not FI_TIcon*.
    . TIconView::drawRect gets hits in the proper count, but the badges don't draw.
    . Try TIconViewScrollView::drawRect.  That didn't hit.
    . GDB and DTrace have no symbols for finder.  The stack traces are of no use.
    . The Finder "Get Info" is broken on my machine following injection.  However, it works on Gus' machine.
    . I have some hits on TIconView::drawRect.  Maybe the root object methods will hold some info.  Put in the method dump code.
    . (3/10/12) Big problem yesterday and today with Mac OS permissions.  Finally solved.
    . I printed the stack on entry to the swizzled code (TIconView::drawRect).  I see patterns in the DTrace like this:
             AppKit`-[NSTableView drawRect:]+0xe5
             AppKit`-[NSTrackableOutlineView drawRect:]+0x4a
              Finder`0x00000001003611ec+0x958
              AppKit`-[NSView _drawRect:clip:]+0xeae
    . NSView::drawRect called Finder (no symbols) who called NSTrackableOutlineView::drawRect, who called NSTableView::drawRect.
    . Search the class header files for NSTrackableOutlineView and NSTableView.
    . NSTracableOutlineView is the base class of the TSidebarView class.  Not ours.  Oh snap!
    . There's another pattern like that:
              AppKit`-[NSControl drawRect:]+0xa3
              Finder`0x0000000100360199+0x1f2
              AppKit`-[NSView _drawRect:clip:]+0xeae
    . Finder is calling NSControl::drawRect.  Can I find that?
    . That looks like it is dealing with drawing text.  Any more?
    . Another pattern:
             ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawRect:]+0x62
              Finder`0x0000000100363de0+0xa69
              AppKit`-[NSView _drawRect:clip:]+0xf9b
    . That's from the TImageBrowserView class.  More promising!
    . That class has the following methods:
	@interface TImageBrowserView : IKImageBrowserView {}
		- (void)viewDidMoveToSuperview;
		- (void)viewWillMoveToSuperview:(id)arg1;
		- (void)viewDidMoveToWindow;
		- (void)viewWillMoveToWindow:(id)arg1;
		- (id)backgroundSubtextAttributes;
		- (id)backgroundTextAttributes;
	@end
    . Not much too interesting there.
    . Any more patterns?
    . Not so fast…  There's more to the pattern:
              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawVisibleCells:]+0x364
              Finder`0x0000000100364f92+0x6d
              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawWithCurrentRendererInRect:]+0x13d
              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawRect:]+0x324
              Finder`0x0000000100363de0+0xa69
              AppKit`-[NSView _drawRect:clip:]+0xf9b
    . It looks like Finder is calling the IKImageBrowserView category extension method drawVisibleCells.  Can I find that?
    . drawVisibleCells is a method in TIconView!  I'll bet someone is calling that method to paint the whole view.
    . drawVisibleCells is defined as: - (void)drawVisibleCells:(struct CGRect)arg1;
    . Perhaps I could swizzle that method, let it call the super method to do the drawing, then loop through all of the nodes in the view and badge them???
      o To do that, I need a couple of things:
          - A list of the nodes.
          - The drawing rectangle for each node.
      o The controller (TIconViewController.h) has an interesting method: - (struct CGRect)iconFrameForNode:(const struct TFENode *)arg1;
          - If I have a node, that should give me the drawing rectangle for the icon.
          - There are also popoverFrameForNode, and frameForNode with the same signature.
      o The controller has what might be the list of nodes: - (const struct TFENodeVector *)targetNodes;
      o While searching for the TFENodeVector definition, I found an interesting structure:
		struct TIconViewLayout {
		    struct TNSRef<TIconView *> _field1;
		    struct CGRect _field2;
		    struct CGRect _field3;
		    unsigned short _field4;
		    int _field5;
		    struct TFENode _field6;
		    struct TFENodeVector _field7;
		    struct TNSRef<NSMutableDictionary *> _field8;
		    _Bool _field9;
		    struct TIconLayoutDataCache _field10;
		    struct TNSRef<TIconSpatialDataController *> _field11;
		    struct unordered_map<TFENode, Point32, TFENodeHasher, std::equal_to<TFENode>, std::allocator<std::pair<const TFENode, Point32>>, 0> _field12;
		    _Bool _field13;
		    struct CGSize _field14;
		    struct CGPoint _field15;
		    struct vector<TIconLayoutBitmap *, std::allocator<TIconLayoutBitmap *>> _field16;
		};
          - Notice _field7: That is a vector of nodes.
          - Also notice _field16.  That looks like a structure that might hold bitmaps that will be displayed.
          - Could I find those bitmaps in memory, and badge them there, so the standard infrastructure will draw them as badged?  Maybe.  Later…
          - Interesting: TIconViewController is derived from TBrowserViewController.  TBrowserViewController has lots of methods
            to handle vectors of nodes.  They use C++ templates to define the vectors.  For example, TBrowserViewController has the following method:
				TBrowserViewController.h:- (void)getVisibleNodes:(struct TFENodeVector *)arg1;
          - It looks like that one call will populate a TFENodeVector with the currently-visible nodes.  I should be able to iterate over that vector.
          - Do I have the definition of TFENode?  And TFENodeVector?  I have TFENode, which just holds a single pointer to an OpaqueNodeRef (for which I
            don't have a definition).  Then I use dynamic class FINode's to get a FINode from the OpaqueNodeRef.  I don't have the FINode definition either.
            Once I have the FINode, I use dynamic class FINode's previewItemURL method to get a URL and subsequent file path.  Perhaps I can get other
            info from the FINode.  There a lot of definitions I DON'T have!
          - While looking for TFENodeVector, I found a great reference for the "struct map<*>" definitions: 
             . http://mailman.linuxchix.org/pipermail/programming/2004-September/001487.html
             . http://mailman.linuxchix.org/pipermail/programming/2004-September/001486.html
          - I don't have the definition of a TFENodeVector either.  Maybe I can just assume it is a std::vector of TFENodes and build the definition myself?
          - One thing I have already tried and aborted because it was taking too much time to get it right:
             . Write a shell script to chase through all of the Mac OS X executable files and class dump them all.
             . Maybe I would find the definitions of FINode, OpaqueNodeRef, and TFENodeVector.
             . Maybe I should try that again...
      o Let's see how far I get with chasing the nodes of the TIconView without the definitions…..
          - Swizzle the drawVisibleItems method and run it without action code just to print out the call stack at the entry to the swizzled function (TIconView::drawVisibleCells).
          - Very interesting!  I get the following stack:
             . NSView::drawRect calls Finder (I'm not swizzling that method now).
             . Finder calls IKImageBrowserView(ImageBrowserDrawing)::drawRect
             . That function calls IKImageBrowserView(ImageBrowserDrawing)::drawWithCurrentRendererInRect
             . That function calls back into Finder at TIconView::drawVisibleCells.
          - I wonder if I am dealing with an iterator here?
          - Actually, that's just what I would expect from seeing the DTrace above.  This just confirms it, and doesn't add too much more info.
          - One thing to note: drawVisibleCells is passed a rect that is the size of a window (863 x 359), so it seems that it is trying to draw the whole window.
          - In any case, I am looking for some event that happens EARLIER.  I want to catch a hook, let it draw, then do my own drawing.
          - I already hooked the higher-level drawRect function, let it draw, then drew my own badge.  That didn't show, indicating to me
               that someone else came later and drew over top of my image.
          - Wait a minute!  I wonder if drawRect was passing a large window as well, rather than a single icon on the window.  If that's true,
                then maybe drawVisibleCells is the proper method!  Run the drawRect test again and see….
          - Sure enough.  The drawRect passed the same area (863 x 359).
          - As a test, instead of painting our icon, paint a big green rectangle in that area.  Maybe I can see that?  
          - I can't make it paint.  I am using the following code in the swizzled method:
			    CGContextRef myContext = [[NSGraphicsContext currentContext] graphicsPort];
			    CGContextSetRGBFillColor (myContext, 0, 1, 0, 1);
			    CGContextFillRect (myContext, CGRectMake(rect.origin.x, rect.origin.y, rect.size.width, rect.size.height));
          - Is there some other way to get a better context?  Is someone repainting after I do?  I should at least see a flash, but I don't!
          - I want to change the code to the following, but I can't find the UIKit framework on my system????
			    CGContextRef myContext = UIGraphicsGetCurrentContext();
			    CGContextSetRGBFillColor (myContext, 0, 1, 0, 1);
			    CGContextFillRect (myContext, CGRectMake(rect.origin.x, rect.origin.y, rect.size.width, rect.size.height));
          - Research on the web says I need to reinstall Xcode.  Here we go….   Installed iTunes update.  Installing Xcode 4.3.1 from the Mac App store.
          - Wow!  That user experience sucks.  It just sits there and says "Installing", but what is it doing????  I liked the downloaded version better.
          - OK.  Found the downloads page.  It is 1.53 GB.  I guess I'll go do something else……
          - Xcode 4.3.1 installed, but still no UIKit!   Where did it go?
          - OK.  Apparently UIKit is for iOS, and AppKit is for Mac.  Live 'n learn.  But where is UIColor?  Or what replaces it?
          - Apparently that's entirely the wrong code for Cocoa.  It should be something like the following:
			[[NSColor redColor] set];
		    NSRectFill([self bounds]);    
          - I tried that with the drawRect function.  It didn't work again.  :(
      o (3/12/12) Try something different.  Some of the classes deal with nodes, and others with images.  Perhaps they are
         storing images to be used with the nodes?  Maybe I can find the messages that set the images, and brand them
         at the point that they are created, then maybe I can loop through the node tree on a timer setting the proper
         brands for the files?
         - That might work if we only needed to brand once, but to rebrand we would need to create a new instance variable
            dynamically to hold the part of the image under the brand, unless the images are built up of layers.
         - Could we just change the layer?  And have the brand layer be on top of the image?
         - Apparently this is possible.  I grepped for "layer" and there are lots of hits.
         - While researching CALayers (Core Animation), I found a class called NSImageView.  Apparently you can have "layer-backed" NSImageViews.
         - I grepped for "ImageView", and found TIconImageView, which is based on TImageView!   That class has three interesting methods: canChangeIcon, setImage and drawRect.
         - First try swizzling TIconImageView::drawRect.
         - Arrrghh!  Got no hits on drawRect.  However, I tried it again, this time doing everything I could think of with the Finder UI.  I got a hit!  And it painted a red icon!
           However, the red icon was in the upper left corner of the "Get Info" window.  At least that's something.  And this time the "Get Info" worked!  However, I don't
           know what I did to make it work, and why it hasn't worked in the past???
         - So, I need to move away from TIconView.  Apparently that class has nothing to do with the QuickLook icons.
         - Sample code with drawRect, setImage, setImagePath: https://developer.apple.com/library/mac/#samplecode/MyPhoto/Introduction/Intro.html#//apple_ref/doc/uid/DTS10003692
         - Look at TImageView.h.  That inherits from NSImageView, which inherits from NSView.  This is a view for a single image.  Only one interesting method: setImage.
           No drawRect.  No drawRect in NSImageView either.  However, NSView has a drawRect.  Try swizzling NSView::drawRect and painting it red.  I expect to see
           red everywhere!
         - I saw some red!  However, not in the right places.  Now various backgrounds are red.  The "get info" window's background is red.  The preview backgrounds are red, but
           not the preview itself, and all of the QuickLook images are still normal.
         - Try NSImage again.  They must be drawing the images with that.  I never got a hit before, but maybe I should try the other methods.
         - Again, it only painted red in the "get info" window in the upper-left corner, and when dragging an item out of the side box.
         - Try FScript again.  Maybe I can see more info?
            . The top view is TFlowView.
            . The main list view area is TIconView (as I have expected????)
            . The large list view area is TIconView too.  Sometimes F-Script shows the whole listview as TIconView, and sometimes it shows it as the individual table cells.
            . An interesting method: TMeetingRoomIconViewCell.h drawImage:
            . I found a really interesting site.  QuickSilver (https://github.com/quicksilver/Quicksilver#readme).
            . That guy makes a QuickLook image for his own use.  See his code in the root/Downloads.
            . His code uses NSBitmapImageRep.  I grepped for that and found TThumbnailImageRep (derived from NSBitmapImageRep).
            . Probably some unknown finder code calls one of the methods in this class (e.g., initWithCGImage:).
            . That class returns an NSImage.  I could badge the image before returning it, but would they cache the modified image? 
            . If they always called one of these methods every time they painted, then that method would work.
            . During research, I noticed that code needs to lock the NSImage before changing the color and painting.  I added graphics save-state and locking code.
            . I tried the NSImage::drawInRect:fromRect:operation:fraction swizzle.  It painted successfully, but it badged the lower left corner of the icon in the upper left corner of the "get info" window.
            . Are there any other trials that need that code?  I checked all of them and added the save-state and lock code.
            . I tried TIconImageView::drawRect again.  It painted the entire icon in the upper left corner of the "get info" window,
            . I tried NSVIew::drawRect again.  It painted the "get info" window background, as before.
            . So, it doesn't seem that these additions have helped.  Reset again…
            . Check out  TPreviewViewController.
            . Check out TQLPreviewView, TQLPreviewViewController, and TQLPreviewViewExtractor.
            . For later: TQLQuickLookToolbarItem.
            . One of the panes in the "vertically sliced" directory view is TBrowserTableView.
            . Apparently the TIconView and TFlowView are using CALayers???  Study that.
            . Tutorial on CALayer (iOS): http://www.raywenderlich.com/2502/introduction-to-calayers-tutorial
            . The only classes implementing drawLayer are the TDesktop* and TDesktopIcon* classes?  Is TDesktop a layer over TIconView?
            . Very interesting from the CALayer guide at: https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CoreAnimation_guide/Articles/ProvidingCALayerContent.html
		When using Cocoa views you must subclass NSView or UIView and implement drawRect: in order to display anything. However CALayer instances can often be used directly, 
		without requiring subclassing. Because CALayer is a key-value coding compliant container class, that is you can store arbitrary values in any 
		instance, subclassing can often be avoided entirely.
            . Core Animation architecture: https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CoreAnimation_guide/Articles/CoreAnimationArchitecture.html#//apple_ref/doc/uid/TP40006655-SW1
	     . CALayer constraints, for positioning the layer: https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CoreAnimation_guide/Articles/Layout.html#//apple_ref/doc/uid/TP40006084-SW1
            . TView is set up as an NSView with layers.  It implements setWantsLayer.
            . NSView.layer is the CALayer backing layer.  That CALayer has a sublayers array which lists all of the sublayers.
            . Hook TIconView::drawRect again, and determine the number of layers.  There are no layers!!!!!   ARRRRRGGGGHHH!
            . Try hooking the TDesktopIcon::drawRect to look at its layers.  No dice.  No hits.   ARRRRGGGGHHH!
            . Try TOutlineView::drawRect to determine the number of layers.  No hits.   Why so few hits????
            . Try hooking something else, other than drawRect.  I wonder if these classes are being initialized?
            . How about TOutlineView::setLayer:?  That never hit either!!!!!   What next?
          - (3/13/12) Refactored the code to clean it up and get rid of debugging and duplicate code.
            . Start working top-down.  TIconView is the area with the icons.  It must be using layers.
            . TIconView < TImageBrowserView < IKImageBrowserView.
            . IKImageBrowserView has backgroundLayer and foregroundLayer methods.  I checked those.  They are nil.
            . IKImageBrowserView is used to house multiple images and movies.  How are the cells enumerated?
            . IKImageBrowserView has dataSource property.  That is the IKImageBrowserDataSource reference.
            . The IKImageBrowserDataSource implements the numberOfItemsInImageBrowser property.
            . The definition of the numberOfItemsInImageBrowser property is: - (NSUInteger) numberOfItemsInImageBrowser:(IKImageBrowserView *) aBrowser;
            . The image browser (me) asks the datasource how many items (I) will have, passing the image browser (me) as a parameter.
            . Rerun the test and see if I can determine how many items the TIconView has.
            . Yippee Skippee!  There are 38 items in the Applications.
            . What is the representation of one of those items?  Researching…
            . FINodes contain references to the IKImageBrowserDataSource(s):
				FINode-FINodeAdditions.h:#import "IKImageBrowserDatasourceItemPrivate-Protocol.h"
				FINode-FINodeAdditions.h:@interface FINode (FINodeAdditions) <QLPreviewItem, IKImageBrowserDatasourceItemPrivate>
				IKImageBrowserDatasourceItemPrivate-Protocol.h:@protocol IKImageBrowserDatasourceItemPrivate
            . When we hit TIconView::drawRect (the current debugging context), we are painting the entire view.
            . TIconViewController also has: - (_Bool)shouldDrawNode:(const struct TFENode *)arg1 atIndex:(unsigned long long)arg2;
             . There are two "setDataSource" methods on TIconViewController: 
				- (void)setDataSource:(id)arg1; 
				- (id)initWithDataSource:(id)arg1 andViewSettings:(id)arg2 targetPath:(const struct TFENodeVector *)arg3 browserController:(id)arg4;
             . Hook them and ask the data source object to print itself.  setDataSource got no hits.
             . I created a new Finder window, and both hooks were hit!  The data source being set is a TBrowserViewDataSource.
             . The TBrowserViewDataSource specifies the controller, which is TBrowserViewController. 
             . TBrowserViewController has an itemCount property.  
             . It also has a number of viewContextMenu* and showContextMenu* methods.
             . There is also a openQuickLookNode, and quickLookSharedPreviewViewForPreviewNode, and getQuickLookNodes.
             . Also ensureCGSurfaceUpdateOnDraw, and iconSizeForView, and iconSize,.
             . Where can I find the list of nodes?????  I don't see it in TBrowserViewController, or in TBrowserViewDataSource.
             . However, there is a getVisibleNodes in TBrowserViewController.  If I assume that the items in the data source are TFENodes, that should be all I need.
             . So, how can I find and paint the image associated with a TFENode?
             . I think I would hook TIconView::drawRect and at that point, enumerate the nodes, find the bounds of each node, and the path of each node, and draw the
               badge into the proper node bounds.  That seems possible, but I haven't been able to draw such that I can see anything changed!!!
             . The other way would be to enumerate the windows and nodes on each window on a timer, draw to the nodes in some way under a focus freeze, and then
               invalidate the area drawn.  Hopefully the badge would show on the screen.
             . I haven't found any evidence of layers.  The count is always zero.
             . However, maybe I should create a new Finder window.  Maybe the layer would be set then.  Try that. 
             . I opened a new window, and TOutlineView::setLayer didn't hit.
             . How about trying TIconImageView while opening a new window?  Try that.
             . That didn't work on the main icons, but it painted the "get info" icon red again.
          - (3/14/12) Working on IKImageBrowserView, and related items.
             . An IKImageBrowserView has and IKImageBrowserViewDataSource.  That is the model.  It contains the data to display.
             . An IKImageBrowserView has many IKImageBrowserItem(s).
             . Each of the IKImageBrowserItem(s) holds a pointer to the image to display (imageRepresentation).  It also holds the type of the image (imageRepresentationType).
             . I want to catch Finder at the point where it has completed drawing, and then draw myself:
               o Where is that?  TIconView::drawRect?  That is the drawing function for the entire pane.
               o I would like to catch it at the cell level.  Is that TIconViewCell?  Which is derived from IKImageBrowserCell.
               o Is there a drawRect at the cell level?  There should be, but where?
               o TIconViewCell has an invalidate method.  That should make it redisplay if we need to brand it when status changes (assuming we can find it).
               o Since TIconViewCell is derived from IKImageBrowserCell, then it has all of the methods defined there.
               o Two interesting IKImageBrowserCell methods:
                   - layerForType:  This returns the CALayer used for drawing.  It can be background, foreground, selection or placeholder.
                   - representedItem:  This is the item that is displayed.  The representationType should specify the class (e.g., NSImage?)
               o From the image-browser-appearance sample, IKImageBrowserView has a drawRect.
               o That sample also creates the CALayer used for the cell drawing.
               o An idea:  Even if a method derived from NSView doesn't have a subclassed drawRect method, maybe I could add one?
               o From the sample, the cell's foreground CALayer is filled with a CGImage via the layer's setContents() method.
               o I can't find a use of setContents in Finder.
               o From the sample, the view's drawRect calls each of the IKImageBrowserCell's layerForType function.  The layerForType function provides the images via SetContents that will be drawn.
               o It seems that the app adds a new piece of data to the datasource, then calls the IKImageBrowserView's reloadData member.  That member queries the datasource about how many items there are.
                  If a new cell is needed, the framework will call IKImageBrowserView's newCellForRepresentedItem member.  That member can be overridden to alloc and init a
                  specific app cell class derived from IKImageBrowserCell.  In the sample app's case, that is the ImageBrowserCell, derived from IKImageBrowserCell.
               o So, given an IKImageBrowserView::drawRect event, how in the *&^(*&^ do I enumerate the cells and paint them?
               o Or, can I dynamically add a drawRect for a cell?  Start with how to find the cell collection.
               o It turns out that TIconView has a newCellForRepresentedItem member!  It actually has two definitions, but only the first is a subclass of IKImageBrowserView:
				- (id)newCellForRepresentedItem:(id)arg1; 
				- (id)newCellForRepresentedItem:(id)arg1 useSubClass:(BOOL)arg2;
                o So, IKImageBrowserView asks TIconView for a new cell, but IKImageBrowserView really holds the collection, not the Finder app code.
                o However, TIconViewController implements the IKImageBrowserItem protocol, and I can find out how many cells there are via numberOfItemsInImageBrowser.  Then
                   I can retrieve the items (cells?) via TIconViewController::imageBrowser:itemAtIndex.
                o If my assumption is correct, that an item is really a cell, then I can enumerate the cells.
                o Since those are items, at least I can find other info, like the image representation type, and the imageRepresentation, and imageUID.
                o I'll start with that.
                   . Hook TIconView::newCellForRepresentedItem and print the input arg1 and returned id.
                   . Hook TIconViewController::numberOfItemsInImageBrowser and trace the number.  Also loop through that count and call TIconViewController::imageBrowser:itemAtIndex:, tracing.
                o newCellForRepresentedItem arg1 is a FINode.  The method was called by IKImageBrowserView.  The super method returns a finder_IKFinderCell.
                o numberOfItemsInImageBrowser returned 0!  The IKImageBrowserView passed in is a TIconView.  Why no items?????
                o I ran it again, and this time put it on the proper icon view in the Applications folder and got 38 items again.
                o The caller of this method is IKImageBrowserView(ImageBrowserDatasource)!
                o All of the items are FINodes!  Of course I don't have the FINode definition.   ARRRRGGGGHHH!
                o I wrote the code to print out the class hierarchy of the FINode.  I got it and put it in the DTrace folder.  
                o Interesting: A FINode is not an IKImageBrowserCell, as I had hoped.  However, it includes all of the methods added by Finder via the
                   FINode-FINodeAdditions.h header file, which I have.  And my printout includes all of the FINode methods and properties!
                o Now I can enumerate these things, but how do I get the IKImageBrowserCell which is what is actually drawn (I think)??????
                o Print out the info for some of the FINode methods and properties.
                o Here are some of the FINode results:
				3/14/12 1:37:58.469 PM Finder: isInIconView: _.
				3/14/12 1:37:58.469 PM Finder: imageLabel: 0.
				3/14/12 1:37:58.469 PM Finder: previewItemLocalizedDescription: Document.
				3/14/12 1:37:58.470 PM Finder: previewItemDisplayName: .DS_Store.
				3/14/12 1:37:58.470 PM Finder: previewItemURL: file://localhost/Applications/.DS_Store.
				3/14/12 1:37:58.470 PM Finder: previewItemTitle: .DS_Store.
				3/14/12 1:37:58.473 PM Finder: imageRepresentationType: <IKImageBrowserPromisedRepresentationType>.
				3/14/12 1:37:58.473 PM Finder: statusInfo: <(null)>.
				3/14/12 1:37:58.473 PM Finder: imageUID: <Icon 5951d8a0 0x7fff7ca4cb40>.
				3/14/12 1:37:58.473 PM Finder: imageLabel: <0>.
				3/14/12 1:37:58.473 PM Finder: imageTitle: <.DS_Store>.
                o I found a definition of TFENode and TFENodeVector at: http://paste.lisp.org/display/94546
				typedef struct {
					NodeRef fNodeRef;
					CFTypeRef dummyValue1;
					CFTypeRef dummyValue2;
					CFTypeRef dummyValue3;
					CFTypeRef dummyValue4;
				} TFENode;
				typedef struct {
					TFENode *_M_start;
					TFENode *_M_finish;
					TFENode *_M_end_of_storage;
				} _Vector_impl;
				typedef struct {
				    _Vector_impl _M_impl;
				} TFENodeVector;
				TFENodeVector vector= {0}; // uses bzero to initialize all members to 0
                o Here's one with a class definition: https://llvm.org/svn/llvm-project/llvm/tags/RELEASE_28/test/FrontendObjC++/2010-08-02-NonPODObjectValue.mm
                o Paint icon labels: http://code.google.com/p/fileview/source/browse/trunk/fileview/FVFinderLabel.m
                o One thing to try: Hook IKImageBrowserCell* methods.
                o Aha! TIconViewController derives from TBrowserViewController, and the latter implements getCellForNode: (TFENode *).
                o That should get me the TIconViewCell.
                o Interesting: TBrowserViewController implements the reloadData method.  When called, that triggers IKImageBrowserView to update all its cells and setNeedsDisplay to repaint.
                   As noted above, IKImageBrowserView will then drive all of the cells to provide their images, which IKImageBrowserView will then render under the covers.
                o TBrowserViewController also includes itemcount, showContextMenu, ensureCGSurfaceUpdateOnDraw, iconSizeForView, iconSize.
                o Interesting: DesktopImage sample shows how to get the selected items.
                o IKImageBrowserDatasourceItemPrivate-Protocol.h has an imageToDrawForCell (id) arg1 method.
                o Try this:  Hook the TIconViewController::reloadData method.  In the hook, enumerate the cells and print the layer info.  Maybe there is a background layer? 
          - (3/15/12) I had a better idea overnight.  There is no reason we can't add a method, rather than just replacing methods.  Add a method to TIconViewCell.  That should be
            the object that is created in TIconViewController's newCellForRepresentedItem.  Add the layerForType method.  Th ImageKit framework should try to find that method
            on the created cell, and if it is not found, pass it up the chain to the super, which would be the cell the ImageKit created.  Try that.
                o Interesting description of the internals of Objective C for debugging: https://www.cs.indiana.edu/classes/c304/ObjC.html
                o A great description of Objective C meta-classes: http://cocoawithlove.com/2010/01/what-is-meta-class-in-objective-c.html
                o I added the TIconViewCell::layerForType method.  Everything looks right, but it didn't hit????
                o Instead, swizzle IKImageBrowserCell::layerForType and see if that hits.
                o I got hits on that.  Background and Foreground, but the layer returned is null:
				3/15/12 7:42:24.904 AM Finder: IKImageBrowser::layerForType: called.
				3/15/12 7:42:24.904 AM Finder: IKImageBrowser::layerForType: arg1. IKImageBrowserCellBackgroundLayer.
				3/15/12 7:42:24.905 AM Finder: IKImageBrowser::layerForType: Returning (null) produced by super.
				3/15/12 7:42:24.905 AM Finder: IKImageBrowser::layerForType: called.
				3/15/12 7:42:24.905 AM Finder: IKImageBrowser::layerForType: arg1. IKImageBrowserCellForegroundLayer.
				3/15/12 7:42:24.905 AM Finder: IKImageBrowser::layerForType: Returning (null) produced by super.
                o Print out some of the cell info.
            - (3/16/12) Back onto the swizzling project.  Look at the DTrace for DB.
            - I ran that in the DTrace directory.  logDBAddingFile.txt.  I really need the Finder trace while doing that.
            - Try hooking TIconImageView::setImage, and TIconImageView::drawRect:.  Neither of those had any hits.
            - I see IKImageBrowserView::drawRect … IKImageBrowserView::drawVisibleCells.
            - This is an important entry:
 				 0  26410               objc_msgSend:entry [<nil> drawWithComponentMask:]
				              libobjc.A.dylib`objc_msgSend
				              DropboxBundle`dropboxDrawImp+0xc
				              Finder`0x000000010ac193e9+0xdb
				              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawVisibleCells:]+0x53a
				              Finder`0x000000010ac10f92+0x6d
				              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawWithCurrentRendererInRect:]+0x13d
				              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawRect:]+0x324
				              Finder`0x000000010ac0fde0+0xa69
 				             AppKit`-[NSView _drawRect:clip:]+0xeae
				              AppKit`-[NSView _recursiveDisplayAllDirtyWithLockFocus:visRect:]+0x62f
				              AppKit`-[NSView _recursiveDisplayAllDirtyWithLockFocus:visRect:]+0xa5b
				              AppKit`-[NSView _recursiveDisplayAllDirtyWithLockFocus:visRect:]+0xa5b
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x408
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x16bd
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x16bd
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x16bd
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x16bd
				              AppKit`-[NSThemeFrame _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x10e
				              AppKit`-[NSView _displayRectIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:]+0x1293
 				             AppKit`-[NSView displayIfNeeded]+0x68c
            - Dropbox has hooked some Finder drawing method (drawRect:?), probably at the cell level, since we are drawing visible cells.  Dropbox is sending a drawWithComponentMask: message.
            - In the next entry, IKImageBrowserCell::drawWithComponentMask: handles the message and sends a delegatesImageManagementToDatasource messages:
 				 0  26410               objc_msgSend:entry [<nil> delegatesImageManagementToDatasource]
				              libobjc.A.dylib`objc_msgSend
				              ImageKit`-[IKImageBrowserCell drawWithComponentMask:]+0x8d
				              DropboxBundle`dropboxDrawImp+0xc
				              Finder`0x000000010ac193e9+0xdb
				              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawVisibleCells:]+0x53a
				              Finder`0x000000010ac10f92+0x6d
				              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawWithCurrentRendererInRect:]+0x13d
				              ImageKit`-[IKImageBrowserView(ImageBrowserDrawing) drawRect:]+0x324
				              Finder`0x000000010ac0fde0+0xa69
				              AppKit`-[NSView _drawRect:clip:]+0xeae
				              AppKit`-[NSView _recursiveDisplayAllDirtyWithLockFocus:visRect:]+0x62f
				              AppKit`-[NSView _recursiveDisplayAllDirtyWithLockFocus:visRect:]+0xa5b
				              AppKit`-[NSView _recursiveDisplayAllDirtyWithLockFocus:visRect:]+0xa5b
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x408
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x16bd
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x16bd
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x16bd
				              AppKit`-[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x16bd
				              AppKit`-[NSThemeFrame _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]+0x10e
				              AppKit`-[NSView _displayRectIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:]+0x1293
            - Neither drawWithComponentMask: nor delegatesImageManagementToDatasource is documented.
            - That is the beginning of the process.  Lots of traces are probably just Dropbox letting super do its job.
            - Eventually, super is done.  Then it looks like Dropbox is called at dropboxLayerForTypeImp.  That is obviously its layerForType method!  So Dropbox has
              subclassed a layerForType method!  That is what I was trying to do.   TODO: Try that with a test app.
            - FScript can dynamically add classes: http://www.fscript.org/documentation/CreatingCocoaClassesWithFScript/index.htm
            - Test app.  Use IconBadge, and just change the target app from Finder to the test.  Use one of the sample programs as the target.  One that does not subclass layerForType.
            - Before the test app:  The most obvious choice for the cell is TIconViewCell.  I want to see if they are used.  I hooked TIconViewCell::drawTitle.  It didn't hit.
            - When IKImageBrowserView asks for the new cell object, what is the type of the object returned?  I have already done that!
            - I hooked TIconView::newCellForRepresentedItem.  TIconView's implementation of that method returns a finder_IKFinderCell.  I never paid any attention to that.
            - Reimplement that hook, and print out all of the stack and class hierarchy info for the finder_IKFinderCell.
            - Eureka!  That's it.  finder_IKFinderCell is derived from IKFinderCell, is derived from IKIconView, is derived from IKImageBrowserCell.
            - I saved the file in the DTrace directory as FinderSwizzleTIconView--newCellForRepresentedItemPrintStackAndHierarchyForFinder_IKFinderCell.txt.
            - Hook the finder_IKFinderCell::draw method.  Let it draw.  Then see if I can get the image, overlay a badge and have it draw again.  Then try overlaying the badge first.
            - Where can I find the image?  That should be IKImageBrowserCell::imageToDrawForCell.  Print out the class name of that object at the hook.
            - Big problem:  Looks like it involves forwarding.  I can hook finder_IKFinderCell::draw (that's the only method).  That class derives from IKFinderCell, which
              derives from IKIconCell, and then IKImageBrowserCell.  However, when I drive the original implementation of finder_IKFinderCell::draw, I get the following:
				3/16/12 3:28:48.766 PM Finder: -[IKImageCell SW_finder_IKFinderCell_draw]: unrecognized selector sent to instance 0x7fab9eaaa630
            - Apparently, one of the classes took the message and forwarded it to IKImageCell???  I don't understand forwarding.  Look into it…..  Another timewaster…
            - Try adding that method (SW_finder_IKFinderCell_draw) to IKImageCell, and just pass it on.  Will that work????
            - That actually worked, but I tried to just pass it to a "draw" method on IKImageCell.  It doesn't have one.
            - When I drive the original finder_IKCell::draw method, I wonder why the forwarding mechanism (whatever it is?) is passing along the renamed selector name
              (SW_finder_IKFinderCell_draw)???  What if I just call my implementation "draw"?  Would it leave the name alone then?  Try it.
            - I see.  That won't work.  To swizzle, I have to add a method with a different name (than "draw", the overridden method), then exchange the implementations.
              My overridden implementation gets control when others send the "draw" message, and my method sends the "SW_finder_IKFinderCell_draw" message to the
              object to cause the original implementation to be executed.  The trouble is: Somehow the original implementation is using the changed method name in the
              forwarding process.  What do I do now???
            - How about this?  Hook TIconView::drawRect.  Set a global to say that method is "busy working".  Then hook some cell-level method.  But which one????
            - TIconView is the controller for all of this.  I notice that TIconView::drawRect ends up with IKImageBrowser::drawVisibleCells.  Could that method be driving
              TIconView::drawVisibleCells?  Hook it and see.  Also, hook TIconView::shouldDrawCell:.   Also drawBackground.  And DrawBackgroundPattern. And ViewWillDraw.
               And setDelegate.  Print the type of the delegate.
          - (3/17/12) Do the above, but first see if IKIconCell::drawImage (or others) are hit.  DB hits that.  The DB trace shows no IKImageCell hits.
            . That hit.  The argument is an IKImageWrapper:
			3/17/12 6:03:28.173 AM Finder: IKIconCell::drawImage: arg1: IKImageWrapper 0x7fba33492410 [path:(null) dataRep:(null) bitmapRep:(null) proxy:(null) openglID:1 cachedSize:{64, 64} volatileType: 4 volatileRep:(null) quality:2].
            . The stack shows that drawImage is called by IKImageBrowserCell::drawWithComponentMask:  I have seen that a lot.  Hook that.  It takes an int and returns void.
            . That is hit as expected.  The arg1 is always 511.  See if I can get IKImageBrowserCell::imageFrame, and paint it red.
            . I can get imageFrame, and I tried to paint it red, but it didn't happen (again)!  ARRRRGGHHH!  I can see the proper icon coordinates in the trace.
            . Maybe I need to invalidate.  Try that.  That didn't work either!  And I really expected it to work!  Why is this so difficult?
            . They MUST be using layers somehow.
            . I found this here: http://code.google.com/p/imedia/source/browse/trunk/IMBImageBrowserCell.m?r=947
             // Draw the image itself. In the case of an IMBNodeObject (which is represented as a large folder icon)
	     // we should draw a small badge icon on top of the large folder icon. This si used to distinguish various
	     // kinds of subnodes visually (e.g. iPhoto events, albums, etc)...
	     //- (void) drawImage:(id)inImage
	     //{
	     //      [super drawImage:inImage];             
	     //                   
	     //      id datasource = self.dataSource;             
	     //                   
	     //      if ([datasource isKindOfClass:[IMBNodeObject class]])             
	     //      {             
	     //              IMBNode* node = (IMBNode*) datasource;             
	     //              NSImage* icon = node.icon;             
	     //              NSRect frame = [self imageFrame];             
	     //              CGFloat x0 = 20; //NSMidX(frame);             
	     //              CGFloat y0 = 20; //NSMidY(frame);             
	     //              CGFloat dx = 16.0;             
	     //              CGFloat dy = 16.0;             
	     //              frame = NSMakeRect(x0-0.5*dx,y0-0.5*dy,dx,dy);             
	     //              [icon drawInRect:frame fromRect:NSZeroRect operation:NSCompositeSourceOver fraction:1.0];             
	     //      }             
	     //}            
	     . Maybe this will work?  First find out the type of the datasource.  It's a FINode.  No surprise.
            . Does a FINode have and icon instance method?  Not that I can see.
            . Print the IKImageBrowserCell::cellState.  Looking for IKImageStateReady (value 2).  That means the thumbnail image has been prepared and is ready to display.
            . Also print isInIconView, previewItemURL, imageRepresentationType, imageUID, nodeRef (OpaqueNodeRef ), imageToDrawForCell, 
            . Interesting. cellState is 2.  Good.  However, isInIconView blows up, because the system thinks the self class is IKImageCell!  I hooked IKImageBrowserCell.
              More message forwarding going on?  Print the self class, and get a full class hierarchy for IKImageCell.
            . Interesting.  I hooked IKImageBrowserCell::drawWithComponentCell.  However, in the hook, the self class is finder_IKFinderCell, and the self superclass is
              IKFinderCell, and if I try to send the isInIconView to what I thought was a FINode (self), Finder crashes and says that IKImageCell doesn't support the isInIconView
              message!   What a mess.  Lots of message forwarding going on???
            . Just try to get the icon anyway.  Maybe it will be found.  FINode doesn't have an icon.  However, when coding this I realized that I needed to use the datasource
              (FINode) to print the stuff above, not self, although what I found out about self is certainly interesting.
            . Good stuff: isInIconView is TRUE.  imageRepresentationType is IKImageBrowserQuickLookPathRepresentationType.  imageUID is IconPreview.  
            . imageToDrawForCell wasn't found, because it needs a parameter.  Try [datasource imageToDrawForCell:self].  That worked, but it is null. 
            . Searching for IKImageBrowserQuickLookPathRepresentationType, I found this code: http://imedia.googlecode.com/svn-history/r844/trunk/IMBObjectThumbnailLoadOperation.m 
            . SparkleShare uses static badging.  Here's the code: https://github.com/hbons/SparkleShare/blob/master/SparkleShare/Mac/SparkleBadger.cs
            . DB hooks layerForType.  That is called when IKImageBrowserCell calls drawOverlays.  "Overlays" sounds nice.  Hook IKImageBrowserCell::layerForType and
              provide an overlay layer.  Get the code from the sample.  I made need to know that I am doing this for a particular type of node/cell.  A higher-level hook could set a
              global "busy" flag so this could be determined.
            . I hooked IKImageBrowserCell::layerForType:.  Here is an example trace:
			3/17/12 9:44:34.973 AM Finder: IKImageBrowser::layerForType: called.
			3/17/12 9:44:34.973 AM Finder: IKImageBrowser::layerForType: type: IKImageBrowserCellForegroundLayer.
			3/17/12 9:44:34.973 AM Finder: IKImageBrowser::layerForType: Returning (null) produced by original overlaid method implementation.
			3/17/12 9:44:34.973 AM Finder: IKImageBrowser::layerForType: cellState: 2.
			3/17/12 9:44:34.973 AM Finder: IKImageBrowser::layerForType: frame: x: 678.571429. y: 228.000000. w: 132.000000. h: 108.000000.
			3/17/12 9:44:34.974 AM Finder: IKImageBrowser::layerForType: imageAlignment: 0.
			3/17/12 9:44:34.974 AM Finder: IKImageBrowser::layerForType: imageBrowserView: <TIconView: 0x7faf63dd9590>.
			3/17/12 9:44:34.974 AM Finder: IKImageBrowser::layerForType: imageContainerFrame: x: 678.571429. y: 228.000000. w: 132.000000. h: 108.000000.
			3/17/12 9:44:34.974 AM Finder: IKImageBrowser::layerForType: ImageFrame: x: 712.000000. y: 268.000000. w: 64.000000. h: 64.000000.
			3/17/12 9:44:34.974 AM Finder: IKImageBrowser::layerForType: indexOfRepresentedItem: 35.
			3/17/12 9:44:34.974 AM Finder: IKImageBrowser::layerForType: isSelected: 0.
			3/17/12 9:44:34.974 AM Finder: IKImageBrowser::layerForType: opacity: 0.000000.
			3/17/12 9:44:34.974 AM Finder: IKImageBrowser::layerForType: representedItem: <FINode 0x7faf62e05fb0>.
			3/17/12 9:44:34.975 AM Finder: IKImageBrowser::layerForType: selectionFrame: x: 708.000000. y: 264.000000. w: 72.000000. h: 72.000000.
			3/17/12 9:44:34.975 AM Finder: IKImageBrowser::layerForType: subtitleFrame: x: 678.000000. y: 235.000000. w: 132.000000. h: 11.777344.
			3/17/12 9:44:34.975 AM Finder: IKImageBrowser::layerForType: titleFrame: x: 727.000000. y: 247.000000. w: 33.000000. h: 16.000000.
            . Modify the code to provide an overlay image.  Implement the code if the original implementation returns null (as above).
            . Doesn't work yet, but I found this in my research: 
		- add an overlay layer with setForegroundLayer: (that's the easiest solution but it is SnowLeopard only).
            . I seem to recall that these layers must be enabled somehow before they will work.  Researching…
            . I think this is the reference.  I might have to dynamically add and subclass IKImageBrowserCell like this: http://stackoverflow.com/questions/4880916/can-ikimagebrowserview-display-multi-line-titles
            . Finally!  The big icons are badging properly!  I implemented the foreground CALayer in IKImageBrowserCell::layerForType, and asked it to redisplay itself!
            . I found 4 128x128 icons on the web.  Only one of them has a transparent background.  They work, including the transparent one, but the icons don't get larger
              when I make the Finder icons larger.  Maybe that's because I only filled in the 128x128 slot in the .icns files?
            . Find four 512x512 images and add those to the .icns files.  Do the icon sizes change now?
          - (3/18/12) Cleaning up the code, deleting debug code, and duplicate code.
            . Looked at appledoc and installed it.
            . Some of the listview icons don't appear (.png, .pdf, .jpeg, etc.), and the "Get Info" function is broken when swizzling the listview.
            . The "get info" function is broken as soon as I reference [self node] to get the TFENode.  It seems that just sending the node message to self break it.  Why?
            . Could it be because DropBox is running too?  No.  I stopped it, and the simple reference to [self node] seems to break it.
            . When TIconAndTextCell::drawIconWithFrame is hit, self is the following: TColumnCell < TListViewIconAndTextCell < TNodeIconAndNameCell <
              TIconAndTextWithActionCell < TIconAndTextCell <TTextCell < NSTextFieldCell < NSActionCell < NSCell < NSObject.
            . node is defined from self in TNodeIconAndNameCell.  In fact, it is a TFENode.  Maybe I could go up the super chain and get the node value directly?
              That's a deep subject.  See the reference: Supersequent method invocation: http://cocoawithlove.com/2008/03/supersequent-implementation.html
            . This is wierd.  Now self is TIconAndTextCell at the same invocation!  Maybe I need to check the self class???
          - (3/19/12) Keep dictionaries of the self class before and after driving the original implementation.
            . That test showed that there are two classes that are presented, and they don't seem to change self before and after the call to the original implementation.  The
              two classes are TColumnCell and TIconAndTextCell.  TColumnCell has the node definitions in the hierarchy.  TIconAndTextCell doesn't.
            . Try limiting the processing to the TColumnCell class.
            . In this test I saw TListViewIconAndTextCell and TColumnCell, but not TIconAndTextCell.  Also I saw no list view icons.  Repeat the test, but ask if the
              self class implements node before sending the message.
            . That fixed the "get info" problem!  However, the pdf icons are still not appearing.  
            . Make a test directory with just a few pdf files.  Delete all of the Dropbox folder files.  Add a single .pdf file in list view mode and run DTrace to capture the messages.
            . Dropbox function runMachine looks like it is the timer that schedules cell display.  There is also a method scheduleCellDisplay.
            . Dropbox hooks TListViewIconAndTextCell::drawIconWithFrame.  They are keeping a variable lastPath from some other previous hook.
            . It looks like all they do is set the lastPath (setLastPath) at that hook.  They will use it at a later hook?
            . The timer loop does something to cause an [NSWindow displayIfNeeded] message.
            . They call a function "getCellURLFromAccessability".  Looks like they are scanning the class hierarchy.
            . It looks like they are hooking TableView and setting a delegate to get events from the table view???
            . I ran another test.  They are hooking TSidebarItemCell::setImage, and calling a function called isURLToDropbox.
            . That results in a call to DesktopServicesPriv::NodeIs.
            . Dropbox is hooking TSidebarItemCell::setImage, and sending a setImage message (fielded by NSImageTextFieldCell), and then a setObjectValue message
              (fielded by NSImageCell::setObjectValue).  The setObjectValue: message provides an NSImage object.  Maybe the setImage message causes the setObjectValue:
              message?
            . There is no setImage method in TSidebarItemCell.  Dropbox must be swizzle-adding that method to TSidebarItemCell.  Try that and see if I get a hit.
            . Researching: I found a site that shows setImage: http://stackoverflow.com/questions/6335871/nsimagecell-change-image-problem
			id dataCell = [self dataCellWithID:@"cellID" andRow:listRow];
			if (dataCell && [dataCell isKindOfClass:[NSImageCell class]]) {
			    NSImageCell *statusIconCell = (NSImageCell *)dataCell;        
			    [statusIconCell setImage:[NSImage imageNamed:[self syncIconNameForStatus:syncState]]];  
			    [[statusIconCell controlView] setNeedsDisplay:YES];
			}
             . I tried adding TSidebarItemCell::setImage, and looking up the chain for the setImage implementation to invoke.  The hook never hit.
             . I tried hooking NSImageView::setImage.  That never hit.
             . I tried hooking TImageView::setImage.  That never hit.
             . Hooking NSImageTextFieldCell::setImage.  That hits, but crashes.  Working on that for a couple of hours now…  The stack shows that NSTableView
               calls Finder, calls our hook.  The crash happens as soon as we call the original implementation.  The self class is TSidebarItemCell.  That class doesn't have
               a setImage method, which might be why the crash is happening.  Maybe I need to use the superSequent method?  The next class up the hierarchy is
               NSImageTextFieldCell.  That class has our added (swizzled) method SW_NSImageTextFieldCell_setImage:.  It also has the (swizzle-overlaid) method setImage:.
               Both of the swizzle methods have the same signature.  Try the superSequent method.  That worked!  No more crashes.  Now it does the same thing it did
               before.  I just need to badge the image.
             . I think I badged the image and then set it, but it didn't show.  Maybe I need to force a redraw.  There is no setNeedsDisplay in the hierarchy.  There is a controlView.
               That controlView should be an NSView, and it should support setNeedsDisplay.  Try that.
             . That executed, but the badge didn't display.  It seems that I need to catch it in the draw* methods, but that's not what Dropbox seems to do.  Study the Dropbox
                trace again.
             . We ARE in the middle of a drawRect:!  That results in a setImage from Finder.  Dropbox hooks that and looks up its URL to see if it is a file it cares about.
               Dropbox then sends a setImage: message to NSImageTextFieldCell.  Dropbox then sends a setObjectValue: message to NSImageCell.  Maybe that's what I am
               missing.  Try to send that message, but how did Dropbox get the NSImageCell?  That's not in the hierarchy.  Maybe it's not in the particular trace I am looking at?
               Add code to test if self responds to that message, and if so, send it.  Try that.
             . That executed, but it didn't help with the badging.  
             . Dropbox is also hooking TListViewIconAndTextCell::drawIconWithFrame.  It seems to send an isViewBased msg to NSTableView(NSTableViewViewBased).
               Dropbox then sends a controlView message (to query the current controlView?).  Then it queries the Dropbox URL.  
          - (3/20/12) I hooked TListViewIconAndTextCell::drawIconWithFrame, and did the same processing as in TIconAndTextCell::drawIconWithFrame.  That worked!  Now
               I am badging the redrawn icons (.pdf, .jpeg, .png, etc.).
           - (3/20/12) Switch to a project to write a manual test program that will allow selection of a file, and buttons to badge the file with various status icons.  The test
             program should also have a mode where it automatically changes status every 1/2 second and rotates the status through the entire list of possibilities.  This
             program will test the ability of the badging system to notify Finder to redraw the icon when the status is changed.
             . Sending Finder a refresh event: http://stackoverflow.com/questions/8892246/how-to-refresh-finder-window
             . GCD threads for long-running tasks: http://stackoverflow.com/questions/4645481/sheets-and-long-running-tasks
             . The manual test program works, and it is badging list-view icons, but the large icons are not badging.  It turns out that the node method is not available for
               IKImageBrowserCell objects.  How can I find the corresponding node, so I can find the associated path?
             . Make a new stack and class hierarchy dump at IKImageBrowserCell::layerForType:. 
               o Called by IKImageBrowserCell::drawBackground.  self is finder_IKFinderCell.  This is the one that was involved with the message forwarding!  YIKES!
               o From my notes above, the [self representedItem] is a FINode!  I should be able to get the path from there.
               o It works!  Now only the Flow-list view doesn't refresh when the badge is changed.
           - (3/21/12) I'm guessing that the Flow-list view is getting different hits on the TListViewIconAndTextCell::drawIconWithFrame hook.  Run it again and list the self
             classes that hit.
             . Two classes hit (TListViewIconAndTextCell and TColumnCell).  I tried ignoring TListViewIconAndTextCell.  That didn't badge at all.  Then I tried ignoring
               TColumnCell.  It worked as before.  I deleted the "ignore" code.
             . Great MacOSx tips: http://www.macosxtips.co.uk/index_files/category-terminal.php
             . That bug turned out to be an Apple bug.  Finder doesn't react to the Apple Event.  Dropbox has the same issue.
             . Context menu reference: http://osdir.com/ml/cocoa-dev/2009-08/msg01498.html
             . I pushed it to the cloud.  Badging works.  The badges are in the proper place.  Apple bug exists.  I am ignoring it.  The badge quality needs some work.
             . What's next?
           - (3/22/12):
             . Fixed the registerName bug.  It was using a name server on the entire local LAN loop!
             . Working now on the root service that will inject Finder on behalf of users.
               o Added a new option to IconBadge (-service).  This will run a /Library/LaunchDaemons launchd service as the root user.
               o Accepts user registrations and unregistrations.
               o Injects the Finder for that user.
               o Watches all Finders for all registered users.
               o Reinjects Finders if Finder is restarted.
             . Changed direction on the implementation of the Finder server communication and processing.
               o Use the HTTP communication used in ClAppDelegate.
               o Finder will tell the the user's Cloud app when it has started.
               o The user's Cloud app will then enumerate the entire directory setting badges for the files.
               o What if Finder crashes?  The Cloud app won't know.  The badge messages will just be ignored.
               o When Finder restarts, the Service will reinject Finder on the user's behalf.
               o Finder will send the user's Cloud app a restart message.
               o The user's Cloud app will rebadge everything.  
               o There may be a stray single badge message received.  The Finder server will ignore this until it receives the initial Cloud directory rebadge batch.
               o Do we need responses from the HTTP requests?  Check out th capability of this transfer mechanism.  We may need to implement responses
                  as separate messages in the other direction.
               o Launchd plist editors: http://superuser.com/questions/36087/how-do-i-run-a-launchd-command-as-root
               o Base64 codec: http://cocoawithlove.com/2009/06/base64-encoding-options-on-mac-and.html
               o Object serialization: http://cocoaheads.byu.edu/wiki/nscoding
               o More Base64: http://www.cocoadev.com/index.pl?BaseSixtyFour
               o I changed back to using Distributed Objects (DO).  I couldn't make a debug environment that worked, and the URL approach puts an ugly dialog
                  in front of the user's face if a process is not running to catch it.
           - (3/23/12):
             . Study GCD.
             . A good guide to GCD: http://cocoasamurai.blogspot.com/2009/09/guide-to-blocks-grand-central-dispatch.html
             . KeyValueCoding (KVC): http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/KeyValueCoding/Articles/Compliant.html#//apple_ref/doc/uid/20002172-BAJEAIEE
             . KeyValueObserving (KVO): http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOCompliance.html#//apple_ref/doc/uid/20002178-BAJEAIEE
             . KVO+Blocks: http://blog.andymatuschak.org/post/156229939/kvo-blocks-block-callbacks-for-cocoa-observers
             . More KVO+Blocks: https://gist.github.com/1370212
             . I'll use NSOperationQueue, rather than the low-level GCD.  That fits in with the KVO+Blocks.
             . I'll need a "User" object.
             . The User object will be:
               o Created at User registration.
               o Deleted at User un-registration.
               o Responsible for monitoring the user's Finder process.
               o Responsible for injecting (or re-injecting) the user's Finder process.
               o Responsible for opening a DO connection to the user's Cloud process.
               o Responsible for notifying the user's Cloud process that Finder has restarted.
               o Responsible for terminating itself on any error registering to the user Cloud process.  When the user's Cloud process
                  restarts, the Cloud process will re-register the user, which will create the User object again.
               o Responsible for cleanly terminating itself when a un-registration message is received.
             . The server will accept messages from multiple users.  Currently only RegisterUser and UnregisterUser.
             . RegisterUser will pass the userName and pid.
             . UnregisterUser will pass the userName.
             . The Finder monitoring task will be running on an independent thread.
             . Finder monitor:
               o Polls on a timer.
               o Able to locate the PID of the Finder process associated with the user.
               o Watch the Finder's PID.
               o If the Finder's PID vanishes, set the Finder PID to NULL.
               o If we locate the Finder's PID, and it is different from the saved PID, send a FinderChanged message to the Cloud process.
               o If an error occurs while sending the Cloud message, terminate the user object.
             . Any error noticed by the monitor will execute a block on the main thread, passing a pointer to the user object involved.
               The block will call the terminate method on the user object.  That way, all terminations will be on the main thread.
             . The main thread will start and stop the monitors.
             . How do I locate finder for a particular user?  That took me about 2.5 hours!  I finally have code that walks all of the processes, printing the process name,
               pid, uid, and the username!
             . If a RegisterUser message arrives, and the user is already registered, terminate the current user object, then instantiate and initalize the new one.
             . In-memory database:
               o (NSDictionary) Users: registered usernames vs. UserObjectRefs.
               o UserObject: The user object.  Properties:
                  - pidFinder
                  - pidCloud
                  - etc.
             . DO registered names:
               o Cloud_<username>: The Cloud.app for <username>.
               o IconBadgeServiceApi: Daemon.
             . A good NSOperationsQueue example: http://www.chrisboyd.net/2011/10/demo-async-uiimage-loading-using-nsoperation/
             . And the code: https://github.com/frsh/AsyncImageDemo/tree/master/AsyncImageDemo
             . I replace the NSOperations stuff with a simple timer.  I don't think we need a separate thread.
             . Timer event pseudo-code:
                   if the FinderDown countdown timer is active
                     decrement the countdown counter
                     if counter <= 0
                       ; Finder has been down too long
                       send an error to the cloud app indicating that Finder is down
                       terminate the timer
                       notify the daemon to unregister this user
                       return
                     endif counter <= 0
                   endif the FInderDown countdown timer is active
                   find this user's Finder instance.
                   if Finder found
                     reset the FinderDown countdown timer
                     get the Finder pid
                     if Finder's pid == ours
                       @@@ do nothing
                     else Finder's pid != ours
                       ; FInder's pid has changed.
                       inject Finder
                       if no error injecting
                         send a message to the user's Cloud app to reattach to the Finder service and rebadge all of the cloud folder files
                       else error injecting
                         send an error message to the user's Cloud app indicating that a Finder injection error occurred.
                         terminate this user and notify the daemon remove this user's registration
                       endelse error injecting
                     endelse Finder's pid != ours
                     save Finder's pid as ours
                   else FInder not found
                     if Finder's pid > 0
                       ; Finder has just died.
                       set our Finder pid to -1.
                       set a countdown timeout for Finder to come back up
                     else FInder's pid <= 0
                       ; The finder-down countdown timer will take care of this case.  Do nothing.
                     endelse Finder's pid <= 0
                   endelse Finder not found
             . Thought testing:
               o At system startup, the daemon is loaded as root.  There will be no users.  The daemon just sits there.
               o The first cloud app starts.  Cloud starts his DO server. Cloud registers with daemon. The daemon will locate the user's Finder, and send
                   cloud a refresh Finder command.  Cloud will register with Finder's server, Cloud will get the refresh message, and will enumerate the cloud
                   folder to Finder, refreshing the badges.  Cloud will badge as file system changes occur.
               o Finder restarts.  The daemon will discover this and send a message to cloud to refresh Finder.
               o Normal operation.  Cloud restarts.  Cloud will register with daemon.  That will unregister first, then do a normal registration and initialization.
                  Daemon will send the refresh message, and everything is as in a normal startup.
               o One note: On a startup, the first message to Finder from cloud should be a delete cloud dictionary message.  That should cause the Finder
                  server to refresh and repaint all Finder windows.  That will remove all badges from view.  Then cloud sends the complete folder enumeration
                  to be newly badged.
               o Normal operation.  Daemon dies.  Launchd will restart it.  Cloud will not discover this without keep alive messages.  If Finder goes down, cloud
                  will receive errors trying to badge.  Cloud could just ignore these errors.  In this Finder-error state, Cloud could periodically attempt to reconnect
                  with Finder.  When successfully connected again, Cloud could send the initial rebadging sequence.  Since Finder comes back up quickly when
                  it restarts, I wonder if Cloud will ever determine that it went down?  Will the messages go through, or will they succeed?  Test that.
            - (3/24/12):
              . Refactoring the daemon code, and reworking the design.
              . Running scripts with NSOperationQueue: http://cocoawithlove.com/2010/11/cocoa-application-for-running-scripts.html
              . Everything is coded.  Beginning testing.
            - (3/25/12):
              . Lost all of my notes on the root login.  :(
              . Debug pause in agent: if (1) {     fprintf(         stderr,          "Process %ld waiting for debugger.\n",          (long) getpid()     );     pause(); }
              . The first thing I tried was CloudApp as the user root.  The problem with that is: The root user is in a different login (or bootstrap) environment.
                It is trying to inject the user's Finder, and the user is trying to find the daemon's server, and the daemon is trying to find the user's server, and
                both of them are in different bootstrap environments.  Not easy.  So I decided that I could make the daemon a simpler user agent, and I went down
                that path for a long time.  User agents are in /Library/LaunchAgents.  However, I finally saw this post: http://marc.info/?l=launchd-dev&m=120153045213668
                All user agents have NO privileges.  ARRRGGGHH!   So I guess I am back to running it as a daemon, and trying to figure out how the daemon
                can get access as a privileged process in the user's bootstrap environment.
              . Reference on launch: https://developer.apple.com/library/mac/#documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/DesigningDaemons.html#//apple_ref/doc/uid/10000172i-SW4-BBCBHBFB
              . The bible on daemons and agents: https://developer.apple.com/library/mac/#technotes/tn2083/_index.html#//apple_ref/doc/uid/DTS10003794
              . From the above:
			In some cases it is helpful to impersonate the user, at least as far as the permissions checking done by the BSD subsystem of the kernel. A single-threaded daemon can do this using seteuid and setegid. These set the effective user and group ID of the process as a whole. This will cause problems if your daemon is using multiple threads to handle requests from different users. In that case you can set the effective user and group ID of a thread using pthread_setugid_np. This was introduced in Mac OS X 10.4.
              . Maybe I can use launchctl bsexec:
				https://developer.apple.com/library/mac/#documentation/darwin/reference/manpages/man1/launchctl.1.html
				http://osdir.com/ml/darwin-dev/2009-03/msg00046.html
				http://old.nabble.com/Re:--Un-loading-user-agents-on--Un-install-p19741630.html
				http://groups.google.com/group/macenterprise/browse%5Fthread/thread/f6dfb166217b14a2
http://stackoverflow.com/questions/2515314/launch-agent-from-daemon-in-user-context
http://lists.macosforge.org/pipermail/launchd-dev/2011-January/000890.html
http://superuser.com/questions/263544/launchd-doesnt-give-apache-xampp-all-priviledges-at-startup
              . Best so far: Daemon threads can be setuid, setgid: http://www.unix.com/man-page/OSX/2/PTHREAD_SETUGID_NP/
            - (3/26/12):
              . It looks like pthread_setugid_np() sets the uid, not the euid.  That will lose root privileges. http://lists.apple.com/archives/perfoptimization-dev/2008/Jan/msg00039.html
              . Some Samba source code doing this: http://opensource.apple.com/source/samba/samba-235.6/patches/pthread-setugid-np-credential-switching?txt
              . Better, whole module: http://opensource.apple.com/source/samba/samba-235.6/samba/source/smbd/sec_ctx.c
              . The code is using these functions to assume user mode, then pop back to root, in order to switch to another user context.  Server-type processing.
              . White paper on setuid: http://static.usenix.org/publications/library/proceedings/sec02/full_papers/chen/chen.pdf
              . Idea from: http://www.exploitsdownload.com/search/osx/.  RSYNC bug allows execution of any program because egid was left as "wheel".
              . Maybe the problem I am having is that I am trying to do this on a per-thread basis, and the pthread_setugid_np() function requires that all of the id's are set the same?
              . No.  How about if I set the uid's to the user, but set the gid's to "wheel"?   That should work(?).  The uid should select the user context, but the gid should provide the
                permission to patch Finder(?).
              . I don't think that will work.  The "wheel" group will allow me to set the effective uid to root, but I need to do that on the thread.  Can I do that?
              . Interesting quote: The process needs to be born with some kind of root privileges, e.g. suid root executable. The code can release the root privileges at start and pick the 
                effective root privileges at runtime when needed.
              . Login hook tech note: http://developer.apple.com/library/mac/#technotes/tn2228/_index.html
              . Setuid program reducing privileges: http://us.generation-nt.com/rfc-lttngtrace-available-non-root-help-201130771.html
              . Make FinderOverride and Injector setuid and setgid executables:
                o sudo chown root:wheel FinderOverride
                o sudo chmod o-rwx FinderOverride
                o sudo chmod u+rws FinderOverride
                o sudo chmod g-w FinderOverride
                o sudo chmod g+rs FinderOverride
                o And the same for Injector…
                o Actually, do this only for Injector, because FinderOverride runs in the Finder process.
              . Another idea, maybe better: Use this setuid/setgid approach with a user agent instead of a deamon.  That way, the program loads in the user's
                context, but should be able to elevate it's own euid to root.  Try that.
              . To install:
                o Build IconBadge project in XCode.
                o In terminal: ~/Source/ShellScripts/InstallService.sh.
              . To run:
                o In terminal: ~/Source/ShellScripts/RunService.sh.
                o In XCode: Set breakpoints on, and place a breakpoint at Iconbadge/main.m: main: after the pause.
                o In XCode: Attach to the CloudApp process.  That should immediately hit the breakpoint above.
              . The user agent works!  And it reinjects Finder when it recycles.
              . Integrate the GUI test into the Cloud app.
              . Cloud.app design:
                o AgentMonitor:
                   - Provide the Cloud.App server to receive messages from the Agent.
                   - Process messages from the Agent.
                   - Support a delegate to notify the rest of the app of the received messages and other events (e.g., refreshFinder message).
                   - Monitor the Agent using KeepAlive messages (on a separate thread).  Reconnect with the Agent as necessary.
                   - Register and unregister the user with the Agent.
                   - Provide a method to asynchronously send a message to the Agent. Accept a block parameter.  Drive the block with success or failure, and the info.
                   - All messages will be sent via GCD queue.
                   - Use try/catch everywhere to handle exceptions.
                   - Provide startup and shutdown methods.
                   - Implement as a singleton.
                   - The main object (CLAgentService) will spin off another object (CLAgentMonitor) on a separate thread to monitor and communicate with the user Agent.
              . Good GCD tutorial: http://www.fieryrobot.com/blog/2010/06/27/a-simple-job-queue-with-grand-central-dispatch/
            - (3/27/12):
              . Testing…
              . Went to Apple store and bought iMac and two Thunderbolt monitors.
              . Debugging the crash that happens when I kill agent.
              . Setting up the iMac.
            - (3/28/12):
              . Setting up the iMac.  Most procedures OK now.
              . Added try/catch in service when launching monitor.  That didn't help the crash.  Debugging the crash.  Stopped, and added it to TODO.
              . Reference copying a block to solve ARC block crash: http://stackoverflow.com/questions/7404653/arc-getting-exc-bad-access-from-inside-block-used-in-delegate-method
              . More on that: http://stackoverflow.com/questions/9223049/referencing-an-nsoperation-object-in-its-own-completion-block-with-arc
              . Synchronous/asynchronous URL request: http://blog.slaunchaman.com/2011/07/19/asynchronous-synchronous-requests-effortless-networking-code/
            - (3/29/12):
              . eBook on XCode 4: http://redirect.rigwig.org:8081/tim/Computer%20Knowledge%20MegaCollection%20v1.0/The%20Actually%20Useful%20Programming%20Library/Objective-C%20-%20Cocoa%20-%20OS%20X%20-%20Xcode/Mastering%20Xcode%204%20Develop%20and%20Design%20-%20Nozzi%20-%20Peachpit%20(2012)/Mastering%20Xcode%204%20Develop%20and%20Design%20-%20Nozzi%20-%20Peachpit%20(2012).pdf
              . Refactoring the DO names to be in the form <serverName>_<userName>.  XCode screwed up with the global renames????  Trying to recover.
              . Successfully recovered and refactored.
              . Solved a bug in startup where the core services were being started twice.
              . The agent and user are working now with the refactored DO names.
              . Next: Make a clickable test to badge files.   Replace the onClick for the main toolbar Cloud folder.  Start a thread that just flips the badges between two files.  Hook it
                up to the CLAgentService API.  Also, hook up the delegate to know when to refresh the Cloud folder status to Finder, and put in the code in CLAgentService to reestablish a
                connection to Finder on the refreshFinder message.  After the Finder connection is restarted, send the refreshFinder message to the delegate.
            - (3/30/12):
              . Added logic to retry connection to finder.
              . Updated the startup logic to start the core services just once.
              . Got my Windows VM image to load.  Configuring it and updating it.
              . Finished the command line tests of the debug version of CloudApp. Debug control with plist works.  -u, -i -a, and -t work from the command line.
              . Tested the client app badging.  It works!  I pushed everything up.
              . Switched to finding the cause (and a fix for) the crashes when Agent and/or Finder are recycled.
            - (4/2/12):
              . Set up the new 3TB Time Machine backup drive, and managed to delete my Windows VirtualBox virtual machine.  Recovering that from the original image on my other external drive….
              . Working on the server-stop crash.
              . Build a simple test jig.  Server and client processes.  Client just sends messages on a timer.  Server just logs the messages.  See if that crashes.
              . Good info on self and blocks: http://stackoverflow.com/questions/4352561/retain-cycle-on-self-with-blocks
              . Fixed the Cloud.app crash when terminating the agent.
              . Working on another crash of agent when terminating Finder.  It dies when it is trying to retrieve the injector ending task status.
              . I fixed the crash.
            - (4/3/12):
              . The Seagate drive drivers lock up Finder.  Working on a fix for that.  Fixed it.
              . Still trying to recover the deleted Windows 7 VM….
              . Pushed the changes for fixing the two crashes.  Also made changes to clean up the git status, deleting and adding files.
              . Started working on the project to display better icon images:
                o Create separate jpg icon files with the following sizes: 16, 24, 32, 48, 64, 96, 128, 192, 256, 384, 512.  This has progression 8, 8, 16, 16, 32, 32, 64, 64, 128, 128.
                o The images should be transparent in the larger sizes, and opaque in the smaller sizes.
                o Load the images into an array at initialization.
                o Select the image to display in real time according to the size desired.
                   - If there is no image with greater size than what we need, choose the largest image.
                   - Otherwise, choose the image just larger than what we need, and let the framework size it down slightly.
                   - That should produce the best quality.
                o Also work on the placement and sizing according to the type (listview/iconview) and the size of the icons selected by the user.
                o Define a class to represent each of the images:
                   - File name on disk.
                   - Unflipped CGImage reference.
                   - Flipped CGImage reference.
                   - Pixels per height and width.  e.g., 16.
                   - Method to initialize and load the class object.
                o Should this object derive from CGImage?  The code uses NSImage and CGImage.  Can I standardize on CGImage?  No.
                o Drawing a CGImage: http://stackoverflow.com/questions/3424103/drawing-image-with-cgimage
                o Another time-waster: 3 hours+.  getlogin() was returning "_spotlight", instead of "robertstevens".  NSUserName() fixed it.
                o The Cloud program isn't badging.  Why not?  I got it to badge, but the image is upside down.  Then I got it flipped, but not vertically through the mid-line.
                o I installed the bob@cloud.com account on the iPad, but I couldn't get it to install on the Mac.
             - (4/4/12): Connect 2012 and our team dinner at Chima.
             - (4/5/12):
                o I got the badging working with CGImage only (no NSImage).  Now load in all of the proper images and implement the display algorithm.
                   - Design the classes and load them up into an ordered array by pixel count.
                   - Call the class BadgeImage.
                o The variable-sized icon badging works great, and looks great!
             - (4/6/12):
               o Now work on the tests.
                  . Restart the Mac multiple times and make sure that all three processes initialize correctly and handle the race conditions.
                  . Add "crash" messages to Finder and Agent, and have the tests crash one, the other, or both, and recover.
                  . Add tests for Agent.  
               o To run tests: Select IconBadgeTests target, then menu Product/Test, or Cmd+U.
               o Existing tests are successful, but they are only directed at Finder, and assumes that Finder is already injected and running.
               o Fixed a bug in yesterday's refactored code that prevented connection between Cloud and Finder.
               o Tests to add for agent:
                  1.  Install the agent.  This is necessary to make sure that the plist is in place for subsequent tests.
                  2.  Stop the CloudApp agent.  Should succeed whether already stopped or not.  It will not be restarted because it is uninstalled.
                  3.  Run the uninstall.  Test that it is uninstalled.  Should succeed whether already uninstalled or just uninstalled.
                  4.  Kill Finder.  Should succeed in any case.  Finder will be restarted by launchd.
                  5.  Test connection to the agent server.  Should fail because it is not running.
                  6.  Install the CloudApp agent.  Should succeed.
                  7.  Test for agent running.  Should fail because agent hasn't been started.
                  8.  Start the CloudApp agent.  Should succeed.
                  9.  Test that the agent is running.  Should succeed.
                  10. Test for connection to the wrong agent host name.  Should fail.
                  11. Test connection to the proper agent host name.  Should succeed.
                  12. Test an unimplemented message to agent.  Should fail.
                  13. Send a keep-alive message to an unregistered user.  Should fail.
                  14. Send a registerUserName message to register the user.  Should fail because we haven't initialized the user DO server.
                  15. Start the user DO server.  Should succeed.
                  16. Send a registerUserName message to register the user.  Should succeed now.
                  17. Test the keep-alive message.  Should succeed now.
                  18. Send a crash message to the agent.  Should cause an exception.  The agent should be subsequently restarted by launchd.
                  19. Wait 2 seconds for the agent to be relaunched.
                  20. Send a keep-alive message.  Should fail because the connection was broken and the user is no longer registered.
                  21. Clear the refreshToFinderReceived flag.
                  22. Send a registerUserName with the wrong login name.  Wrong pid.  Should fail.
                  23. Send a registerUserName with the wrong pid, but the correct login name.  Should fail.
                  24. Send a registerUserName with the correct pid, but the wrong login name.  Should fail.
                  25. Send a registerUserName with the correct pid, and the correct login name.  Should succeed.
                  26. Send a keep-alive message for this user name.  Should succeed.
                  27. Wait 2 seconds. (for Finder to be injected and a refreshToFinder message to be received).
                  28. Check for the receipt of the refreshToFinder message.  Should be received by now.  Should be successful.
                  29. Check to see if the Finder server is running.  It should be.
                  30. Send a telNumber command to Finder.  It should fail with an error.
                  31. Send a setBadgeType: signature to Finder.  It should fail with an error, because it also requires the withPath: parameter.
                  32. Send a getBadgeCount message to Finder.  It should return with success and a zero count.
                  33. Send a clearAllBadges message to Finder.  It should succeed.
                  34. Clear the refreshToFinderReceived flag.
                  35. Send an ohSnap message to Finder to crash it.  It should succeed.  LaunchD should restart Finder.
                  36. Wait 2 seconds for the Finder to be relaunched.
                  37. Check for the receipt of the refreshToFinder message.  Should be received by now.  Should be successful.
                  38. Send a getBadgeCount message to Finder.  It should succeed and return a zero count.
                  39. Send a setBadgeType:forFileAtPath: message.  It should succeed even if the file is not present in the file system.
                  40. Send a getBadgeCount message to Finder.  It should succeed and return a count of one.
                  41. Send a getBadgeType:forFileAtPath: message for the same file as above.  It should succeed and return synced.
                  42. Send a setBadgeType:"none":forFileAtPath: message for the same file as above.  It should succeed.
                  43. Send a getBadgeCount message to Finder.  It should succeed and return a zero count.
                  44. Send an unregisterUserName message to agent with the wrong user name.  It should succeed.
                  . Send an unregisterUserName message to agent with the correct user name.  It should succeed.
                 o Wait on the tests.  Badge the existing Cloud directory first.  How best to enumerate the directory recursively?
                   . I will get a flat array of the files and directories by scanning the directory recursively.
                   . Loop through the flat array badging the files.
                   . Do that under a lock.
                   . If a user action comes in while this bulk operation is underway, add the user file path into a separate set.  
                   . Under the lock, before badging a file, see if it is in the user set.  If so, don't badge it.
                   . After iterating over the whole array, delete the array and the user set.
              - (4/7/12):
                o Time waster: Just getting my MacBookAir set up and paired with the three Bluetooth devices took over an hour.
                   That, plus installing XCode updates, and syncing my code base…   I should have gone to work. 
                o The startup Cloud directory enumeration and badging works now.
                o I started downloading Moutain Lion to install on my MacBookAir.  I will test the badging on Mountain Lion.  It doesn't work on Gus' system.
                o It works on Mountain Lion on my machine, but not on Gus' or Steve's.
                o 8:30 - 2:30
              - (4/8/12):
                o 6:30 - 20:00 (2 hours personal)
                o The BuildStaging directory is being created.  Why is Gus' machine throwing errors?  Does he not have admin rights when he is building?
                o Changed "error" to [error localizedDescription] everywhere when used with NSError.
                o Setting up the unit test XCode environment: http://twobitlabs.com/2011/06/adding-ocunit-to-an-existing-ios-project-with-xcode-4/
                o Time-waster (2.5 hours).  Trying to find the main bundle from the test bundle.  I was trying to use bundleForClass, with a class from the main bundle,
                   and got led down the garden path by examples from the web, and problems resulting from those examples.  In the end, I just got the test path
                   and went relative to that to get the other path, in order to find the scripts that I needed for test.
                o Good info on DO sync: http://www.cocoabuilder.com/archive/cocoa/168017-distributed-objects-question.html
                o More good info on DO sync: http://web.archiveorange.com/archive/v/SEb6aXy6AzRrBdfsowUI
                o 23 tests working.
              - (4/9/12):
                o Time waster (2 hours+). SenTest won't run all of the tests.  It stops at test 007.  Maybe the XCode 4.4 project files are changed?
                o Now testing works again.  I installed Mountain Lion and XCode 4.4.
                o Wrote the code to find the login user name for a particular pid.  Implemented the check in the agent to make sure that the pid matches the user name.
                o All 23 tests work again, and I have a small demo for MarkT, who should be visiting us for lunch today.
                o Finished all 44 tests, and they work.  This completes the unit and functional testing of the agent and Finder processes.
                o Debugged the problem connecting with Finder with Gus on his machine.  It has to do with the permissions for Injector.
                o 6:30 - 19:45            
              - (4/10/12):
                o 6:15 - 18:30
                o LaunchD .plist generator: http://spotmac.lima-city.de
                o (4/10/12) Is the Agent in the wheel group (really?)?  No, it is the standard user logon.
                o (4/10/12) Badging doesn't work on Gus' or Steve's machine.
                o (4/10/12) Make getpwuid thread-safe.  Use getpwuid_r() everywhere.
                o (4/10/12) Remove "set -x" in the shell scripts.  
                o Fixed crash due to removed retain.
                o Great info on NSException handling: http://macdevcenter.com/pub/a/mac/2007/07/31/understanding-exceptions-and-handlers-in-cocoa.html?page=3
                o WaitForDebug.plist is in IconBadge/Resources:
                   . Copy it to the target Resources directory.
                   .  /Library/Application Support/Cloud/CloudApp.app/Contents/Resources
                   . Unload and load.  See the message in Console.
                o (4/10/12) Uncomment messages in CLAgentService.m:beginAgentServices.
                o (4/10/12) Test for memory leaks.
              - (4/11/12):
                o 6:15 - 18:30
                o AppleEvent sample code: http://developer.apple.com/library/mac/#samplecode/MoreAppleEvents/Introduction/Intro.html
                o I proved that the AppleScript "tell application "Finder" to update every item in front window" doesn't work.
                o I spent the morning trying to find an AppleScript reference for Finder.  No dice.  It seems that support for AppleScript is very spotty.
                o I am dropping the research on the AppleScript approach.  I'll start looking for a lower-level "invalidate" method.
                o Good info on NSView forcing a redraw: http://stackoverflow.com/questions/7648047/force-a-window-to-redraw-itself-using-core-graphics
                o Try a different approach.  The Finder DO server runs on a separate thread, and events come in at different times then when we are
                   actually badging the icons with our images.  I need to be able to call the particular view's setNeedsDisplay method.
                o First write a test that will enumerate each of the visible Finder windows, just once, on the server thread.  Find the application (sharedApplication).
                   Find the windows for that application.  Then find the contentView for each of the windows.  Call setNeedsDisplay on each of the views.  See if that works.
                o That worked.  All badging is now updated, even the ListView/FlowView window!   Pushed!
                o Looking at the retain logic.  Removing them caused a crash.  It turns out that it the obtuse KVO mechanism.  The KVO event was calling back to the
                   server, and the server was killing the user and releasing it, then the KVO returned to the user, but no user!  I need to use notifications instead. 
                   They are one-way, and guaranteed (locally).
                o Researching notifications. 
              - (4/12/12):
                o 6:00 - 18:00
                o Had to rebuild the Finder class-dump.  It's not on this new iMac.  Find it in Projects/DTrace/FinderClassDumpMountainLion
                o I researched the TBrowserWindow and TBrowserWindowController classes.  I think I can find the target path, but that needs more work.
                o I wrote the code to use notification between the agent server and user classes, but it was still crashing.  I finally determined that the mode of notification
                   I was using was still synchronous, like KVO.  I changed the mode to use the ASAP queued notification.  Now the unit tests work again.
                o I also fixed a bug that was resulting in the server not being able to reinject finder.  The NSOperation can't be reused once it is complete.
                o Made NSError+Categories.* to remove duplicate NSError creation code.
                o Changed the Finder server code to run the Finder refresh on the Finder main thread (to prevent threading issues).
                o Everything is working fine with no retains.
                o Pushed changes.
                o Changed the int return codes to NSError ** and pushed.
                o Added documentation and prettied things up with @pragmas.
                o Fixed the user code to reset the agent state when an error message is received from the agent.  The user will now try to reconnect with the agent.
                o Investigated the typing delay in the initial cloud dialog.  It is not due to any of the shell integration code.
                o Well along the way of finding the paths associated with the various Finder windows.
                o Vector memory: http://books.google.com/books?id=gYNVsCaxfYgC&pg=PA378&lpg=PA378&dq=vector+start+finish+end+of+memory&source=bl&ots=KLTHo6cQnK&sig=PogEXQXfz7YVOw1Vs2Eqx04zsAM&hl=en&sa=X&ei=cUeHT9vUIYuo8QT54p2cCA&sqi=2&ved=0CCcQ6AEwAg#v=onepage&q=vector%20start%20finish%20end%20of%20memory&f=false
              - (4/13/12):
                o 6:00 - 18:15
                o I realized that there are some Finder views like the "All My Files" view that list files from everywhere, including the Cloud directory.  We want to show those files as badged.
                o I ditched that effort in favor of limiting the number of requested repaints.  I will paint immediately, but only N times in each second.  I sent an email to Gus, Steve and Phil about that.
                o Timer limiting pseudo-code:
                          ; data
                            MAX number of repaints per second
                            countdown number of repaints allowed
                            repaint pending flag
                          ; timer
                          if repaint pending
                            set repaint pending = NO
                            cause a repaint
                          endif repaint pending
                          reset paints allowed to MAX
                          ; badge operation
                           if paints allowed count > 0
                             cause a repaint
                           else paints allowed count <= 0
                             set repaint pending
                           endelse paints allowed count <= 0 
                 o Another time waster:  XCode crashes repeatedly blowing up the stack while indexing.  That cost 1.5 hours.  I finally solved it.  It is a bug in the indexer.  Saw somw
                    of my pseudo-code
                 o Phil had a suggestion to evenly space the refreshes.  Change the pseudo-code to the following
                           ; data
                              Constant: kTimeBetweenRepaints: e.g., 0.33
                              timer active flag
                           ; timer pop
                             cancel the timer
    			        cause a repaint
                             clear the timer active flag
                           ; badge operation
                             if timer not active
                               set timer active flag
                               set a timer
                               cause a repaint
                             endif timer not active          
                  o Interview with Chuck.
                  o Error message: The managed object model version used to open the persistent store is incompatible with the one that was used to create the persistent store.
                     . Delete the file /Users/robertstevens/Library/Application Support/com.citrix.core_data      
                  o The throttling of the Finder window refresh works properly, and the tests succeed.
                  o Working the whole afternoon on load testing.  I got the manual test to work sending a badge every millisecond.
                  o I implemented that logic in the Cloud.app and hooked it up to the Open Cloud Folder menu item.  Shooting various problems with the load that is created.
                     The normal test works, but when I crash Finder, it doesn't recover.        
              - (4/14/12) Sat:
                o 9:30 - 16:00, 17:15 - 20:30
                o Time waster: 45 minutes.  Setting up the MacBookAir for the load test.  I thought I had broken the system because I couldn't get Console to work.  I had modified
                   a plist file to change the default behavior of deleting messages over 500 per second to printing them all.
                o Finally got the system set up properly and found a bug having to do with access of self in a block.  However, it's still failing illogically.  I think I know the reason.
                   I'm accepting tons of badges, and loading them into memory.  The blocks are executing later and not paying attention to the Finder connection state.  Actually,
                   the block that is executing later has an old copy of the state on the stack.
                o I don't think I can accept just any number of badges.  We could run out of memory.  But how many badges do I accept?  Any number I pick would be wrong.
                   The problem is that I don't have application knowledge.  
                o One way would be to buffer up to 1000 badges, and then stop the API synchronously.  However, I really don't want to ever stop the API.
                o I think that means that the use must queue up all of his badges, and run them into the API  synchronously, using a separate thread to do it?
                o Actually, I could change the test to send 1000, then add an API call to put a marker block on the queue, which would send an event back to the test to
                   send another 1000 when the first 1000 are done.
                o Then I need a way to block the execution of the queue thread when Finder is down, so the badges start to flow again when Finder is up again.
                o I could use a mutex for that.
                o Finder-down is noticed in many places.  The timer thread might notice it.  The queueFinderSend thread might notice it when attempting to send a badge.
                o It is always the timer thread (main thread) that notices when Finder is ready again.
                o Perhaps I could create and pre-lock a mutex at initialization.  Then if the queueFinderSend thread has a problem sending a message, it would just block on the
                   pre-locked mutex, and try the same badging operation when it acquires the mutex.
                o But how do we get the mutex locked again by the timer thread before the queueFinderSend thread retries the badge operation?  This seems like a classic flip-flop
                   thread pattern.  What is the simplest pattern I can find to implement this?
                o Use NSConditionLock.  The timer thread is responsible for setting the FINDER_UP condition.  Both threads are responsible for setting the FINDER_DOWN
                   condition:
                          ; initialization
                            id condLock = [[NSConditionLock alloc] initWithCondition:NO_DATA];
                          ; queueFinderSend thread:
                            loop attempting to badge
                               [condLock lockWhenCondition:FINDER_UP];
                               try badge
                               if error
                                  [condLock unlockWithCondition:FINDER_DOWN];
                               else no error
                                  [condLock unlock];
                                  break;
                               endif no error
                            endloop attempting to badge
                          ; timer thread
                            ; When connected to finder:
                                [condLock lock];
                                [condLock unlockWithCondition:FINDER_UP];
                             ; When noticing that finder is down:
                                [condLock lock];
                                [condLock unlockWithCondition:FINDER_DOWN];                             
                o Allow only a maximum number of badges to be queued.  Count the badges as they come to the API.  Increment a count.  When
                   it reaches the maximum, return a MAXIMUM_BADGES_QUEUED return code to the user.  The user should stop sending badges.
                   The first such return code will also add a dispatch_sync block to the queueFinderSend queue.  This block will reset the count, and will
                   drive an event to the user via the delegate.
                o The badging works now, and I can reliably? (5 tries) kill Finder and have it reconnect.
                o I can use the NSTaskDidTerminateNotification to notify when NSTask completes: https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSTask_Class/Reference/Reference.html
                o Big time waster:  NSTask won't run injector!
                o Actually, I think it is running injector, because Finder injects, but injector puts out no debug log entries.  It is being compiled in debug mode, with DLog statements.  Why no logs?????
                o When I run it from the command line, it prints to the terminal, but somehow NSTask is blocking the logs.  Maybe I need to set NSTask stderror???
              - (4/15/12) Sun:
                o 6:30 - 13:30
                o Backslash escape blanks in a path:            
              NSArray *arr = [[[NSBundle mainBundle] pathForResource:@"injector" ofType:@""] componentsSeparatedByString:@" "];
              NSString *launchPathWithEscapedSpaces = [arr componentsJoinedByString:@"\\ "];
                o NSTask source code: http://www.quantum-step.com/download/sources/mySTEP/Foundation/Sources/NSTask.m
                o Print to XCode console AND Console.app: http://parmanoir.com/Redirecting_NSLog_with_NSLogConsole
                o Still HUGE time-waster (2 hours so far this morning).  NSTask seems to launch injector, but doesn't see it complete, and doesn't notify the agent user object.  That
                   causes a retry of the launch of injector, but now it doesn't seem to run.  At least NSLog isn't working, and Finder doesn't respond to the 2nd and subsequent injector launch
                   attempts.  Maybe if I cause injector to crash?  At least then I would be sure it is working.
                o It's crashing, so it is being launched.  Why can't I get debug logging?????   ARRRGGGHHHH!
                o Redirecting NSLog (stderr): http://www.atomicbird.com/blog/2007/07/code-quickie-redirect-nslog
				//    int fd = creat ("/Users/robertstevens/Source/Trash/my_log", S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);
				//    close (STDERR_FILENO);   // this closes descriptor 2 (stderr)
				//    dup (fd);                 // this dups the file onto the lowest file descriptor (2)
				//    close (fd);              // this closes the original file descriptor
				//    NSLog(@"this will be written to my_log");                
                o Finally, it appears that I can't use NSTask in NSOperation: http://www.cocoabuilder.com/archive/cocoa/293896-nstask-in-nsoperation.html
			NSTask relies on a runloop. Since you have no control over what thread
			your operation runs in, you can't run a runloop on your operation's
			thread, and therefore cannot use NSTask in this manner.

			You will need to spawn your NSTasks on the main thread (or at least a
			thread you own, not one owned by NSOperationQueue or GCD). When you
			get your -taskDidTerminate: notification *on the main thread*, you can
			enqueue another operation to handle the result of the task completing.         
                o NSLog gets sent to asl_log: http://www.cocoabuilder.com/archive/cocoa/198249-logging-mechanisms-in-cocoa.html
                o Write to ASL (Apple Logging):
			    aslclient client = asl_open(/*ident*/ NULL, /*facility*/ "Injector" /*or other reasonable facility string*/, ASL_OPT_STDERR);
			    asl_log(client, /*msg*/ NULL, ASL_LEVEL_NOTICE, "printf-style format; interpolates values, such as %i", 42);
			    asl_close(client);
                o Mostly everything works, but there is still an occasional crash in CloudApp, and an occasional hang? in Cloud.
              - (4/16/12) Mon:
                o 6:15 - 18:30
                o Finder kills recover and don't cause agent or cloud crashes.
                o Backup to network drive: http://opensoul.org/blog/archives/2009/01/14/network-time-machine-backups-to-another-mac/
                o More on Backup to network drive: http://apple.stackexchange.com/questions/28208/time-machine-backup-on-another-mac-in-my-network
                o All three kill tests work perfectly!  I submitted it.
                o I need to check the status of the user app from agent, and kill the badges for that user when Cloud goes down.  Use the existing proxy and send a (new) keepAlive
                   message to Cloud.  If it breaks in any way, send a clearAllBadges message to Finder, and unregister the user.
                o That works, but Finder didn't refresh, so the badges stayed there until the user causes the window to refresh manually.  Add a refreshWindows message to the
                   Finder API.  I will also need to put logic into the user to send a refreshWindows message some amount of time after the last badging operation, if a new badging
                   operation doesn't come in within that amount of time.  Actually, that was just a bug.  The throttling timer wasn't processed on a clearAllBadges request.
                o It's all working now, and submitted!
                o Working on problems with the unit tests.  hasRegisterBeenRequested is messed up.
              - (4/17/12) Tue:
                o 6:15 - 17:45
                o 18:00 - 20:30 Education, FlaDotNet, Microsoft, FTL, HTML5      
                o Finally ended the hunt for the cause of the crash at the end of the unit tests when the user app (test app) is terminated.  It seems that I needed to retain the proxy
                   obtained from rootProxyForConnectionWithRegisteredName:
			Some leaks, and places where objects could leak if the timing was
			right, in Distributed Objects have been fixed in 10.5. This may mean
			that you may no longer get away with something you used to get away
			with due to the leak. Not retaining the root proxy you get from the
			connection, if you're going to hold onto it, seems to be a common
			pitfall.   Web site: http://www.cocoabuilder.com/archive/cocoa/216768-10-5-and-root-proxies.html
                 o The unit tests work now.
                 o All of the tests work now, but I had to place an extra retain on the agent user objects to prevent an agent crash.  I submitted this version.  It works well.
                 o I need to refactor the creation of the user object, and pass the retention ownership of the user object to the dictionary.  I don't think this will prevent the crashes,
                    but it is a more standard pattern.
                 o The refactoring is done.
                 o I also passed the processing of the unregisterUserName to the user object for proper handling.
                 o The tests are broken because the registerUserName action calls unregisterUserName.
              - (4/18/12) Wed:
                o 7:00 - 18:30
                o Fix the broken tests.  It is not simple.  There are two choices when a registerUserName comes in: 1) If the user is already registered, call unregisterUserName, then
                   register the user as we have before.  There may be two issues with that.  One, we are kicking out an error on the unregister, and two, the unregister may take some time?
                   2) Just verify that the user that is coming in is the same user, and allow reconnect.  On the reconnect, send back a refreshToFinder message somehow.  Research
                   these options.
                o That is done, and all tests pass.  The agent crash on user release is still there, occasionally.
                o Meeting with discussion of sync problems.
                o Change the design to spin off a separate NSOperation thread for each user.  That thread should have a run loop.  All of the existing code will run on that thread.
                   The run loop will run in an external loop, checking for a run loop exit request.  The other code will clean up, and will set the run loop exit request.  The run loop
                    will run for an additional N seconds, then terminate.  Actually, I think I can do it without the thread.  Maybe I should try that first?  When users are placed into the watch
                    dictionary, also put in a countdown of seconds.  In the timer loop, when a watched user is seen, count down the seconds, and remove the user from the watch
                    dictionary when the countdown is complete.
                 o I changed the server timer processing to delay the user release by 5 seconds.  That didn't work.
                 o Steve pointed out that my user dealloc releases, and sets to nil.  Perhaps that releases twice?   Working on that.
              - (4/19/12) Thu:
                o 6:15 - 18:15
                o Meeting with more discussion of sync state machine.
                o Fixing the double-release fixed the agent crash.  I pushed the code.  All tests work beautifully.
                o Test with two users.  Create a new regular user.  Build the app with the load-test badging.  Copy the Cloud.app bundle into the user's Applications 
                   folder.  Execute the app, start the load badging, and perform the kill tests.  Leave it running, and switch to my own user.  Perform the tests under
                   my user.
                o Multiple users work great!  In fact, OsX automatically starts the agent for the new user, so the user is not even prompted for credentials to install!
                   I tested with an admin user, and with a regular user.
                o Started reviewing the code.
                o Changed file names for consistency and pushed.
              - (4/20/12) Fri:
                o 6:15 - 
                o Reviewed the code.  Removed all retains.  All tests work.  Renamed variables and modules for consistency.
                o Started the Windows client project.  Watched 1.5 videos on MvvmLight.
              - (4/21/12) Sat:
                o 9:30 – 16:00
                o Watched more videos and read documents on MvvmLight.
                o Which development platform should I use? WPF?  Silverlight?  Silverlight is asynchronous, and would provide support for Windows Phone 7.  But where is Windows Phone 7 going?  
		  Will we support that?  I believe Silverlight is delivered through the browser, and there is an “out of browser” mode for Silverlight.  Is that what we want?
                o Silverlight 5 features: http://www.silverlightshow.net/items/10-Laps-around-Silverlight-5-Part-10-of-10.aspx
                o More SL5: http://justlikeamagic.com/2011/05/18/new-in-silverlight5-elevated/
                o SL5 Multiple Windows: http://trelford.com/blog/post/sl5multiwindow.aspx
                o Cross-platform WPF, SL and WP7: http://trelford.com/blog/post/sl5multiwindow.aspx
                o MvvmLight: http://www.galasoft.ch/mvvm/
                o SL5 supports full-trust out-of-browser operation.  It even supports P/Invoke, file system access, and Win32.
                o SL5 is also easier to get running on Windows Phone 7.  
                o SL5 is asynchronous, and supports part of the TPL (Task Programming Library).
                o SL5 supports multithreading.
                o MvvmLight supports SL5.
                o Windows Phone will use SL, or a slightly-modified version.
                o SL5 Multiple Windows: http://trelford.com/blog/post/sl5multiwindow.aspx
                o SL5 Elevated Trust: 		.
                o SL5 will be supported until 2021.
                o It seems that SL (or some version thereof) is still a major strategy at Microsoft.
                o SL5 support goes all the way back to XP: http://www.microsoft.com/getsilverlight/Get-Started/Install/Default.aspx
                o SL5 OOB app can be installed via setup (or via supported browsers): http://www.codeproject.com/Articles/179756/Installing-Silverlight-OOB-Application-using-a-Set
                o MvvmLight supports Windows 8: http://blog.galasoft.ch/archive/2011/10/03/mvvm-light-toolkit-for-windows-8-preview-mvvmlight-win8.aspx
                o Conclusion: We should probably use SL5 and MvvmLight.  That code base has the best likelihood of being supported across the desktop and mobile.
                o Problems with the IE9 downloader.  I used Opera to download the MvvmLight sample program.  Updating VS2010 to support SL5.
                o I got everything installed, and the sample SL5 app builds.  It looks like a good base, because it uploads files to a web server.  Expression Blend 4 and VS2010 both work.
              - (4/22/12) Sun:
                o 7:00 – 19:00
                o Installed MvvmLight V4 Beta 1
                o Installing the .Net frameworks and supporting VS2010 libraries.
                o Two views in one window: http://www.codeproject.com/Articles/323187/MVVMLight-Using-Two-Views
                o Rounded corners in SL: http://dvanderboom.wordpress.com/2010/11/06/dynamic-clipping-of-rounded-corners-in-silverlight/
                o Window control OOB: http://programming4.us/multimedia/2018.aspx
                o Sample code to paint an entire window with custom controls: http://www.silverlight.net/learn/overview/out-of-browser-applications/out-of-browser-applications-(silverlight-quickstart)
                o Book with OOB stuff: http://www.springerlink.com/content/mlk750562rrk1r50/
                o Trying to get a window with a full image to display with rounded corners.  So far, close, but no cigar.
                o Animated drop shadows: http://msdn.microsoft.com/en-us/library/ms753350(v=vs.90).aspx
                o Custom chrome window OOB: http://www.codeproject.com/Articles/68955/Silverlight-4-How-Can-I-Create-a-Customized-OOB-Wi
                o I have a chromeless window and a standard window working with the standard Cloud main screen image.  No buttons or other windows.
               - (4/23/12) Mon:
                 o 6:30 – 18:30
                o Get a Windows development environment set up at work.  First, install a VirtualBox VM and install Lion.  Then maybe I can use that to open the VM image and do something
                  to make it convertible to VMWare.  
                o I couldn't do that.  VirtualBox won't even run.
                o I tested RDP.  That doesn't support multiple monitors.
                o I decided to go back to the physical machine.  I installed VMWare Standalone Converter.  Hopefully, I can take an image and get it running on Mountain Lion.
                o Can I disable the "Silverlight" controls on an OOB app?  Researched that.
                o Good OOB AppManifest.xml documentation: http://www.silverlightshow.net/items/Silverlight-3-as-a-Desktop-Application-Out-of-Browser-Applications.aspx
                o Apparently we CAN disable the Silverlight context menu for the OOB app.
                o Can we build a setup installation package that will also install the Silverlight runtime?
                o Installing an OOB app via a setup project: http://www.codeproject.com/Articles/179756/Installing-Silverlight-OOB-Application-using-a-Set
                o But can we also include the Silverlight plugin itself in the setup package?
                o Another custom OOB installer: http://www.c-sharpcorner.com/uploadfile/dbd951/silverlight-oob-application-installer/
                o Another one: http://timheuer.com/blog/archive/2010/03/25/using-sllauncher-for-silent-install-silverlight-application.aspx
                o Another one: http://weblogs.asp.net/alnurismail/archive/2010/05/24/a-distributable-exe-silverlight-oob-application.aspx
                o Microsoft Deployment document: http://www.microsoft.com/silverlight/resources/
                o Comparing SL OOB and WPF with ClickOnce: http://stackoverflow.com/questions/5314346/clickonce-versus-windows-gadget-versus-silverlight-oob
                o Installing an OOB app for all users on a machine: http://forums.silverlight.net/t/220344.aspx/1
                o Manually installing SL via an open source installer: http://www.dotnetheaven.com/Blogs/4285/a-simple-silverlight-oob-application-installer-using-nsis.aspx
                o Mac SL install package: http://www.microsoft.com/silverlight/handlers/getsilverlight.ashx
                o SL vs. WPF features: http://msdn.microsoft.com/en-us/library/cc903925(v=vs.95).aspx
                o Excellent description of SL OOB app capabilities: http://www.silverlightshow.net/items/Mastering-LOB-Development-for-Silverlight-5-Out-of-Browser-OOB-Applications-.aspx
                o Jounce framework: http://www.wintellect.com/CS/blogs/jlikness/archive/tags/silverlight+5/default.aspx
                o Jounce at CodePlex: http://jounce.codeplex.com
                o SL 5 features: http://www.gianlucacucco.net
                o MvvmLight supports WinRT.
                o OOB app in systray: http://stackoverflow.com/questions/6887747/how-to-minimize-silverlight-application-to-system-tray
                o More OOB app in systray: http://firstfloorsoftware.com/blog/hosting-silverlight-outside-the-browser
                o Native Extensions for SL, supports task bar, etc.; http://archive.msdn.microsoft.com/nesl
                o Feature requests for SL 5: http://geekswithblogs.net/JoshReuben/archive/2010/09/13/silverlight-5.0--wpf-5.0---not-quite-there-yet.aspx
                o Great examples of creating child windows: http://geekswithblogs.net/JoshReuben/archive/2010/09/13/silverlight-5.0--wpf-5.0---not-quite-there-yet.aspx
                o NESL support minimize to system tray!:  http://archive.msdn.microsoft.com/nesl
                o Blend tutorials: http://expression.microsoft.com/en-us/cc184874
                o I have the Windows dev machine imported into a VMWare Fusion VM on the Mac, and operating full screen across the 3 monitors.  Yet to be proven: performance.
                o Installing updates, etc.
  o (4/24/12) Tue:
    - 6:00 - 18:00
    - Cocoa objc_msgSend debuggging: http://www.friday.com/bbum/category/science/technology/apple/mac-os-x/
    - Installing Expression, git and the rest of the development environment.  Got it installed.
    - Fixed a bug with the VM.  The comboboxes were erasing as the mouse goes over them.  That was not usable.
    - Downloaded the PictureUploader sample for MvvmLight and SL5. 
    - Both MvvmLight and Jounce are MIT licensed.
    - Description of ViewModelLocator: http://stackoverflow.com/questions/5462040/what-is-a-viewmodellocator-and-what-are-its-pros-cons-compared-to-datatemplates 
    - Building the main window with Blend and VS2010.
    - Awesome button building: http://www.codeproject.com/Articles/64937/Building-Better-Buttons-in-Expression-Blend-Silver
    - I built a button, but it is without actions and states at the moment.
    - I used these instructions: http://codeflow49.blogspot.com/2009/10/step-by-step-shiny-button-template-with.html
    - Got the Samsung notebook.  I set it up, but it runs Windows 7 Home Premium.  I need to upgrade it to Professional to be able to connect to the domain.
  o (4/25/12) Wed:
    - 6:15 - 18:30
    - Installing Win7 Enterprise on the Samsung laptop.
    - Finishing the shiny button tutorial.
    - A completely wasted day working on hardware and PC setup.  We installed the SSD in the iMac, and the Samsung laptop is working properly, although not
      nearly completely set up.
  o (4/26/12) Thu:
    - 6:30 - 18:30
    - I got the Blend buttons working and showing the proper color.  They aren't the right shape, and they don't animate enough, but I'll wait for Rion
    - Installing Visual Studio on the Samsung.
    - MVVM Validation snippet extensions: http://www.basarat.com/2011/02/mvvmlight-extensions-part-snippets.html
    - About RelayCommand: http://blog.galasoft.ch/archive/2009/09/26/using-relaycommands-in-silverlight-and-wpf.aspx
    - MVVM Light tutorial with unit testing: http://www.codeproject.com/Articles/166688/Using-MvvmLight-with-XAML-Silverlight-4-or-WPF
    - A very thorough example: http://www.codeproject.com/Articles/82298/A-Sample-Silverlight-4-Application-Using-MEF-MVVM
    - Also: http://issuevision.codeplex.com/
    - A WPF page slide transition: http://www.codeproject.com/Articles/197132/Simple-WPF-Page-Transitions
    - A Silverlight sliding panel demo: http://www.windowspresentationfoundation.com/Tutorials/SlidingPanels/SlidingPanelWIthToggleBtn/
    - Animation in Silverlight: http://weblogs.thinktecture.com/cnagel/2010/03/easing-animation-with-wpf-and-silverlight.html
    - Great site for sophisticated code: http://www.silverlightshow.net/items/Animated-navigation-between-Pages.aspx
    - I downloaded and played with several animated page navigation samples.  The link above was the best.
    - I asked Gus and Steve about whether we need sliding windows.  They think it should fit with the native OS, but be good looking.  After all,
      it's only an installation program.
    - Maybe we should go all the way back to Windows Forms?  Let's think about that first.
    - What do we have to support?
      . Forward to Windows 8 desktop.
      . All the way back to XP
      . Windows Metro tablets and Windows Phone 8.
      . Windows Phone 7
      . Problem with Windows Forms.  It's Win32.  That is not supported on Metro and Windows Phone 7.
      . It seems like Silverlight is still the way to go:
        o It gives us all of the options (static windows, animation)
        o It gives us Windows Phone 7.
        o (slightly modified) It gives us Metro.
        o It limits the API in use to a very small platform.
      . Keep at it, but forget the sliding navigation for now.
      . Use a fixed sized window, like on the Mac.
      . Forget MVVM.  Too complicated for this.
      . Build the meat of the client into a Silverlight class library.
      . Build unit tests to the class library.
      . For the first step, investigate Silverlight navigation.
      . Silverlight navigation: http://msdn.microsoft.com/en-us/library/cc838245(v=vs.95).aspx
  o (4/27/12) Fri:
    - 6:15 - 17:15
    - I built the CreateNewAccount form.
    - Navigation works.
    - MvvmLight works for RelayCommands and Messaging.
    - Working on validation and how to present the errors to the user.  Use the IDataErrorInfo interface?
    - Interesting post on error handling: http://www.silverlightshow.net/items/Data-Driven-Applications-with-MVVM-Part-III.aspx
    - I need to use a 1-1 View-ViewModel relationship.  Right now all of the views go to one ViewModel.  The Model will hold the data.  Done.
    - Working out the details of validation, using the post above.
  o (4/28/12) Sat:
    - 7:30 - 16:00
    - Installed Expression Blend and VS2010 tools for Silverlight 5 on my laptop.
    - Nice validation resource: http://www.codeproject.com/Articles/75962/Validation-in-Silverlight
    - Maybe better MVVM validation pattern: http://stackoverflow.com/questions/5282919/data-validation-in-silverlight-4
    - And: http://outcoldman.ru/en/blog/show/260
    - I think I am finally at a place where I can code validation.  I will make the validation run only when the user clicks the OK button.
      Unfortunately, the LostFocus method just doesn't work, and it it did I couldn't use it because we shouldn't validate when the user clicks
      the "back" button.
  o (4/29/12) Sun:
    - 5:30 - 15:30
    - Fill in the validation code in the ViewModel, and go back to the View to present the errors.
    - Validation of the CreateNewAccount form is complete, and checked in.
    - Study the Mac SDK.
    - Study .Net HTTP asynchronous communication.
    - Here is a great post on async HTTP: http://pfelix.wordpress.com/2011/08/05/wcf-web-api-handling-requests-asynchronously/
    - Microsoft has implemented WCF Web API to make HTTP a first-class citizen. Also called ASP.NET Web API.
    - Open source REST sample app: http://restbuckson.net/
    - JSON handler: http://blog.alexonasp.net/post/2011/07/26/Look-Ma-I-can-handle-JSONP-(aka-Cross-Domain-JSON)-with-WCF-Web-API-and-jQuery!.aspx
    - WCF Web API sample code: https://github.com/pmhsfelix/WcfWebApi.Preview5.Explorations
    - Another good post with lots of examples on WCF Web API: http://www.bizcoder.com/index.php/2012/01/09/httpclient-it-lives-and-it-is-glorious/
    - Silverlight and web sockets: http://www.codeproject.com/Articles/220350/Super-WebSockets-WCF-Silverlight-5
    - WebSocket framework under Apache license: http://superwebsocket.codeplex.com/
    - A project using superwebsocket: http://www.codeproject.com/Articles/220350/Super-WebSockets-WCF-Silverlight-5
    - An HTTP parser: https://github.com/bvanderveen/httpmachine
    - A JSONP handler: https://github.com/AlexZeitler/WebApi.JsonP
    - HTTP Strict Transport Security; install via NuGet.
    - RESTful HTTP Facilitator with examples cross-platform and cross-site: https://github.com/amirrajan/Restful
    - Fluent HTTP Async Cross-platform: https://github.com/prabirshrestha/FluentHttp/
    - Synchronous HttpWebRequest example: C:\Users\BobLaptop\Downloads\SilverlightSampleApp\RestSamples
    - More on WCF Web API with asynchronous example: http://mattduffield.wordpress.com/tag/wcf-web-api/
    - Codeplex for ASP.NET Web API: http://wcf.codeplex.com/wikipage?title=WCF%20Web%20API%20is%20now%20ASP.NET%20Web%20API
    - Home page for ASP.NET Web API: http://www.asp.net/web-api
    - HttpClient released, and with OAuth example: http://www.asp.net/web-api/samples
    - Async JSON sample: http://code.msdn.microsoft.com/Introduction-to-HttpClient-4a2d9cee
    - Using JSON.net sample: http://code.msdn.microsoft.com/Using-JSONNET-with-ASPNET-b2423706
    - Using OAUTH sample: http://code.msdn.microsoft.com/Extending-HttpClient-with-8739f267
    - Downloading a file sample: http://code.msdn.microsoft.com/HttpClient-Downloading-to-4cc138fd
  o (4/30/12) Mon:
    - 6:15 - 17:15
    - Porting the CLSettings modules.
    - Cocoa to WP7 mapping tool: http://wp7mapping.interoperabilitybridges.com/Library.aspx?filterpath=iPhone-iOS_4_2-Foundation-NSArray&source=[ALL]
    - Meeting (Gus, Steve, Mike, Phil):
      . Almost there with .2
      . Indexing architecture too slow compared to Google.
      . What's pending in Server?
      . What does it take to get to 0.2?
      . Workloads:
        o Account Management
          - AC
          - UA
          - OAUTH
        o Sync
          - MDS
          - PUSH
          - Upload/Download
      . Database (partitioned or global): A priority research item.
      . Discussion about buckets.  Do we ask user for preferred location?
    - Working on CLSettings….
    - EDUCATION: FAU HPCC & GPU Users Group, 6:30 - 8:30:
      . Machine learning.
      .  
  o (5/1/12) Tue:
    - 6:15 - 17:15
    - Working on CLSettings.  Everything's a research item!!!
    - CLSettings compiles now!
    - Working on the panel buttons for choosing the amount of storage (with Blend, without much success).       
  o (5/2/12) Wed:
    - 6:15 - 18:30
    - Use the standard buttons because Rion is redoing that screen.
    - I need to present a user dialog.  This can only be done by the view.  Research that.
    - A great dialog source: http://blog.roboblob.com/2010/01/19/modal-dialogs-with-mvvm-and-silverlight-4/
    - Installed Mountain Lion Dev Preview 3 and update, and XCode 4.4 update.
    - However, in contrast to the dialog above, the dialog should be in the view: http://compositewpf.codeplex.com/discussions/69088
    - I'll use a simple one from Laurent referenced on this page: http://mvvmlight.codeplex.com/discussions/209338
    - A simple examle of displaying a list via MVVM: http://www.windowsphonegeek.com/articles/Working-with-a-simple-ViewModelLocator-from-MVVM-Lite
    - I completed a 2.5 hour time-waster: A binding was failing.  I didn't look in the output window!   DUH!
    - I completed another 1 hour time-waster: The wrong button was being fired.  That was driving into the setter logic, and the debugging breaks were
      set to ignore all exceptions.  The setter logic was getting a FileNotFoundException trying to open the Cloud folder.  That drove into code that
      navigated to an unknown screen (not coded yet).
    - The SelectStorageSize dialog is being instantiated twice.  That causes messages to be subscribed twice, and displayed twice.  I fixed that.  The
      Navigation messages must be unique.
    - The _LocalSettings file must be created.  Not true.  The debugger was stopping on a first-chance exception.
    - I'm at a good point now.  The Settings work, and navigation works with the SelectSize dialog.  Commit this and push it.
    - Interview with a front-end JavaScript developer.
  o (5/3/12) Thu:
    - 7:30 - 19:00
    - Had to rework the whole CLSettings module to make proper properties that would persist properly.  That's working now.
    - Reworking modules to properly set focus, and to use NavigatedTo events to initialize the dialog properties. 
    - Finally fixed the SetupSelector code to handle radio buttons properly.
    - Description of selecting messages to receive: http://stackoverflow.com/questions/3393286/how-to-use-mvvm-light-with-tokens
    - RadioButtons and Converters: http://www.codeproject.com/Articles/81960/Binding-RadioButtons-to-an-Enum-in-Silverlight
    - Researched a candidate: Robert Banegas, an entrepraneur.
    - Stuck: XAML can't find a converter for the radio buttons.  I'm trying to select a particular radio button via an enumeration.
  o (5/4/12) Fri:
    - 8:00 - 18:45
    - Working on the converter issue.  Got past the hang-up over the not finding the converter resource.  It works.
    - Working on making the radio button hit size larger: http://stackoverflow.com/questions/7252927/increasing-the-hit-size-of-a-radio-button
    - Now the full-cover radio buttons work beautifully!  Submit this.
    - Working on fixing the SelectSetup dialog to use the new unselected mask and full area radio button hit area.
  o (5/5/12) Sat:
    - 7:45 - 15:30
    - Got the SetupSelector dialog working with the full-box radio button hit area, and the unselected full-box screen.  Beautiful!
    - Good article on parsing e-mail addresses: http://haacked.com/archive/2007/08/21/i-knew-how-to-validate-an-email-address-until-i.aspx
    - The UI works well.  I added the default enter button everywhere, and tabs work.  Pushed this Sunday morning.
  o (5/6/12) Sun:
    - 7:00 - 14:00
    - 17:00 - 20:30
    - The GUI is complete with all of the required patterns.
    - The next goal is to get this user registered with the server.  To do that I will need to add the HTTP support.  That should
      be added in an SDK with a proper API. That should just be a class library, but I read somewhere that standard class libraries
      are not supported in Silverlight???  That would be bad.  This API needs to be used by any application.  Research this.
    - Class library requirements: http://forums.silverlight.net/p/168532/379808.aspx.
    - Basically, I have to have two class library projects.  One Silverlight, and the other a full .Net library.  The Silverlight
      library must use only Silverlight references.  The full library will use the normal .Net references.  If a particular
      module has no dependencies on one or another, it can be defined in one library and referenced in the other using "Add as Link".
    - I should make the class library as a Silverlight class library, and reference it from the Silverlight application.  A .Net
      application can reference this library, but not the other way around: http://stackoverflow.com/questions/465460/sharing-c-sharp-code-between-windows-and-silverlight-class-libraries
    - Here's how one guy targets multiple platforms (old): http://abdullin.com/journal/2009/1/4/how-to-target-multiple-net-frameworks.html  
    - Portable Class Libraries might be better: http://msdn.microsoft.com/en-us/library/gg597391.aspx
    - Here's an old MSDN Mag Retargetablility article: http://msdn.microsoft.com/en-us/magazine/cc163387.aspx
    - A walk-through of building a Silverlight Class Library: http://stuff.seans.com/2010/06/04/silverlight-4-project-types-part-iii-silverlight-class-library/
    - I found the Async CTP!  This allows asynchronous programming.  It changes the VS compilers: http://msdn.microsoft.com/en-us/vstudio/hh378091
    - HttpClient is part of the Metro API (adds PATCH support): http://www.silverlightshow.net/news/Windows-8-Patch-Support-in-HttpClient.aspx
    - I'm trying to find out whether I can use HttpClient on Silverlight....
    - It is available via NuGet: http://blogs.msdn.com/b/henrikn/archive/2012/02/20/asp-net-web-api-and-httpclient-available-on-nuget.aspx
    - File download with HttpClient example: http://www.sharpgis.net/category/Silverlight.aspx
    - I installed Async CTP into Visual Studio.
    - .Net OS support: http://msdn.microsoft.com/en-us/library/8z6watww.aspx
    - Silverlight future: http://www.zdnet.com/blog/microsoft/will-there-be-a-silverlight-6-and-does-it-matter/11180
    - Silverlight installation experience white paper: http://www.microsoft.com/en-us/download/details.aspx?id=15072&hash=7GpYSVQUaeaFdAgl56C%2b8QJKzKK9XRlcc5cl9dNuKTh3j5Qd6odj%2beDLLG5sDUNeXm6OhLixvqu85uh4TJ9irw%3d%3d
    - Silverlight works back to XP: http://forums.silverlight.net/t/252601.aspx/1
    - Request for HttpClient on Silverlight: http://wcf.codeplex.com/workitem/21
    - I installed HttpHelper into the project: http://mattduffield.wordpress.com/tag/wcf-web-api/
    - Another link: https://github.com/facebook-csharp-sdk/http-helper
    - I wanted in the worst way to use the new HttpClient support in Asp.Net Web API.  It isn't supported.  It is supported in .Net, and in Metro, but not in SL5.
      I could write it in a .Net library and use P/Invoke to get to it, but I decided against that.  I will use the HttpWebRequest API which is supported in
      .Net and SL, but not in Metro.  :(
    - Use one of the HTTP helper classes, and use async calls.
    - I will build a Silverlight Class Library.  We can port this to other platforms, possibly converting it to a Portable Class Library.  I won't take the time
      to build a portable library now.
    - Setting up a Silverlight full-trust application: http://silverlightedweb.blogspot.com/2011/12/how-to-get-unrestricted-access-in.html
    - I'm adding strings.  Localization: http://www.pochet.net/blog/2010/06/10/localization-of-xaml-files-in-silverlight/
      . And here: http://msdn.microsoft.com/en-us/library/dd941931(v=vs.95).aspx
      . Install this resource generator: http://www.pochet.net/blog/2010/06/07/code-generators-for-generating-strongly-typed-resource-classes-for-visual-studio-2010/
      . It remains to specify the resources so they can be accessed via XAML, but they should now be accessible via code.
      . How do I do that?  Tomorrow...
  o (5/7/12) Mon:
    - 6:15 - 19:15
    - Coding the next portions of the user interface, dealing with merging the cloud folder.
    - Completed the setup of localization and inserted the first message!
    - Decided I need to have more complex dialogs.  I found this: http://blog.roboblob.com/2010/01/19/modal-dialogs-with-mvvm-and-silverlight-4/
    - I need to display a nice looking dialog with an image icon, multiple lines of text with different fonts, a caption, and multiple buttons with different styles.  Try using the above post to create that.
    - The dialog works!  And it can be wired from the ViewModel, although that is probably a bad thing: http://compositewpf.codeplex.com/discussions/69088
    - However, wiring dialogs from the ViewModel is what the Mac client does, and it makes porting a lot easier.
    - Now lets see if I can make a decent looking dialog with and image, different text, etc.
    - Great JetPack themes for Silverlight: http://www.microsoft.com/en-us/download/details.aspx?id=14590
    - Also: http://www.silverlight.net/content/samples/sl4/themes/jetpack.html
    - Great example of how to bind Title= on a page to a DependencyProperty: http://stackoverflow.com/questions/2662938/ag-e-parser-bad-property-value-silverlight-binding-page-title
    - The new dialog works great!
    - A different approach to localization: http://stackoverflow.com/questions/3665823/load-resources-resx-from-folder-in-silverlight
    - Working on a problem reading the strings from resource.resx.
  o (5/8/12) Tue:
    - 6:15 - 18:45
    - I reworked the custom message box dialog for spacing, and reworked the buttons to be rectangles.  It works better now.  I can control everything I need I think.
    - Time-waster:  I need to install Async CTP into Visual Studio, but I can't because I have the Ultimate version installed, and Citrix removed that installation image from Apps.
    - I uninstalled VS2010 Ultimate, and reinstalled VS2010 Team SystePremium Edition.
    - I also installed VS SP1, updates, Async CTP, and the localization custom build utility.
    - Big time-waster.  About 4 hours.
    - While that was happening, I studied XAML, and watched a really interesting video about Convention over Configuration, and Co-Routines.  This is a great
      app architecture, and I wish I had started with that architecture.  It would make the code much simpler.  However, I have all of the patterns in place, so I will continue...
      . http://channel9.msdn.com/events/MIX/MIX10/EX15
      . www.caliburnproject.org
      . www.bluespire.com
      . devlicio.us/blogs/rob_eisenberg
    - I got the localization strings working.  Now I can proceed.
    - Another big time-waster.  After installing the new VS environment, my new dialog is throwing an exception trying to load it.  I built the MvvmLight
      framework from source, and I am debugging it.  I don't know if it is environmental, or something I changed...  It doesn't seem like it is the XAML.  Blend loads it fine.
      MvvmLight is saying that the IOC can't find the type in the cache.  It registers it fine.  Some kind of recursion?  It looks like the goForward code calls
      the IOC.getInstance.  That resolves fine and calls the EditUserModalDialogView() constructor.  That calls InitializeComponent, which loads the XAML.  The XAML loader
      somehow results in a recursive call to IOC.getInstance.  That doesn't hit the breakpoint in the ViewModelLocator.EditUserModalDialogView property, but results in
      an exception that points to the GetInstance call in that property's get function as the culprit!   ?????   That's fixed.  Only about an hour....  It was my
      fault.  I had added some code to fix several compiler warnings in the EditUserModalDialogView code-behind.  I had tried removing those changes, but apparently
      I didn't remove them correctly.  Restoring the code from a backup fixed the problem.
    - Now there are several problems in the dialog.  A long text string isn't properly wrapped in the body.  The separator is showing to the right of center, and the
      buttons are too much to the left.  For the buttons, instead of the StackPanel, I should put them in a 4-column grid.  The first column will be fixed (empty) with
      30 points.  The 2nd and 4th columns will have the buttons (Auto).  The 3rd column will be empty with "*" sizing.
    - Finally!  It all works!  And it looks very good.  Time to move on...
    - Silverlight has toast notification suupport: http://timheuer.com/blog/archive/2009/11/22/silverlight-4-notification-window-queue-sample.aspx
    - Dispatcher BeginInvoke example: http://stackoverflow.com/questions/9321684/cannot-update-silverlight-ui-from-asynchronous-method-completed-callback
    - I researched the issue of notifications back to the same class, queued vs. immediate.  I can use MvvmLight's DispatcherHelper and SL5 Tasks.
    - Interesting: The Mac client displays a folder selection dialog that looks like mac\SavedSource\ChooseAPlaceToStoreYourCloudFiles.tiff.  That is a folder
      chooser dialog that allows a big long message at the top.  I guess that's a Mac thing.  Does Windows have something like that?  Yes it does.  It's the
      FolderBrowserDialog.
    - Silverlight 5 trusted apps and file system access: http://msdn.microsoft.com/en-us/library/ee721083(v=vs.95).aspx
    - Silverlight 5 sample file explorer: http://www.c-sharpcorner.com/uploadfile/dbd951/sample-of-a-file-explorer-using-silverlight-5/
    - Ouch!  It seems that the SL5 OpenFileDialog can select files, but not folders!!!!  Do I have to make my own????
    - It is possible to use PInvoke to run the standard Windows folder selection dialog, but that might appear ugly.
    - Silverlight TreeView example: http://amjadsilverlight.wordpress.com/author/amjadsilverlight/
    - PInvoke examples: http://www.gamedev.net/page/resources/_/technical/general-programming/inter-process-communication-ipc-introduction-r2865
    - I will need to write a COM program, or an ActiveX DLL to host a WPF program that can extend Silverlight functionality where needed.  FolderBrowserDialog
      will be the first function added.
  o (5/9/12) Wed:
    - 6:15 - 18:45
    - For now, just build a new folder location dialog without the folder explorer.
    - I may need to establish some parameters for launching a View-ViewModel.  Apparently Silverlight uses Query Strings for passing page arguments,
      just like HTML.  See: http://www.informit.com/articles/article.aspx?p=1854714&seqNum=3
    - Another MVVM package: Jounce: http://www.wintellect.com/cs/blogs/jlikness/archive/tags/Jounce/default.aspx
    - One way to pass parameters: http://geoffwebbercross.blogspot.com/2012/04/mvvm-light-passing-params-to-target.html
    - Another way: http://geoffwebbercross.blogspot.com/2012/04/mvvm-light-passing-params-to-target_12.html
    - Watch Laurent's Deep Dive into MVVM again: http://channel9.msdn.com/Events/MIX/MIX11/OPN03
    - Here is a walk through of passing parameters via navigation: http://hirenkhirsaria.blogspot.com/2012_04_01_archive.html  
    - Unregistering message subscription in ViewModel: http://stackoverflow.com/questions/7036873/when-to-dispose-viewmodel-in-mvvm-light
    - More on unregistering message subscription: http://mvvmlight.codeplex.com/discussions/259098
    - An ActiveX control exposing a WIndows Forms user control, which hosts a WPF user control: http://documentation.microfocus.com/help/index.jsp?topic=%2Fcom.microfocus.eclipse.infocenter.studee60win.sp02ws01%2FGUID-0BBFFEEB-4DC6-4B5F-AFC5-6A211E826D42.html     
    - Also WPF can, in turn, host other ActiveX controls: http://msdn.microsoft.com/en-us/library/ms742735.aspx 
    - Maybe we don't need WPF, since the view will just show the standard Windows Forms folder selection dialog.
    - Windows Forms is used with WPF to show a folder selector here: http://syumulnetwork.blogspot.com/2011/09/myth-self-note-5-c-wpf.html
    - I ran into a bug with the FolderSelectionSimpleView.  I implemented it as a dialog, but SimpleIoc was locating the original dialog, not this new one.
      I inspected the MvvmLight IOC source code, and his unit test showed me the proper way to register multiple classes, all implementing the
      same IModalWindow interface.
    - Now the FolderSelectionSimpleView/ViewModel works and looks great!
    - Time to move on...
    - The next thing will be to actually perform the installation.  The Mac client uses an application delegate like this:
          CLAppDelegate *delegate = [NSApp delegate];
          NSError *error = [delegate installCloudServices];
    - I should do the same thing.  Create a singleton class with methods that perform and support installation.
    - The CLAppDelegate singleton skeleton is coded and it works.
    - The installCloudServices method returns an NSError object.  This error object encapsulates rich information about the error.
      It seems I need a similar pattern in Windows.  I will just make one.  NSError has I will make one with the following members:
      . (string) Error domain
      . (int) Error code
      . (string) String resource key used to retrieve the localized error string from the assembly resources.
      . (Dictionary<string, object>) Error information.
      . Call this class CLError.
    - While coding the installation, I realized I need a nice logging class.  Research...
    - Trace works now.  It logs to date-time named files in C:\Trash\Trace.  It also logs to the VS Output window.
    - Now I have to implement a call like the following:
            [self performSelector:@selector(startCloudAppServicesAndUI) withObject:nil afterDelay:2];
    - The caller is running on the main thread, called from SetupSelectorViewModel.  The target method should execute
      on the main thread after a delay of two seconds.
    - An interesting implementation of delayed BeginInvoke: http://blog.codethaumaturgy.com/tag/silverlight/
    - Another approach using timer: http://stackoverflow.com/questions/8094307/creating-a-delay-on-silverlight
    - Discussion of late-bound dynamic invocation: http://www.dotnetfunda.com/articles/article1428-invoking-of-delegates-in-net-part-ii.aspx
    - Delayed execution using TPL: http://www.codeproject.com/Articles/194249/Task-Parallel-Library-6-of-n
    - I decided to build a task-based extension to Dispatcher that would produce code similar to the Cocoa code:
                   Dispatcher.DelayedInvoke(TimeSpan.FromMilliseconds, () => { doStuff(); }));
  o (5/10/12) Thu:
    - 6:15 - 18:45
    - Another time-waster (1.5 hours).  My Dispatcher extension method wouldn't compile.  Finally solved it.  I had to write it like this:
                   Deployment.Current.Dispatcher.DelayedInvoke(TimeSpan.FromMilliseconds, () => { doStuff(); }));
    - The NSError equivalent (CLError) is working now.
    - The Cloud folder creation is coded.
    - The detection of multiple instances is coded.
    - I purchased Automagical (the Objective C to C# conversion utility) on the P-card.  I spent about 1.5 hours on it, and can't get
      it to do the simplest conversion.  I have asked for technical support.
    - The tour dialogs are complete.
    - Fixed a build bug on the Mac client.  The SenTestingKit.h file was not found.  This broke when I installed the new XCode release 4.4??
    - Reviewed the Mac client IconBadge changes and reran the unit tests.  There were a number of mostly refactoring changes that need
      to be pushed.  I committed the changes locally.  They are ready to push, but I don't want to do that while everyone is in CA.
    - I designed the tour to be five views.  They will all use the same ViewModel.  How should the ViewModel control the Views?  It should be
      really simple.  The ViewModel will have a PageNumber property.  The Tour1 view will be the initial navigated-to page.  Its buttons
      will be wired to commands in the ViewModel, and all other tour views will have their buttons wired to the same commands.  The
      ViewModel will take the commands, inspect and modify the PageNumber property, and will navigate to the proper tour page.  At the
      end of the tour, the UI will be done.
    - How do I remove the view entirely when the tour is over?  I think I just navigate to a null page.  That would be a navigation:Page
      with an invisible content.  Test that.  It doesn't work.  It shows as a normal window with a white background.
    - But that's not what I want anyway.  An invisible application is no good.  It can't be controlled, and it appears in the
      taskbar.  It needs to minimize itself to the system tray with a menu, status and toasts.  I already researched that above.
      Search for "minimize".
    - Minimizing an application to the system tray: http://www.codeproject.com/Articles/27599/Minimize-window-to-system-tray
    - Researching that again.  I might have to resort to WPF!   :(  Silverlight is a risk item, but if it is possible, it
      would keep our executable small, and it would mostly work on WP7, Metro, and WP8.
    - I downloaded the Silverlight NESL open source project source code.  That supports minimizing to the system tray.
  o (5/11/12) Fri:
    - 6:15 - 18:45
    - I decided to switch to WPF.  Silverlight is good, but it has issues, and may have more.  I should be able to
      overcome the issues, but WPF is a standard Windows app, so I should be able to do anything.  The major Silverlight
      issues are:
      . Right-click anywhere on the window brings up a Silverlight context menu.
      . No direct support for minimizing to the system tray.
      . No support of a folder selection dialog.
    - Will switching back to Silverlight be difficult?
      . MvvmLight supports WPF and Silverlight.
      . All of the UI, notification, and validation patterns have been developed on Silverlight.  Keeping those patterns
        should allow easy conversion back to Silverlight.
      . The sync engine should be straight C# code, applicable to either.
    - I will change the directory structure to support building in either.  Almost all of the code will be in a common
      directory, using preprocessor instructions to build differently for each platform.
    - Test the existing UI first, commit and push, then start working on WPF.
      . Continue command -> new or merge dialog
      . I said select a new location -> enter new location dialog
      . I selected C:\Users\robertste\test and clicked continue -> sent conflict resolved message
      . That issues a recursive call to goForward
      . Use a delayed method call here.
      . This delayed method call will need a parameter (the dictionary).  That is new.  Build it and test it.
      . I'm having trouble compiling the delegate.  This seems to be the answer: http://stackoverflow.com/questions/968709/anonymous-methods-and-delegates
      . And more delegates: http://msdn.microsoft.com/en-us/library/ms173176.aspx
      . That fixed it.
    - Started the WPF conversion.  I copied the Silverlight directory to win-client20120511SilverlightFinal.  Then I made a WPF project called
      win-client in the original win-client directory, and added all of the existing code to the project.  It fails immediately on XAML navigation:frame.
      Apparently the navigation is different between Silverlight and WPF.  WPF uses NavigationWindow.  Research that.
    - WPF/Silverlight differences: http://msdn.microsoft.com/en-us/library/cc903925(VS.95).aspx
    - Apparently WPF doesn't implement iNotificationDataErrorInfo.  That causes my Silverlight validation to break (compilation).
    - Interesting cross WPF/Silverlight Validation Toolkit: http://validationtoolkit.codeplex.com/ Problem: GNU GPLv2 license.
    - 
    - WPF Change list:
      . The main App.xaml and App.xaml.cs are different, and just a stub.
      . App.xaml points to NavigationPage.xaml.
      . NavigationPage.xaml loads MainPage.xaml.
      . "navigation:Page"a in all of the top level navigation pages changes to "Page".
      . In XAML, change ValidatesOnNotifyDataErrors to ValidatesOnDataErrors.
  o (5/12/12) Sat:
    - 9:00 - 14:00
    - 16:00 - 17:00
    - Interesting Validation toolkit: http://fluentvalidation.codeplex.com/wikipage?title=CreatingAValidator&referringTitle=Documentation
    - Implementing INotifyDataErrorInfo.  This works in Silverlight, but is missing in WPF.
    - Another validation toolkit.  This one has an error template that we could override: http://www.codeproject.com/Articles/32814/Total-View-Validation
    - Navigation in WPF: http://msdn.microsoft.com/en-us/library/ms750478.aspx
    - One good way to navigate in WPF: http://stackoverflow.com/questions/9290269/mvvm-light-toolkit-galasoft-for-wpf-navigation-through-windows
    - I will use the method above to navigate.
    - Another (strange?) way to do navigation in WPF: http://www.lapthorn.net/archives/600
    - I have the INotifyDataErrorInfo validation mostly compiling OK.
    - I ran into another problem: Navigation in WPF is quite different than Silverlight.
    - I have a compilation error.  The OnNavigatedTo and OnNavigatedFrom events aren't supported.
    - A Page (view) has a NavigationService.  A NavigationService supports the Navigated event.  The Navigated event handler gets event args:
      . Content: Root node of the target page's content.
      . ExtraData: Optional user defined data.
      . IsNavigationInitiator: Did the current navigator initiate the navigation?
      . Uri: Target page.
      . WebResponse: Can be used to retrieve HTTP response headers.
      . Documented here: http://www.lapthorn.net/archives/600
    - None of this looks pertinent.
    - I think I can just use the NavigationService.Navigated event, and not worry about the event args.
    - However, Silverlight doesn't use a NavigationService, so I will need to retrieve that at page load time???
    - I got the OnNavigatedTo event handler coded and built.
  o (5/13/12) Sun:
    - 6:30 - 14:00
    - 15:00 - 16:30
    - IsolatedStorageSettings is a Silverlight thing.  It is not supported in WPF.  Researching Settings in a WPF application environment.
    - Implemented IsolatedStorageSettings for WPF.  CLSettings builds now.
    - There are issues with the PasswordBox control in WPF.  Silverlight treats that as a DependencyProperty, so it can be bound to, and the
      password is in the clear to the code.  This makes validation easy because the validator can look at the actual text and determine whether
      it meets the password strength required, etc.  Researching this...
    - Creating an attached property for PasswordBox: http://blog.functionalfun.net/2008/06/wpf-passwordbox-and-data-binding.html
    - I think there are two problems here:
      . The Password field is not a DependencyProperty, and so is not bindable for validation, etc.  The code above should help with that.
      . In ForceValidation(), I use GetBindingExpression(PasswordBox.PasswordProperty) for the Silverlight PasswordProperty DependencyProperty.
        Then I locate the parent of that binding expression with bindingEpression.ParentBinding.  Then I check to see if that element
        has specified ValidatesOnNotifyDataErrors (which also needs to be changed to ValidatesOnDataErrors).  The problem is: The PasswordBox
        control doesn't have a PasswordProperty, and the code above won't help that.  Also, the code above does not add a binding expression
        to the PasswordBox.Password property, so there is no binding expression to find!  There must be a solution to this.  Research....
    - Another guy using the above code: http://stackoverflow.com/questions/2999779/data-validation-on-wpf-passwordboxtype-password-re-type-password
    - Another guy using the above code as well: http://stackoverflow.com/questions/8942259/error-handling-in-wpf-passwordbox
    - Here is a derivation of the above code: http://www.wpftutorial.net/PasswordBox.html
    - This might be the solution.  It is a bindable password custom control that is implemented as a Decorator of PasswordBox: https://gist.github.com/468331
    - Try that solution.  It is coded and it builds.  Hopefully that will work.
    - Didn't work.  The trouble with this Decorator solution is that it doesn't expose all of the other properties and DependencyProperties of PasswordBox, because
      it is derived from Decorator.  I might be able to make it work by adding all of the other PasswordBox properties, but that seems like a lot
      of work, and it would be fragile.
    - Some detailed info about bindings: http://www.hardcodet.net/2008/04/wpf-custom-binding-class
    - This adds a DependencyProperty to a control: http://stackoverflow.com/questions/1088906/adding-a-custom-dependency-property-to-a-control-template-in-xaml
    - Good tutorial on DependencyProperties and AttachedProperties: http://www.wpftutorial.net/dependencyproperties.html
    - Overriding a DependencyProperty: http://stackoverflow.com/questions/9319328/hiding-a-dependency-property
    - In the case of the WPF PasswordBox Password property, it is defined as a property, but not as a DependencyProperty.  I would like to turn
      it into a DependencyProperty.  It seems that I need to add the DP because it doesn't already exist, but I need to access the existing
      Password property in the new DP getters and setters.  Try that.
    - My first try at that didn't work, because I couldn't derive from PasswordBox.  It is a sealed class!!!!  ARRRGGGHHH!
    - I found a completely different secure password approach deriving from an UN-sealed TextBox and it worked: http://www.codeproject.com/Articles/30976/Passwords-in-WPF-How-to-find-yours-and-how-to-prev
    - Down to 24 errors.  Fixing navigation will remove most of those.  On to navigation...
    - With MVVM, the ViewModel is not supposed to actually navigate, because that would imply knowledge of the views.  Instead, the ViewModel
      sends a messasge to the View, and the View actually navigages.  That is the way it is implemented for Silverlight.  A navigation message
      handler in the View currently looks like this:
                Messenger.Default.Register<Uri>(this, "PageSelectStorageSize_NavigationRequest",
                                   (uri) => ((Frame)(Application.Current.RootVisual as MainPage).FindName("ContentFrame")).Navigate(uri));
    - I have already changed the views to locate the NavigationService (above).  The navigation service supports the NavigateTo() method:
                NavigateTo(new Uri(@"/PageXXX",UriKind.Relative)); 
    - I will just change the navigation to use this syntax.  The new syntax is this:
                Messenger.Default.Register<Uri>(this, "PageSelectStorageSize_NavigationRequest",
                                   (uri) => { this.NavigationService.Navigate(uri); });
    - Done.  Now down to 6 errors.
    - The last? build problem is the inability of the code-behind to see the named common:SecurePasswordBox 
    - WPF Snoop tool: http://blois.us/Snoop/
    - It builds!
  0 5/14/12 Mon:
    - 8:30 - 18:30
    - Debugging the WPF application.
    - Trip to the Boca Raton Apple store, and lunch at 5 Guys.
    - Interviewed David Bruck.  We hired him as contract-to-hire.
    - The home page shows, and I can navigate to the CreateAccount page, but I am debugging an exception in the MvvmLight command code when I try to navigate back to the home page.
  0 5/15/12 Tue:
    - 6:15 - 18:30
    - I solved that bug.  It was an invalid cast first-chance exception that was resulting in a different exception way down in the framework code.
    - Possible solution to the current validation problem:  http://stackoverflow.com/questions/127477/detecting-wpf-validation-errors
    - Validation in WPF tutorial: http://blogs.msdn.com/b/bethmassi/archive/2008/06/27/displaying-data-validation-messages-in-wpf.aspx
    - I finally fixed the validation.  I had to implement IDataErrorInfo.  The ValidationToolkit should be deleted, except for the errorTemplate.  We will
      need to rework even that!
    - I ran into another problem with the pesky secure password fields.  The binding was passing the encrypted passwords to the ViewModel.  That
      didn't validate.  I changed the design to use the password field Set function to send a message to the view, which retrieved the clear password
      and set it to a write-only ViewModel property Password2.  Since all of that was synchronous, the validation is now performed on Password2 in the
      same Password setter.
    - Now the next problem....  The dialogs don't work.  Surprise!
    - This is the same problem as before?  The SimpleIOC lookup fails and throws an exception.  I tried looking for the type IModalWindow with the proper key.
      That located the service, but it also caused a recursion trying to instantiate an instance of the target modal dialog view.
    - Tomorrow....
  0 5/16/12 Wed:
    - 6:30 - 17:30
    - Interestin very simple IOC built from scratch: http://www.remondo.net/building-simple-ioc-container-csharp/
    - Current bug: SimpleIOC isn't working properly to get the CloudMessageBoxView instance.
      . In DoGetService, the instance doesn't exist yet in _instancesRegistry.
      . The service type (Dialog.Abstractions.Wpf.Intefaces.IModalWindow) is found in _interfaceToClassMap.
      . So we build a new empty dictionary and add the dictionary to the _instancesRegistry using the service type key above.
      . We look to see if the dictionary (instances) contains the parm key ("dialog_box_CloudMessageBoxView").  If so, we would return that instance.  It doesn't exist yet.
      . So we go about building an instance.
      . We look to see if _factories contains our service type.  It does.
      . In the factory for our service type, we look to see if it contains our parm key.  It does.
      . So we do this:
                instance = _factories[serviceType][key].DynamicInvoke(null);
      . That results in an extended recursion on the view constructor and usually crashes VS.
      . I found the problem.  The dialog views were constructing themselves as the DataContext, not the ViewModels.
    - Next problem:  The dialog does not appear over the SetupSelector view.  The dialogs are created by the Extended WPF Toolkit: http://wpftoolkit.codeplex.com/SourceControl/list/changesets
    - I downloaded the WpfToolkit source, built it, and I am debugging to find the solution.
    - David Bruck joined us today.  I spent some time with him, building his machine and explaining the project.  He will start with a badging demo.
    - Styled pop-up control hosted in a UserControl: http://rachel53461.wordpress.com/2011/08/20/popup-panel-for-wpf/
    - Another modal UserControl: http://lexa.tatalata.com/?p=305
    - Data binding using ViewSources: http://code.msdn.microsoft.com/windowsdesktop/Wpf-ViewSource-Example-on-210f2cd2  
    - Tool to inspect visual and logical trees: http://www.codeproject.com/Articles/21495/Understanding-the-Visual-Tree-and-Logical-Tree-in
    - Still working on the dialog.  It seems that they don't work because they haven't been added to the element tree.  I'm modifying the Extended WPF Toolkit and
      the dialog support to pass the Page's LayoutRoot grid as the parent container for the dialog.  I should finish that in the morning.  I hope it works.
  0 5/17/12 Thu:
    - 6:15 - 17:45
    - EDUCATION: GCUG Guest Suites, Boca, 6:30 - 8:30: Using Windows 8 HyperV to spin up and actively move VM resources.  Amazing!
    - The dialogs are working now.  WPF was laying them out in the first row of the grid only, and the layout was somehow painting just a slice down the left.  David helped me
      see that and we stretched the dialog out over all of the row and column definitions of the grid.
    - Now the first dialog paints a dotted rectangle in the upper left corner, same size as the dialog.
    - Now I am fighting with a failure to navigate (SetupSelector navigating to PageTour1 after showing a couple of dialogs).
    - I know what the bug is.  The general dialog box is used multiple times without being disposed.  Each time it adds a Closed callback, so the OnClosed event
      is driven multiple times, and the ViewModel attempts to navigate twice.  But how to fix it?  Tomorrow....
  0 5/18/12 Fri:
    - 6:15 - 18:45
    - One-shot lambda event handler: http://stackoverflow.com/questions/2150581/one-shot-events-using-lambda-in-c-sharp
    - I fixed that "navigation twice" bug.  I used the one-shot lambda approach above.  Showing the dialog adds a Closed event handler.  When the Closed event handler
      fires, it does its job, and then removes itself from the RoutedEvent chain.
    - Now work on the next bug.  The first dialog displays a dotted line the same size as the dialog, but in the upper left corner of the window.  This must
      be a bug in WPF?  It seems that it is the default "focus" indicator.  Perhaps it wouldn't show if I give something else the focus?  Like the containing grid?
      That was David's suggestion.  Try it.  I tried it before the Show.  That didn't work.  Perhaps in the ChildWindow?  I tried it after setting the WindowState to Open.
      That didn't work.
    - XAML tutorial: http://www.wpftutorial.net/XAML.html
    - I spent about 6 hours on this problem, trying to get DependencyProperties to fire correctly.  I can't get it to work.  I used a simple workaround: Set the
      actual FocusedElement property to point to btnOK in the code-behind.  That works now.  The right button now has the dotted line around it, and the
      big ugly dotted line is gone.  Yay!
    - I spent some time making the dialogs size properly with a minimum width and height so the fields are always visible.
  0 5/19/12 Sat:
    - 7:00 - 15:00
    - Assembly info: http://srikanthtechnologies.com/articles/dotnet/globalassembly.html
    - I made another pass over the dialog layout.  They look good now.
    - Pushed the changes, in two batches.
    - I researched the question of how to implement the API (managed or unmanaged).  I came to the conclusion that ours is a brand new API with no users
      out there.  If they want to write in C++, they can use the new managed C++ compiler and access our API directly.
      see: http://msdn.microsoft.com/en-us/library/ms973872.aspx.
    - Design guidelines for class library developers: http://msdn.microsoft.com/en-us/library/ms229042
    - Implement Finalize and Dispose to clean up unmanaged resources: http://msdn.microsoft.com/en-us/library/b1yfkh5e
    - I read through the design guidelines for class libaries.  I decided to implement only asynchronous interfaces for lengthy operations.
      That will keep it compatible with Silverlight apps.  I will use the delegate callback pattern.
    - Errors will be delivered by exceptions bubbling up the stack.  This is the recommended way for frameworks.
    - Delegate callback example: http://www.myelin.co.nz/notes/callbacks/cs-delegates.html
    - Async Programming Model (APM) "Guy on a horse": http://social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/faa5da25-f50c-4a87-b1e8-ed7a6ec8cd71
    - Here is one way using TPL to capture the async exception and the async result: http://stackoverflow.com/questions/8748645/catching-an-exception-thrown-in-an-asynchronous-callback
    - I think we should drive the callback on the UI thread.  Our callback (after the async operation) will be on a worker thread, so I will use Dispatcher.Current.BeginInvoke()
      to drive the API-caller's callback on the UI thread, with the result code, and possible exception info.  That should work.
  0 5/20/12 Sun:
    - 9:30 - 16:30
    - Exceptions in Tasks: http://msdn.microsoft.com/en-us/library/dd997415.aspx
    - How to return an arbitrary object result from an asyncrhonous task: http://msdn.microsoft.com/en-us/library/dd537613.aspx
    - Chaining continuation tasks: http://msdn.microsoft.com/en-us/library/dd537612.aspx
    - Class library localization: http://stackoverflow.com/questions/1138934/c-sharp-class-library-localization.
    - I determined the asynchronous pattern we will use (see it in CLApiRegistration).  It provides for asynchronous tasks that return
      an arbitrary result object (perhaps just an int) and a potential exception object that may have been generated by the asynchronous task.
    - CLApiDevice and CLApiAccount are coded.
    - Research HttpClient again.  The support for that class is one of the major reasons I switch to WPF.
    - Here is an introduction: http://code.msdn.microsoft.com/Introduction-to-HttpClient-4a2d9cee
    - HttpClient requires the following NuGet packages to be installed in the project:
      . System.Net.Http: The main NuGet package providing the basic HttpClient and related classes
      . System.Net.Http.Formatting: Adds support for serialization, deserialization as well as for many additional features building on top of System.Net.Http
      . System.Json: Adds support for JsonVaue which is a mechanism for reading and manipulating JSON documents
      . I installed those on my home laptop.
    - HttpClient by example: http://alexmg.com/post/2009/04/07/Introduction-to-the-HttpClient.aspx
    - More HttpClient by example: http://www.bizcoder.com/index.php/2012/01/09/httpclient-it-lives-and-it-is-glorious/
    - It is possible to build up HttpContent post data like this:
                var postData = new List<KeyValuePair<string, string>>(); 
                postData.Add(new KeyValuePair<string, string>("Name", "test")); 
                postData.Add(new KeyValuePair<string, string>("Price ", "100")); 
                HttpContent content = new FormUrlEncodedContent(postData); 
    - Example of using a CancellationToken: http://stackoverflow.com/questions/4783865/how-do-i-abort-cancel-tpl-tasks
    - I'm researching ways to use the CancelationToken to allow the user of an API to specify a timeout for a particular
      operation.
    - Do it like this: var cancelTokenSource = new CancellationTokenSource(TimeSpan.FromSeconds(3)).
    - See http://www.sadev.co.za/content/net-45-baby-steps-part-2-task-timeout-cancellation
    - Change the API to allow the user to specify a timeout in seconds.
    - This function requires .Net 4.5.  Why not?  It will be released by the time we go out.
    - I installed .Net 4.5 on my home laptop.
    - For some reason, only the default CancellationTokenSource() constructor is available in .Net 4.5, even though the web
      docs say it should be there.  That was a small time-waster.
  0 5/21/12 Mon:
    - 6:15 - 18:00
    - Installed .Net 4.5 at work.
    - Installed the HttpClient NuGet packages.
    - Worked on very slow Mac performance.  Had to reboot the system.  The memory was very low.
    - Installed the Newtonsoft JSON library NuGet package on my work machine.  It uses the MIT license.
    - The server registration code is at code complete.  Time to test it...
    - processRegistration is the function that should communicate with the server to register the user.  Presently, the Windows code
      just moves on to select the storage size.  Change that to register with the server.
    - I worked with David to try to create a global IsBusy progress bar, the one shipped with the Extended WPF Toolkit.  We weren't
      successful doing that, so I will just add it to the pages that need to use it, and wrap all of the existing content on the page
      with the busy indicator control.  That's done.
    - Part of the global busy indicator trial was to create a global ViewModel and View.  The View was in NavigationWindow.xaml, and
      the ViewModel was in the App.Xaml resources.  Those resources load with the application and the properties in the ViewModel
      can be referenced in other code like this:
                  BusyIndicatorModel myBusyIndicatorModel = (BusyIndicatorModel)Application.Current.Resources["BusyIndicatorModel"];
    - The rest of the day I was coding the user registration.  Not quite complete.
  0 5/22/12 Tue:
    - 6:15 - 19:00
    - I found that I need the snazzy message box dialog to display only the OK button, so I will add a binding on the left
      button to make it visible or not.  Done.
    - I was successful at registering a user, but I am still trying to parse the JSON response using JSON.net.
  0 5/23/12 Wed:
    - 6:15 - 18:30
    - Deserializing JSON to a hierarchical Dictionary<string, object>: http://stackoverflow.com/questions/1207731/how-can-i-deserialize-json-to-a-simple-dictionarystring-string-in-asp-net
    - Using Linq with JSON: http://stackoverflow.com/questions/5033178/net-linq-to-json-with-newtonsoft-json-library
    - Registration works properly!
    - The first tour page now properly presents the user's first name in the greeting.
    - Removed duplicate resource manager code from CLAppDelegate.cs.
    - Startup with dynamic StartupUri choice: http://stackoverflow.com/questions/3439320/is-there-a-way-to-start-a-wpf-application-without-startupuri-that-doesnt-break
    - Another dynamic StartupUri choice: http://stackoverflow.com/questions/1945843/how-to-change-startupuri-of-wpf-application
    - Determine the number of app instances per user: http://benjsoft.blogspot.com/2011/01/c-ensure-that-single-instance-of-your.html#!/2011/01/c-ensure-that-single-instance-of-your.html
    - The test for "Cloud app already running for this user" is working.  It puts up a dialog with an OK button if the application is already running.
    - Next goal: Get isFirstTimeSetupNeeded() working.  If it is needed, put up the welcome dialog that is already working.  If not, don't put up any dialog at all.
    - Time-waster: 0.5 hour.  I saw the C:\Users cloud directory again.  I couldn't find where that was set.
    - Minimizing to system tray using WinForms assembly: http://possemeeg.wordpress.com/2007/09/06/minimize-to-tray-icon-in-wpf/
    - WPF context menu for system tray icon: http://social.msdn.microsoft.com/Forums/br/wpf/thread/01b6f20c-d4fb-4956-a3f6-d5e5d91bd239
    - System tray apps, complete?: http://www.simple-talk.com/dotnet/.net-framework/creating-tray-applications-in-.net-a-practical-guide/
    - WPF NotifyIcon support, without WinForms!: http://www.codeproject.com/Articles/36468/WPF-NotifyIcon
    - I installed it on my iMac (Hardcodet.Wpf.TaskbarNotification), via NuGet.
    - Some source that demos how to minimize to system tray?: http://archive.msdn.microsoft.com/TheNotifyIconExample
    - Minimizing to system tray with WinForms example: http://blog.qurbit.com/tutorials/getting-your-c-app-to-run-in-the-system-tray/
    - I found a minimize-to-tray sample that works fine.  I'll use it.
      . License: Freeware: http://www.broccoliproducts.com/profile.php
      . Documentation and download: http://www.broccoliproducts.com/softnotebook/trayicon/trayicon.php     
    - I got the SysTray Minimize support code (HookWrapper and TrayIcon) integrated and built.
  0 5/24/12 Thu:
    - 6:15 - 18:45
    - I got the application down into the system tray!  There is no task bar icon.  The system tray icon has a tooltip, and the app is running!
    - However, I am using the TrayIcon classes from www.broccoliproducts.com.  I need to use the NotifyIcon for WPF tray icons instead.  They are much more functional.
    - I moved the NotifyIcon for WPF project into the win-client directory to save the source, and fixed the references.  It is in the win-client\3rdParty subdirectory.
    - Create a demo service that will exercise the system tray capabilities, like toasts, menus, etc.  To do that, I will need to initialize the services (most of them dummy at this point).
    - Add the Exit menu item and make that functional.  It will cause the app to close all of the services and exit, cleaning up all of the resources.  That's the next goal.
    - I got all of the core services stubbed out, and the notification service has a test 1-second timer event on a separate thread to drive some tests of the
      pop-up toasts, etc.
    - Implementing the Taskicon NotifyIcon stuff....
  0 5/25/12 Fri:
    - 6:45 - 19:00
    - "James going-away lunch"
    - Team movie.
    - The notify icon should be added to the invisible window in XAML.  When the user clicks the preferences button on the system tray icon context menu,
      that will show the NavigationWindow and navigate to the proper page.  When the tour ends, the last NavigationWindow-based page should be unloaded
      and the InvisibleWindow should be shown, making the system tray icon visible.  Maybe I should always start the InvisibleWindow, initially with the
      system tray icon invisible.  NavigationWindow and InvisibleWindow need to be globally accessible.  Perhaps they should register themselves to
      CLAppDelegate.  When the NavigationWindow is shown, the application should be shown in the task bar again.
    - Invoking MvvmLight RelayCommand from code-behind: http://stackoverflow.com/questions/4136776/firing-relaycommand-from-codebehind-bound-to-vm
      . Do it like this: 
              var viewModel = (MyViewModel)DataContext; 
              if (viewModel.MyCommand.CanExecute(list)) {
                viewModel.MyCommand.Execute(list); 
              }
    - The NotifyIcon stuff works, but it puts up two icons, and the icons aren't fixed on the system tray toolbar.  They appear in the pop-up
      window.  Also, Gus doesn't like the fancy stuff.
    - Goals: 
      . Put up only a single icon.
      . Make everything standard Windows look.  Use the WindowsForms stuff if I have to:
        o Standard Windows tooltip.  Hover over the icon to see this text-only tooltip.
        o Standard Windows balloon tips.  These are programmatically triggered, fade and disappear automatically.  They point to the icon in the system tray.
        o Standard Windows context menu.  Right-click to see this context menu pop-up.
        o WPF-styled pop-ups for "growl" notification support.  These are programmatically triggered, and they fade and disappear automatically.  They can
          contain any WPF content.  They have only an "X" close button.
        o WPF-styled active window pop-ups.  Left-click on the icon and the window pops up.  It can have any WPF content and/or controls.  This one I won't hook
          up until we need it.
        o The icon should always be shown in the system tray.
    - I got the command bindings working on the context menu, but there are still two icons being created.
  0 5/26/12 Sat:
    - 7:30 - 16:15
    - Debugging bindings: <MenuItem Header="Show Cloud Window" Command="{Binding ShowPreferencesPageCommand, Converter={StaticResource DebugConverter}, ConverterParameter=A}">
    - New problem: The WindowInvisible is not being constructed before the services are initialized, causing an exception.  I need to wait
      for the window to be constructed before I continue with intialization of the services.  When just going to the tray, use the WindowInvisible Loaded event
      to send a queued and delayed event to CLAppInitialize to start the service initialization.  Currently, CLAppDelegate immediately calls startCloudAppServicesAndUI()
      if first-time setup is not needed.  I need to have this method fired some time after the WindowInvisible Loaded event fires.  That worked.
    - Now I have a single icon showing, and the context menu (fancy) works.  The test timer is firing every second.  
    - Next, find a way to put up a standard context menu, while keeping the fancy toasts as a substitute for growl support.
    - Another very nice pop-up window when you hover over the system tray icon: http://www.codeproject.com/Articles/36788/WPF-XAML-NotifyIcon-and-Taskbar-System-Tray-Popup
    - Here is someone trying to get a standard context menu using NotifyIcon for WPF:
      . http://stackoverflow.com/questions/9251665/tray-icon-context-menu-positioning-in-wpf-application
      . http://wyday.com/blog/2008/vista-menu-with-icons-in-c-sharp/
      . http://stackoverflow.com/questions/5055433/how-to-display-a-windows-7-style-context-menu
    - The standard context menu is working now, with icons!
    - Now show the standard tooltip.
    - The standard tooltip works, but it shows underneath instead of on top of the cursor.
    - Context menu position: http://www.hardcodet.net/projects/wpf-notifyicon
    - Embedding .Net controls into the standard balloon tooltip: http://www.codeproject.com/Articles/37912/Embedding-NET-Controls-to-NotifyIcon-Balloon-Toolt
    - Determining the NotifyIcon window coordinates: http://blog.quppa.net/2010/12/08/windows-7-style-notification-area-applications-in-wpf-part-2-notify-icon-position/
    - And part 3 of the above: http://blog.quppa.net/2010/12/09/windows-7-style-notification-area-applications-in-wpf-part-3-taskbar-position/
    - I got the standard tooltip working, and placed reasonably well, although the placement is not 100% optimum.
    - I made a change to the NotifyIcon for WPF library to make the tooltip placement better.
    - Next, show the standard balloon tips.
    - Next problem: The CLNotificationService wants to show the balloon tooltips, but it is the view that should do all of the UI!  :(  I'll have to create a
      custom balloon tooltip class with the info I need, and send it as a message to the view.  The view will use the info to start the tooltip.  The
      tooltip will fade on its own.  However, only the ViewModels know about their Views.  Yikes!  I think I will just go directly to the view with this
      one.  I'll use the MvvmLight messaging.
    - The standard balloon tooltips work!
    - Now test the fancy "growl" notifications.  That will require another data class, message, registration, send and final action in the view.
    - The fancy growl notifications work.
    - Now the only thing left is to pin the NotifyIcon to the system tray.  Tomorrow...
  o 5/27/12 Sun:
    - 7:00 - 16:00
    - Fix up the context menu layout, and add Check for update...  Also, figure out how to bind to the resource strings from XAML.
    - Binding XAML to enums: http://www.ageektrapped.com/blog/the-missing-net-7-displaying-enums-in-wpf/
    - System tray design guidelines: http://msdn.microsoft.com/en-us/library/windows/desktop/aa511448.aspx
    - The keyboard accelerators don't work, and the "&"s don't show as underlines.  The context menu is a WPF menu that looks like
      a Windows form's menu.  I will need to implement the keyboard accelerators in the WPF way at 508 time.
    - I tried to get the NotifyIcon always visible on the system tray.  I could probably make that happen, but decided against it.  It is
      the user's choice.  The Dropbox icon is not on the system tray either.
    - Get the exit path working.  That works now, and the application exits.
    - David will provide the remaining shell integration in his COM object: Explorer context menu.
    - Installed more git Visual Studio integration (Git Extensions).
    - I spent 1.5 hours in git hell, but the system tray changes were pushed.
    - What's next?  Working on the services?:
      . Badging
      . UI Activity
      . Indexing
      . Network monitoring
      . File system monitoring
      . Cloud folder monitoring
      . Sync
      . Notification
    - I initialized and terminated the BadgeNet COM object.  That required a small change to allow for restarts of the badging service.
    - I pushed the system tray changes.
    - RSync thesis: http://www.samba.org/~tridge/phd_thesis.pdf
    - I read through Phil's documentation of the MDS and Storage HTTP commands.  They were mostly unintelligible to me.  Minimial and
      unusable documentation.  Obviously the code will tell me what is really going on...
    - I researched syncing on the web for a while.  I didn't really find anything but RSync, which is GPL-licensed.
    - I think it is time to start studying and documenting the Mac client code.  I will sync it down to my laptop and start that process.
    - I completed the documenting of many of the services.
  o 5/28/12 Mon:
    - 6:00 - 12:15
    - All of the services, and about half of the CloudSDK public API is documented.
    - I think we can faithfully duplicate this code with a direct port to Windows.
  o 5/29/12 Tue:
    - 6:30 - 18:30
    - Wrote a status memo on the work this weekend.
    - Investigate the reimplementation of GCD on the Windows side.
    - GCD in C#: https://gist.github.com/451978
    - GCD in C: http://blog.quiscalusmexicanus.org/post/4916668260/grand-central-dispatch-for-win32-the-port      
    - Utility to convert line endings: sfk165: http://www.stahlforce.com/dev/index.php?tool=remcrlf&back=dev
            Open a dos cmd window and enter command :
              sfk165 lf-to-crlf [or addcr] [dir .ext1 .ext2] or [singlefile]
                  or
              sfk crlf-to-lf [or remcr] [dir .ext1 .ext2] or [singlefile]
    - Working on porting the CLSyncService.m module.  Maybe a bad choice of starting points because it pulls in the whole world.....
  o 5/30/12 Wed:
    - 6:15 - 19:00
    - DTOs and POCOs: http://rlacovara.blogspot.com/2009/03/what-is-difference-between-dto-and-poco.html
    - LINQ2SQL: http://www.sidarok.com/web/blog/content/2008/10/14/achieving-poco-s-in-linq-to-sql.html
    - Massive, dynamic DB access like ActiveRecord in Rails: https://github.com/robconery/massive
    - HttpClient stream download to file: http://code.msdn.microsoft.com/HttpClient-Downloading-to-4cc138fd
    - HttpClient stream upload to file: http://blog.alexonasp.net/post/2011/07/27/POSTing-Uploading-Files-using-the-WCF-Web-API.aspx
    - Priority queues: http://s291.codeinspot.com/q/1335328
    - Parallel tasks: http://msdn.microsoft.com/en-us/library/ff963549.aspx
    - Compare threading approaches: http://nitoprograms.blogspot.com/2010/08/various-implementations-of-asynchronous.html
    - New Async Methods: http://nitoprograms.blogspot.com/2010/08/various-implementations-of-asynchronous.html, and http://www.microsoft.com/en-us/download/details.aspx?id=19957
    - The above document (2nd URL) has a very fast method for down-streaming a file.
    - I need a stand-in for NSOperationQueue.  The mac client uses the following features:
      . A queue of uploads
      . A queue of downloads
      . For each, specifying the concurrency allowed.  Up to that many operations will be ongoing at once.  The rest will be queued.
      . For each, the ability to cancel all of the operations.
      . For each operation, progress call-backs.
      . For each operation, indivually cancel
      . For each operation, indivually completion callback.
      . Exceptions or other errors will drive the completion callback with NSError.
      . Results are provided with the completion callback.
    - I can use the TAP (Task-based Async Pattern) described above, but I need to wrap it in a queue and have a dispatcher.
    - I would like to keep the same code pattern so the port is straight-forward.
    - The patterns in use in the mac client are:
      . An upload or download operation is represented by CLHTTPConnectionOperation.
      . A download operation is created:
              __block CLHTTPConnectionOperation *downloadOperation = [self.restClient streamingDownloadOperationForStorageKey:event.metadata.storage_key
                                                                                                     withFileSystemPath:fileSystemPath
                                                                                                               fileSize:event.metadata.size
                                                                                                             andMD5Hash:event.metadata.hash];
      . Then set the download operation progress block:
               [downloadOperation setDownloadProgressBlock:^(NSInteger bytesRead, NSInteger totalBytesRead, NSInteger totalBytesExpectedToRead) {
                    // accumulate progress and update the UI
              }];
      . Then set the download operation completion block:
              [downloadOperation setOperationCompletionBlock:^(CLHTTPConnectionOperation *operation, id responseObject, NSError *error) {
                   // stuff to do on completion
              }];
      . Then add this download operation to a list of operations:
             [operations addObject:downloadOperation];
      . Then add all of the operations to the NSOperationQueue:
             [self.downloadOperationQueue addOperations:operations waitUntilFinished:YES];
      . Note the last waitUntilFinished:YES.  That actually blocks!!!!!!! until all of those huge terabyte files complete their upload/download!
      . So, what should I do?
        o Use the CLHTTPConnectionOperation mostly as is, because it is the POCO for the operation.  I'll have to connect it to HttpClient.
        o CLHTTPConnectionOperation will derive from CLNSOperation.
        o Make a new class (CLNSOperationQueue) to represent NSOperationQueue. Done.
      . Apparently the mac client uses the Start method like the Main method is intended, however the mac code works fine.
      . I think I will just implement the main method and change the code slightly.  Simpler...
      . Good example of TAP: http://www.codeproject.com/Articles/127291/C-5-0-vNext-New-Asynchronous-Pattern
      . An async document "lab" is in c:\source\Documents.
      . Time-waster: Trying to get the Async CTP installed in VS 2010.  Aborted.  Spent a lot more time installing VS2011 beta full
        premium version.
  o 5/31/12 Thu:
    - 6:15 - 18:15
    - VS2011 finally installed.  Installed documentation.  Got the async support working.
    - Completed the first pass of CLNsOperationQueue and CLNsOperation.
    - Working through getting a build, with a lot of commented-out code.
    - Split the ClientSdk to two projects: CloudApiPublic and CloudApiPrivate.  Win-Client -> CloudApiPublic, CloudApiPrivate.  CloudApiPrivate -> CloudApiPublic.
  o 6/1/12 Fri:
    - 6:15 - 17:15
    - 1.25 hour time waster.  The Mac used up all its memory and had to be restarted, then Windows needed to install 18 updates.....
    - Installed and played with CCloud (Comodo).  It's interesting, but I'm not overly impressed.  The cloud drive is a mounted drive, backed by the web.  e.g.: F:.
      And it is REALLY SLOOOOWWWWW!   Every operation waits forever to sync that folder with the cloud.  It doesn't appear to be file-system-backed.  Other
      features are good.  Drag anything and the cloud lights up.  Favorites, files, etc.  5 GB free.  My work email.
    - I finished the split-out of the CloudApi to public/private, and got the code to build with lots of it commented out.  I pushed it.
    - Huge time-waster!  After pushing everything, I needed to reboot the mac, so I suspended the Windows 7 VM, and restarted everything.
      When it came back up, (I'm guessing here), I may have clicked the wrong Windows 7 VM to start up, and that may have ben an underlying
      VM for the current VM????  In any case, when it came back up it was in the wrong "window" state, not like I had left it.  So I shut
      that one down and ran the other (proper?) MV from the Fusion GUI.  It refused to start.  Something about GUIDs not matching.  I did
      a lot of research, and it looked like it would be very difficult to recover, so I decided to go to Bootcamp and recover from my Acronis
      backups.  Just getting to Bootcamp required 8 hours of moving and deleting.  I started that and went home.  Wasted 6 hours today.
  o 6/2/12 Sat:
    - 6:00 - 14:30
    - The Acronis restores wouldn't work (software too old?), so the only thing left was to rebuild from scratch and lose my whole environment!!!
    - I'm not to happy with VMWare, Apple and Acronis right now.  :*(
    - I managed to get most of my environment re-installed, and fortunately I had pushed to git just before this happened, so I
      can build the project again with VS2011.
    - Time spent on that time-waster: 14.5 hours, with a lot more in the future as I fill out the lost environment....
  o 6/3/12 Sun:
    - 8:00 - 14:45
    - Installed VS2011 on my home laptop. That took 3.5 hours!!!!
    - I spent the rest of the day getting everything to build to my home laptop under 2011.  Fixed multiple problems....  I pushed the result.
  o 6/4/12 Mon:
    - 5:00 - 7:45 (home)
    - 8:45 - 18:30 (work)
    - Working on CLSyncService.cs.
    - Moved and set up in new space.
    - Investigated Ultrabac.  There are some problems.  The differential can't find the full backup.
    - More setup time on my environment.
    - Just a little work on porting...
  o 6/5/12 Tue:
    - 6:15 - 18:30
    - Porting CLSyncService...
    - Removed all stuff from the Cloud.
    - Installed PGP.
    - Tested Ultrabac.  It works and builds a .VHD file!
    - Installed Microsoft Virtual PC with XP mode.
  o 6/6/12 Wed:
    - 6:30 - 18:30
    - It builds again, with a lot of commented out code.  Commit this.
    - While coding the CloudApiPrivate, I needed to move Settings to CloudApiPrivate.  I did that.  I caused a lot of suck-in and build problems.  I pushed it to master.
    - Good example of MultipartFormData: http://stackoverflow.com/questions/10339877/asp-net-webapi-how-to-perform-a-multipart-post-with-file-upload-using-webapi-ht
    - Another example in Scenario6.xaml.cs in the HttpClient sample in Downloads.
    - JSON.Net documentation: http://james.newtonking.com/projects/json/help/
    - Working on the first SyncFromCloud HTTP request.
  o 6/7/12 Thu:
    - 5:00 - 7:30   (home)
    - 10:30 - 18:45 (work)
    - Sending authorization:
		var httpClient = new HttpClient(); 
		var url = new Uri("http://bing.com"); 
		var accessToken = "1234"; 
		var httpRequestMessage = new HttpRequestMessage(HttpMethod.Get, url); 
		httpRequestMessage.Headers.Add(System.Net.HttpRequestHeader.Authorization.ToString(), string.Format("Bearer {0}", accessToken)); 
		httpRequestMessage.Headers.Add("User-Agent", "My user-Agent"); 
		var response = await httpClient.SendAsync(httpRequestMessage); 
    - Sending multipart requests: http://stackoverflow.com/questions/10036445/how-does-one-correctly-implement-a-mediatypeformatter-to-handle-requests-of-type
    - HttpClient request/response extension methods: http://www.forkcan.com/viewcode/1211/Extension-to-the-HttpClient
    - The HTTP request is built.  Drive it asynchronously and then drive the completion handler.  Check for exceptions and handle them.  Refer to CLRegistration.
    - TaskCompletionSource: http://stackoverflow.com/questions/6884470/task-chaining-without-taskcompletionsource
    - And more: http://blogs.msdn.com/b/pfxteam/archive/2010/11/21/10094564.aspx
    - And maybe the solution: http://www.albahari.info/threading/threading.pdf
    - I reworked the GCD implementation to use templates.
    - The code is complete for SyncFromCloud.
  o 6/8/12 Fri:
    - 6:30 - 18:30
    - Mac-client raw view from Charles Proxy /sync/from_cloud:
           	POST /sync/from_cloud HTTP/1.1
		Host	192.168.1.55:8001
		User-Agent	Cloud/0.3 CFNetwork/588.2 Darwin/12.0.0 (x86_64) (MacBookAir4%2C2)
		Content-Length	54
		Accept	*/*
		Authorization	Token token="N7tUpFmClEsnClZf5RonTngV47E21WihdHhMEbjwvcg"
		Content-Type	application/json; charset=utf-8
		X-Cld-Client-Version	M03
		Accept-Language	en-us
		Accept-Encoding	gzip, deflate
		Connection	keep-alive
    - /sync/from_cloud request:
		{
			"path" : "\/",
			"sid" : "83697880505771\/62500"
		}		  
    - /sync/from_cloud request raw:
		POST /sync/from_cloud HTTP/1.1
		Host: 192.168.1.55:8001
		User-Agent: Cloud/0.3 CFNetwork/588.2 Darwin/12.0.0 (x86_64) (MacBookAir4%2C2)
		Content-Length: 54
		Accept: */*
		Authorization: Token token="N7tUpFmClEsnClZf5RonTngV47E21WihdHhMEbjwvcg"
		Content-Type: application/json; charset=utf-8
		X-Cld-Client-Version: M03
		Accept-Language: en-us
		Accept-Encoding: gzip, deflate
		Connection: keep-alive
		{
			"path" : "\/",
			"sid" : "83697880505771\/62500"
		}
    - /sync/from_cloud response:
		{"events":[],"pending_count":0,"sid":"267833267234883/200000","partial_response":false}
    - /sync/from_cloud response raw:
		HTTP/1.1 200 OK
		Content-Type: application/json; charset=utf-8
		Transfer-Encoding: chunked
		Connection: keep-alive
		Status: 200
		X-Powered-By: Phusion Passenger (mod_rails/mod_rack) 3.0.12
		X-UA-Compatible: IE=Edge,chrome=1
		ETag: "6ddb603e547cd0e0405a48ce60f19739"
		Cache-Control: max-age=0, private, must-revalidate
		X-Request-Id: af54ae24e52814f0c8c291120d3ebcdd
		X-Runtime: 0.045129
		Date: Fri, 08 Jun 2012 14:38:56 GMT
		X-Rack-Cache: invalidate, pass
		Server: nginx/1.0.15 + Phusion Passenger 3.0.12 (mod_rails/mod_rack)
		{"events":[],"pending_count":0,"sid":"267833267234883/200000","partial_response":false}        
    - Research on the Mac File system monitor:
	CLEventTypeAddFile
	CLEventTypeAddFolder
	CLEventTypeModifyFile
	CLEventTypeRenameFile
	CLEventTypeRenameFolder
	CLEventTypeMoveFile
	CLEventTypeMoveFolder
	CLEventTypeDeleteFile
	CLEventTypeDeleteFolder

	Need CLEvent:
	  Metadata
	    string Path
	    string ToPath
	    string FromPath
	    string Revision
	    string CreateDate
	    string ModifiedDate
	    string Hash
	    string Mime_type
	    string Sid
	    string Size
	    string Storage_key
	    string Version
	    string LastEventID
	    bool IsDirectory
	    bool IsDeleted
	    bool IsPending
	  SyncHeader
	    string Action
	    string EventID
	    string Sid
	    string Status
	  Action
	  IsMDSEvent

	o The file system monitor presents events only with the following information:
	  Dictionary
	    "event_count", 99999  // number of events in the group
	    "event_id", 99999     // last eid in group
	    "events", Array
	      Dictionary
		"event", string (event name: One of the CLEventType* strings listed above)
	        "metadata", Dictionary
	          if eventName is RenameFile/Folder or MoveFile/Folder
		    "from_path", oldPath of the item (without the Cloud folder root)
		    "to_path", path of the item (without the Cloud folder root)
		  else eventName is NOT one of RenameFile/Folder or MoveFile/Folder
		    "path", path of the item (without the Cloud folder root)
		  endelse eventName is NOT one of RenameFile/Folder or MoveFile/Folder
    - I got the wire image for both the Windows and Mac client, so I can compare the HTML directly.
    - I'm into test.
    - The Mac client appears to have a couple of problems in its event filter function.  It doesn't take out
      multiple duplicates, and it might not be accurate filtering using the hash.
    - David helped me rewrite the filter on Windows using Linq.
  o 6/9/12 Sat:
    - 7:15 - 12:30 (home)
    - Dictionary helper: http://sradack.blogspot.com/2007/10/dictionary-returns-null-instead.html
    - Stepping through the code.  I built a dictionary helper: Dictionary<>.GetValueOrDefault().  It tests for keys and
      prevents exceptions.
    - Sync depends on the index server which has not yet been started.  I will need to dummy it up as I test.
  o Lost this file 6/15/12.  Recovered to 6/9/12 Sat. evening.
  o 6/10/12 Sun:
    - 7:00 - 15:00 (plane)
    - Filling out CLSyncService.
  o 6/12/12 Tue (WWDC)
    - Filling out CLSyncService.
    - About 1/2 hour.
  o 6/13/12 Wed (WWDC)
    - Ditto, about 2 hours.
  o 6/14/12 Thu (WWDC)
    - Switched onto the Mac to get Finder context menu working.
    - About 2 hours.
  o 6/15/12 Fri (WWDC)
    - About 1 hour.
    - Run Applescript from ObjC: http://stackoverflow.com/questions/4909702/run-applescript-from-cocoa-application
    - Applescript reference: https://developer.apple.com/library/mac/#documentation/applescript/conceptual/applescriptlangguide/conceptual/ASLR_fundamentals.html#//apple_ref/doc/uid/TP40000983-CH218-SW2
    - Source to look through Finder windows, using FSRef: http://code.google.com/p/cdto/source/browse/main.m
  o 6/16/12
    - FSRef description: http://cocoadev.com/wiki/FSRef
    - Update Finder icon directly: http://markmail.org/message/wg2f3lo7gxmpkplf
    - Event mouse clicks: https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/EventOverview/HandlingMouseEvents/HandlingMouseEvents.html#//apple_ref/doc/uid/10000060i-CH6-SW1
    - Services: http://cocoadev.com/wiki/MakingServices
    - MenuWillOpen: fires when the menu will appear, and can be used to customize it:https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/MenuList/Articles/DisplayContextMenu.html
    - LLDB debug Finder:
      sudo xcode-select -switch /Applications/Xcode44-DP5.app/
      target create /System/Library/CoreServices/Finder.app/Contents/MacOS/Finder
      image dump symtab
      breakpoint enable (all breakpoints enabled)
      breakpoint disable 1.43
      breakpoint set -r .*Menu.*
      process attach --pid 262
    - Right-click breakpoint hit: DesktopServicesPriv`NodeIsQueryHitsContainer
  o 6/17/12 Sun:
    - 9:00 - 16:00 (home)
    - Using LLDB.  I attached to Finder, and managed to hit a breakpoint!  It looks
      like none of the Finder symbols are defined, but I am able to stop on a
      Framework function when I right-click a file in Finder.  I stopped at
      AppKit`+[NSMenu _contextMenuTarget].
         * thread #1: tid = 0x1c03, 0x00007fff8ab77323 AppKit`+[NSMenu _contextMenuTarget], stop reason = breakpoint 2.1
           frame #0: 0x00007fff8ab77323 AppKit`+[NSMenu _contextMenuTarget]
           frame #1: 0x00007fff8ab76867 AppKit`_NSTargetForSendAction + 85
           frame #2: 0x00007fff8ab767e5 AppKit`-[NSApplication targetForAction:to:from:] + 635
           etc.
    - I'm not making progress with the debugger, trying to stop on right-clicks.  What to do?
    - It seems that I need to write some code that will execute in Finder's context, to list out the object tree.
    - Research the visual tree involving menus.
    - I believe each  NSWindow has a collection of NSViews.  Each of the NSViews has a "menu" property that is set
      with an NSMenu.  The frameworks handle the user interaction.
    - Write a sample program that has a context menu, and inspect the UI hierarchy there.
    - The process from the sample:
      . Create NSMenu.
      . Create NSMenuItems and add them to the NSMenu.
      . Find the Cell of the item which will have the menu (in this case NSSearchField.Cell.
      . Perform [cell setSearchMenuTemplate:nsMenu]
    - Find a different sample.
    - NSView inherits from the abstract class NSResponder.
    - The NSResponder.setMenu:(NSMenu *)menu method sets the associated menu.
    - So, if I list the windows, then list the view hierarchy, I should see interesting views.
    - The menu property retrieves the associated NSMenu from a view, so I should be able to find the
      Cloud context menu item.
    - I put up a single Finder window and dumped the view hierarchy.  The console log is at
       /Users/robertstevens/Source/Projects/DTrace/ContextMenu/FinderViewHierarchy20120617.log
      . The window has the following hierarchy:
        o NSView:NSResponder:NSObject
          - TSidebarSplitView:NSSplitView:NSView:NSResponder:NSObject {{0, 0}, {770, 383}}
            . NSView:NSResponder:NSObject {{0, 0}, {148, 383}}  (this is the left sidebar)
            . NSView:NSResponder:NSObject {{149, 0}, {621, 383}}  (this is our view)
              o TBottomBar:NSView:NSResponder:NSObject {{0, 0}, {621, 23}} (the bottom bar)
              o NSScrollView:NSView:NSResponder:NSObject {{0, 23}, {621, 361}}  (the scroll view)
                - NSClipView:NSView:NSResponder:NSObject {{0, 17}, {606, 329}}  (the clip view)
                  . TListView:NSOutlineView:NSTableView:NSControl:NSView:NSResponder:NSObject {{0, 0}, {714, 589}}  (the container for all of our list items)
                    o TListRowView:NSTableRowView:NSView:NSResponder:NSObject {{0, 152}, {714, 19}}  (the first row)
                      - 1. TNameTextField:TTextField:NSTextField:NSControl:NSView:NSResponder:NSObject {{16, 0}, {305, 18}}  (the text name field on this row)
                      - 2. TDateTextField:TTextField:NSTextField:NSControl:NSView:NSResponder:NSObject {{321, 0}, {181, 18}}  (the date field on this row)
                      - 3. TTextField:NSTextField:NSControl:NSView:NSResponder:NSObject {{502, 0}, {97, 18}}  (the description field? on this row)
                      - 4. NSButton:NSControl:NSView:NSResponder:NSObject {{6, 0}, {12, 17}}  (the button the user clicks on this row)
                      - 5. TTextField:NSTextField:NSControl:NSView:NSResponder:NSObject {{599, 0}, {115, 18}}  (????)
                      - On the Finder window, it was in list view, with the headers: Name, Date Modified, Size, and Kind.
                      - The list view shows an expander caret, an icon, then the fields above.
                      - So, These are the fields 4, 3, 5, 2 and 1 above?
                    o The next row‚ and so on...
      . It looks like the context menu is on the TListRowView.
      . Try swizzling the TListRowView.setMenu method, and print out the Name of the field (TTextField:NSTextField).  This should be the stringValue method.
      . That didn't work.  The setMenu happens very early, before our test swizzles Finder.
      . Instead of hooking setMenu, chase the view hierarchy to find the first TListRowView object.  Then get it's menu property and do the print mentioned above.
      . I did that:
        - The console log: /Users/robertstevens/Source/Projects/DTrace/ContextMenu/FinderViewHierarchy20120617B.log
        - The TListView has a menu.
        - Now I am getting a hit on the TListRowView_setMenu() hook on every row!  
        - But I have no information about the menus.  Print that out.
        - I noticed that the setMenu call is actually setting the TListRowView's menu to nil.  I assume that's because the responder
          chain will invoke the parent's (TListRowView's) menu for any of the rows clicked.
      . More logging proves that all of the context menus seen here have zero NSMenuItems?????
      . I checked the window menu with logging.  That is the main Finder window, not the context menus.
      . I noticed that the menus on the rows that have no menu items are TContextMenus.  This is the definitions from class-dump:
          @interface TContextMenu : NSMenu
          {  
          }
          + (BOOL)handleEventAsRightClick:(id)arg1 targetObject:(id)arg2;
          + (void)handleContextMenuCommon:(unsigned int)arg1 nodes:(const struct TFENodeVector *)arg2 event:(id)arg3 view:(id)arg4 browserController:(id)arg5 addPlugIns:(BOOL)arg6;
          + (void)buildContextMenu:(id)arg1 forContext:(unsigned int)arg2 browserController:(id)arg3 maxItems:(unsigned long long)arg4 addServices:(BOOL)arg5;
          + (void)addViewSpecificStuffToMenu:(id)arg1 browserViewController:(id)arg2 context:(unsigned int)arg3;
          + (void)addSharingServicesToMenu:(id)arg1 forCommand:(SEL)arg2 browserController:(id)arg3 andNodes:(const struct TFENodeVector *)arg4;
          + (void)populateActionMenu:(id)arg1 browserController:(id)arg2;
          + (void)contextMenuClickedOnContainer:(const struct TFENode *)arg1 event:(id)arg2 view:(id)arg3 browserController:(id)arg4;
          + (void)contextMenuClickedOnNodes:(const struct TFENodeVector *)arg1 event:(id)arg2 view:(id)arg3 browserController:(id)arg4;
          + (BOOL)allowContextualMenuForEvent:(id)arg1;
          + (void)clearContextMenuState;
          + (id)contextMenuWithDelegate:(id)arg1;
          - (void)menuDidCompleteInteraction:(id)arg1;
          - (void)configureForPathbarWithNode:(const struct TFENode *)arg1 browserController:(id)arg2;
          - (void)configureForSidebarWithNode:(const struct TFENode *)arg1 browserController:(id)arg2 constrained:(BOOL)arg3 data:(id)arg4;
          - (void)configureWithNodes:(const struct TFENodeVector *)arg1 browserController:(id)arg2 container:(BOOL)arg3;
          - (void)dealloc;
          - (id)initWithDelegate:(id)arg1;
          - (id)initWithObject:(id)arg1 nodes:(const struct TFENodeVector *)arg2 event:(id)arg3;
          - (id)initWithTitle:(id)arg1;
         @end		
      . There are some interesting methods there.  First of all: (BOOL)handleEventAsRightClick:(id)arg1 targetObject:(id)arg2;  Swizzle that and see if we get a hit.
      . Having trouble swizzling that method that takes two parameters.
      . I will probably need to hook the initialization of the TListView.  I could let it initialize, then chase the view hierarchy to add
        the context menu items.		
      . What if we swizzle when there are already some Finder windows present?  At swizzle time, I will need to chase the windows and views, and add
        the context menu item to all menus unless it is already there.
  o 6/18/12 Mon:
    - 6:30 - 18:00
    - Syncing the machines from the WWDC work on the Windows and Mac laptops.
    - Swizzling class methods: http://stackoverflow.com/questions/3267506/how-to-swizzle-a-class-method-on-ios
    - I have swizzled several of the TContextMenu class methods, but I'm not getting hits.  I wonder if the class method swizzling is working.  Try some other
      class method that should be hit.  See if I can get some log output from a class method swizzle.
    - The class method adds are not working.  I have to use the metaclass to do that.  Reference: http://rants.tempura.org/2012/01/25/classes-and-meta-classes.html
    - I was successful at capturing the TContextMenu after it has been built!
    - We want to add our icon and "Cloud.com" into the Share submenu.  Try to do that and have the menu drive a new action method that I will swizzle in dynamically.
    - I can also log the Share submenu after it has been built.  I should be able to add items to that submenu.  Tomorrow...
  o 6/19/12 Tue:
    - 7:30 - 18:30
    - I was able to add a copy of the first Share menu item to the end of the Share context submenu.  It works.
    - Big time waster: Trying to find out how to add a menu action handler.  Trying to find the @encoding().  I had to find a sample program and put in some debugging…
      . For a method: - (IBAction)screensMenuAction:(id)sender
      . The encoding is: v12@0:4@8
    - The click handler works now!
    - I have been trying to get the rect of the clicked submenu NSMenuItem.  As it turns out, that is not easy because NSMenuItem is an NSObject, not an NSControl (no UI components).
    - Talking with Phil, we experimented with the other Share operations (email, AirDrop, etc.).  They all position the pop-up window in the containing Finder WINDOW!  Actually,
      the Finder window is constrained to minimum sizes that will allow all of the pop-up windows to appear in their entirety.  It appears that the pop-up windows are positioned
      in the center horizontally, and with the bottom of the window on the vertical center.  If the Finder window is made smaller, the pop-up window will end up with its
      bottom just over the bottom of the Finder window client area.  So, I will find the screen coordinates of the Finder window and pass those to Cloud.app.
    - Loop through the parent chain to find the first window and log the screen coordinates of the client area of that window.
    - Problem:  I am at the lowest level with a NSMenuItem object.  There is no way I know of to chase up the parent tree to the containing view.  It turns out that the current
      "key window" is the Finder window containing the TBrowserView.  I will just get the screen coordinates of the client area of that view.
    - I was successful at logging the screen coordinates of the current Finder key window.  What's next?
    - Test it in different Finder views.
    - It works in all of the Finder views.
    - Get the cloud icon working now.
    - Fortunately the icon image size is constant, no matter which Finder view is in force when the context menu is popped up.
    - Investigating how to add Cloud.com into the Finder sidebar.
    - Interesting sidebar note from growl: http://stackoverflow.com/questions/1540557/add-an-item-to-the-finder-save-dialog-sidebar
    - Shared file list API: http://stackoverflow.com/questions/4852516/add-place-to-finder-sidebar
    - An implementation of the Shared File List API in Python: http://www.opensource.apple.com/source/pyobjc/pyobjc-26/pyobjc/pyobjc-framework-LaunchServices/PyObjCTest/test_lssharedfilelist.py
    - Some code that adds items to the run-on-login list: http://rhult.github.com/preference-to-launch-on-login.html
    - Use the Shared File List API: http://stackoverflow.com/questions/1062856/how-do-you-programmatically-put-folder-icons-on-the-finder-sidebar-given-that-y
    - Another API reference: http://stackoverflow.com/questions/10751199/how-to-get-finder-sidebar-favorites-content-cocoa
    - The include file is: /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Headers/LSSharedFileList.h
  o 6/20/12 Wed:
    - 6:15 - 18:30
    - The custom Cloud icon in the Finder sidebar has been swizzled, and it works great!
    - I fixed the bug that was preventing CloudApp from being installed when the Cloud directory is deleted. 
    - Changed the Finder server thread start-up to use an NSThread, rather than a pthread.  I need the NSThread so I can drive a method on the server class from the Finder swizzled methods.
    - The swizzled click handler is now calling a selector on the Finder server thread.  I am coding the support to forward this event with the screenRect to the user's Cloud.app DO server.  
  o 6/21/12 Thu :
    - 6:30 - 18:00
    - Time-waster: 0.5 hours.  Configure MacBookAir to back up to the Seagate 3 TB drive moved from the iMac.
    - Another time-waster: 0.5 hours.  Configure the Magic Trackpad to work on Windows and start a backup on the Windows machine.
    - Filling out the code to send the context menu click event to Cloud with the full path and Finder client area origin and size.
    - Problem: The user may have right-clicked on a list of multiply-selected items.  How do I get the list of those items, and the full paths of those items to send to Cloud.app?
    - Interesting swizzle candidates in TBrowserViewController (I have the object pointer for that):
		- (void)showContextMenu:(id)arg1 showContainer:(BOOL)arg2;
		- (void)showContextMenuForContainer:(const struct TFENode *)arg1 forEvent:(id)arg2;
		- (void)showContextMenuForNodes:(const struct TFENodeVector *)arg1 forEvent:(id)arg2;
		- (unsigned long long)getSelectedNodesInFocus:(struct TFENodeVector *)arg1 upTo:(unsigned long long)arg2;
		- (void)getSelectedNodesForQuickLook:(struct TFENodeVector *)arg1 upTo:(unsigned long long)arg2;
		- (unsigned long long)getSelectedNodes:(struct TFENodeVector *)arg1 forContainer:(const struct TFENode *)arg2 upTo:(unsigned long long)arg3;
		- (unsigned long long)getSelectedNodes:(struct TFENodeVector *)arg1 upTo:(unsigned long long)arg2;
		- (unsigned long long)getSelectedNodes:(struct TFENodeVector *)arg1;
		- (unsigned long long)selectedNodesCountInFocus;
		 - (void)selectionChangedByUserAction:(BOOL)arg1;
		 - (BOOL)nodeIsSelected:(const struct TFENode *)arg1;
		 - (struct TFENode)focusNode;
		 - (const struct TFENode *)target;
		 - (void)computeTargetPathsFor:(const struct TFENodeVector *)arg1;
		 - (void)finishedHandlingContextualClick;
    		 BOOL _handlingContextualClick;
		 - (_Bool)getContextualClickLocationInView:(struct CGPoint *)arg1;
	    	 struct CGPoint _contextualClickLocationInView;
		 - (void)setHandlingContextualClickAtLocationInView:(const struct CGPoint *)arg1;
		 - (void)finderActionCompleted:(id)arg1;
		 - (double)iconSize;
		@property(readonly, nonatomic) unsigned long long selectedNodesCount;
		 - (void)browserSelectionChanged; (TBrowserWindowController)
    - Interesting.  When the context menu items are loaded, the TBrowserWindowController is doing it, not TBrowserViewController as I had expected.
    - TBrowserWindowController has a pointer to the TBrowserViewController.
    - Both of these classes have a selected nodes count.  Print them both.
    - Surprise!  With a single item selected, both counts are zero.  With 3 items selected, both counts were 3!  Go figure….
    - An idea: Maybe it is too late in the click handler.  The handler runs on another thread, and the selection may have been removed by the time it handles the event.
    - Move the selectedNodes print logic to the addSharingServicesToMenu swizzle.
    - Same result!  Maybe the count is only set when multiple selection has been used?  See if there is a valid single node selected when the count is zero.
    - Returning a struct from ObjC_MsgSend: http://stackoverflow.com/questions/8405737/how-do-i-return-a-struct-value-from-a-runtime-defined-class-method-under-arc
    - Time-waster:  How to return a struct from an Objective C method.  I finally figured it out and got the focusNode, but I'm not having any luck finding the URL from the TFENode.
    - While testing I saw the number of selected nodes go to one when I selected a single item!  Try the method to get back the selected node and try to get the URL from that.
    - Interesting;  I did "NSArray *selectedNodes = [view selectedNodes];" and it threw an exception.  The view is actually a TColumnViewController!  And it doesn't know selectedNodes!
    - I think Intellisense was throwing me off.  "selectedNodes" is not a member of any view controller in the hierarchy.  Punt!
    - I think the nodes are held by the TBrowserViewDataSource.  That holds a "struct TNodeToChildrenMap *_nodeChildrenMap;".  struct TNodeToChildrenMap is a C++
      "struct unordered_map" with a key of type TFENode and values of type TChildList.  I don't have the definition of TChildList :(.
    - I know that there are two class-dumps.  FinderKit and Finder.  They are almost the same, but the class names in FinderKit are prefixed with FI_.  So TBrowserViewController is
      FI_TBrowserViewController.  I wonder why the name differences?  I used the straight names for the badging, and that works OK.  I'll stick with the straight names.
  o 6/22/12 Fri:
    - 7:30 - 18:30
    - Probably the right way to find the FINode is to use the data source, but I don't yet know how to iterate through those items.
    - An idea: I wonder if I can find the FINode through the view hierachy?  When TIconAndTextCell_drawIconWithFrame is called, the self pointer is an object such that [self node] is a TFENode
      which can be used to get the FINode, and then the URL.
    - Another idea: Maybe I can use the debugger to inspect the data source?
    - Big time waster: 1.5 hours.  I switched to use GDB, and it would not work under XCode.  I finally got it working.
    - GDB was a big help!  I found that the last parameter (addNodes) in the call to TContextMenu_addSharingServicesToMenu_forCommand_browserController_andNodes is a pointer
      to a TFENodeVector.  The block at that location is a struct _Vector_impl.  That contains three  8-byte pointers (on 64-bit).  They are first, finish and end-of-storage.
      In my debugging case, I right clicked on a single item and got the context menu.  The debug break happened when I left-clicked the "Share" context menu item.
      The TFENodeVector points to a single TFENode at 0x7f9b6543d800.  That memory looks like 98 A4 04 65 9B 7F 00 00, or 0x7F9B6504A498.  That should be a pointer to an OpaqueNodeRef.
      Executing the statement "p (id) [NSClassFromString(@"FINode") nodeFromNodeRef:0x7F9B6504A498]" in GDB produced 0x7f9b6504a490.  That should be a FINode.  Executing the
      statement "p (NSURL *)[0x7f9b6504a490 previewItemURL]" gives 0x7f9b63470640.  That should be a pointer to the url string.  Executing "po (NSString *)[[0x7f9b63470640 path] lowercaseString]"
      gave "/applications/dashboard.app"!  Is that right?  Yes it is, but this hook is delivering only one of the multiple selected files, the one the user clicked on.
    - Almost complete with delivering the click event to Cloud.app.
  o 6/23/12 Sat:
    - 6:30 - 14:30
    - Testing.  I saw the first click notification to CLUIActivityService.
    - The complete event delivery path works now, with a couple of issues.  I pushed it on my branch.  Issues
      . After the first Cloud.com click, the MessageBox shows, and when the user clicks OK, the main window is
        no longer the key window, so the click event doesn't have all of the information, and ignores the click.
      . Only a single selected item is passed when, actually, multiple items are selected.
      . If there are no share items, the click will also be ignored.  
  o 6/24/12 Sun:
    - Off
  o 6/25/12 Mon:
    - 6:15 - 18:30
    - Pushed all of the changes and worked with Gus to get it working for Mountain Lion and Lion, with Retina and non-Retina displays.
    - Researched the changes needed to add our icon to the login dialog, and our own text.
    - The custom text works in the password dialog, but the icon doesn't.
    - Some sample code that does authorization: http://code.google.com/p/blacktree-alchemy/source/browse/trunk/Crucible/Code/QSAccessibility.m?r=87
    - The test code for the password dialog custom icon and text works.
  o 6/26/12 Tue:
    - 6:30 - 18:30
    - Refactoring the IconBadge authorization code to implement the password dialog custom icon and text.  It works now.  I pushed this code to master.
    - Researching context menus to try to capture all of the files selected by the user.  At the moment, we are only capturing one selection.
    - Fixed a bug in the retina support, and pushed it.
  o 6/27/12 Wed:
    - 8:45 - 18:30
    - I used DTrace to get a log of all objc_MsgSend events while right clicking an item in Finder to get the main context menu to display.  Unfortunately
      it looks like the context menu is set up early because I don't see any Finder code that is setting it up, only the framework events when the user
      right clicks.
    - I swizzled SW_NSMenu_popUpContextMenu_withEvent_forView_withFont which was hit in the trace.  No hits.  Try the popUpContextMenu with a leading underscore
      and as an instance method.
    - That did it!  I got a hit.  The menu is TContextMenu.  The Event is RMouseDown.  The view is TBrowserTableView.  The font is nil.
    - Add a separator and a Cloud.com item at the end of the list.
    - Even though I add the menu items, they don't appear.  Apparently, this function is both building the menu and popping it up, so when I add the
      menu items, they don't display.
    - I swizzled - (void)configureWithNodes:(const struct TFENodeVector *)arg1 browserController:(id)arg2 container:(BOOL)arg3;  No hits.
    - I swizzled + (void)addViewSpecificStuffToMenu:(id)arg1 browserViewController:(id)arg2 context:(unsigned int)arg3;
    - That worked.  Now I have the Cloud.com menu item in the main context window.  The click works.
    - Gus wants it to always look like the Share submenu with Cloud.com and the icon.  So, if the Share menu is not found, add a submenu with the single
      Cloud.com menu item.
    - Doing more research on the right click: It is possible to make another Finder window the top-most window, then right click on an item in a Finder window
      underneath the top-most window.  That action does not confer "key" window status to the underneath window.  The "key" window approach doesn't work.
      I will need to find the associated window by chasing the view or responder chains.
    - Now, add the share submenu as a second Share submenu with the Cloud.com item and see if it works.
    - Now it works for both Lion and Moutain Lion (not yet actually tested on Lion).
    - Next, capture the selected items.  I will need to chase something up the tree to find the containing window (the window containing the TBrowserView).
    - When adding the Share menu item (Mountain Lion), I get a TBrowserWindowController.
    - When adding the Share menu and the item (Lion), I get a TColumnViewController.
    - In the case of the TBrowserController, NSWindow is a TBrowserWindow, which contains a pointer to the TBrowserWindowController.  So I could loop through
      the Finder windows to find our TBrowserWindowController, and that would be the window.
    - In the case of the TColumnViewController, a TColumnViewController is a TBrowserViewController.  There is a pointer in a TBrowserWindowController to the
      TBrowserViewController, so again, I could loop through the Finder windows to find ours.  
    - Implement the above to replace the "key" window logic to find the proper window coordinates.
    - Use the NSMenuItem.setRepresentedObject method to save the TBrowserWindowController or TBrowserViewController for the click handler.
  o 6/28/12 Thu:
    - 6:15 - 18:00
    - The algorithm to find the proper window works.
    - Now tackle the tougher problem; How can I find the list of selected nodes?
    - Reveal an item in a Finder window via AppleScript: http://lists.apple.com/archives/cocoa-dev/2005/Jan/msg00797.html
    - Reveal multiple items in Finder: http://forums.macrumors.com/showthread.php?t=450120
    - Info on NSBrowserTableView: http://stackoverflow.com/questions/4414795/what-is-a-nsbrowsertableview-as-compared-to-an-nsbrowser
    - The list views appear to use some form of derived NSTableView.  If I have the table view, I can find the selected items as NSTableView.numberOfSelectedRows,
      isRowSelected, etc.  But how do I find the TFENode from the row?  Also, in the icon view the user selects multiple cells, not rows.
    - Sample NSTableView multiple selection app: https://developer.apple.com/library/mac/#samplecode/DragNDropOutlineView/Introduction/Intro.html
    - I can enumerate the selected rows using a block like this:
   			 NSMutableArray *items = [NSMutableArray array];
    			[[_outlineView selectedRowIndexes] enumerateIndexesUsingBlock:^(NSUInteger row, BOOL *stop) {
        			[items addObject:[_outlineView itemAtRow:row]];
    			}];
    - My guess is that I find the TFENode from the data source and use the numberOfRowsInTableView: or tableView:objectValueForTableColumn:row: methods.
    - Other views like the TIconView will probably do it differently.  TIconView derives from IKImageBrowserView.
    - Interesting: TGlobalWindowController is a singleton, and has functions for converting between URL and TFENode:
		+ (struct TString)urlForNode:(const struct TFENode *)arg1;
		+ (struct TFENode)nodeForUrl:(const struct TString *)arg1;
    - Look at TBrowserWindowController: - (void)selectNodesNowOrLater:(const struct TFENodeVector *)arg1;
    - Look at TBrowserViewController: - (unsigned long long)getSelectedNodes:(struct TFENodeVector *)arg1;
    - Look at TBrowserViewController: - (BOOL)nodeIsSelected:(const struct TFENode *)arg1;  How can I get the list of nodes to iterate through?
    - TBrowserViewController selectedNodesCount is interesting, but by experience it gives the wrong value.
    - What is TBrowserViewController - (const struct TFENode *)browserRoot;?  Is that the head of the node list???
    - Look at TBrowserViewController - (unsigned long long)getCommandTarget:(SEL)arg1 outNodes:(struct TFENodeVector *)arg2 maxItems:(unsigned long long)arg3;
    - Promising: TBrowserViewController:
		- (struct TFENode)nodeAtIndex:(unsigned long long)arg1;
		@property(readonly, nonatomic) unsigned long long itemCount; // @dynamic itemCount;
                Combine those with nodeIsSelected?
    - I ran into a (compiler?) problem.  nodeAtIndex returns a struct, not an id, so the compiler won't let me use the standard bracketing syntax with
      a cast.  I must call objc_msgSend_stret directly.  http://stackoverflow.com/questions/2573805/using-objc-msgsend-to-call-a-objective-c-function-with-named-arguments
    - That all worked.  I can now properly find the selected items!
    - Several remaining problems:
      . A right-click does not select the item, so that item is not included as selected.  Select three items and right-click on one of them.  All three are shared.
        However, right-click an unselected item, and only the right-clicked item is shared.  So I need to rework the logic to match this behavior.  That will
        require identifying the right-clicked item (new research).
      . Prove that the coordinates reported are correct for the containing window, even if another window is top-most.  (Done).
      . Test the current code on Lion.  Lion doesn't crash, but there is an issue: Multiple-selection and right-click doesn't add the Share item to the context menu.
        Unfortunately that will require additional swizzling on the Lion base.  :(    
    - Researching how to find the node that was right-clicked.  I should be able to find that via the TBrowserViewController (somehow???)
    - Try TBrowserViewController:- (const struct TFENode *)nodeBeingEdited:  That was nil.  Try again…
    - Try TBrowserViewController:- (struct TFENode)focusNode; That returned the folder being edited, not the right-clicked item.
    - Try TBrowserViewController:- (struct TFENode)settingsNode;  That also returned the folder being edited.
    - Try TBrowserViewController:- (const struct TFENode *)target;  That also returned the folder being edited.
    - Try TBrowserViewController:- (unsigned long long)getCommandTarget:(SEL)arg1 outNodes:(struct TFENodeVector *)arg2 maxItems:(unsigned long long)arg3;  (not tried yet…)
    - Try TBrowserViewController:- (const struct TFENode *)snapshotNode;  The snapshotNode was not nil, but the path returned null.
    - Maybe try TBrowserViewController:- (_Bool)getContextualClickLocationInView:(struct CGPoint *)arg1;
  o 6/29/12 Fri:
    - 6:15 - 18:30
    - Ideas:
      . Run DTrace again and see if I can find an earlier Finder method that will identify the right-clicked TFENode.
      . Inspect the sample program to see if it has the same behavior.
      . Use the debugger to stop on the context menu building functions and look around.
    - The sample program exhibits the same behavior.  It uses the following code:
	    NSInteger clickedRow = [_outlineView clickedRow];
	    id item = nil;
	    SimpleNodeData *nodeData = nil;
	    BOOL clickedOnMultipleItems = NO;

	    if (clickedRow != -1) {
	        // If we clicked on a selected row, then we want to consider all rows in the selection. Otherwise, we only consider the clicked on row.
	        item = [_outlineView itemAtRow:clickedRow];
	        nodeData = [item representedObject];
	        clickedOnMultipleItems = [_outlineView isRowSelected:clickedRow] && ([_outlineView numberOfSelectedRows] > 1);
	    }
    - itemAtRow is implemented by TBrowserTableView. 
    - clickedRow is implemented by NSTableView.
    - TBrowserTableView also implements: - (struct TFENode)nodeAtRow:(long long)arg1;
    - The selected items are enumerated in the sample by:
		[_outlineView selectedRowIndexes]
    - That should be enough.  Try it.
    - Unfortunately, I don't get an NSTableView-based class after I implemented it.  I get a TColumnView, which is derived from TBrowser.
    - Great tool!  I managed to get the debugger to stop in Finder at the right-click event.  The debugger lists everything, including the "T" classes, and
      also including the private variables.  Attach to Finder, then run Cloud, so two processes are running in the same project.  
    - The TBrowserWindow._lastRightHit private variable is the TBrowserTableView.  I hope I can get that in code, but I'll bet I can't because it isn't
      a property.
    - That works great now in list mode!
    - However, it doesn't work in the icon view.  That view produces a _lastRightHit class of TIconView <- TImageBrowserView <- IKImageBrowserView.  I will need
      to handle that class differently.
    - The IKImageBrowserView provides the selected item list, but I'm having trouble finding the right-clicked item.  The delegate protocol provides a cellWasRightClickedAtIndex
      method, and that appears to be implemented by TIconViewController:- (void)imageBrowser:(id)arg1 cellWasRightClickedAtIndex:(unsigned long long)arg2 withEvent:(id)arg3;
    - Maybe the sender is the cell?  And maybe I can get that cell's index?  Try that.  No.  The sender is the NSMenuItem.
    - TIconView has a private variable (struct TFENode _mouseDownNode;) that might be helpful.  TIconView doesn't respond to that message.
    - TIconView:- (id)axSelectedChildren returns:
		(gdb) po [tView axSelectedChildren]
		<__NSArrayM 0x7fcad10dfa40>(
		   FINodeUIElement title:32x32-icon.png role:AXImage
		)
    - TIconView implements - (void)rightMouseDown:(id)arg1;
    - Revelation! TIconView actually selects the item on right-click, so I don't need to use the same logic as above for TBrowserTableView.
    - Now the TIconView mode works, but the straight list view doesn't.
    - That view is a TListView <- NSOutlineView <- NSTableView.  It should work then.  Why doesn't it???
    - It blows up on the nodeAtRow: message to the view.
    - The TListViewController is the dataSource.  I should be able to find the node from there.
    - So far, I can't seem to get the dataSource to cooperate with any of the mandatory methods that should be implemented…
    - In the dataSource, this should be helpful: - (struct TFENode)nodeAtIndex:(unsigned long long)arg1;
    - Now all four views are working in Finder.
    - The desktop view (right on the desktop) doesn't work, but neither does sharing to mail.  We will fix ours when they fix theirs…
    - Also, the Finder icon "do something with these files" doesn't work.  There is no right click!
    - At this point, all Finder window functions work, in all four views, and with the toolbar icon, and do the expected thing.
    - The desktop still doesn't work, and that's because there is no window.  Maybe I can make it work easily?????
    - The [sender representedObject] is TDesktopWindowController.
    - The [[sender representedObject] window] is TCocoaDesktopWindow.
    - The [[[sender representedObject] window] _lastRightHit] is TDesktopIconView.
    - [TDesktopIconView controller] is TDesktopViewController.  That has all of the data.  nodes is a TFEVector of the nodes.  nodeIsSelected can be used to see if it is selected.
    - Also, right-click selects the item, so just loop through the nodes to see which ones are selected.
    - That didn't work.  There was only one node in the nodes vector, and it wasn't selected.
    - Try: TDesktopViewController - (unsigned long long)getSelectedNodes:(struct TFENodeVector *)arg1 upTo:(unsigned long long)arg2;
    - Now the desktop right-click works.
    - One thing remaining for context menus is the Finder toolbar icon for sharing.  Apparently they split the sharing items onto their own menu.
    - Another bug: Select files on Flowview then switch to column view and click the "DoThings" toolbar icon.  No paths appear, even though there are two files selected.
  o 6/30/12 Sat:
    - 6:30 - 16:00 (home)
    - The server is down.  Working on the Windows client state machine design.
    - The CLSptNsOperationQueue class must be redesigned.  Currently it uses the calling threads to execute the operations.  It must supply its own threads.
      . I need to have N GCD queues where N is the maxConcurrentOperations.
      . I could just start each of those queues at initialization and point them at the Dispatcher(), but then the threads would have to be
        polling the operation queue to find work.
      . Instead, have the threads adding the operations to the queue actually fire off the GCD queue if it is available.
      . When the GCD thread finishes an operation, it would look for more work.
      . Actually, the GCD object needs rework like this too.  It has a polling delay of 100 ms.  I reworked the GCD object for no polling delay.
  o 7/1/12 Sun:
    - 5:30 - 15:30 (home)
    - The operation queue will have maxConcurrentOperations GCD queues to work with.  As items are added to the operation queue, a free
      GCD queue is allocated and started with the operation.  As the operation completes, that event should drive the dispatcher to
      remove the next operation from the queue and start it up on the GCD queue that just completed.
    - Actually, the operation queue code works properly because it uses its own threads.  Just leave it along.
    - I need a WaitUntilFinished() method on the operation queue.  How can I implement that?  Just do that with a poll loop.  This is
      a long-running operation, and the calling thread is not the UI thread.
    - The async file upload and download is coded and pushed.
    - Working on the File System Dispatcher.
  o 7/2/12 Mon:
    - 6:15 - 18:30
    - Coding in CLFSDispatcher and recoding in CLSyncService.
  o 7/3/12 Tue:
    - 6:15 - 18:30
    - 20:00 20:30 
    - The Mac client is busy writing and rewriting metadata, filling it in from the file system, and from the index.  It seems that the whole front
      end to sync should be redesigned.  David's code is already filling in most of the information, and already has the functions to
      make it easier.  Here is the design:
      . The FSM will make a batch of events available as before.
      . Sync will process on a single thread, thus serializing the whole sync process.
        loop through the event batch
	  if this is a directory
	  else this is a file
	    attempt to freeze the file, producing an open Stream.
	    if no error freezing the file
	      add the open stream to the event
	    else error freezing the file
	      add this error to the event's error log
	      remove this event from the batch
	      enqueue the event to the error queue
	    endelse error freezing the file
	  endelse this is a file
	  present this item to FSM to update the metadata while 
        endloop through the event batch
     - David and I redesigned everything.  The FSM will take care of everything if sync just calls "freeze" under
       the sync "lock".
     - For now, I will just mock up everything to send the first sync-to to the server.
     - I installed WireShark on my samsung laptop for the plane.
  o 7/4/12 Wed: (home)
    - 5:45 - 7:45
    - Translating CLSyncService
  o 7/4/12 Wed through Mon 7/9/12 (Ohio):
    - About 12 hours translating CLSyncService, and pseudo-coding CLIndexService.
  o 7/10/12 Tue:
    - 6:15 - 18:30
    - Pseudocoding CLIndexService done.  
    - Gus made a whole lot of changes to sync to remove the sorting of events on sync-from.  I completed the integration of those changes, and it builds.  Pushed.
  o 7/11/12 Wed:
    - 6:15 - 18:30
    - isMDSEvent is set true for the following:
      . All Sync_From events.
      . Sync_To events where the server sent us the status and a valid metadata dictionary.
    - With David:
      . Initialize the indexing service at StartIndexingService.
      . MarkItemAtPath_asPending not necessary?
      . FileChange vs. FileSystemItem
        o Add targetPath to FileChange
        o Add revision to FileChange
        o Add isLink to FileChange
	o 
    - Deserialize NewtonSoft JSON.net to List<type>: http://www.codeproject.com/Tips/79435/Deserialize-JSON-with-C
    - Got the login from the main screen working.
    - Testing the Sync_to server communication.  I got a positive response from the server, and I'm working on parsing the JSON response.
  o 7/12/12 Thu:
    - 6:30 - 18:00
    - Create C# model objects from JSON: http://json2csharp.com/
    - I stepped all the way through sync_to using the debugger to step over about 5 - 6 issues that I need to fix.
    - Those issues are fixed.  Except for the index functions that David is working on, sync-to works.
  o 7/13/12 Fri:
    - 8:15 - 16:30
    - Sync-from works, and file download is almost started.
    - Worked with David to work out procedures for our upcoming sync design process.
    - Worked with David to determine the design for limiting long file paths to 260 (or even less) characters.  Done.
  o 7/14/12 Sat: (home)
    - 5:30 - 16:00
    - File download works!
  o 7/15/12 Sun: (home)
    - 5:30 - 16:00
    - Upload almost works, but there are problems in the integration of the index service.
    - Lots of issues in the integration.
    - Research on uploading large files.
    - File upload works!
  o 7/16/12 Mon:
    - 6:15 - 18:30
    - Working on push notification, researching...
    - Apparently Microsoft does not have any support for websockets unless you are running windows 8: http://www.hanselman.com/blog/VisualStudio11BetaInContext.aspx
    - SignalR is installed and is presenting an exception on the ws:// prefix: "The URI prefix is not recognized".
    - SignalR won't support WebSockets except on Window 8.  It might support Server-sent events, but look elsewhere for now...
    - Chuck has also implemented "server-side events".
    - Alchemy websockets are MIT and LGPL licensed: http://alchemywebsockets.net/
    - Alchemy requires that both client and server run Alchemy code.  I might be able to modify the source, but abort for the time being.
    - Server-sent events vs. Long Polling vs. WebSockets: http://dsheiko.com/weblog/websockets-vs-sse-vs-long-polling/
    - WebSockets status: http://www.hanselman.com/blog/YourUsersDontCareIfYouUseWebSockets.aspx
    - The SignalR Server-Sent transport assumes that SignalR is also on the server side.  Our server is running the Faye Redis protocol.  We need to support that protocol.
    - Faye protocol in javascript: https://groups.google.com/forum/?fromgroups#!topic/faye-users/8M77F-v6yoo
    - The best WebSockets client I have seen so far is the WebSocket4Net: The project's homepage is http://websocket4net.codeplex.com/.
    - Push notification works with WebSockets!!!!
  o 7/17/12 Tue:
    - 6:30 - 18:30
    - Integrating index.  Mostly working.
  o 7/18/12 Wed:
    - 6:30 - 19:00
    - Index integrated and working.  With breakpoints off, I saw a file sync from the Mac to Windows, and vice-versa.
    - Meeting to switch gears and let David redesign sync for the Windows client.
    - Server logs:
      . On Macbook Air.
      . In Source/Projects/ServerLogs
      . ctxsclouddev.pem is the private key for server access.
      . ssh -i ctxsclouddev.pem ubuntu@upd.cloud.com.
      . Logs are in /var/log/*.log
      . For the upd server: tail -f user.log
      . For development: connect to ubuntu@upd-edge.cloudburrito.com
      . For the push server: r1.9.3 ~ $ ssh -i ~/.ssh/ctxsclouddev.pem ubuntu@push.cloud.com 
      .  ubuntu@push3:~$ cd /webapps/push-app/current/log 
      .  ubuntu@push3:/webapps/push-app/current/log$ tail -f *
    - Filed expense report for Fedex charge.
    - Git push without entering password.
      . Download from here: https://help.github.com/articles/set-up-git
      . Save to downloads.
      . Extract the .zip file.
      . Launch the git-credential-winstore.exe file from the command prompt in the same directory.
      . Restart the command prompt.
      . Run git push.
    - Converted to the new edge dev environment.
  o 7/19/12 Thu:
    - 6:30 - 18:30
    - Windows search tutorial: http://www.thejoyofcode.com/Using_Windows_Search_in_your_applications.aspx
    - Conversation with Phil and David.
      . We won't download files that would violate the path length.
      . Renamed appendages included in the length calculation.
      . Add the server file and metadata to the index.
      . Able to query the index for the list of issues.
      . Containing folder will be badged with an X if it contains any errors.
    - Working on finding the moved Cloud folder with WIndows search.
    - Found the moved or renamed cloud directory via Windows Search by its creation date, as long as it hasn't been deleted.
    - One issue, the Pictures and Public subdirectories also have the same creation date.  Remove them from the results if they have the same root.
    - Got the search to produce only the renamed or moved cloud folder.  Now find a way to query the trash directory and add those results to the search.
    - To find the proper recycle bin to see if the user deleted the cloud folder, get the Settings.Instance.CloudFolderPath and extract the drive letter, since
      that would be the drive containing the recycle bin.  Use the drive letter and locate the recycle bin on that drive.  Then search the recycle bin for the folder.
      See http://fullonblogs.blogspot.com/2012/01/empty-recycle-bin-using-c-sample-code.html
    - Working on a problem finding the deleted folder in the recycle bin.
    - Recycle bin forensics: http://dereknewton.com/2010/06/recycle-bin-forensics-in-windows-7-and-vista/
    - More recycle bin forensics: http://www.forensicfocus.com/downloads/forensic-analysis-vista-recycle-bin.pdf.
    - Recycle bin:
      . The recycle bin root is different for different OSs.  e.g., $Recycle
      . Append the user's SID to find the recycle directory.
      . That directory has a lot of $I* and $R* files.
      . The $I file has the original path, delete time and file size.
      . The $R file is the actual file.
      . The creation time of the $R file is the original creation time.
      . For a directory, the $R file is the actual directory, and the files inside still have the same file names.
      . Again, for a directory, the creation date of the $R file is the original creation date.
      . So, to find a file with a particular creation date:
        - Find the user's recycle directory.
        - Get the collection of $R directories in one query.
	- Loop through the collection reading the attributes for the creation date.
	- It should be an exact match.
      . The function for finding the cloud directory in the recycle bin works.
  o 7/20/12 Fri:
    - 6:30 - 18:30
    - Working on the "cloud directory missing" UI.
    - The control logic is done for finding moved or deleted cloud folders.
    - If the folder is moved, and it is found again, the location of the cloud folder is simply updated, and Cloud executes.  No dialog.
    - Need new dialogs:
      . Your Cloud folder is missing! (actually found in the recycle bin).
        o Title: Cloud.com
	o SubTitle: Your Cloud folder is missing!
	o Text: To continue syncing, please restore your Cloud folder.  You may also choose to unlink this computer from your account.
	o Buttons:
	  - Unlink: Resets the settings and exits?
	  - Restore: Restores the folder to the original location (from the recycle bin) and runs Cloud.
      . Your Cloud folder is missing! (actually not found anywhere).
        o Title: Cloud.com
	o SubTitle: Your Cloud folder is missing!
	o Text: To continue syncing, please restore your Cloud folder.  You may also choose to unlink this computer from your account.
	o Buttons:
	  - Unlink: Resets the settings and exits?
	  - Locate... Puts up the folder location dialog.
      . Cloud folder locate dialog:
        o Folder selection dialog.
	o Title: Cloud.com
	o Subtitle: Choose a new place to store your Cloud files.  A folder named "Cloud" will be created inside the folder you select.
	o Standard OS Folder selection with Make new Folder button.  This is via "Windows Forms" for us.
	o Buttons:
	  - Select: Submit with folder selected: Will create new folder, update the folder to that location, and continue executing Cloud.
	  - Cancel: Returns to the calling dialog.
  o 7/21/12 Sat: (home)
    - 5:30 - 16:30
    - Installed July update for VS 2012.
    - Debugged an error on auth-edge.cloudburrito.com for Mike.
    - Test completed OK: Delete the cloud folder, then remove the device from the account.
    - Much of it works.  Only the FolderBrowserDialog left.
    - How to use ShowDialog from WPF: http://stackoverflow.com/questions/315164/how-to-use-a-folderbrowserdialog-from-a-wpf-application
  o 7/22/12 Sun: (home)
    - 5:30 - 7:00
    - 13:30 - 16:00
    - The missing cloud folder support is complete and tested.
    - Form layout techniques: http://blogs.msdn.com/b/wpfsldesigner/archive/2010/06/04/layout-techniques-for-windows-forms-developers.aspx
    - TreeView Explorer with left/right panes: http://blogs.microsoft.co.il/blogs/davids/archive/2009/09/02/wpf-explorer-view-with-treeview.aspx
    - Outlook-style restyled WPF TabControl: http://www.codeproject.com/Articles/24106/Creating-an-Outlook-Navigation-Pane-by-Restyling-a
    - Left pane, rigt grid: http://www.codeproject.com/Articles/22980/WPF-A-Beginner-s-Guide-Part-1-of-n
    - Outlook-style navigation pane: http://www.codeproject.com/Articles/43181/A-Serious-Outlook-Style-Navigation-Pane-Control
    - Simple left navigation with pages on the right: http://www.codeproject.com/Articles/72724/Beginning-a-WPF-MVVM-application-Navigating-betwee
    - Programmatically selecting TreeView items: http://www.codeproject.com/Articles/20645/WPF-TreeView-Selection
    - Example code to programmatically change treeview: http://blogs.msdn.com/b/marthami/archive/2007/09/17/how-to-write-a-dynamic-treeview.aspx
    - Styling treeview categories: http://stackoverflow.com/questions/3209249/can-i-create-a-navigation-control-like-this-example-in-wpf-using-a-treeview
    - Code example for listbox-driven navigation to frame: http://stackoverflow.com/questions/3529765/wpf-page-to-page-navigation-from-listbox-menu-employing-frame-technique
    - WPF Inspector: http://www.wpftutorial.net/Inspector.html
    - Researching navigation.
  o 7/23/12 Mon:
    - 6:30 - 18:30
    - To reset a user ID on the cloudburrito server: POST https://mds-edge.cloudburrito.com/folder_objects/reset?user_id=nnnn
    - To see who's connected on the cloudburrito server https://auth-edge.cloudburrito.com/user/connected
    - I need to consolidate the windows to a single NavigationWindow that we can use to pop up from the system tray.  Make a PageInvisible for no content and navigate to that.
    - All of the windows and pages have been refactored to use a single NavigationWindow.  They work properly with visibility.  Names have been changed to be more consistent.
  o 7/24/12 Tue:
    - 6:30 - 18:30
    - Silverlight code still in place on 7/23/12.  I will remove it.  It's ugly.
    - Debug trick to force a breakpoint on the main thread so I can use the debugger to look around at things.
        void PageCloudFolderMissing_Loaded(object sender, RoutedEventArgs e)
        {
	    // System goes to sleep after this event
            //DEBUG
            //Application.Current.MainWindow.Dispatcher.BeginInvoke(new RunDebug(DebugWait));
        }
        //private delegate void RunDebug();
        //private void DebugWait()
        //{
        //    System.Threading.Thread.Sleep(3000);
        //    Application.Current.MainWindow.Dispatcher.BeginInvoke(new RunDebug(DebugTest)); 
        //}

        //private void DebugTest()
        //{
        //    bool doNothing = true;
        //}
    - I reworked all of the GUI code for proper navigating and window showing (again).  I had to move the OnNavigated event handler to
      the NavigationWindow (where it belongs), and drove the new HandleNavigated() function in the pages via a new IOnNavigated interface.
    - Moving on....
    - Show one of the windows from a click on the system tray icon (preferences).
    - I am able to click preferences, bring up the PagePreferences page in NavigationWindow, and navigate to FramePreferencesGeneral
      in the PagePreferences frame.
  o 7/25/12 Wed:
    - 6:30 - 18:30
    - The PagePreferences page should hold a class instance of all of the preferences, initialized from the Settings.  
    - The Frame* pages will access this class instance via the .Parent property.  The user can navigatee through the Frame* pages
      setting and resetting values.  The PagePreferences OK button will commit the values to Settings.  The PagePreferences Cancel
      button will toss the changes.
    - Good explanation of comboboxes: http://www.codeproject.com/Articles/301678/Step-by-Step-WPF-Data-Binding-with-Comboboxes
    - WPF Spy utility (Snoop): http://snoopwpf.codeplex.com/
    - Silverlight Spy utility: http://firstfloorsoftware.com/silverlightspy/
    - How to get the PagePreferences ViewModel?
      . The PagePreferences view loads, and loads its ViewModel.
      . The user clicks a particular preferences button on PagePreferences (e.g.: general).
      . That causes FramePreferencesGeneral view to load, which loads its ViewModel.
      . The FramePreferencesGeneral ViewModel needs the CLPreferences instance from the PagePreferences ViewModel.
      . FramePreferencesGeneral.View.Parent should be the PagePreferences.View.
      . David showed me how to do this via DependencyProperties.  The PagePreferences has a DP that is set when the PagePreferences ViewModel
        navigates to the FramePreferencesGeneral page (via a new message sending a KeyValuePair<Uri, CLPreferences>.
      . The FramePreferencesGeneral page has a copy of the DP and implements a OneWay binding.  When the Frame page is loaded, the
        DP is automatically set.
      . The Frame page sends the DP to its ViewModel at initialization.  Then the Fram page ViewModel has what it needs.
      . Interesting: If the preferences are simple, and not related, the Frame page ViewModel doesn't need the referece to the preferences
        at all.  I can simply bind the Frame page to the preferences directly.  I'll try that for the General page, which is simple and unrelated.
    - WPF Binding example: http://www.codeproject.com/Articles/29054/WPF-Data-Binding-Part-1
    - Debug a binding.  Add ", Converter={StaticResource DebugConverter}", and put a breakpoint in the get and set. 
    - To install MvvmLight Code Snippets, see http://mvvmlight.codeplex.com/
    - The FramePreferencesGeneral dialog is complete and tested.
  o 7/26/12 Thu:
    - 7:45 - 18:30   (Boca power-outage problems this morning)
    - Fix Macbook Air fan constantly running:
		SMC reset instructions for a MacBook Air are:
		Shutdown your MacBook Air (go to the Apple menu and choose ìShut DownÖî).
		Make sure your MacBook Air has external power. Connect the power adaptor, if it isnít already.
		Using the Airís built-in keyboard (not a plug in keyboard or bluetooth keyboard), of the left hand side of the keyboard press Control-Shift-Option and on the top right of the keyboard, the power key at the same time.
		Release all the keys at the same time.
		Press the power key to start the computer.
    - The FramePreferencesAccount view works.
  o 7/27/12 Fri:
    - 6:30 - 18:45
    - The network dialog is a small view with two buttons.  Each brings up a modal dialog.  Both dialogs are rather complex.  Somehow I have to
      build these complex dialogs into the modal dialog window and provide them the preferences data object that they need.  When they are done,
      I need the modified preferences.  Maybe there is a way to pass user state to the dialog.  If not, I need to add that capability.
    - The Frame VM eventually calls ShowDialog(view, ViewModel,,.).  Give the reference to Preferences from the Frame View to the Frame VM, then
      pass it to ShowDialog using DialogViewModel properties, similar to the following:
                                    var dialogFolderSelection = SimpleIoc.Default.GetInstance<IModalWindow>(CLConstants.kDialogBox_FolderSelectionSimpleView);
                                    IModalDialogService modalDialogService = SimpleIoc.Default.GetInstance<IModalDialogService>();
                                    modalDialogService.ShowDialog(dialogFolderSelection, new DialogFolderSelectionSimpleViewModel
                                    {
                                        FolderSelectionSimpleViewModel_FolderLocationText = cloudFolderRoot,
                                        FolderSelectionSimpleViewModel_ButtonLeftText = _rm.GetString("folderSelectionSimpleButtonLeftText"),
                                        FolderSelectionSimpleViewModel_ButtonRightText = _rm.GetString("folderSelectionSimpleButtonRightText"),
                                    },
                                    ViewGridContainer,
                                    returnedFolderSelectionSimpleViewModelInstance =>
                                    {
                                        if (dialogFolderSelection.DialogResult.HasValue && dialogFolderSelection.DialogResult.Value)
                                        {
						// etc....
                                        }
                                    });
    - Then bind the Dialog view to the Dialog VM properties, including Preferences.
    - Actually, the Dialog VM should present just a subset of the Preferences.  The Dialog VM will set that subset back into the preferences data object
      when the user clicks OK, or just discard the subset if the user clicks Cancel.
    - Bind friendly localizable enums to combobox: http://www.codeproject.com/Articles/29495/Binding-and-Using-Friendly-Enums-in-WPF
    - Researching how to bind friendly localizable enums to combobox.
    - The DialogPreferencesNetworkProxies works somewhat.  Working on the combobox.
  o 7/28/12 Sat: (home)
    - 5:00 - 13:00
    - 14:00 - 14:30
    - 16:00 = 17:00
    - Installed Visual Studio 2012 updates (Nuget, Web Platform Installer and Web tools extensions).
    - Worked all day on the radio button problem.  Apparently there is a huge problem with radio buttons implementing bindings.  They call it a "feature", but
      it's mostly a bug.  There were several suggested fixes out there, and acknowledgements of the problem.  I tried them all and couldn't get it to work.
      Finally, I treated each control as an independent (non-grouped) control with it's own VM binding, and that worked.  I used the VM to control the
      behavior of the radio buttons (click one and the other goes off, etc.).  What a pain, but it's working.
    - Working on validating the textbox fields on the DialogPreferencesNetworkProxies ChildWindow.
  o 7/29/12 Sun: (home)
    - 6:00 - 15:30
    - System colors: http://stackoverflow.com/questions/5094447/how-do-i-use-the-correct-windows-system-colors
    - A WPF/Silverlight child window: http://www.dreamincode.net/forums/topic/182878-silverlight-4-creating-a-custom-modal-dialog/
    - The DialogPreferencesNetworkProxies finally works well, with validation, password encryption, graying controlls and a modified ChildWindow.
  o 7/30/12 Mon:
    - 6:30 - 18:30
    - The DialogPreferencesNetworkBandwidth dialog works well, and I reworked the DialogPreferencesNetworkProxies dialog too.
    - Working on miscellaneous GUI issues.
    - Fixed the F5 Refresh problem.  Cancelled the event.
    - Working on FramePreferencesAdvanced.
  o 7/31/12 Tue:
    - 6:30 - 18:30
    - FramePreferencesAdvanced works now.  It moves and resets the cloud folder path.
    - All of the preferences UI works pretty well now, but still lots of issues to be covered before it can be considered "shippable".
  o 8/1/12 Wed:
    - 6:30 - 
    - Fixed the button presentation to use StackPanel everywhere.
    - Good page on Window.Closing event and MVVM: http://stackoverflow.com/questions/3683450/handling-the-window-closing-event-with-wpf-mvvm-light-toolkit
    - Animated shutdown sample: http://blog.galasoft.ch/archive/2009/10/18/clean-shutdown-in-silverlight-and-wpf-applications.aspx
    - EventToCommand: http://www.danharman.net/2011/08/05/binding-wpf-events-to-mvvm-viewmodel-commands/
    - I made an OnClosing() function in every ViewModel.  This gets called when the user clicks the Cancel button, or when the user clicks the 'X'. 
    - That change (catching the Closing event via Interactivity) didn't work for the Pages.  Pages don't have Closing events!
    - So I will have to catch the event in the NavigationWindow code behind and somehow get the event to any of the pages that are subscribed
      to that event, asking each if they want to cancel the closing.
    - Or perhaps, we always cancel the closing (to get out of the UI thread), and send a message to any page listening.
    - Who would put up the dialog?
    - Can I make a ViewModel for the NavigationWindow view?  Maybe that ViewModel could put up the prompt?  I think not because the NavigationWindow is not
      allowed to have content of any kind.  All it does is navigate through pages as its content.
    - Research further....
    - I implemented a strategy proposed by Larent: http://blog.galasoft.ch/archive/2009/10/18/clean-shutdown-in-silverlight-and-wpf-applications.aspx
    - That worked for PageHome, but didn't work for the next page (PageSelectStorageSize).
      . I registered the message in the ViewModel.
      . The problem is that the ViewModels may remain in storage, and the message is still registered when the next page is showing.  The result is two
        attempts to show a modal dialog, and neither actually shows.
      . How to fix this?
      . I will have better luck with the views, because they have better-defined protocol when they are active and when they are not.
      . Identify some precise events that will determine whether the page is showing.  Navigating?  Navigated?
      . Register the message in the view when the view is showing, and unregister it when it is not.
      . The view will issue a command to the ViewModel when the message is received, and the ViewModel will put up the modal prompt dialog.
      . Testing shows that the HandleNavigated event is reliable and is fired when the page is shown.
      . Add a message that all pages and frames (also pages) will register.  That message will require that the target page unregister the window closing event.
      . NavigationWindow can send that message just before it drives the HandleNavigate event, so all pages will unregister, then only the target page will register.
      . Still working on this...  Why are the simplest things so difficult????
  o 8/2/12 Thu:
    - 6:30 - 18:45
    - That approach works for PageHome at least.  However, there is another issue.  PageHome actually issues the shutdown in a dialog result handler.
      The shutdown wants to close the window, and the whole process is repeated, ad nauseum!
    - Apparently I need to have a global "shutting down" flag that will shortcut this loop, and actually shut down the application.
    - It seems that the appropriate place for that is the AppDelegate, and maybe much of this should be put there.  However, there is also the CleanShutdown
      ShutdownService, which also seems appropriate.
    - The ShutdownService is meant to actually perform the shutdown.  It sends a message to all registered entities querying whether any of them want to block
      the shutdown.  If none want to block it, the ShutdownService sends another message "NotifyShutdown" to all registered entities, and then shuts down the app.
    - The shutdown occurs via a protocol:
       MyNavigationWindow.Closing event calls ShutdownService.RequestShutdown()
       ShutdownService.RequestShutdown()                              Page
       ---------------                                                ----
       Should we shut down?                                           ==>
                                                                      <==     Since we are not shutting down (yet, via instance flag), reply no, and put up the dialog asynchronously to ask the user.
							 ...  time  ....
                                                                      <==     User says shut down.  Set an instance flag saying we are shutting down.  Call ShutdownService RequestShutdown()
       Should we shut down?                                           ==>
                                                                      <==     Since the shutting down flag is set, reply yes
       Notify all registered entities we are shutting down            ==>
       Call Application.Current.Shutdown on the main thread
    - However, the Application.Current.Shutdown just starts the process all over again.  I still need a global flag to short-circuit this.
    - That flag should just be a static in ShutdownService.  That way it is localized.
    - Try that.  Another issue.  The modal dialog result handler actually issues the shutdown.  It can't do that.  We need to have a single point
      of shutdown, and a call to AppDelegate to clean up resources before actually going down.
    - The dialog result handler needs to asynchronously tell the ViewModel that triggered the dialog that the user said yes.  The ViewModel will
      set its ShuttingDown flag and call ShutdownService.RequestShutdown.  That ViewModel will no longer stop the shutdown.
    - Maybe the appropriate place to clean up resources is in the App.xaml.cs Application_Exit() function.
    - Try that.
    - That works now!  I tested all of the setup dialogs.  They behave properly.  There are some issues with the preferences dialogs and the dialogs.  Working through them...
    - For the preferences window (PagePreferences), there must be a way to detect that there have been changes, and when the user clicks the 'X', ask him if he wants
      to save the changes.
    - Another problem.  When PagePreferences is visible, it also has a visible Frame page (e.g., FramePreferencesGeneral). Clicking the 'X' causes both of the 
      views to get the WindowCloseRequested message.  Really, the frames shouldn't participate in this.  The message should only go to the page.  Remove
      the Frame processing.  Done.
    - Another problem: When comparing the original preferences to the current (possibly changed) preferences, I need to do a deep compare operation that
      gets down to values and/or strings.  Hash code compares obviously don't work, unless the target is a struct.  
    - Deep compare for dictionaries: http://stackoverflow.com/questions/8911866/deep-compare-dictionaries
    - Full comparison library: http://comparenetobjects.codeplex.com/
    - The deep compare works, and now the PagePreferences Cancel button works properly.  So does the 'X'.
    - The PreferencesNetworkBandwidth/Proxies dialog don't prompt to save the changes when clicking Cancel or the 'X'.  Fix that.  But that will require
      displaying a dialog on top of a dialog.  Can we do that?  I don't know why not.  Try it.
    - The dialog over dialog works, but there are some issues with the 'X' processing.  Also, for a dialog, the Update and Cancel buttons result in a 
      window close, which comes in looking like a window close, which would normally be treated as the user clicking the 'X'.  I have to be
      careful handling that case.  When the Update or Cancel buttons are clicked, the ViewModel Update or Cancel Relay Commands are executed, and then
      the window close event occurs.  Also, when the "save?" dialog on dialog is clicked, the result should be the parent dialog closing, but we have
      told the parent dialog to remain open so the child dialog can appear over it.  How do I cause the parent dialog to close?
      I imagine that should be a message to the parent dialog's view to instruct it to close.  Of course that will cause another Window
      closing event, and I have to handle that.  Is this ridiculous or what?
  o 8/3/12 Fri:
    - 7:30 - 18:15
    - Event life cycle for window and page: http://wpf.2000things.com/
    - The dialog on dialog support works properly for DialogPreferencesNetworkBandwidth.  I don't like this UI.  It should be reworked with 
      Bryan for better reusability.
    - Big time waster.  The encryption doesn't produce the same encrypted strings each time.  I need to compare only on the clear text to see if it has changed.  
      That's not especially easy because I am using reflection to compare the preference subsets.  I'll have to decrypt to clear text and compare that separately,
      and set the encrypted version to an empty string for the reflected comparison.  Eeeessshhh!
    - Now the DialogPreferencesNetworkProxies dialog works properly.
    - Now work on catching the PagePreferences 'X' click (or Alt-F4) Close when any dialog is active.  Just ignore it when a dialog is active.  That
      should be easy with the CleanShutdown code.  Just have each of the dialogs subscribe to the CleanShutdown message and respond to ignore the close.
    - That seemed like it would work, and the code seems to be working properly, but somebody navigated to PageInvisible on that event!  Somehow???
    - The problem is that all loaded Pages and dialogs get the WindowCloseRequest, and all of them try to close their windows.  In this specific test,
      PagePreferences was loaded with FramePreferencesNetwork, and DialogPreferencesNetworkProxies was visible.  PagePreferences decided to
      navigate to PageInvisible.  How do I prevent that?  I think each of the ViewModels will need to be aware that a modal dialog is active.  I
      could do that with a message (query), or I could do it with ViewModel instance state information.  The best way to do this would be with
      a message query.  That works now.
    - Work on the minimizing problem.  When launched from the system tray icon context menu, the NavigationWindow should become a full-fledged
      window.  It should minimize to the task bar.  It should only minimize to the system tray when navigating to PageInvisible.  That works now.
    - Minimizing with animation to the system tray in C++: http://www.codeproject.com/Articles/735/Minimizing-windows-to-the-System-Tray
    - Windows API Code Pack: http://archive.msdn.microsoft.com/WindowsAPICodePack/Wiki/View.aspx
    - Animating system tray icons: http://stackoverflow.com/questions/559853/tray-icon-animation
    - VB animate to system tray (works well): http://www.vbforums.com/showthread.php?574806-Minimize-form-to-system-tray-(-quot-animated-quot-)
    - Above downloaded to Downloads\MinimizeToSystemTrayExample
    - More of that: http://stackoverflow.com/questions/76079/how-to-put-an-net-application-in-system-tray-when-minimized       																	         
    - AnimateWindow from C#: http://shalvinpd.blogspot.com/2009/06/win32-api-calls-from-c.html    
    - A C# version: http://netcode.ru/dotnet/?lang=&katID=30&skatID=283&artID=7791  
    - The C# version all prettied up: http://www.codeproject.com/Articles/11019/A-Single-Instance-Application-which-Minimizes-to-t
    - Working on animating to the system tray, and out of the system tray.
  o 8/4/12 Sat: (home)
    - 5:30 - 14:45
    - I have a sample app working.  It animates a window frame to the system tray and back again.  Integrate it into the Cloud app.  Perform
      the animation, then put up a standard toast that says where the Cloud app is located in the system tray.  Also animate the preferences
      window back out of the system tray on the right-click.
    - How and where should this code be located?  It seems that the code that performs the animation should be in the NavigationWindow, because
      that is the window that is being animated.  The animation to the system tray should be triggered by a navigation to PageInvisible, and the animation
      out of the system tray should be triggered by animating to any other page (or away from PageInvisible?).
    - The animation should occur or not based on the normal Windows user registry setting that controls window animation.
    - Use an asynchronous method to control the animation.
    - The animation to the system tray works if the user hasn't disabled window animation in the registry, but it works with issues:
      . The animation is a diminishing rectangle.  It should be a nice transparent diminishing image of the window.  Maybe I can find a way to do that in the future?
      . When already installed and restarting cloud, there is no window, so it shouldn't animate.  Find a way to turn off the animation in that case.
      . The window should animate out of the system tray when bringing up preferences.  The support is there, just call it at the appropriate point.
    - Preventing the first animation:
      . We know it is the first animation when AppDelegate chooses the first Uri for the NavigationWindow to navigate to.  App.Xaml.cs Shows the window
        and the NavigationWindow navigates to the first page.  If that is PageInvisible, we don't want to run the animation logic in PageInvisible.
        How do I get that information to PageInvisible?
      . If the first Uri is PageInvisible, I can set a flag in NavigationWindow.xaml.cs from App.Xaml.cs before showing the window.
      . Then the NavigationWindow view could register a message with a return boolean.
      . Then PageInvisible could query the NavigationWindow view.
      . The querying action would reset the bool as a one-shot.
      . Complex, but it works and prevents globals.  Implement it that way.
      . That works.
    - Now, how should I animate the PagePreferences out of the system tray?
      . That happens when the user clicks the system tray icon context menu, or when the user double-clicks the system tray icon.
      . Those events are known in PageInvisibleViewModel in the ShowPreferencesPageCommand.
      . That causes a navigation request message to the PageInvisible view to request that it navigate to PagePreferences.
      . The navigation request should trigger the animation, and we should wait for the animation to complete before actually navigating to PagePreferences and showing the window.
      . Change the original navigation request message to "TriggerOutOfTrayAnimation", or something like that.
      . That message would start an asynchronous task that would run the animation.  
      . At the end of the animation, the original navigation request would be sent by the animation task thread.
      . Try that.
    - Save and restore window placement to/from settings: http://blogs.msdn.com/b/davidrickard/archive/2010/03/09/saving-window-size-and-location-in-wpf-and-winforms.aspx
    - The animation out of the system tray works with an issue:
      . The window starts way to the left of the system tray.
      . I tracked it down to the fact that I had to change the position of the NavigationWindow to plus-infinity to fix residual screen garbage left when it
        animated into the system tray.
      . The Screen.Bounds function was returning the other monitor as the monitor containing the NavigationWindow.
      . When I properly save and restore the window placement (noted above), that will fix the problem.
      . Tomorrow...
  o 8/5/12 Sun: (home)
    - 5:30 - 12:30
    - Working on the animation.
    - Working on saving the window position.  Works.
    - Both the animation and window position saving are working properly now.
    - The welcome tooltip works after minimizing and animating to the system tray.
  o 8/6/12 Mon:
    - 6:30 - 18:30
    - Working on key accelerators.
    - .Net 4.0 key binding: http://stackoverflow.com/questions/612966/keyboard-events-in-a-wpf-mvvm-application
    - Default enter and esc keys: http://stackoverflow.com/questions/2031322/how-do-you-bind-enter-and-esc-keys-to-ok-and-cancel-buttons-respectively-in-a-wp
    - Binding to resx files via XAML: http://robertoschiabel.wordpress.com/2010/01/31/wpf-add-localization-via-resx-files/
    - Labels work with TextBoxes, not TextBlocks: http://stackoverflow.com/questions/1662132/create-alt-key-shortcuts-in-wpf-xaml 
    - Binding keys to commands: http://stackoverflow.com/questions/3246134/assign-short-cut-key-to-a-button-wpf
    - Accelerators: http://elentok.blogspot.com/2011/02/keyboard-friendy-wpf-applications.html
    - Good Access tutorial: http://wpf.2000things.com/tag/access-keys/
    - The access keys don't work at all.  The underscore appears as a standard character, and doesn't function with the Alt key.  I found the reason.
      Our "StyledButtonTemplate" is not handling the underscore properly.  A standard button works fine.  I got around that one.  I removed the Content=
      attribute and added <AccessText Text="{x:Static resx:Resources.NameOfResource}"/>.  That worked.
    - PageHome has been fixed up with keyboard accelerators, and the Esc and Enter key work properly.  This will serve as a template.  Work on the others...
    - Problem and timewaster: Run Preferences, General, and click the Check for Updates button.  This displays a dialog with an OK button.  The
      Enter key should close it.  The Esc key should close it too.  Pressing the Enter key had the effect of selecting the Preferences OK button underneath
      (which is supposed to be disabled (modal)).  Pressing the Enter key a second time closed the entire Preferences dialog.  Apparently, the IsDefault
      of the parent view was found first in the search from the top down?  I need to disable the parent's IsDefault when a dialog is open.  How best to
      do that?  There is also the problem of a dialog on a dialog.  Consider that in the design.
    - Somehow the last dialog to display needs to deactivate IsDefault and IsCancel for all of the other views, and restore the settings when it closes.
    - How about a message that says save your settings and clear them, and then another message that says restore them?  The messages would not be
      handled if the sender is "this".  These messages could go to the views, but maybe should be handled by the ViewModels instead since I am 
      already using bound IsDefault and IsCancel properties.  NO.  It can't go to the ViewModel.  There is only one instance of that, potentially,
      for multiple views.  It must go to the view.  That works now, and I spread the solution through the whole project.
  o 8/7/12 Tue:
    - 6:30 - 18:30
    - The ChildWindow "modal" dialog isn't modal in many ways!  This is causing a lot of grief.
    - Microsoft WPF modal windows: http://msdn.microsoft.com/en-us/library/aa969773.aspx
    - I got a real modal dialog working in the simple PreferencesGeneral check for updates button case.  Now I need to spread that support
      over the project.  That also means that I should remove some of the code I added to try to get around the non-"modal" ChildWindow problems.
    - Another solution for dialog windows: http://www.c-sharpcorner.com/uploadfile/cordialamit/wpf-practical-solutions/
    - I have real dialogs working, with a set of patterns that work for dialog on dialog, but there are issues caused by the pretty-severe change in design.
  o 8/8/12 Wed:
    - 6:15 - 18:15
    - Scoped IsDefault buttons: http://neilmosafi.blogspot.com/2007/04/default-buttons-in-wpf-and-multiple.html
    - Dialog box design guide: http://msdn.microsoft.com/en-us/library/windows/desktop/aa511268.aspx#modalDialogBoxes
    - KeyDown event handling: http://social.msdn.microsoft.com/Forums/en/wpf/thread/7720a20d-7ad3-4f40-b549-534c272175ec
    - Catch keyboard events: http://stackoverflow.com/questions/11306030/wpf-button-ispressed-and-accelerator-key-trigger
    - Most of the keyboard accelerators are in place.
    - Meeting today with Gus, Steve, Phil and David.  2 months to go, and they want feature parity with the Mac client???
    - I need to reassess the missing code, compared to the Mac.
    - David completed the code of the "GrabEvents" function set.  He will be working on switching from HttpClient to HttpWebRequest tomorrow.
  o 8/9/12 Thu:
    - 6:30 - 18:30
    - I looked through all of the current Mac code and built a new list of to-do's.  Overwhelming!  We might be ready for a real beta by next March!???
    - Implement the Advanced installation scenario.
    - All of the UI is looking good.
    - I cleared 46 TodDo's.
  o 8/10/12 Fri:
    - 6:30 - 18:30
    - Thinking about installation:
      . All-users installation, or single user?
      . The Windows ClickOnce installation is specific to a single user, with the advantage that it automatically downloads and installs only the required prerequisite libraries.
      . The Windows Installer can install applications for all users on a computer, but it might require embedding all libraries in the download, making it larger.
      . The Mac app is single-user.  All syncing and GUI runs as a user process.
      . Would we allow two users (of the computer, in the same account) to share the same cloud folder?
        o Both user processes continue to run, even though only one user can work with a desktop at a time.  Programs could be processing in the Cloud folder.
	o What does Dropbox do?
	  - I found one user who created two instances of Dropbox running as different accounts on the same computer.  One used C:\Dropbox.
	    The other used C:\DropBox\2ndInstance.  The first synced everything.  The 2nd synced just 2ndInstance.
	  - So, apparently it works, even though it might not be supported.
	o What should the relationship between users and folders be?
	o I think it would be valuable to have a common folder (C:\Cloud) on one computer, and multiple users in a family able to see it.  That way, family pictures would be readily available to
	  everyone on the computer, and also synced to other devices.
      . The above seems to imply that the sync process should be a system service, installed for all users.
      . A Cloud folder must be associated with a single Cloud account by design.
      . There would be a system service per Cloud account on a device.  This could actually be a single service, with a thread per account.
      . Would we allow one computer to act as multiple devices in the same Cloud account?
        o Maybe.
	o Each would require its own distinct Cloud folder.
	o Maybe the upload/download of files would occur using "LAN sync" between the separate logical devices.
      . Would overlapped Cloud folders be allowed (each owned by a separate account)?  The resulting protocol might be a little weird, but it would probably work.  Each of the system services
        would be getting the (duplicate, in some cases) file system events, and syncing the events to its own server account.
      . So, it seems that a sync system service per account is the way to go, and that implies an installation that supports all users on the computer.
      . What about the user processes?
        o User processes would handle all UI.
	o Multiple account complicate the UI:
	  - There would probably be a single systray icon.  I can't imagine one for each account.
	  - On the icon context menu, select Preferences.  Preferences for which account?  The UI would probably have to change to a treeview with the account at the top level.
	  - If multiple accounts are installed, the user can certainly drag files to the appropriate Cloud folder via Explorer, but what does it mean
	    to drag a file to the Cloud systray icon?  Which account would that imply?
    - FAQ on MSI packaging and re-packaging: http://voxel.dl.sourceforge.net/project/mayadeploy/FAQ/FAQ%20on%20MSI%20packaging%20and%20repackaging%20Ver%200.0.2.pdf
    - Windows Installer presentation: http://www.google.com/url?sa=t&rct=j&q=windows%20installer%20deployment%20to%20xp%20vista%20win7&source=web&cd=5&ved=0CFgQFjAE&url=http%3A%2F%2Fmschnlnine.vo.llnwd.net%2Fd1%2Fpdc08%2FPPTX%2FPC42.pptx&ei=XxElULiWLIyo8QSav4DwCQ&usg=AFQjCNH-TAHcfe_zuc3dG-rwa8XO8sywCA
    - Installation works!  Tested on XpX86-32, VistaX86-32 and Win7X85-64.  HTTP communication and GUI work fine.  Blows up looking for a database file.
    - Modify Index to automatically create the database file, and to look for DB update scripts in the program folder.  These will look like DbUpdate0001.sql, DbUpdate0002.sql, etc.  If not found,
      it will look for the database .MDF file and open it.  If no .MDF file is found, the base .MDF file will be created.  If update files are found, they will be applied in sequence.
  o 8/11/12 Sat: (home)
    - 5:30 - 15:45
    - 17:00 - 18:00
    - 19:00 - 19:30
    - Installed InstallShield Limited Edition on my home laptop and got it building.
    - Installing a development certificate:
      . Run mmc.
      . Click File, Add-Remove SnapIn
      . Select Certificates (left).
      . Click the right-arrow to add.
      . Select User and OK.
      . Select Certificates again.
      . Add and select local computer, check Allow the selected computer to be changed... Click Finish.
      . Exit the Add-Remove SnapIn utility.
      . Expand Console Root, Certificates Current User, Personal, Certificates.
      . Right-click Certificates and click Import...
      . Navigate to the certificate.pfx certificate that was created via the VS project property screen.
      . Type the password for the certificate.
      . Check Mark this Key as exportable.
      . Check Include all extended properties.
      . Click Next.
      . Select Place all certificates... in Certificate Store Personal.  Click Next.
      . Click Finish.
      . Drag the imported certificate (from center) to Console Root, Certificates-CurrentUser, Trusted Root Certification Authorities, Certificates (left).  Click OK to install.
      . In Visual Studio, open the project properties page and re-import the certificate, entering the password when prompted.
      . Now the project should build.
    - I finally got the whole solution building on my home laptop.  That only took 1.5 hours!
    - There is some unfinished business in installation:
      . COM Registration:
        o The dummy RegisterCom.exe installation program is intended to actually register BadgeCOM.dll.
        o I believe there are two DLL's: 32- and 64-bit.
        o We need to select the proper DLL and use RegSvr32.exe to register it, as in: RegSvr32.exe BadgeCOM.dll.
      . Missing database .MDF file:
        o The Index code will eventually automatically create the .MDF file if it doesn't exist.
        o I need to implement that creation, or just install the initial .MDF file in the proper location.
      . Tackle the COM registration first.  
    - The builds work, including the installation project CloudSetup.
      . The BadgeCOM dll's are located as follows:
        o Debug64: win-client\x64\Debug64\*
        o Release64: win-client\x64\Release64\*
        o Debug: win-client\Debug
        o Release: win-client\Release
      . All other projects are output to:
        o Debug64: win-client\bin\Debug
        o Release64: win-client\bin\Release
        o Debug: win-client\bin\Debug
        o Release: win-client\bin\Release
    - The installation for each of these four configurations is picking the proper files for BadgeCOM as above.
    - RegisterCom.exe should only have to issue RegSvr32 for the BadgeCOM.dll that installation places in the target Program Files directory.
      How do I find that directory?
    - Note on installing x32 vs. x64: http://blog.deploymentengineering.com/2011/01/blair-symes-recently-posted-building-32.html
    - Windows Installer on 64-bit Platforms: http://blogs.msdn.com/b/heaths/archive/2005/10/24/windows-installer-on-64-bit-platforms.aspx
    - 944 page eBook on InstallShield: http://pub.boisrobe.free.fr/The_official_InstallShield_for_Windows_Installer_Developers_Guide.pdf
    - Registering COM objects via C#: http://edndoc.esri.com/arcobjects/9.2/NET/0df20605-b457-42d6-b63c-341a3824474a.htm
    - WiX does what we need: http://stackoverflow.com/questions/6357910/installshield-limited-edition-problems-with-general-information-page-and-crash
    - GUID to the clipboard: http://wix.tramontana.co.hu/tutorial/getting-started/the-software-package
    - Possible to convert from InstallShield to WiX? http://stackoverflow.com/questions/2565435/installshield-to-wix
    - Sample non-InstallShield C++ and C# without source: http://www.simple-talk.com/dotnet/visual-studio/visual-studio-setup---projects-and-custom-actions/
    - Sample C++ DLL: http://www.codeproject.com/Articles/1747/MSI-Custom-Action-DLL
    - Self-registering DLL's: http://www.darinhiggins.com/self-registering-com-net-assemblies/
    - WiX tutorial: http://wix.tramontana.co.hu/tutorial/user-interface/ui-wizardry
    - Launch RegSvr32.exe to do it: http://pcheruku.wordpress.com/2008/09/15/c-sample-to-register-dll-files-programatically/
    - Register in code by loading the DLL: http://www.leberhall.com/2009/07/i-have-need-to-register-some-com-dlls.html
    - It works now, but I don't find it ideal.  I couldn't find a way to run a managed (or unmanaged) EXE that could access the properties
      of the installation.  So I passed the BadgeCOM.dll path into RegisterCom as via the command line.  Then I found a way to
      register the DLL by loading it and calling its RegisterDll entry point.  I still need to clean it up some, and make it silent.
      Currently it puts up a big black window.
    - I fixed the black window.  Now it is silent.
    - Big problem: The installer somehow detects that BadgeCOM.dll is attached to Explorer and wants to kill Explorer, even when it is unregistered
      with RegSvr32 /u.  Investigating.  I removed all references (other then MRU references) from the registry via RegEdit, and InstallShield
      still thinks that Explorer must be killed!  It seems that InstallShield takes a snapshot of the registry, and knows that the Custom Action
      added registry entries to register BadgeCOM as a COM object, and on the next install it uses that information to kill Explorer?????
      Responding to the dialog and saying it's OK that a reboot may be required continues the install, and no reboot is required.
      Now it doesn't happen!  Is it random?  A bug?  In InstallShield?  When this happens, I can remove everything from the registry and
      it won't put up that prompt.
  o 8/12/12 Sun: (home)
    - 5:30 - 15:45
    - I changed the name of the executable (and assembly) to Cloud (from win-client).  That caused an hour-long time-waster due to bugs in VS.
      It wouldn't build.  I added "assembly=Cloud".  Restarted VS.  Still had the problem.  Removed "assembly=Cloud" and restarted VS.
      Now it builds fine!
    - I added all of the assemblies in bin\Release not backed by primary projects.
    - WyBuild Automatic Updater for WPF: http://wyday.com/wybuild/help/automatic-updates/using-automatic-updater-in-wpf.php
    - SharpSetup works with WiX: http://sharpsetup.eu/index.php?option=com_content&view=article&id=62&Itemid=56
    - Create patch files via VS addin: http://www.codeproject.com/Articles/11373/How-to-create-installation-patches-for-VS-NET-depl
    - I researched installers and updaters.
      . Use WyBuild as the updater for the first release.
      . Re-implement the installation using SharpSetup working with WiX (later).
    - I need a test FTP server to test WyBuild.  I installed it on my home laptop.
    - FTP wasn't working.  I found a small FTP server which seems to work great (ftpadmin): http://www.sentex.net/~mwandel/ftpdmin/
    - That FTP program didn't work with ftpadmin.  I guess I need to install IIS.  It's already installed.  However, I still have problems getting
      the updater to connect...  OK.  I got that to work.  WyUpdate expects to use anonymous logins.  That seems reasonable.
    - The WyUpdate test works.
    - Trying to add the AutomaticUpdater control to the WPF app, but there is trouble because it must only go on a Window, and all I have is
      the NavigationWindow that can't take any controls.  Tomorrow....
  o 8/13/12 Mon:
    - 6:45 - 18:30
    - I made a dialog (to get the required Window) and added the AutomaticUpdater control on it.  It works, but it is really ugly, and doesn't fit in with
      the application look and feel.  How should it work?
      . There is a Check for Updates button on the FramePreferencesGeneral page.  There is also a menu button on the systray icon context menu.
      . Ideally, they should both work the same.  It seems that both should put up a modeless dialog window.  That modeless dialog would have the UI necessary to work with the updates.
        o Buttons:
	  - Check Now.
	  - Install Update Now.
	  - Install Update at next start of Cloud.
	  - Done: Exits the window.
	o Text blocks:
	  - Status:  
	    . The most up-to-date version is installed.
	    . An update is available, with the changes listed.  Activates the Install buttons.
	    . Error information on error.
	o Images:
	  - Cloud logo.
      . At startup, put up an invisible modal dialog:
        o Test for an available update.
	o Perform the update
	o Restart the app when update is complete.
      . Perhaps the window should always be active, so the control can periodically check for updates.
      . I am able to hide the control.
      . Run the window hidden.  While running, check for updates and automatically run download and extract them every N days.
      . When the user clicks either of the Check for Updates buttons, show the window and force a check for updates.
      . Clicking the Done button simply hides the window, but it continues to run.
      . When an update is available, show the changes in the status, enable the install buttons and instruct the user.
    - My dialog is working pretty well.  It is a hidden window (off-screen).  It checks for an update as soon as it is activated by
      either button.  It always reports that the program is up-to-date.  Now I have to see what it does when the program is
      out of date.  Time to change the version forward, and take notes below because it is a fairly complex process.
    - The wyUpdate program sees the change, but the test by the control is not producing any events???
    - I worked for quite a while with Mat on the Finder server.  We fixed a bug that happened because the CloudApp.App was not
      getting deleted, so it couldn't be overwritten by the new build.  It happened because we needed to kill Finder because Finder
      was injected and had that executable locked.  We also fixed a couple of other small issues and added some logging.
    - Tomorrow....
  o 8/14/12 Tue:
    - 6:45 - 18:45
    - The AutmoaticUpdater is in Automatic mode by default.  It checks for an available update by itself.  The current state is in the property
      UpdateStepOn.  It is in state UpdateReadyToInstall.
    - Implement a timer to watch this UpdateStepOn and display the current status.  If it is ready to install, enable the Install buttons.
    - Worked with Brian and made him a Blend 4 project that implements only the Styled Button.
    - Git hell: I was working with .gitignore trying to have it include client.wyc and wyUpdate.exe, and killed my local index.  I managed to recover!
    - Working on the updater.
      . In status UpdateAvailable, clicking the Install Now button only downloads the update and presents the:
        o An update is ready to install.  The new update is Version 1.2.  The changes are:
	      o Only changed the version...
      . It is adding an extra line.  Remove that.
      . Change the buttons to read Download Now.  Then when the download is complete, change them to Install.
      . Remove "It will be automatically downloaded."
      . Change status to "Downloading" at the downloading event.
    - The updater works properly now.
    - Started including the open source wyUpdate into the project.
  o 8/15/12 Wed:
    - 6:30 - 18:45
    - Working on issues with build and install.
    - Wrote the WindowsClientScreenShots.docx document (in C:\Source\Projects\win-client\Documents.
  o 8/16/12 Thu:
    - 6:30 - 18:15
    - Working on updating the artwork from the current Mac client.
    - Great icon converter: http://iconverticons.com/
    - Finished updating the artwork as far as I wanted to go.  Brian and Rion will provide new artwork.
    - Started on the shell integration context menu stuff.
    - Nice tutorial to get started with some debugging tips: http://www.codeproject.com/Articles/441/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens
    - Part 2: http://www.codeproject.com/Articles/445/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens
    - Part 3: http://www.codeproject.com/Articles/448/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens
    - Part 4: http://www.codeproject.com/Articles/449/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens
    - Part 5: http://www.codeproject.com/Articles/463/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens (property sheets)
    - Part 6: http://www.codeproject.com/Articles/485/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens (drop handler)
    - Part 7: http://www.codeproject.com/Articles/711/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens (owner draw, and right-click in directory white space)
    - Part 8: http://www.codeproject.com/Articles/722/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens (Add columns to Explorer detail view)
    - Part 9: http://www.codeproject.com/Articles/797/The-Complete-Idiot-s-Guide-to-Writing-Shell-Extens (custom icon for various file types)
    - Windows User Experience GUI Design Guide:   http://www.microsoft.com/en-us/download/details.aspx?id=2695
    - Multithreaded named pipe sample: http://msdn.microsoft.com/en-us/library/aa365588.aspx
    - Simple sample named pipes: http://avid-insight.co.uk/joomla/component/k2/item/589-introduction-to-win32-named-pipes-cpp
    - Named pipe client server sample: http://code.msdn.microsoft.com/windowsdesktop/CppNamedPipeClient-a88eb958
    - C++ and C# named pipe communication snippets: http://www.codeproject.com/Tips/420582/Inter-Process-Communication-between-Csharp-and-Cpl
    - Debugging Shell Extensions: http://bobhood.wordpress.com/2011/04/10/tips-for-debugging-a-windows-shell-extension/
    - More debugging Shell Extensions: http://stackoverflow.com/questions/1331876/debugging-shell-extension-in-windows-7
    - Debugging Shell Extensions from Microsoft: http://msdn.microsoft.com/en-us/library/windows/desktop/cc144064(v=vs.85).aspx
    - Microsoft Shell Extension context menu walkthrough: http://code.msdn.microsoft.com/windowsdesktop/CppShellExtContextMenuHandl-410a709a
    - Restart Explorer: http://social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/9d3b9080-df66-44fd-a949-b0bf29b5e988/
    - More restart Explorer: http://community.spiceworks.com/scripts/show/403-restart-explorer
    - Graceful shutdown of explorer: http://my.opera.com/Devocalypse/blog/2010/02/18/how-to-remove-a-shell-extension-dll-without-restarting
    - Worked with Brian to try to get him a Blend project that would work with Win7 and our XAML files.  No success yet.
  o 8/17/12 Fri:
    - 7:00 - 18:30
    - Debugging COM object:
      . Build BadgeCOM.dll for Debug64.  It builds to win-client\x64\Debug\BadgeCom.dll
      . regsvr32 C:\Source\Projects\win-client\x64\Debug64\BadgeCOM.dll
      . Restart Explorer?
      . Attach to the Explorer process.  (might load a million Microsoft symbols)
      . Place breakpoints in the context menu code.
      . Right-click in an Explorer window.
      . I wrote two cmd files.  Here is a better procedure:
        o Modify the code and build.
        o In a command window run "RegisterBadgeCom".
        o Open an explorer window.
        o Attach to the explorer process indicated for that window.
        o Place your breakpoints.
        o Select files or folders.
        o Right-click on the selected items.  You should hit your breakpoint.
        o Continue when done debugging.
        o Detach All in VS.
        o Run "RestartExplorer" in a command window.
        o Repeat ad nauseum...
    - Good? example of starting a process: http://www.goffconcepts.com/techarticles/development/cpp/createprocess.html
    - Launching a user process with an example of launching cmd.exe (special): http://forum.sysinternals.com/why-does-this-work-createprocessasuser_topic25936.html
    - I can now launch Cloud.exe from the shell extension if it is not already running.
    - We need to prefix the named pipe name with the logged in user name.  I checked the string character requirements of both.  The named pipe name will
      accomodate the user's login name.  Get the login name by Environment.UserName.
    - The name will be the standard pipe name prefix plus UserName/BadgeCOM/ContextMenu.
    - There will be two pipes in use between the shell extension and BadgeNet, one in each direction.
    - The messages must be serialized.  Here is example code:
	Client Side Sending Data:
		NamedPipeClientStream cs = new NamedPipeClientStream("MyServer", "MyPipeName", PipeDirection.Out);
		MyObject messageToSend = new MyObject() { MyProp1 = "Hello", MyProp2 = 7 };
		IFormatter f = new BinaryFormatter();
		f.Serialize(cs, messageToSend);
	Server Side Receiving the Data:
		NamedPipeServerStream ss = new NamedPipeServerStream("MyPipeName", PipeDirection.In);
		ss.WaitForConnection();
		IFormatter f = new BinaryFormatter();
		MyObject messageReceived = (MyObject)f.Deserialize(cs);
	The class used as the message type:
		[Serializable]
		public class MyObject
		{
			public string MyProp1 { get; set; } 
			public int MyProp2 { get; set; }
		}
    - What should be the protocol?  That depends on what I will be doing.
    - Start with the same requirements as the Mac client.  There will be a single context menu item.  Clicking it will
      launch Cloud.exe if it is not already running.  Each right-click will connect to a BadgeNet server side named pipe
      in Cloud.exe.  A single message will be sent one direction only.  The message will have the following info:
      . Screen loction of the mouse click, or the window coordinates of the context menu item.
      . Window coordinates of the Explorer window.
      . An array of full paths representing the items currently selected in the Explorer window.
    - Json Serialization/Deserialization in C++: http://www.danielsoltyka.com/programming/2011/04/15/simple-class-serialization-with-jsoncpp/
    - JsonCpp: http://jsoncpp.sourceforge.net/
    - I have JsonCpp built in BadgeCOM, but is it really the right tool for the job???
    - From the code above, it looks like the deserializer will read right from the stream.  How does it know how many bytes to read?
      Maybe it knows when it has "closure" and quits reading????  Also, the code above uses BinaryFormatter, but I assume I can
      also use a JsonFormatter.  What is the JsonFormatter?
    - MsgPack, like JSon, but smaller and faster? http://msgpack.org/
    - Working on BadgeCom serialization/deserialization over named pipes.
  o 8/18/12 Sat:
    - 5:30 - 15:30
    - BSON (Binary Serialized JSON): http://bsonspec.org/
    - I will use the C++ JsonCpp serializer that is already building, and the JSON.net deserializer until David merges his JSON serialization.  Then
      we can switch to that on the C# side.
    - Installed FileZilla on home laptop to support automatic update.
    - Using JsonCpp to formally serialize and deserialize a C++ class.  Overkill? http://www.danielsoltyka.com/programming/2011/04/15/simple-class-serialization-with-jsoncpp/
    - Using JsonCpp to deserialize an array of strings: http://code.google.com/p/crossaid/wiki/JSON
    - (very little) JsonCpp documentation: http://jsoncpp.sourceforge.net/
    - Example of how to build a JSON object using JsonCpp: http://forum.libcinder.org/topic/cijson-a-jsoncpp-wrapper-for-cinder  (apparently a very old example.  The Json::append method doesn't exist).
    - BadgeCom is working up to the point where it is ready to send the JSON to BadgeNet.  I will start working on getting BadgeNet to properly open the pipe.
    - Using Json.net to deserialize from stream: http://stackoverflow.com/questions/4749639/deserializing-json-to-net-object-using-newtonsoft-or-linq-to-json-maybe
    - I finally managed to get two processes debugging at the same time.  It looks like the pipe transfer is taking place, but BadgeNet doesn't fall out of the call to
      deserialize.  Two approaches: 1) Step into the deserialization and see if it gets any data at all.  2) Perhaps it is getting all of the data, but not a new line,
      because BadgeNet is doing a ReadLine.  Maybe that's not completing.
    - Tips for debugging multiple processes:
      . Attach to another process, or start a process.
      . Right-click on another project and select Debug, Start a new Instance.  That will get both going.
      . To terminate one of the processes, use the Processes Debugging window, right-click one of the processes, and click Terminate Process.
    - Both the client and server processes are opening the pipe, and I am simultaneously debugging both processes (which is tricky), but the current
      bug is that only a single byte is being transferred.  The client is writing 187 bytes, including a newline, but the server is completing the
      ReadLine with only a single byte.  :(.
    - I installed Visual Studio 2012 RTM on my home laptop.  
  o 8/19/12 Sun:
    - 5:30 - 15:30
    - I got the answer while sleeping last night.  DUH!  It should have been obvious.  Why did I not see it and waste that time?  I was using a
      SyledWriter.  That writes the JSON for human consumption, formatted with newlines and carriage returns.  Use FastWriter instead.
    - It works now!  The JSON is deserialized straight into the ContextMenuObject POCO.
    - For now, just copy the selected files and/or folders to the Cloud directory root.  Later we can put up a full window to do lots more.
    - It works!  At the moment, there is a single context menu item "Share to Cloud".  It performs a copy of the selected files and/or folders
      recursively, with the Windows Explorer UI for handling conflicts.  Later we can make this a submenu and/or add another context menu
      item to show the sharing window.  This also shows a taskbar icon with a right arrow and green animated progress indicator.
    - MSDN guide to shell extensions: http://msdn.microsoft.com/en-us/library/windows/desktop/cc144067(v=vs.85).aspx
    - I got the icons working, but surprise!  Wrong icons.  Those are the file/folder icons, not the context menu icons.
  o 8/20/12 Mon:
    - 6:45 - 18:45
    - Using transparent bitmaps for the context menu icon (but it's in C#): http://mmsf.codeplex.com/discussions/245725/
    - Cascading and bitmapped context menus: http://www.codeguru.com/cpp/com-tech/shell/article.php/c4505/Cascading-and-Bitmapped-Context-Menus.htm
    - Drawing transparent bitmaps: http://www.codeguru.com/cpp/g-m/bitmap/article.php/c1753/Transparent-Bitmap--True-Mask-Method.htm
    - Owner drawing is complicated.  Fix it now by changing the background to the context menu background.  That si 0xF1F1F1, or 241, 241, 241.  OK that's done now.
    - Web client: https://web-edge.cloudburrito.com/
    - The context menu is complete enough for R1 and I sent an email documenting it.
    - Start work on the drag and drop operation from Explorer.  When a drag operation is started, slide up a toast from the system tray.  When the user
      drops on the toast, copy the files to the Cloud folder.
    - Drag and drop overview (WPF): http://msdn.microsoft.com/en-us/library/ms742859.aspx
    - Drag and drop walkthrough (WPF): http://msdn.microsoft.com/en-us/library/hh144799.aspx
    - Drop an explorer text file into a WPF textbox: http://social.msdn.microsoft.com/forums/en-US/wpf/thread/a539c487-1dec-4935-b91b-c3ec252eb834
    - Drag and drop is affected by security settings.  Set to least secure to see if it works.
    - Drag a UI object and automatically create a file in a folder: http://blogs.msdn.com/b/delay/archive/2009/10/26/creating-something-from-nothing-developer-friendly-virtual-file-implementation-for-net.aspx
    - Drag an image from an app or an image file from Explorer to a WPF app: http://social.msdn.microsoft.com/Forums/en/wpf/thread/eb0ac25a-4de0-4b93-9be7-3eea0ecf8c62
    - Drag and drop from WPF to Windows Forms: http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/67f2e945-a798-484a-b918-cda1e71699aa
    - Drag and drop to WPF MSDN sample: http://msdn.microsoft.com/en-us/library/ms771747(v=vs.90).aspx
    - Extensive INTRA-application WPF drag and drop: http://www.codeproject.com/Articles/37161/WPF-Drag-and-Drop-Smorgasbord
    - Hooking via Detours for drag and drop: http://stackoverflow.com/questions/1746380/detect-drag-and-drop-operations-in-an-external-application-using-net
    - Shell extension: Creating data handlers: http://msdn.microsoft.com/en-us/library/windows/desktop/cc144163(v=vs.85).aspx
    - Global hook to watch drag and drop operations: http://www.experts-exchange.com/Programming/Languages/CPP/Q_10203575.html
    - A guy trying to do the same thing: http://stackoverflow.com/questions/4109269/register-a-global-hook-to-detect-whether-mouse-dragging-files-text
    - BTW: Comodo.com does exactly this.
    - Global hooks to C# via Windows messages: http://www.codeproject.com/Articles/18638/Using-Window-Messages-to-Implement-Global-System-H
    - More basic global hooks to C#: http://www.codeproject.com/Articles/6362/Global-System-Hooks-in-NET
    - I got the sample mouse and keyboard global hook sample running in C:\Users\robertste\Downloads\GlobalSystemHooksToCs2ndTry.
    - Research how to add the drag and drop callbacks.
  o 8/21/12 Tue;
    - 6:30 - 18:30
    - Working on getting the client installed on cloudburrito.com for download, install and updates.
    - Using SFTP on Windows:
      . Install the FileZilla client.
      . Save the private key file somewhere safe and rename it *.ppk.
      . Run FileZilla client, Edit, Settings, SFTP, and add the *.ppk key file.
      . In the Host field on the main screen, type sftp://50.112.242.112 (or other URL).
      . In the Username field, enter "deploy".
      . Click Quickconnect.
    - Web client: web-edge.cloudburrito.com
    - I was able to install and run Cloud.exe on my laptop from web-edge.cloudburrito.com the first time!  Uninstall works too.
    - I tested the installation and update process from my laptop.  It works.
      . The installation path is http://web-edge.cloudburitto.com/clients/windows/setup.exe
      . The update path is http://web-edge.cloudburitto.com/clients/windows/updates
    - DragOver, DragDrop, etc. snippet: http://social.msdn.microsoft.com/Forums/hu-HU/wpf/thread/b2dabda7-09bb-4381-bf0e-b48167139bee
    - Detours (sophisticated hooking of any binary): http://research.microsoft.com/en-us/projects/detours/#publications
    - Great sample for dragging files from an app to and from Explorer: http://www.codeproject.com/Articles/840/How-to-Implement-Drag-and-Drop-Between-Your-Progra
    - Shell extension drop handler description only: http://everything2.com/title/drop+handler
    - Some source code that works with hooks and drag/drop: http://www.koders.com/cpp/fidED6F39D1109ED9DBBE0F6D8B838A6B6E5E5DA67A.aspx?s=wh_cbt
    - A reference to hooking DoDragDrop: http://forums.codeguru.com/showthread.php?480710-How-to-hook-drag-and-drop-functionality-of-windows
    - DoDragDrop disables all mouse move events: http://stackoverflow.com/questions/2664905/dodragdrop-disables-mousemove-events?rq=1
    - Get intra-app mouse position with GetCursorPos(): http://blogs.msdn.com/b/jaimer/archive/2007/07/12/drag-drop-in-wpf-explained-end-to-end.aspx
    - SetWindowsHookEx: http://msdn.microsoft.com/en-us/library/windows/desktop/ms644990(v=vs.85).aspx
    - Drag between any CWnd-derived window: http://www.codeguru.com/cpp/misc/misc/draganddrop/article.php/c255/Drag-and-Drop-Between-Any-CWndDerived-Window.htm
    - Injection library written in Delphi (public domain): http://proger.i-forge.net/ApiHook_%E2%80%93_Win32_API_hooking_tool/7wP
    - How should this work?
      . Suppose the user starts dragging an item, but never drags it to the Cloud app, and drops it back at the same place.  No drag and drop actually occurred.
      . In this case, I need to see the starting event, the mouse moves (with coordinates) and the ending event.
      . What are those events?  
      . I need to hook the DoDragDrop OLE function:
		The OLE function DoDragDrop implements a loop that tracks mouse and keyboard movement until such time as 
		the drag is canceled or a drop occurs. DoDragDrop is the key function in the drag and drop process, 
		facilitating communication between the drag source and drop target. 
      . Can I get into the middle of that loop?  To track mouse and keyboard movement?  And know when it's over? http://msdn.microsoft.com/en-us/library/windows/desktop/ms692464%28v=vs.85%29.aspx
      . See http://msdn.microsoft.com/en-us/library/ms678486(v=vs.85).aspx for the way DoDragDrop works.
      . If I hook the DoDragDrop function, I will know when the operation ends because DoDragDrop is a black hole.  It is called in the middle of a mouse move event,
        and it doesn't return until the drag/drop operation is complete.  It returns with DRAGDROP_S_DROP (successful), DRAGDROP_S_CANCEL (cancelled) or E_UNSPEC (error).
      . DoDragDrop function: http://msdn.microsoft.com/en-us/library/ms678486(v=vs.85).aspx
      . DoDragDrop calls the IDropTarget::DragOver with each mouse move while the mouse is still in the target drop area.
      . DoDragDrop calls IDropTarget::DragLeave when the user cancels, or when the mouse leaves the drop window.
      . Use shell extensions to build a custom folder view: http://www.codeproject.com/Articles/88/Namespace-extensions-the-undocumented-Windows-Shel#SFVM_GETDRAGPOINT
      . Tutorial on API hooking: http://www.codeguru.com/cpp/w-p/system/misc/article.php/c5667/API-Hooking-Revealed.htm
      . Really good tutorial and samples of different process injection techniques (old? 64-bit?): http://www.blizzhackers.cc/viewtopic.php?p=2483118
      . Old survey of various API spying techniques: http://www.internals.com/articles/apispy/apispy.htm
    - So, the best design so far:
      . Use a regular C++ DLL.  (Is this possible, or do I need a COM DLL?)
      . The DLL will hook DoDragDrop.  (How do I actually hook it?)
      . When the DoDragDrop handler is called, the drag/drop operation has started.
      . This event will trigger drag/drop handling (below).
      . Call the DoDragDrop base function.
      . When the DoDragDrop base function returns, the drag/drop operation is complete (successful, cancelled or error)
      . This event will complete the drag/drop handling.
      . Return from the DoDragDrop hook.
      . The DLL will post events to C# via delegates.
      . We will have one or more dedicated threads in Cloud (C#) to handle the drag/drop functionality.
      . At the start event, start a 50 ms timer.  This timer will use interop to call GetCursorPos() to get the current mouse position.  No mouse events are fired while in DoDragDrop.
      . At the start event, begin the animation to slide up the drop target from the systray area.
      . At each mouse event, calculate the multi-monitor distance from the drop window.  As the distance gets closer, animate the transparency toward more opaque.
      . Change the text and opacity of the drop area when DragEnter occurs.
      . Change the text and opacity of the drop area when DragLeave occurs.
      . Handle the DragDrop event and determine what was dropped.  Handle it appropriately (that's also a difficult function).  Trigger the animation of the disappearing drop target.
      . At the DragDrop completion event, trigger the animation of the disappearing drop target.
      . With this design, the drop area only appears when Cloud is running.  That's what I think we want.
    - Is it possible to use a regular DLL?  Yes.
    - How do I hook the DoDragDrop function?
      . This tool supposedly works for XP and Vista.  Win7?????  http://www.codeproject.com/Articles/2082/API-hooking-revealed
      . EasyHook (with big licensing issues): http://easyhook.codeplex.com/
      . Detours ($10K).
      . A hooking DLL: http://www.autoitscript.com/forum/topic/87240-windows-api-hooking-injecting-a-dll/
      . X86/X64 hook engine (but does it globally hook?): http://www.codeproject.com/Articles/21414/Powerful-x86-x64-Mini-Hook-Engine
      . Old injection article: http://www.codeproject.com/Articles/4610/Three-Ways-to-Inject-Your-Code-into-Another-Proces
      . App_Init DLLs (would work, but would probably require a reboot): http://www.codeproject.com/Articles/49319/Easy-way-to-set-up-global-API-hooks
      . I will try to use EasyHook (just for internal use) and see if we can get around the license issues.
    - Does the Shell Extension drag/drop handler see operations outside Explorer?  No.  It doesn't see any drag events.  It is just used to add
      items to the drop context menu (ContextMenu handler), and to add custom items to the persisted data in the clipboard (data handler).
  o 8/22/12 Wed:
    - 6:30 - 18:30
    - Fixed some issues, and then started working on the Badging.
  o 8/23/12 Thu:
    - 6:30 - 18:00
    - BadgeNew compiles with the new FilePathDictionary.  I changed all of the string paths to FilePath, and removed the Nullable badge types.
    - When setBadge is called from the SqlIndexer, what items are badged?  It seems that the items are the leaves are the things that are being completed,
      but the leaves have a complete path, so the badging status may be affected up the tree.  For example, suppose the C:\A\B\C.txt is added, and
      C:\A is the root of the Cloud directory.  Then C:\A, C:\A\B and C:\A\B\C.txt should be badged as syncing.
    - Don't use .Add to add a badge (may throw).  Use dict[] = X.
    - To remove an item, use dict[] = null;
    - To refer to an item, use TryGetValue.
    - Convert all Settings.Instance.CloudPath to a stored FilePath (faster).
    - What are the rules for the icon type bubbling?
      . A SyncSelective should be badged individually, it should not bubble up.
      . Any SyncError should be bubbled  up as SyncSyncing
      . Any SyncSyncing should be bubbled up as SyncSyncing
      . SyncSynced is represented as no value.
      . If no value, it bubbles up as SyncSynced
      . Values are not set, just queried to make the determination.
      . Use a postorder deepest first recursion.
      . The children of a node will determine the node's badge type.
    - There are two types of events handled by BadgeNet:
      . SqlIndexer is setting a badge (setBadgeType(type, path)
      . One of the four COM objects has sent a query: I am the handler for a particular badge type.  This event carries a full path to the file system
        item.  Should this file system item be badged with my icon?  True or False.
    - Algorithm for setBadgeType(type, path)
        if type == synced
	  set the Value at this node to null (means synced)
	else type != synced
	  set the Value at this node to the type
	endelse type != synced
        ; Do this as the last action in setBadgeType
	; Use the FilePath.Parent to recurse up.  Until null or equal to Cloud path
	; FilePathComparer.Instance.Equals(parm1, parm2)
	; Instance of FilePath also has FilePath.Contains.
	recurse up the tree to and including the Cloud folder root
	  Notify this node to the file system (causes the file system to update the icon)
	endrecurse up the tree to and including the Cloud folder root
    - Algorithm for the badge query(type, path) (in RunServerPipe()
        if path.Contains(CloudRoot)
	  value = TryGetValue(path)
	  if value != null
	    if value == type
	      return true
	    else value != type
	      return false
	    endelse value != type
	  else value == null
            ; If an item is selective, then none of its children (hierarchy) should be badged.
	    if this path != CloudPath
	      recurse through parents of this node until and including the CloudPath
	        if the value at this node is not null and is SyncSelective
		  return false
	        endif the value at this node is not null and is SyncSelective
	      endrecurse through parents of this node until and including the CloudPath
	    endif this path != CloudPath
	    ; Determine the badge type from the hierarchy at this path
	    try
              tree = GrabHierarchy at path
	      desiredBadgeType = GetDesiredBadgeTypeViaRecursivePostorderTraversal(tree)
	      if type == desiredBadgeType
	        return true
	      else type != desiredBadgeType
	        return false
	      endelse type != desiredBadgeType
	    endtry
	    catch
	      if type == synced
	        return true
	      else type != synced
	        return false
	      endelse type != synced
	    endcatch
	  endelse value == null
        else !path.Contains(CloudRoot)
	  return false;
        endelse !path.Contains(CloudRoot)
    - BadgeType GetDesiredBadgeTypeViaRecursivePostorderTraversal(node)
        ; Nodes are FilePathHierarchicalNode<GenericHolder<cloudAppIconBadgeType>>
	if node == null
	  return synced
	endif node == null
        loop through all children of node
	  returnBadgeType = GetDesiredBadgeTypeViaRecursivePostorderTraversal(child)
	  if returnBadgeType != Synced
	    return returnBadgeType
	  endif returnBadgeType != Synced
        endloop through all children of tree
        if this node has a value
          switch on value
          case synced
	    return synced
          case syncing
            return syncing
          case error
            return syncing
          case selective
	    return synced
          endswitch on value
        else this node doesn't have a value
	  return synced
        endelse this node doesn't have a value
    - Time-waster: Setting up chat on cloudburrito and Yahoo with Trillian on both Windows computers, and iMessage on Mac.
    - Testing the badging support using the CloudTest project...
  o 8/24/12 Fri:
    - 6:30 - 18:30
    - Testing badging.  Debugging between C# and C++ Explorer was getting nowhere.
    - I wrote two trace subsystems that output trace from the C# CloudTest process and the BadgeCOM Explorer to the same interleaved file.
  o 8/25/12 Sat: (home)
    - 6:30 - 14:30
    - Codeplex article on icon overlays: http://www.codeproject.com/Articles/7484/How-to-overlay-an-icon-over-existing-shell-objects
    - I got it working, but it is not responsive at all, and it is chewing up handles like mad, and it seems to be very fragile.  It needs to be redesigned.
    - It takes more than a second to switch the badge.  If I rebadge in a loop, the badges seem to change sometimes every second, but sometimes
      after 2 seconds.  The badges don't appear in order.
    - A faster way to send data to Cloud would be to use Windows messages IPC.  But can I get the info back?  One way would be for Cloud to
      send an IPC message to Explorer, but we didn't write that code.   We wouldn't get it.
    - Tutorial on IPC: http://www.codeproject.com/Articles/13724/Windows-IPC
    - MemoryMapped IPC: http://www.codeproject.com/Articles/12909/Synchronization-of-multiple-reader-and-writer-proc
    - Sample that reads and writes messages via Memory-mapped Files: http://code.msdn.microsoft.com/windowsdesktop/Inter-process-communication-e96e94e7/view/SourceCode#content
    - Ideally, I would like to replace all of the named pipes with MMFs.  One consideration for the context menu is that the size of the data is potentially unlimited.
      I would need to set up a protocol to transfer chunks of the transmission.  The badging doesn't have that problem.
    - The sample above would work fine for C#, but I also need it to work with C++.
    - Marshalling data from C++: http://stackoverflow.com/questions/10723973/external-application-receives-message-but-no-contained-data-using-sharedmemory
    - C++ MMF sample: http://www.codeguru.com/cpp/article.php/c17975/C-Programming-Memory-Mapped-Files-using-RAII.htm
    - Fix .lnk file associations: http://www.winhelponline.com/blog/unassociate-file-types-windows-7-vista/, or run C:\Users\robertste\Downloads\FileTypeAssociationsFix\lnkfix_vista.reg.

  o 8/26/12 Sun: (home)
    - 5:30 - 15:45
    - Build the MMF IPC mechanism for the badge support.  Here are the requirements:
      . For each user, there will be one Cloud process, and multiple Explorer processes (all in that user's space).
      . The Cloud process will communicate independently with each Explorer process.
      . Cloud will create and dispose the MMF.
      . The MMF will be named so all processes can find it.
      . The MMF name will be <Username>/BadgeCOM/MMF
      . The MMF will not have a backing file.
      . The MMF will be created by Cloud during core service open.
      . The MMF will be opened by Explorer dynamically (see below).
      . All synchronization mutexes should also be opened once at initialization.
      . The Explorer shell Extension IsMemberOf() function queries whether to display a badge (true or false).
      . The time spent in the IsMemberOf() function should be minimal.
      . Handle all error situations.  The Cloud process may crash, and any Explorer process may crash.
      . IsMemberOf (Explorer) needs to know if the Cloud process is actually active and responding.  A test message will be exchanged
        to see if Cloud is responsive.  Any error or timeout will cause IsMemberOf to immediately exit with no badge.
      . Each communication channel (Explorer <==> Cloud) will be synchronized by a named mutex.
      . The Mutex name will be <Username>/BadgeCOM/<ProcessId>/Mutex  
      . IsMemberOf will immediately exit with no badge in the following cases:
        - The existing named MMF cannot be opened.
        - MMF cannot be mapped.
        - The mutex cannot be opened.
        - Any error accessing the mutex.
        - The opening message exchange has an error or times out.
        - Any error or timeout sending the path to Cloud or receiving the badging result from Cloud.
      . Cloud should dispose the MMF when stopping the core services, or when exiting the application.
      . Each Explorer process must be allocated a separate area in the MMF for its communication with Cloud.
      . For that purpose, there will be a common area allocated for all Explorer processes to use for the
        initial message exchange.  Explorer will send its process ID, and Cloud will respond with the
        communication offset and length in the MMF.
      . A different mutex will be used to synchronize the initial message exchange.
      . That mutex will be named <Username>/BadgCOM/Mutex.
      . Initially, the messages will have a maximum size.  This is possible with IsMemberOf() because Explorer only sends
        a single full path, and receives a single byte response.  However, in the future we may use this mechanism with
        the context menu support.  In that case the amount of information sent by Explorer is open-ended, and we will need
        to implement chunked transfer.
      . Initialization, or re-initialization, should occur dynamically.
        - Usually, Explorer starts first, but not always.
        - Explorer may be stopped and started.
        - Cloud may be stopped and started.
        - In any order, initialization or re-initialization should occur.
        - Since Cloud is responsible for creating the MMF, each Explorer process must have a watcher.
        - At Explorer COM object init (GetOverlayInfo()), start a watcher thread.
        - The watcher thread will initialize and perform keep-alive messaging.
        - The watcher determines the connection status, and Explorer will not badge if not connected.
        - When not connected, the watcher will periodically attemt to reconnect.
      . Wrap the access to this communication channel in a class and make the API simple.  Call the class ClCommMMF.
        - From Explorer (C++):
          o At open):
                 try
                 {
                   _badgingOpen = false;
                   ClCommMMF *_comm = new ClCommMMF();
                   if _comm != NULL
                     _comm->Open();
                     badgingOpen = true;
                   endif _comm != NULL
                 }
                 catch
                 {
                 }
                 ...
          o At badge request (IsMemberOf()):
                 bool shouldBadgeBeApplied;
                 try
                 {
                   if _badgingOpen
                     shouldBadgeBeApplied = _comm->ShouldBadgeBeApplied(path);
                   else !_badgingOpen
                     shouldBadgeBeApplied = false;
                   endelse !_badgingOpen
                 }
                 catch
                 {
                   shouldBadgeBeApplied = false;
                 }
        - From Cloud (C#):
          o Implement as a singleton.
          o At open (StartCoreServices):
                Func(string, bool) delegate = DelegateShouldBadgeBeApplied.
                CLError error = CLCommMMF.Instance.Open(delegate);
                if (error != null)
                {
                  process error
                }
          
          o DelegateShouldBadgeBeApplied(path):
                determine whether this path should be badged
                return result
           
          o At close (StopCoreServices, or application exit):
                ClCommMMF.Instance.Dispose();
    - ToDo's:
      . Build a small test C# project that tests the robustness of the multiple-process access.
      . What happens when the Cloud process crashes with the MMF open?  How does Explorer see that?
    - This seems pretty difficult, and maybe even more complex than the named pipe support.
    - Can I fix the named pipe support?
    - I can see these issues:
      . Does the current client create a new instance of the named pipe for each message?  If not, that would be a problem.
      . Should I implement the watcher thread to always attempt to keep the pipe open?  Would that increase performance?
      . If a new instance is being created for each method, should I just make the pipe bi-directional?  Would that increase performance?
    - Using multiple named pipe clients with one server: http://stackoverflow.com/questions/5584211/named-pipes-usage-multiple-clients-one-server-multiple-parallel-requests
    - Server pseudo-code for the above: http://stackoverflow.com/questions/4451805/windows-named-pipe-issue-error-code-233-alternates/4475816#4475816
    - Untested server code (but looks pretty good): http://stackoverflow.com/questions/4570653/multithreaded-namepipeserver-in-c-sharp/5054851#5054851
    - A tested (C++) multithreaded pipe server: http://msdn.microsoft.com/en-us/library/aa365588(v=vs.85).aspx
    - The C++ client that works with the above server: http://msdn.microsoft.com/en-us/library/aa365592(v=vs.85).aspx
    - Maybe we have only two problems:
      . The server threading model is wrong.  I need to spin up a new thread for each communication.
      . I should use bidirectional pipes to do the request/response.
    - Try implementing that....
    - It is working, but it still has issues.  Some pipes are failing to open after waiting for the server because the pipe is busy.  Why is it busy?
      The server threading model should have taken care of that.  The client WriteFile is failing with an error 6 (invalid handle).
    - Things to try:
      . Try not waiting for 2 seconds.  That sounds wrong anyway, but may end up with the wrong badge.
      . Why is it busy.  There should be instances available.  Keep a count of used instances on the server.  Maybe I'm using up all 254???  
  o 8/27/12 Mon:
    - 6:15 - 18:30
    - Things to try:
      . Retry errors from the 2 second wait.
      . Close the handle when retrying.
      . Try without logging.
    - It works now!  No errors, and responsive.  It is still very sluggish when trace is on, but that is to be expected.
    - That support broke the context menu copy.  Added trace to the Context menu support.
    - The context menu support is fixed now.  I will start looking at integrating the badging into SQLIndexer.
    - Notes for SQLIndexer badging:
      . Set badge synced on a completed event.
      . Perform some operation when making a new sync point.?????
      . Merge event:
      . Add event:
      . Build index:
        o Badge where "DoNotAddToSql == false"????  IndexingAgent: 1323
      . IconOverlay needs to subscribe to a move event from SQLIndexer?????
        o Only fire for new move events, not completed move events.
	o Badge as syncing at the move "new" path.
    - The first pass of the integration is coded and built.
  o 8/28/12 Tue:
    - 6:00 - 18:30
    - Access MDS server: https://mds-edge.cloudburrito.com/folder_objects
    - David and I integrated the badging calls into the indexer.  It seems to be working properly.
    - Started testing installation.  It crashes on XP.  Some serious debugging with WinDbg.  We finally got the environment set
      up to debug CLR.  The issue:  We need SQL Express in the installation.  David is working on that.
  o 8/29/12 Wed:
    - 6:30 - 19:00
    - Fixed bug: The app would not exit because the named pipe server threads were stuck waiting for client connections.
    - Applying the new design assets and reworking the GUI.  I finished setup through PageSelectStorageSize.
    - David finished coding and testing the database SqlCe implementation.
    - We tried to install it on Xp64, and ran into the same InstallShield bug when trying to select SqlCe as a prerequisite.  Fighting that....
  o 8/30/12 Thu:
    - 5:30 - 18:15
    - Debugging with WinDbg, I saw the following:
	System.Windows.Data Error: 40 : BindingExpression path error: 'ToolTipText' property not found on 'object' ''PageInvisibleViewModel' (HashCode=19651376)'. BindingExpression:Path=ToolTipText; DataItem='PageInvisibleViewModel' (HashCode=19651376); target element is 'Button' (Name=''); target property is 'ToolTip' (type 'Object')
	System.Windows.Data Error: 40 : BindingExpression path error: 'IconSource' property not found on 'object' ''PageInvisibleViewModel' (HashCode=19651376)'. BindingExpression:Path=IconSource; DataItem='PageInvisibleViewModel' (HashCode=19651376); target element is 'Image' (Name=''); target property is 'Source' (type 'ImageSource')
    - Several first-chance exceptions are presented, but handled (norma), then I get:
	Message:  Unable to load the native components of SQL Server Compact corresponding to the ADO.NET provider of version 8876. Install the correct version of SQL Server Compact. Refer to KB article 974247 for more details.
    - That's the same problem we have been having.
    - However, I installed that prerequisite .msi on the XP64 machine.  
        \\ftlwrobertste02.eng.citrite.net\C\Program Files (x86)\InstallShield\2012LE\SetupPrerequisites\MSXML 6.0 SP1\x86\msxml6_x86.msi (that's really the SqlCe installer.
    - It can also be found here on my machine, as downloaded from InstallShield:
	C:\Program Files (x86)\InstallShield\2012LE\SetupPrerequisites\SQL CE 3.5
    - I found the solution here.  We need to install the 4.0 version of SqlCe: http://kb.flexerasoftware.com/selfservice/microsites/search.do?cmd=displayKC&docType=kc&externalId=http--communityflexerasoftwarecom-archive-indexphpt-197273html&sliceId=&docTypeID=DT_MACROVISIONCOMMUNITY_1_1&dialogID=133703293&stateId=0%200%20133697655
    - That works when manually installed on XP64.  Tha app runs and syncs, but no badges.  That's because there is an error registering BadgeCom.dll.  It is looking for the following files (via Depends):
      . MSVCP110.DLL
      . MSVCR110.DLL
      . ATL110.DLL
    - Those files should be included in the Visual C++ 11.0 CRT and ATL redistributables (x86 and x64).  I included those prerequisites in InstallShield, but it wouldn't build.  Something about I had to select Intel64 or Amd64 since I
      had selected a 64-bit component.  I researched that, and it looks like I would need the full product, so I unselected the 64-bit redistributables to see if that would work.  It built.
    - I found that I needed to manually install the SqlCe 4.0 engine.  Now Cloud runs and syncing works on Xp64, but badging is broken.
    - Reset MDS account: POST https://mds.cloud.com/folder_objects/reset?user_id=10
    - The artwork has been applied (but not fully tested to all of the setup-related pages.
  o 8/31/12 Fri:
    - 5:30 - 18:45
    - Down to the wire...  It deploys now on Win7-64.  I completed the GUI artwork updates and tested them.
    - Working on bug that causes Explorer to continuously reboot after uninstalling Cloud.  The program is written (RegisterCom.exe) and we are testing it.
    - The RegisterCom.exe is working, and we are close to a downloadable installation that works on Win7-64.
  o 9/1/12 - 9/8/12 Cruise
    - I worked about 10 hours on the context menu shell extension, and researching how to build drag/drop to the systray area.
  o 9/9/12 Sun: (home)
    - 5:30 - 14:30
    - Systray icon always visible: http://forums.codeguru.com/showthread.php?306661-How-to-always-show-an-icon-in-system-tray
    - I couldn't find a way to build a driver that would hook OLE32.DoDragDrop for all users and all processes.  It is probably possible, but I couldn't find any reference on the web.
    - This is a user thing, and each process must be injected.
    - I will use EasyHook to do the injection.
    - The initial list of processes for this user is easy, but what about new processes that come along.
    - Process creation notification isn't easy: http://forum.sysinternals.com/process-create-exit-notification-the-easiest-way_topic19180_page4.html
    - The easiest way is to enumerate the processes on a timer and inject them as they come into play.
    - Keep a list of the processes for this user, along with the PID and some other info (such as the process name?).  Inject the new ones.
    - Each of the injected processes will hook OnDragDrop() and send a message ("Enter") before calling the base, and another message ("Leave") on return from base.
    - Only one such pair of messages is expected because OnDragDrop is synchronized by the clipboard.
    - When "Entered", Cloud will slide up a window out of the systray area (the Drop window).  Initially, the window will be mostly transparent.  The text will say something
      like "Drag the object here to share to the Cloud folder."
    - The systray  Drop window ViewModel will start a timer to monitor the mouse position every 50 ms.
    - The distance to the systray area is calculated from the mouse position coordinates.
    - As the distance gets smaller, the Drop window becomes more opaque.
    - When the mouse enters the Drop window, it will begin to receive MouseOver events.  Then the text in the window will change
      to "Drop the object here to share to the Cloud folder."
    - When the user drops the object, it will be copied to the Cloud folder, and the Drop window will animate away.
    - Establish a DragDropService that will start and stop with the core services.
    - The trigger to show the window will be an MvvmLight message to PageInvisible.
    - PageInvisible will hide the systray icon and show the TaskbarIconAnimatedWindow.
    - The TaskbarIconAnimatedWindow will derive from TaskbarIcon, and will provide the mouse coordinate watch timer, animation of the
      transparency, changing of the window text, and the actual sharing operation (copy files, create virtual files, etc.)
    - The EasyHook files must be registered at installation using admin privileges.
    - Pseudo-code:
      StartService:
        instantiate the DragDropServer class
        call class.Start() to start the server
      DragDropServer.Start()  
        indicate started
        start a timer to update the process list (OnTimerProcessUpdate), 250 ms.  Fire immediately
        start a timer to process the inbound queue of injection messages (OnTimeCheckInjectionMsgQueue), 100 ms.  Fire in 100 ms.
        call IpcCreateServer to create the server end of the notification channel
      DragDropServer.Stop()  
        lock
          indicate stopped
        endlock
      OnTimerProcessUpdate:
        lock
          disable the timer
          if stopped
            return
          endif stopped
          enumerate all of the processes for this user (current process list)
          foreach process in the enumeration
            if the enumerated process is not in the hooked process list
              inject the enumerated process
              add the enumerated process to the hooked process list
            endif the enumerated process is not in the hooked process list
          endforeach process in the enumeration
          enumerate all of the hooked processes
          foreach hooked process
            if this process not in the current process list
              remove this process from the hooked process list
            endif this process not in the current process list
          endforeach hooked process
          enable the timer for 250 ms
        endlock
      OnTimerCheckInjectionMsgQueue:
        lock
          disable the timer
          if stopped
            return
          endif stopped
          loop removing queued items
            if "Enter"
              send MvvmLight message to PageInvisible to start the TaskbarIconAnimatedWindow
            elseif "Leave"
              send MvvmLight message to TaskbarIconAnimatedWindow to quit
            endelseif "Leave"
          endloop removing queued items
          enable the timer for 100 ms
        endlock
    - The code for the client and server builds, and I pushed the changes.  I will instrument that code and test it, then
      move onto the code for the Drop window.
  o 9/10/12 Mon:
    - 6:30 - 18:30
    - Installing 64-bit DLLs using Deflate: http://darenatwork.blogspot.com/2011/05/adding-both-32-and-64-bit-versions-of.html
    - CorFlags utility: http://blogs.msdn.com/b/joshwil/archive/2005/05/06/415191.aspx
    - 64-bit, 32-bit exes and dlls: http://blogs.msdn.com/b/joshwil/archive/2005/04/08/406567.aspx
    - I spent the whole day trying to get injection to work.  There is a 64-bit/32-bit build issue that is preventing the injection dll from loading.
  o 9/11/12 Tue:
    - 6:30 - 18:45
    - Great example of post-build commands in Visual Studio: http://geekswithblogs.net/dchestnutt/archive/2006/05/30/80113.aspx
    - I have injection working, but there are still a lot of issues, including leaving EasyHook32.dll locked in many processes if we ever crash.
    - Put that project on hold for a while and work on the user interface.
  o 9/12/12 Wed:
    - 6:15 - 7:45 (home)
    - 11:00 - 18:30
    - Adding a folder to favorites: http://stackoverflow.com/questions/4271759/how-do-i-programmatically-add-a-folder-to-the-users-favorites-in-windows-explo
    - More on that: http://social.msdn.microsoft.com/Forums/en-IE/csharpgeneral/thread/4d65a7e5-1c02-4c18-bbc0-8d49340ca5f7
    - Another referecence on add/remove folders: http://www.codeproject.com/Articles/146757/Add-Remove-Startup-Folder-Shortcut-to-Your-App
    - The Favorites folder for IE is C:\Users\Robertste\Favorites.
    - The Favorites folder for Explorer is C:\Users\Robertste\Links.
    - Adding to Internet Explorer and Explorer Favorites, and removing them, work now.
    - Adding and reseting the custom Cloud folder icon works now.
    - Adding and removing shell links (quick launch, AutoStartAtLogin, Shortcut on Desktop, SendTo Explorer menu: http://www.codeproject.com/Articles/3905/Creating-Shell-Links-Shortcuts-in-NET-Programs-Usi
    - Another tutorial on shortcuts: http://www.geekpedia.com/tutorial125_Create-shortcuts-with-a-.NET-application.html
    - It mostly works, but the shortcut removal logic is actually creating the Cloud folder.  Fix that bug tomorrow.
  o 9/13/12 Thu:
    - 6:30 - 18:45
    - David worked with me to make the location of the Settings IsolatedStorage file independent of the direction location of the assembly accessing the Settings.
    - Install and uninstall copy the RegisterCom.exe and BadgeCom.dll files to the System32 directory so they can be found after uninstall wipes all of our files.
      Unfortunately, the shortcut support required me to include CloudApiPrivate.  That required me to include a lot of other 3rd-party DLLs into the System32 directory.
      Instead of that, I will make a subdirectory in ProgramFiles to hold all of the required DLLs, and I will copy them there at install, for use during uninstall.
      Uninstall will remove those files, and hopefully, everything up to and including the Cloud.com folder.
    - I also need to refactor the server unlink support into CloudApiPrivate so RegisterCom will have access to it to unlink the device from the server during uninstall.
    - I fought a time-waster for a couple of hours.  I was copying the RegisterCom.exe and BadgeCom.dll into System32, but InstallShield was looking for them in
      SysWOW32 instead.
    - List of DLLs needed in Program Files:  Make a directory CloudSupport:
      . RegisterCom.exe
      . BadgeCOM.dll
      . CloudApiPrivate.dll
      . CloudApiPublic.dll
      . Microsoft.Net.Http
      . 
    - The installation side works.  I refactored RegisterCom to move the required uninstall files into a ProgramFiles subdirectory (CloudSupport).
  o 9/14/12 Fri:
    - 6:30 - 18:30
    - I'm having trouble deleting the currently-executing assembly (RegisterCom.exe) and its dependent DLLs.
    - Maybe I can use shadow copy to achieve this? http://msdn.microsoft.com/en-us/library/ms404279(v=vs.100).aspx
    - Try this solution using a self-erasing batch file: http://stackoverflow.com/questions/2245201/how-can-i-make-my-net-application-erase-itself
    - Create the batch file in the tmp directory.
    - Drive the batch file and exit before restarting Explorer
    - The batch file should:
      ; Name it CloudClean.cmd
      ; Parameter: path to this batch file, including filename.ext
      ; Parameter: C:\Program Files (x86)\Cloud.com\Cloud
      ; Parameter: Explorer.exe path, including filename.ext
      loop up to 3 times
        wait 1 second
        taskkill Explorer
	if BadgeCom.dll is in CloudSupport, unregister it
        attempt to delete all files in CloudSupport
	if the CloudSupport directory is empty
	  delete the CloudSupport directory
	endif the CloudSupport directory is empty
	delete the Trace.log file
	if the Cloud directory is empty
	  delete the Cloud directory
	endif the Cloud directory is empty
	if the Cloud.com directory is empty
	  delete the Cloud.com directory
	endif the Cloud.com directory is empty
	if the Cloud.com directory does not exist
	  break out of the loop
	endif the Cloud.com directory does not exist
      loop up to 3 times
      start Explorer
      delete this batch file
    - This is pretty complex for a batch file.  VBScript can be used back to XP.  Use that.  Launch the script from a batch file, then the
      batch file will delete itself.  Create both in the user's temp directory.
    - Launching a VBScript script from the command line: http://technet.microsoft.com/en-us/library/ee156587.aspx
    - List processes via VBScript: http://www.windowsadminscripts.com/coding/networking/processes/
    - Another one: http://www.developerscloset.com/?p=153
  o 9/15/12 Sat: (home)
    - 6:30 - 10:45
    - 11:45 - 15:30
    - Force manual uninstall: http://kb.flexerasoftware.com/selfservice/viewContent.do?externalID=Q106234
    - Install the script debugging tool: http://www.edugeek.net/forums/scripts/14917-trace-vbs-script.html
    - Tracing subroutines using echo: http://www.idevelopment.info/data/Programming/windows_scripting/scripts/Miscellaneous_Functions/Mail.vbs
    - .Net Interop from VBScript: http://www.visualbasicscript.com/Interop-Using-NET-from-VBScript-m26652.aspx
    - I spent a time-waster trying to get the VBScript to trace to DebugView.  Maybe it's not possible.  I gave up on that.
    - Make it trace to a file in the user's temp directory instead.  Maybe I can make all of the RegisterCom modules trace to
      the same file.  Later though...
    - Another problem???  When run from the command prompt, the VBScript file apparenly works OK.  It stops Explorer, does its thing, and
      starts Explorer.  Then about 4 seconds later, Explorer stops for no apparent reason.  I wonder if it also does that when run
      from RegisterCom?
    - More problems getting the .vbs script to start.  Fixed.
    - The .vds script executes part-way and dies.  I need trace or debug.  And, does VBScript support try/catch?  I need to make sure that Explorer is loaded
      in case there is an error.
    - VBScript error handling: http://stackoverflow.com/questions/4999364/try-catch-end-try-in-vbscript
    - A way to do try/catch in VBScript: http://my.opera.com/Lee_Harvey/blog/2007/04/21/try-catch-finally-in-vbscript-sure
    - Try/catch technique works!
	    Class FtpUpload
		' Constructor
		Private Sub Class_Initialize
		    wscript.echo("FtpUpload: FtpUpload: Constructor entry.")
		End Sub : Private Sub CatchErr : If Err.Number = 0 Then Exit Sub
		    ' Catch
		    Select Case Err.Number
			Case Else wscript.echo("FtpUpload: Catch: Unhandled error " & Err.Number & " occurred.")
		    End Select
		Err.Clear : End Sub : Private Sub Class_Terminate : CatchErr
		    ' Finally
		    wscript.echo("FtpUpload: Finally: Exiting constructor.")
		End Sub 
	    End Class    
            ' Drive it
            With New FtpUpload : End With
    - Now a bigger time-waster: Running the script from the command prompt: The script dies and takes cmd.exe and vs.exe with it!!!!   Maybe I should reboot.
  o 9/16/12 Sun: (home)
    - 5:30 - 16:00
    - TODO:
      . Hide taskkill window. (Done)
      . Explorer didn't restart from .vbs script. (Done)
      . Unregister BadgeCom.dll in .vbs script. (Done)
      . In the .vbs script, don't kill Explorer if it is already killed. (Done)
      . The RegSvr32 /u put up an error window.  Can it be run silently? The module was loaded, but the call to DllUnregisterServer failed with code 0x8002801C.
        That's a normal error code.  It was already unregistered by RegisterCom.exe.  Remove the code in the .vbs script. (done)
    - Running a command from VBScript and retrieving the StdOut: http://www.itninja.com/question/running-cmd-in-silent
    - Good Microsoft tutorial on running commands from VBScript: http://technet.microsoft.com/en-us/library/ee156605.aspx
    - Functions and parens in VBScript: http://blogs.msdn.com/b/ericlippert/archive/2003/09/15/52996.aspx
    - It finally works with no errors!!!!  Everything is deleted, including the script file.  About three days on this so far!  Unbelievable!
    - Now add shortcuts to the Cloud folder to the start menu and pin one to the taskbar.  More research...
    - GUIDs for pinning to start menu and taskbar: http://msdn.microsoft.com/en-us/library/windows/desktop/cc144110(v=vs.85).aspx
    - Pinning a shortcut to the start menu for all users: http://codester.net/index.php/2011/12/22/pinning-applications-to-the-start-menu-for-all-users/
    - Why we shouldn't pin everywhere: http://blogs.msdn.com/b/oldnewthing/archive/2003/09/03/54760.aspx
    - Pin and unpin to the task bar: http://wayneye.wordpress.com/2010/07/17/programmatically-pin-shortcut-onto-taskbar-on-win7/
    - The PinToTaskbar support is coded.  Testing this.   UnpinToTaskbar is not yet coded.
  o 9/17/12 Mon:
    - 7:30 - 18:30
    - The taskbar won't take shortcuts pointing to a folder.  Those get added to Explorer's jumplist.  To pin to the taskbar, it can only be an .exe file or a shortcut pointing to an .exe file.
    - I wrote a short program (ShowCloudFolder) that just launches Explorer to the cloud folder, and pinned that.  It works.
    - Huge timewaster:  Badging doesn't work on my machine.  The trace shows that we are asking Explorer to badge, but it just doesn't show up on the screen.  We tried another .ico file.
      That didn't work either.  I sent my entire BadgeCOM folder to David to try it on his machine.  Fixed.  It turned out to be TortoiseSVN's icon overlay DLLs that have some kind of bug.
    - Everything installs, the shortcuts are placed, including the taskbar Cloud, and uninstall cleans everything up.
  o 9/18/12 Tue:
    - 6:30 - 18:30
    - TODO for the rest of the shortcuts:
      . Setup at creation of Cloud folder:
        x Add an autostart shortcut to the startup folder.
        x Use any saved Cloud folder location in Settings to avoid the Locate/Merged dialog.  If the folder is found at that location and matches the creation date, just use it.
	x Add Explorer favorite shortcut to cloud folder.
	x Add Internet Explorer favorite shortcut to cloud folder.
	x Add Desktop shortcut to cloud folder.
	x Add taskbar shortcut to ShowCloudFolder.exe.
	x Add a menu item to the Cloud.com Start menu (shortcut to ShowCloudFolder.exe).
	x Add a menu item to the systray menu (shortcut to ShowCloudFolder.exe).
	o Add a pinned item to the Explorer taskbar jump list (Windows 7 only?)
	x Add a pinned Show Cloud Folder item to the general start menu.
      . Change Cloud folder location
        x Modify target location in the Explorer favorite shortcut to the cloud folder
        x Modify target location in the Internet Explorer favorite shortcut to the cloud folder
        x Modify target location in the desktop shortcut to the cloud folder
	o Modify target location in the Explorer taskbar jump list (Windows 7 only?)
      . Unlink:
        x Reset all Settings except for the Cloud folder location and creation date.  
        x Remove the autostart shortcut from the startup folder
      . Uninstall:
        x Remove the Explorer favorite shortcut to the cloud folder.  (This happens automatically at uninstall)
        x Remove the Internet Explorer favorite shortcut to the cloud folder.  (This happens automatically at uninstall)
        x Remove the desktop shortcut to the cloud folder.  (This happens automatically at uninstall)
	o Remove the Explorer taskbar jump list pinned entry (Windows 7 only?).
      . Implement CloudCopy.exe which is called from Explorer's context "Send to" submenu "Cloud Folder" item.
      . On every start of Cloud.exe:
        o Test settings to see if all of the above is enabled or disabled.  Add or remove the items as required.
    - Bugs with the above:
      x The autostart shortcut didn't appear. (it does in MsConfig).
      x The desktop shortcut is missing. (fixed)
      x The pin to taskbar shortcut didn't appear. (fixed)
    - Great script with lots of functionality for pinning to start menu: http://social.technet.microsoft.com/Forums/en/w7itproinstall/thread/73eb1c0a-fc78-4ae7-ba6d-356d9a9a5328
    - All of the shell integration works now for add and modify.  Unlink, install and uninstall work.  Now it's time to make the integration sensitive to the preferences.
    - What preferences should we have?
      . Show Cloud Folder:
        o On Desktop
        o In the Explorer favorites list
        o In the Internet explorer favorites list
        o Pin to taskbar
        o Pin to start menu
      . Cloud folder icon:
        o Use the cloud icon for the Cloud folder.
      . Startup:
        o Start Cloud when system starts
    - That works mostly.  Testing...
  o 9/19/12 Wed:
    - 6:30 - 18:30
    - TODO today:
      . Implement CloudSendTo.exe which is called from Explorer's context "Send to" submenu "Cloud Folder" item.
      x Don't completely clear settings so they are saved across an unlink.
      x The cloud folder icon didn't show until I restarted Explorer. (that's the way it is.  Add a global TODO).
      x Big delay clicking OK on the preferences dialog before it animates to systray.
      x After modification, the "show cloud folder" icon was the default "paper" icon.
      x The Hello Cloud slide-up notify icon didn't go away. (only happened once, added to real TODO list.).
    - Lots of GUI changes made today.
  o 9/20/12 Thu:
    - 6:30 - 17:15
    - Apparently it is possible to add a primary Explorer context menu item via the registry: http://www.codeproject.com/Articles/10104/Add-a-context-menu-to-the-Windows-Explorer?rp=/KB/cs/appendmenu/appmenu_src.zip
    - Working on CloudSendTo.exe.  As I expected, Explorer simply passes the selected items to the SendTo program as a list of parameters (full paths).
    - For now, we will just copy the selected items to the root of the cloud folder.  This program could access the Settings, find the cloud folder and just do the copy.
    - However, we may want to do something more significant with the items in the future, something that will require the resources of Cloud.exe.
    - So we need to pass the items to Cloud.exe, but what if Cloud.exe is not running?
    - We could pass it to another instance of Cloud.exe which would hand off the files to the primary instance and exit.
    - Or we could emulate what we are already doing in the Explorer context menu shell extension.  The shell extension starts Cloud.exe if it is not already running, and communicates with Cloud.exe via a named pipe.
    - I will use that method.
    - The context menu shell extension also passes the coordinates of the Explorer window over the pipe.  That information may not be available to us.  Maybe Explorer runs the program as a child process of Explorer.
      If that is the case, we may be able to get the coordinates of the Explorer window.  If that is not possible, pass some default coordinates at the current mouse position.
    - The CloudSendTo.exe program works.  It now launches Explorer to show the user the cloud directory with the copied files in it.
    - Info about always show systray icon on taskbar: http://stackoverflow.com/questions/958817/force-windows-to-show-a-system-tray-icon
    - Maybe the way to show systray icon on taskbar: http://community.kaseya.com/xsp/f/26/t/14790.aspx
    - Try to use this program (convert to C#): http://forums.codeguru.com/showthread.php?306661-How-to-always-show-an-icon-in-system-tray
  o 9/21/12 Fri:
    - 4:00 - 9:15 (Apple store, pick up new iPhone 5)
    - 9:45 - 12:30?  (then to 10th Ave. pizza with the team)
    - Working on reverse engineering the systray icon pinning.  The program I found works (RegisterIcon: AlwaysShowNotifyIcon), but it seems to be written for an earlier OS (Vista?).
      They changed things in Win7.  The registry keys are there, and they are not encrypted, but they are highly encoded with file names? that start with a GUID and end with .rkr extensions.
  o 9/22/12 Sat: (home)
    - 6:45 - 13:30
    - 15:00 - 15:30
    - The affected registry keys seem to be the following (from http://community.kaseya.com/xsp/f/26/t/14790.aspx):
                Replace Registry Value: %USERKEY%\Software\Classes\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify\IconStreams
                Replace Registry Value: %USERKEY%\Software\Classes\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify\PastIconsStream

                Replace Registry Value: %USERKEY%_Classes\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify\IconStreams
                Replace Registry Value: %USERKEY%_Classes\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify\PastIconsStream
    - Test by using an existing icon in the pop-up.  I'll choose MagicDisk.  Capture the settings of each of these keys, then force the icon to the taskbar and capture again.
      Look for differences in the values.
    - I ran that on the first "IconStreams" value.  There were no changes (without rebooting).
    - Simple char replacement cipher used in the registry: http://www.broadbandreports.com/forum/r7146202-Programs-List-~start=20
    - Another description of the cipher: http://cmb-it.blogspot.com/2008/05/understanding-most-frequently-used-mfu.html
    - Script to encrypt/decrypt rot-13: http://cmb-it.blogspot.com/2008/05/decrypt-encrypt-string-in-rot-13.html
    - New test.  Use the rot-13 decrypt procedure and inspect the result. That works.  Now I can see all of the paths, GUIDs, etc.
    - Now back to the original task.  I have to see something change.  Two ways: Use ProcMon or a registry change watcher, or reboot, write all of the files before, reboot
      and write all of the files after, then check for differences.
    - ProcMon was unproductive.  Try the boot procedure.  The code is written to save the key values.
    - Procedure:
      x Put MagicDisk in the pop-up.
      x Reboot.
      x Capture the keys and name them "Start".
      x Put MagicDisk onto the system tray.
      x Capture the keys and name them "ToSystray".
      x Reboot.
      x Capture the keys and name them "ToSystrayReboot.
      x Put MagicDisk back into the pop-up.
      x Capture the keys and name them "ToPopup".
      x Reboot.
      x Capture the keys and name them "ToPopupReboot".
      . Analyze the keys for changes.  Use WinMerge.
        o Start-ToSystray-CurrentUser-IconStreams: Identical
        o Start-ToSystray-CurrentUser-PastIconsStream: Identical
        o Start-ToSystray-Users_Change-IconStreams: Identical
        o Start-ToSystray-Users_Change-PastIconsStream: Identical
      . There are no changes in these registry entries until reboot, and then the changes are pretty significant, like they are being rewritten.
      . The PastIconsStream seems to be a pure binary structure.  It probably contains the icons themselves.
    - Looking at Gadgets (Vista and Win7).
    - Communicating between Gadget and a managed app using WCF: http://blogs.msdn.com/b/karstenj/archive/2006/10/20/wpf-wcf-vista-gadgets.aspx
    - Drag/Drop with a Gadget: http://www.codeproject.com/Articles/17588/Drag-and-Drop-Archiver-gadget
  o 9/23/12 Sun: (home)
    - 6:30 - 12:00
    - I'm not making enough progress with pinning the systray icon to the taskbar.  Gadgets look promising, but they're only Vista-forward,
      and they are usually hidden by apps covering the entire desktop.
    - Switch back to the GUI specs in preparation for the GUI review this week.
    - I made another pass through the preferences.
  o 9/24/12 Mon:
    - 6:30 - 18:00
    - TODO today:
      x The preference network dialogs are topmost.
      x Preference network button spacing.
      x Preferences network vertical spacing between buttons.
      x PreferencesAdvanced, vertical spacing between buttons.
    - Started work on deployment.
    - David realized that we may need to update the files that were copied to the CloudSupport folder in ProgramFiles.  RegisterCom was doing the heavy work
      to copy the proper BadgeCom.dll for the current bitness to the CloudSupport folder, but the installer has no way of updating files based on bitness.
    - I reworked the install/uninstall process to eliminate the CloudSupport folder, and instead the files are copied to the proper ProgramFiles\Common Files folder.
      In the case of 64-bit, BadgeCom.dll is copied to both Program Files\Common Files and to Program Files (x86)\CommonFiles.  The uninstaller scans both
      directories to delete files.  The Common Files folder has the same Cloud.com\Cloud folder structure as Program Files.
  o 9/25/12 Tue:
    - 6:30 - 18:45
    - Run the Windows key manager: rundll32.exe keymgr.dll, KRShowKeyMgr
    - I finished the documentation of the deployment and update process.
    - Debugging a problem registering BadgeCom.dll on Win7Sp1X86.  It is dependent on the VC++ redist 110 versions (Atl, msvcr, msvcp).  I added those to System32, and now it croaks
      because it thinks it is 64-bit.  Maybe because the modules I copied are 64-bit???  Check that.  No, they are x86.  Some of the projects were building for the 110
      redists.  I changed them all to 100.  The redist 100 dlls are being copied only for 64-bit.  Maybe I should copy them for 32-bit as well.  I used ProcMon to
      get info.  The x86 VC++ redist files are set as a prerequisite, so I don't think that is the problem.  ProcMon showed that the 32-bit Atl100.dll is being loaded.
      That is probably causing the 183 error from LoadLibrary.  I will move the 100 dlls into the amd64 directory and copy them from there so the 32-bit environment
      won't find them.
  o 9/26/12 Wed:
    - 6:30 - 18:30
    - Cloud finally deploys to Win7Sp1X86!
    - Now try Vista.  Hopefully that will be fairly easy since it is close to Win7.
    - Controlling Synaptics Touchpad: http://stackoverflow.com/questions/11858838/c-sharp-how-to-disable-synaptics-touchpad
    - Controlling Synaptics Touchpad: http://www.autohotkey.com/community/viewtopic.php?t=70834
    - Using WMI to find the touchpad: http://www.blackwasp.co.uk/MouseStatus.aspx
    - The new auth "os_platform" protocol support works.
    - Pin to Start Menu on vista: http://www.askvg.com/fix-pin-to-start-menu-option-is-missing-in-windows/
    - Taskbar and NotifyIcon reference msdn: http://msdn.microsoft.com/en-us/library/windows/desktop/cc144179(v=vs.85).aspx
    - All six platforms now download, install, run, sync, badge and uninstall!  Pushed.
  o 9/27/12 Thu:
    - 6:30 - 18:30
    - Updating a locked DLL: 
		If the file is in use, we copy the new file with a different name and load it (after we unregistered the old one). 
		This makes the 2 dlls loadedm, but only the new one is in used until the next restart. In addition, 
		we add a RunOnce command to delete the old dll and rename the new one to its original name.
    - Find processes locking a DLL: http://stackoverflow.com/questions/317071/how-do-i-find-out-which-process-is-locking-a-file-using-net
    - Find processes locking a file: http://stackoverflow.com/questions/860656/how-does-one-figure-out-what-process-locked-a-file-using-c
    - Command line program to delete a non-module file locked by another process: http://www.codeguru.com/cpp/w-p/files/fileio/article.php/c1287/Deleting-Locked-Files.htm
    - Sample program (winNt): http://www.codeguru.com/cpp/w-p/system/processesmodules/article.php/c2827/Examine-Information-on-Windows-NT-System-Level-Primitives.htm
    - Researched how to delete files locked by another process.
    - Fixed a bug in DialogCheckForUpdates.xaml.  The  Install Now button was acting like the Check Now button.
    - Working on getting the update to work within Cloud from the context menu shortcut.
    - I need a local test HTTP download and update server.  I have been trying to use shortcuts, but that doesn't work...
    - Installing local IIS for FTP access:
      . Control Panel/Programs and Features.
      . Turn Windows Features On or Off
      . Make sure IIS is installed with FTP Server.
      . It was on my Win7Sp1X64 machine.
      . Windows search: type IIS and start the IIS Manager.
      . Expand the left column.
      . Expand "sites".
      . Select "sites".
      . Click "Add FTP Site in right panel.
      . FTP site name: FtpTest.
      . Physical path: C:\FtpRoot
      . Click Next.
      . Default except for No SSL.
      . Click Next.
      . Default except for: Check Anonymous, Allow access to "All Users", Permissions: Read/Write.
      . Click Finish.
      . In right panel, click Start if it is not already started.
      . Open WyBuild, and our Cloud project.
      . Select the Upload the Updates view.
      . Click Add new site.
    - I didn't get that working.  Apparently, FileZilla is already installed with a server at local host.  Check that out.
    - Connect using user bobs, password simple bird.
    - Added better exception handling for XAML load and parse issues in PageInvisible.  Issued a message to the user (ugly MessageBox) and exited the app.
    - CloudUpdater needs to kill Explorer, wait for it to exit, continue to perform the update, then start Explorer, wait for its process to appear, then wait 2 seconds, then start Cloud again.
  o 9/28/12 Fri:
    - 7:30 - 16:00
    - Restart manager C# example: http://msdn.microsoft.com/en-us/magazine/cc163450.aspx
    - Using Restart Manager with a Secondary Installer: http://msdn.microsoft.com/en-us/library/windows/desktop/aa373682(v=vs.85).aspx
    - How do I find out which process has a file open?: http://blogs.msdn.com/b/oldnewthing/archive/2012/02/17/10268840.aspx
    - Restart Manager video: http://channel9.msdn.com/Blogs/DanielMoth/Restart-Manager-in-Vista-for-developers
    - CloudUpdater(wyUpdate) kills a process by querying for its main window handle.  If it has one, it uses CloseMainWindow to close the app.  If not, it kills the app.
    - The start of that code path is in frmProcesses.cs closeProc_Click and closeAll_Click.
    - I need to be able to debug CloudUpdater in the mode that is is called when Cloud invokes it through AutoUpdater.  Try GFlags first.
    - GFlags call VS debugger: C:\Windows\System32\vsjitdebugger.exe
    - That works.  The autoupdater calls CloudUpdater.exe with arg "/autoupdate".
    - frmMain:beginAutoUpdateInstallation
    - CloudUpdater determines whether the current user needs to be elevated in permissions, and then regardless, copies itself to the temp directory and relaunches
      itself with the elevated permissions.  That launch uses arguments "-supdf:\"" + <tempdir> + "\\selfUpdate.sup\""
    - To pause wait for the debugger to be attached:
		#if DEBUG
			while (!Debugger.IsAttached)
			{
				Thread.Sleep(100);
			}
			Debugger.Break();
		#endif  // DEBUG
    - Another problem: The AutomaticUpdater code actively kills the client process if it doesn't open the pipe in time, so find the code that opens the pipe and
      debug break after that.
    - It looks like I should kill explorer before the code in frmMain.Updating.cs, line 461. (case UpdateOn.ClosingProcesses).
    - The asynchronous update work is actually processed in InstallUpdate.cs.
    - How should I make sure that Explorer is started again (in all exit cases)?
    - UpdateHelper handles the pipe messages between AutomaticUpdater.dll and CloudUpdater.
    - The wrapper around CloudUpdater works to shut down and restart Explorer.
    - I also built a new wyBuild CloudUpdater project so we can use our own servers for the updater self-update.
    - 4Kids dinner.
  o 9/29/12 Sat: (home)
    - 10:15 - 14:15
    - The Restart Manager can be used to restart Explorer (hopefully in the same state): http://msdn.microsoft.com/en-us/library/windows/desktop/aa373524(v=vs.85).aspx
    - InstallShield MSIRESTARTMANAGERSESSIONKEY: http://gunnalag.wordpress.com/2011/04/17/core-flexera-installshield-editor-default-properties-reference/
    - Using Windows Installer with Restart Manager: http://msdn.microsoft.com/en-us/library/windows/desktop/aa372466(v=vs.85).aspx
    - Custom actions should not attempt to shutdown or restart applications using the RmShutdown, RmGetList and RmRestart functions: http://msdn.microsoft.com/en-us/library/windows/desktop/aa372466(v=vs.85).aspx
    - Sample Restart Manager code: http://www.codeproject.com/Articles/20010/How-to-Develop-Restart-Manager-Aware-Application-T
    - rmtool.exe is the test tool for RM compliance: http://www.codeproject.com/Articles/20010/How-to-Develop-Restart-Manager-Aware-Application-T
    - Resource Manager only works on Visa and above.  On XP, all we can do is to kill the locking processes, or register a RunOnce action and perform a reboot.
    - Today was spent mostly on moving the work test environment for Update to my home computer.
  o 9/30/12 Sun: (home)
    - 6:30 - 15:30
    - 18:30 - 20:15
    - Creating an XML file in VBScript: http://technet.microsoft.com/en-us/magazine/2008.02.heyscriptingguy.aspx?pr=PuzzleAnswer
    - XMLDOM SetAttribute: http://www.devguru.com/technologies/xmldom/quickref/element_setAttribute.html
    - FTP via VBScript: http://www.tek-tips.com/viewthread.cfm?qid=1293398
    - FTP commands:
      . mput *: transfer files with wildcard
      . lcd: change local directory
      . cd: change remote directory
      . mkdir: make remote directory
      . rmdir: delete remote directory
      . mdelete: delete remote files with wildcard
      . http://www.nsftools.com/tips/MSFTP.htm#mput
    - Automated most of the update prepration procedure.
  o 10/1/12 Mon:
    - 6:30 - 18:30
    - Good driver for Windows FTP command: http://www.naterice.com/articles/51
    - Documentation for InetCtls.Inet.1 (msinet.ocx):
      . http://social.msdn.microsoft.com/Forums/en/refsourceserver/thread/d5bd1da1-6c3e-4b41-8409-2f49f2a47bd3
      . http://officeone.mvps.org/vba/ftp_upload_file.html
      . http://officeone.mvps.org/vba/ftp_download_file.html
    - The update automation works!
    - Now the updates are broken.  I fixed the CloudUpdater updates to work properly.  Now when CloudUpdater is not "self-updated", it doesn't copy itself
      to the temp directory and relaunch itself, with the result that my code to kill explorer and wait for Cloud to exit is not invoked.
    - Change the design of the "Install Now" function.  Launch a self-destructing .vbs script to wrap CloudUpdater.  It will wait for Cloud to exit,
      kill Explorer, launch CloudUpdater, wait for it to complete, relaunch Cloud.exe, then destroy itself.  Call this script CloudInstallUpdate.vbs.
    - I tested the CloudUpdater self update process with the linked cloud.wyc file.  I made CloudUpdater version 2.6.18.100 and 2.6.18.101.  Version 1.1.1.4 used
      the former and version 1.1.1.5 used the latter.  I installed V1.1.1.4 and ran CloudUpdater (the V1.1.1.4 version).  The DbgView trace shows that
      it did a self-update to the 2.6.18.101 version.
    - I commented out the changes in CloudUpdater:Program.cs.
    - Working on the new VBScript wrapper.
  o 10/2/12 Tue:
    - 7:30 - 18:45
    - The CloudInstallUpdate.vbs has been tested standalone.  Testing with Cloud.
    - Time waster:  The Check for Updates dialog "Install Now" button click does not work?????
    - Great article on Embedded Resources: http://www.codeproject.com/Articles/3089/Understanding-Embedded-Resources-in-Visual-Studio
    - The update process works well now.
  o 10/3/12 Wed:
    - 6:30 - 18:30
    - Reset all of the test updates (11 now), rebuild and test updating from version 1 to 2.  Then upload version 2 for Scott.  Have him
      install that, then upload update 3 and have him test that.
    - Areas of concentration:
      . Desktop GUI features, server protocol
      . Metro client
      . Windows phone 8
      . Sync and file system monitoring
      . Unit and functional testing
      . Close-down testing
      . OS integration
      . Install/Uninstall/Update/Deploy
    - People:
      . Person 1:
        o Desktop GUI features, server protocol
      . Person 2:
        o Metro client
        o Windows phone 8
      . Person 3:
        o Sync and file system monitoring
        o Unit and functional testing
      . Person 4:
        o OS integration
        o Install/Uninstall/Update/Deploy
      . Person 5 (part time) and offshore:
        o Close-down testing
    - Working with Scott to test update on his Win32X86 system.  I think I fixed a crash having to do with negative screen offsets.
  o 10/4/12 Thu:
    - 7:00 - 18:30
    - I added some user experience enhancements to NewUpdate.vbs.  It's quicker now.
    - Fixed the crash that Scott was seeing.
    - I spent the rest of the day working on various update issues, testing it on a SkyNet Win7Sp1X86 machine.
    - Current bug: The Check for Updates dialog doesn't appear the first time.  It is off screen.
  o 10/5/12 Fri:
    - 7:30 - 18:30
    - SlickEdit: Set cursor undo: Command line: set-var def_undo_with_cursor (set value to 1)
    - At uninstall, delete the following directories:
	rmdir /s /q "%userprofile%\wc"
	rmdir /s /q "%appdata%\wyUpdate AU"
    - I spent the whole day testing update.  The current bug is in the Autoupdater.  It gets stuck after downloading an update.  Restarting cloud corrects the status and allows a normal update installation.
      I added trace to CloudUpdater (dbgview).
  o 10/6/12 Sat: (home)
    - 5:30 - 16:45
    - Adding trace to AutoUpdater.
    - Configuring my home machine for the current test environment and fixing problems in git sync.
    - Determine TCP ports open: netstat -anob
    - After several hours of a time-waster, I finally got IIS to host the /clients/windows directory with HTTP.
    - The update process finally works from Cloud!  The big time-waster was a redesign of the AutoUpdater Version 2.6.18 vs. 2.6.16.  The event names were changed, and some other things...
      I also needed to clear the wyUpdate cache directories after running CloudUpdater.  AutoUpdater was still seeing an available update after the current update was actually installed.
    - Progress bar XAML: http://www.c-sharpcorner.com/uploadfile/mahesh/wpf-progressbar/
    - Progress bar styles and template (msdn): http://msdn.microsoft.com/en-us/library/ms750638.aspx
    - Interesting progress and scroll bar templates: http://msdn.microsoft.com/en-us/magazine/cc163497.aspx
    - Very interesting fancy download/upload progress bar with history, speed, etc: http://stackoverflow.com/questions/9978078/windows-8-fancy-progress-bars-via-c
    - And his blog (Windows 8 style progress bar). (RateBar): http://stackoverflow.com/questions/9978078/windows-8-fancy-progress-bars-via-c
    - Good tutorial on using templates with controls: http://www.devx.com/dotnet/Article/42304
    - Control Template Round Button: http://www.codeproject.com/Articles/30994/Introduction-to-WPF-Templates
    - Virtualizing ItemsPanel override: http://wpftutorial.net/listboxitemsarrange.html
    - Using a grid as the panel for an ItemsControl: http://www.scottlogic.co.uk/blog/colin/2010/11/using-a-grid-as-the-panel-for-an-itemscontrol/
    - Another grid in an ItemsPanel: https://rachel53461.wordpress.com/2011/09/17/wpf-itemscontrol-example/
    - Use control templates everywhere?: http://nirajrules.wordpress.com/2009/03/08/controltemplate-vs-datatemplate-vs-hierarchicaldatatemplate-vs-itemspaneltemplate/
    - "Whenever you want a control template to be assigned dynamically, you need DataTemplates along with a DataTemplateSelector.
        For example, my grid control uses a datatemplate selector that looks at the type of cell (Text, Image, DropDown, CheckBox) and assigns the appropriate DataTemplate.
        In cases where the control will never change, just use a controltemplate and be done with it"
        http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/d8f79b2b-c745-42bd-a821-db9ce0b5c2e9/
    - Solar system listbox with canvas: http://www.zagstudio.com/blog/470
    - Indirecting a style when using ItemsControl: http://www.sturmnet.org/blog/2007/03/31/wpf-bottom-dwelling-with-an-itemscontrol
  o 10/8/12 Mon:
    - 6:30 - 18:30
    - I built two versions for Scott, tested them on SkyNet, and they worked for Scott!  Onto other things...
    - The file upload/download prototype XAML is built.  The prototype ViewModel should test it and put it through simulated actions.  How to do that?
      . The VM provides the two lists of CLStatusFileTransfer objects.
      . The number and status of the items in the lists should be randomized.
      . Creation timer:
        o This timer will control the creation of items.
	o On a timer tick:
        o Disable the timer.
	o At the end of processing below, choose a new duration for the next tick: 1 - 4 seconds.
        o Randomly choose the direction (up/down)
	o If the chosen list is full, exit.
	o Randomly choose the file size (1 byte - 2 GB)
	o Randomly choose the path from a list.
	o Randomly generate the filename.ext.
	o Build the full relative path + filename.ext
	o Determine the bandwidth allocation for this object at this moment.  Save it in the object as the beginning bandwidth.
	o Place the item on the list at the end (bottom of the view)
      . Bandwidth timer (every 100 ms.)
        o Choose an overall bandwidth up (randomly between 50% and 100% of the average historic bandwidth)
        o Choose an overall bandwidth down (randomly between 50% and 100% of the average historic bandwidth)
	o This bandwidth will be spread evenly over the active up/down objects.
      . Upload/Download timer processing:
        o Tick every 200 ms.
	o Proccesses all objects on both lists.
	o Any model data required will be stored in the CLStatusFileTransfer object and marked debug.
	o If this object is complete, remove it from the list and dispose it.
	o From the previous bandwidth allocated to this object, determine the bytes transferred in the last time slot.
	o Adjust the object's properties by the amount transferred and the previous rate..
	o Determine the rate from the current bandwidth at this moment and save it for next time.
      . The progress bars show history of the download.  The rate is the vertical axis, and percent complete is the horizontal axis.  Both range from 0.0 to 1.0.
      . What is the reference rate?
      . We should keep an average aggregate upload and download rate in Settings.
      . If a single upload is working, it should use the entire aggregate upload bandwidth.
      . If two uploads are working, each should use half of the upload bandwidth, and so on...
      . Since the instantaneous bandwidths go up and down, we should allow for individual readings over the maximum, so set the maximum at perhaps
        80% of the vertical space.  That will allow 20% over the maximum.  If the rate calculates over that, just chop it off.
      . So for an example, suppose we have 1024000 bits per second (1 Mb/s) aggregate upload bandwidth.
      . And suppose we have 3 upload tasks.
      . Then each should use 341333 bits per second.
      . Divide bits per second by 10 (old ASCII fudge).
      . So each upload should see 34133.3 bytes per second.
      . The 80% (0.8) rate for each of the three upload displays would correspond to 34133.3 bytes per second.
      . So the 1.0 rate would be that number divided by 0.8, or 42666.625 bytes per second.
      . Anything over that should be chopped.
      . If one of the threee uploads completes, the other two should share the whole bandwidth.  In that case we would have 512000 bits per second, 51200.0
        bytes per second for the 0.8 rate, or 64000.0 bytes per second for the 1.0 rate.
      . No.  That won't work.  As uploads come and go, the history would not be consistent.
      . We should calculate these numbers as if we always had 6 going.
      . If all six were going, each would use 1/6 of the total bandwidth.
      . If three complete, we would expect the individual bandwidth of the remaining three uploads to double.
    - Coding the above...
  o 10/9/12 Tue:
    - 6:30 - 18:30
    - How should the historic average be calculated??
      . The samples should be fairly quick because this number can be changing rapidly.
      . Sample only if there was at least one upload/download active for the entire sample period.
      . Capture the number of bytes transfered during the sample period.
      . The sample transfer rate is the number of bytes transfered divided by the sample period in seconds.
      . Choose the sample period.  5 seconds?
      . Keep a 50 period moving average in memory.
      . Save the current average value to Settings at every sample.
      . When starting up, start with the saved average as the first sample, and accumulate samples from there.
      . If there are fewer than 50 periods in memory, calculate the average over the samples that we have.
    - The file upload/download works somewhat with the test drivers, but the status bars don't move to the right.
  o 10/10/12 Wed:
    - 6:30 - 18:30
    - The detailed status window works well.  The buttons are not yet functional.
  o 10/11//12 Thu:
    - 6:30 - 18:30
    - Reviewed the todo list.
    - Completed the detailed status window and checked it in.  The log display is still not functional.
    - Moving to another desk.
    - Fixed the Preferences Unlink to check for unsaved changes to preferences.  That was not easy.
    - Move Cloud folder while running issue:
      . Currently, the code in FramePreferencesAdvancedViewModel:MoveCloudFolderWithUserInteraction actually moves the cloud folder (renames) with the 
        File System Monitor and all of the sync code running.  Not good.
      . A better approach would be to save the move (rename) request and restart Cloud.  Cloud would find the request and perform the action
        before starting the core services.
      . I could use another of those self-destruction VBScripts to do the dirty deed.
      . In Cloud, actually create and delete the target directory, just to prove that there won't be a problem moving the directory.
      . Then fire off a script with the current and target directories.
      . Then as a last dying action, change the Settings to the new Cloud directory path.
      . The script would wait for Cloud to exit, kill it if it was tardy, then move the directory, and restart Cloud which will find the Cloud
        directory at the new location.
      . One glitch: At shutdown, we may actually remove the Cloud directory if it only contains the empty default folders.  Create a new Settings
        flag that indicates that this directory move is in progress.  Shutdown will inspect the flag and not delete the existing Cloud folder.
        The flag will be cleared on every Cloud startup, whether or not it starts core services.
  o 10/12//12 Fri: (home)
    - 5:30 - 10:30
    - Move cloud directory with restart is coding and almost working...
  o 10/13/12 Sat: (Orlando)
  o 10/14/12 Sun: (Orlando)
  o 10/15/12 Mon:
    - 6:30 - 18:30
    - Database: CopyrightCloud.comCreatedByDavidBruck
    - The move cloud folder support works.
    - Fixed bugs in the push polling fallback.  It worded from enableded->disabled->enabled.
    - Implemented the saving of the server Udid and filtered push notifications by the Udid rather than by the computer friendly name.
  o 10/16/12 Tue:
    - 6:30 - 18:30
    - NameChanger driver makes a part of a directory structure appear in another part of the directory structure: http://code.msdn.microsoft.com/windowshardware/NameChanger-File-System-728e1b2a
    - SimRep driver redirects file open to another path: http://code.msdn.microsoft.com/windowshardware/SimRep-File-System-9a4e2206
    - Driver with trace: http://code.msdn.microsoft.com/windowshardware/Tracedrv-f1c8ada8
    - Windows Portable Devices (WPD) supported on XP with MediaPlayer 11: http://msdn.microsoft.com/en-us/library/windows/hardware/ff597869(v=vs.85).aspx
    - WPD device properties: http://code.msdn.microsoft.com/windowshardware/Windows-Portable-Device-44810a91
    - Minifilter driver to track file system deletes: http://code.msdn.microsoft.com/windowshardware/Change-File-System-4b132959
    - Cancel-safe minifilter driver: http://code.msdn.microsoft.com/windowshardware/cancelSafe-File-System-0f8c8148
    - NDIS driver that supports multiple minidrivers (used for VLANs): http://code.msdn.microsoft.com/windowshardware/NDIS-MUX-Intermediate-3e97f538
    - WDF Installation package: http://code.msdn.microsoft.com/windowshardware/InstallWdf-13752008
    - Event tracing to ETW (Event Tracing for Windows): http://code.msdn.microsoft.com/windowshardware/Eventdrv-42894135
    - UMDF (User Mode Driver Framework) has access only to the address space of the process in which it runs: http://msdn.microsoft.com/en-us/library/windows/hardware/ff554455
    - Metadata manager minifilter driver blocks access to metadata file: http://code.msdn.microsoft.com/windowshardware/Metadata-ManagerFile-8a527ef9
    - Codeplex smart card UMDF sample: http://www.codeproject.com/Articles/134010/An-UMDF-Driver-for-a-Virtual-Smart-Card-Reader
    - David: We could just write a SMB server.  That could actually run on a server and serve multiple users.
    - WNetUseConnection (connect with credentials to SMB share without creating a drive letter): http://stackoverflow.com/questions/659013/accessing-a-shared-file-unc-from-a-remote-non-trusted-domain-with-credentials
    - FreeNAS, CIFS SMB server under BSD license: http://en.wikipedia.org/wiki/FreeNAS
    - NAS4Free: http://www.nas4free.org/
    - Book on CIFS: http://ubiqx.org/cifs/Intro.html
    - GNU GPL legal issues: http://en.wikipedia.org/wiki/GNU_General_Public_License
    - CIFS/SMB e-book: http://ubiqx.org/cifs/
    - SharpBox experimental CIFS server on Codeplex: http://sharpbox.codeplex.com/SourceControl/changeset/view/94877#1842737
    - Microsoft open protocol capture files: http://sysdoccap.codeplex.com/wikipage?title=System%20Overview%20Document%20Scenario%20Captures
    - Microsoft CIFS specs: http://msdn.microsoft.com/en-us/library/cc224428(prot.20).aspx
    - At this point: Samba would be an option, but that option is prevented by our legal department because of the GNU GPL license requirement.  So, switch back to looking at a UMDF implementation.
    - UMDF samples document: http://msdn.microsoft.com/en-us/windows/hardware/gg463290
    - UMDF USB walk-through: http://msdn.microsoft.com/en-us/library/windows/hardware/hh706184(v=vs.85).aspx
    - UMDF synchronous app requests pended and completed by driver: http://www.osronline.com/showthread.cfm?link=101250
    - UMDF driver-created file objects: http://msdn.microsoft.com/en-us/library/windows/hardware/ff554633(v=vs.85).aspx
    - UMDF driver-created file objects (more): http://msdn.microsoft.com/en-us/library/windows/hardware/ff554550(v=vs.85).aspx
    - UMDF USB driver sample (Microsoft): http://code.msdn.microsoft.com/windowshardware/wdfosrfx2lab-c10cb375
    - UMDF impersonation: http://books.google.com/books?id=jgDNRYZGNL4C&pg=PT519&lpg=PT519&dq=umdf+driver+filter+redirect+file+open&source=bl&ots=5Ox-TgqTv_&sig=NB2tP2jfwFNmLf3cSd9sBuUfms8&hl=en&sa=X&ei=Bpl9UL7vN4j69gTOzYDwBg&ved=0CE0Q6AEwCA
    - File system drivers cannot be UMDF drivers???: http://msdn.microsoft.com/en-us/library/windows/hardware/ff560442(v=vs.85).aspx
    - Buy it for $18K with source code: CallbackFileSystem: http://eldos.com/cbfs/
    - I don't think we will need the "middleware" license.  This drive letter virtual drive implementation will be the Cloud product.  3rd parties will need to implement their own File System Monitor (or equivalent)
      to generate the FSM events.
    - I read the manual.  It's well done, with good reviews, and it does exactly what we need it to do, and it also provides the same functionality for Mac if we need it.
    - Integrating CallbackFileSystem into Cloud:
      . install and uninstall will need to be driven by RegisterCom.
      . Create a new service which will initialize and terminate the virtual file system.
      . The trial implementation will do the following:
        o Allocate a mount point that in the same way as we do now for the Cloud directory.  This drive letter will represent the Cloud directory virtual file system view.
	o Specify a drive letter to use for the actual Cloud storage.  That directory will be hidden and marked as system.  Allocate the space off of the drive root.
	o Questions?  Will the storage drive be used for all users? Will the database be used for all users?  Probably, because then we can dedup on the machine.
        o Just map the user view straight through to the hidden view.
	o Also map the metadata straight through.
	o Also map the security straight through.
    - I tried the sample VDisk.  It was not without problems.  The driver intstallation threw an exception because it couldn't find some file, but it worked on restart.  Uninstall said we needed to reboot.
  o 10/17/12 Wed: (home)
    - 6:00 - 10:30
    - The normal cloud directory path (e.g.: "C:\Users\RobertSte\Cloud") won't work because we need to use only a drive letter to represent the cloud directory.  e.g.: "X:".
    - That means all of the code that is in place to move the cloud directory (at setup and in Preferences) should be replaced with code that allows the user to change just the cloud drive letter.
    - Coding a test of CallbackFileSystem.
  o 10/18/12 Thu - 10/22/12 Mon: (off)
    - About 8 hours spent working.
    - The CallbackFileSystem test works.  It produces a virtual drive X: that maps to the underlying Cloud directory.  The file system monitor still tracks the underlying cloud directory.
  o 10/23/12 Tue:
    - 10:30 - 16:30
    - Caught up with David and the current events.
    - Wrote a memo and scheduled a meeting to discuss the virtual drive and whether we will proceed with it.
  o 10/24/12 Wed:
    - 6:45 - 18:30
    - The sample code for CallbackFileSystem is in branch 20121017A0IntegratingCallbackFileSystem.
    - I moved the push notification code to CloudApiPublic.  It works, and I pushed it to git.
  o 10/25/12 Thu:
    - 8:00 - 
    - Doxygen is a candidate documentation tool.  The Microsoft support may also be adequate.  We need to generate HTML documentation, with an intro and other sections, including
      Class and type documentation, and we need a way to prevent documentation of internal classes.
    - 



    








      
    









    
      

    
    


        



      




     
      



      

         										  




  


- (3/15/12) Project redirection
    . Phil had a great idea.  Maybe the Mac FollowMeData project recently released did the file badging.  Actually,  it does!
    . However, it uses the custom icons.  If you copy the file out of the Cloud folder, the icon goes with the file.  Bad.
    . However, if we could remove the custom icon when the file moves out of the folder, then that would work!
    . Steve proved that he could use NSWorkspace::setIcon:forFile to change the icon on a desktop file or folder.  So that works.  He can do everything in Cocoa, using Apple's published APIs.
    . One problem: We are only looking at the file system events for the Cloud folder.  We get the file removed event, but we don't get the file created event when, say, moving a file from
       the cloud folder to the desktop.
    . Perhaps we could see that the file was removed, and watch for the file created event.  We should get that in the same event callback.  If we don't get the file created event, add
      the file to a watch list.  Subscribe to the global event stream (root) starting with that event, and watch maybe 100 events going forward.  If we see the same filename.ext, remove
      the badge because it was moved outside the Cloud folder.  Watch globally until the watch list is clear, or until we have seen a max number of events.
    . I will implement that code.
    . From Wikipedia: A file's inode number stays the same when it is moved to another directory on the same device, or when the disk is defragmented which may change its physical location. 
       This also implies that completely conforming inode behavior is impossible to implement with many non-Unix file systems, such as FAT and its descendants, 
       which don't have a way of storing this invariance when both a file's directory entry and its data are moved around.
    . Assume we get N events at a callback.
    . We need to determine which of the RENAME events relate to a file that was moved out of the Cloud directory.
    . Good example of multiple streams: https://bitbucket.org/boredzo/fs-notifier/src/bb3cbc42641c/Notifier.m
    . Doing it by watching the root and all events with source code: http://stackoverflow.com/questions/7300998/tracking-file-renaming-deleting-with-fsevents-on-lion; 
    . Pseudo-code for globals:
      global tracking array
      count of global events handled
      constant max count of global events handled
    . Pseudo-code for initialization:
      initialize the global tracking array to empty
    . Pseudo-code for handling Cloud directory events
     set startNodeId = 0;
     loop through the Cloud directory FS events
        … current logic.  Track whether we added or removed the file
        if this event has the rename flag
          get this file's inode
          if we removed the file
            add the inode to the tracking array
            if startNodeId == 0
		set startNodeId = this event ID.
            endif startNodeId == 0
          endif we removed the file
          if we created the file
            delete the inode from the tracking array if it is there
          endif we created the file
        endif this event has the rename flag 
      endloop through the events
      if the tracking array has elements
        if the global stream is not active
          indicate the global stream is active
          reset the count of global events processed
          start the global stream to watch for a create, starting with node startNodeId
        endif the global stream is not active
      endif the tracking array has elements
     . Pseudo-code for handling the Global FS events:
       loop through the events presented to this callback
          increment the events handled
          if this event has the rename and create flags set
            get the inode for this file 
            if this inode is in the tracking array
                remove the inode from the tracking array
                if this is a file
                  send event to remove the badge from the file
                else this is a directory
                  send event to remove the badge from the directory
              endif this is a directory
            endif this inode is in the tracking array
          endif this event has the rename and create flags set
          if the tracking array is empty, or if we have exceeded the max event count
            mark the global event stream as stopped
            stop the global event stream
          endif the tracking array is empty, or if we have exceeded the max event count
      endloop through the events presented to this callback
    . (3/16/12) DUH!  I finished this, and the first test made me realize that the inode ID won't work.  By the time we get the first event, the move has already happened, and we can't find the file to get its inode.
    . Go back to the swizzling project, at least until Steve, Phil and I can talk.  See above.


    


                


 - (3/11/12) Reverse Engineer DB
    . DB is written in python.
    . (3/7/12) PyRetic: http://code.google.com/p/pyretic/downloads/detail?name=pyREtic_0.5.1.zip&can=2&q=
    . Also UnPyc.     . Use pyREtic to reverse-engineer.  This is an in-memory decompiler.  It loads the application (DB) into its own environment, and then allows the user to probe the target.
    . (3/11/12) All work in the DB directory: /Applications/DB.app/Contents/MacOS
    . pyREtic presentation (Flash): http://prezi.com/kmyvgiobsl1d/pyretic-rich-smith-blackhatdefcon-2010/
    . Added a module DB.py:
		#!/usr/bin/python
		import sys, os
		sys.path.append("/Applications/DB.app/Contents/MacOS/pyREtic")
		print sys.path
		from pyREtic import REpdb
		REpdb.set_trace()
    . Downloaded the pyREtic package and installed it as the pyREtic directory in ./MacOS.
    . Renamed DB's python module to python.original, because DB's version was causing errors.  I am using the MacOS version of python.
    . Run "python DB.py".  That takes you to the REpdb.py prompt.
    . Commands at the REpdb prompt:
		import DB  <== imports the DB module into the debugging environment
		obj_mirror(DB)  <== allows DB.py to act as a proxy for the original DB
    . Commands at the REpdb prompt: auto_remap "/Applications/DB.app/Contents/MacOS/DB"
    . That asks you which python version to load.  DB uses 2.5.4.  pyREtic will download that for you.
    . The python 2.5.4 download failed with a socket error.
    . The log is saved in /Users/robertstevens/Source/Projects/DB.
    . DB presentation video on DB and Python: http://ontwik.com/python/pycon-2011-how-DB-did-it-and-how-python-helped/
    . Very handy logging function (later): http://vgable.com/blog/2010/08/19/the-most-useful-objective-c-code-ive-ever-written/
    . Great article about how to generate type definitions for class_addMethod: http://www.mikeash.com/pyblog/friday-qa-2010-11-6-creating-classes-at-runtime-in-objective-c.html
    . I'm trying to swizzle NSImage::drawInRect:fromRect:operation:fraction.
    . I believe I swizzled it correctly, but it never hits!!!!   ARRRRGGHHH!  This is frustrating……  Done for the day (3/11/12)
    
- Project to create a bundle via xcode
     . Using a script: http://stackoverflow.com/questions/2578496/creating-my-own-bundle-in-xcode-for-iphone-application
     . Apple doc on bundles: https://developer.apple.com/library/mac/#documentation/CoreFoundation/Conceptual/CFBundles/AboutBundles/AboutBundles.html
     . Good doc on special build requirements: http://www.musicalgeometry.com/?p=1237
     . Shell script to take both sides of a git conflict: http://stackoverflow.com/questions/2637747/get-position-in-class-hierarchy
 - Merging two project files (.pbxproj):
     - I don't have to do this.  Just add a new file and select a project file!   Works like a charm.  That's good Xcode!  :)
 - SMJobBless overview: http://qc-dev.blogspot.com/2010/07/installing-helper-tool.html - 
 - SMJobBless sample: https://developer.apple.com/library/mac/#samplecode/SMJobBless/Introduction/Intro.html#//apple_ref/doc/uid/DTS40010071
  - (3/7/12) Running Windows under VmWare on the Mac: http://codebetter.com/petervanooijen/2011/08/11/running-visual-studio-and-resharper-on-a-mac/


WYUPDATE PROCEDURES (9/26/12) 
 o Execute all of these procedures on a 64-bit development machine. 
 o Version info:
   . We will use the Microsoft .net version definition
   . Marked as Version major.minor.revision.build
   . Since some versioning schemes use "0" to mean "alpha release", and since history has given a stigma to the "zero" release of many products,
     our first external release will be Version 1.1.1.build.
   . The "build" number is incremented every time we deploy, even for internal use.
   . So, we will start with version 1.1.1.1, then version 1.1.1.2, etc.
 o Set the win-client build number (Cloud.exe).  The base version will be 1.1.1.1.
 o In Visual Studio, set the version in the win-client properties Application tab.  Click Assembly Information, and change both the Assembly version and File version to 1.1.1.1.
 o In Visual Studio, select the Release64 configuration and Rebuild Solution. 
 o In Visual Studio, select the Release configuration and Rebuild Solution. 
 o Download and install wyBuild: http://wyday.com/wybuild/downloading.php
 o Run the program.
 o Click Create New Project
 o Company name: Cloud.Com, Product name: Cloud.
 o Choose or create a new theme.
 o Choose or add languages.
 o Choose Update Infomation view
 o In WyBuild, change Update Version to: 1.1.1.1, and indicate the changes for this version:  "Base version for automatic updater".
 o Target git-saved development directories:
   . win-client\WyUpdater\Cloud.wyp: The WyBuild project file.
   . win-client\WyUpdater\DownloadVersion1_1_1_1: This directory contains the server download files and folders necessary to install Cloud:
     - IsSetupPrerequisites\
     - CloudSetup.exe
     This directory is stored on the download server.
   . win-client\WyUpdater\Version1_1_1_1\: The complete set of deployment files representing Version 1.1.1.1, for our records only.  WyBuild does not use this directory.
     Other versions are represented as \Version1_1_2\, \Version1_1_3\, etc.  This directory will also include the version file "client.wyc" for Version 1.1.1.1.
   . win-client\WyUpdater\Version1_1_*\ProgramFiles\:  These are the deployment files and directories that the installer places into
     C:\Program Files (x86)\Cloud.com\Cloud.
   . win-client\WyUpdater\Version1_1_*\CommonFiles32Bit\:  These are the deployment files and directories that the installer places into
     C:\Program Files (x86)\Common Files\Cloud.com\Cloud.
   . win-client\WyUpdater\Version1_1_*\CommonFiles64Bit\:  These are the deployment files and directories that the installer places into
     C:\Program Files\Common Files\Cloud.com\Cloud.
   . win-client\WyUpdater\updates\: This directory contains the server update files built by WyBuild.  These files include the compressed binary changes necessary
     to take any deployment file from any starting version to the target version.  This directory is installed on the update server.
   . win-client\WyUpdater\wyUpdate\: This directory is built by WyBuild.  It contains the current client version file (client.wyc) and a copy of wyUpdate.exe.
     We don't use wyUpdate.exe.
 o Run CloudSetup.exe from C:\Source\Projects\win-client\CloudSetup\CloudSetup\Express\SingleImage\DiskImages\DISK1 to install Cloud.  
   This will install to C:\Program Files (x86)\Cloud.Com\Cloud.   Don't launch the Cloud.exe program.
 o Delete the following files in the C:\Program Files (x86)\Common Files\Cloud.com\Cloud\ directory.
   - Trace.log
   - client.wyc
 o Copy the installed files as follows:
   . C:\Program Files (x86)\Cloud.com\Cloud\*.* =====> C:\Source\Projects\win-client\WyUpdater\Version1_1_1_1\ProgramFiles\.
   . C:\Program Files (x86)\Common Files\Cloud.com\Cloud\*.*  =====> C:\Source\Projects\win-client\WyUpdater\Version1_1_1_1\CommonFiles32Bit\
   . C:\Program Files\Common Files\Cloud.com\Cloud\*.*  =====> C:\Source\Projects\win-client\WyUpdater\Version1_1_1_1\CommonFiles64Bit\
 o Note: The Version1_1_1_1 and other Version* files are not used by WyBuild.  They are our record of the files in the release.
 o In WyBuild, select the Files & Folders view.
 o In the C:\Source\Projects\win-client\WyUpdater\Version1_1_1_1\ProgramFiles\ folder, select all of the files and folders. Drag all the of the files to the WyBuild "Your program's folder".
   . Note: This doesn't copy the files.  It just makes a copy of the metadata which points to the original location of the files.
 o In the WyBuild Files & Folders view:
   . Right-click Program files, Common Files folder (32-bit)
   . Select New Folder.  Add folder "Cloud.com".
   . Right-click the new folder "Cloud.com".
   . Select New Folder.  Add folder "Cloud".
   . Perform the same above steps for the "Program files, Common Files folder (64-bit)" entry.
 o In the C:\Source\Projects\win-client\WyUpdater\Version1_1_1_1\CommonFiles32Bit\ folder, select all of the files and drag them to WyBuild "Program files, Common Files folder (32-bit)\Cloud.com\Cloud".
 o In the C:\Source\Projects\win-client\WyUpdater\Version1_1_1_1\CommonFiles64Bit\ folder, select all of the files and drag them to WyBuild "Program files, Common Files folder (64-bit)\Cloud.com\Cloud".
 o In WyBuild, select the Download Sites view.
 o Click Add Site, enter "http:///web-edge.cloudburrito.com/clients/windows/updates/%file%" and click Add site again to add it to the list.
 o Select the Build wyUpdate & Updates view.
 o Click Build wyUpdate.
   . An explorer window will pop up.  You are building a wyBuild project.  Name the project Cloud.  Type "Cloud" and click Save.
   . This will create two files.  Click "Open the containing folder" to see them.  These files will be added to the installer to save on the client.
     - client.wyc: This file identifies the client version.  In this case, it will identify the client as V1.1.1.1.  Later in the procedure this
       file will be added to the installation to identify it as V1.1.1.1.
     - wyUpdate.exe:  This is the WyBuild distribution version of the stand-alone updater.  We have our own built from open source (CloudUpdater.exe).
       The client user may run the CloudUpdater.exe program to update Cloud to the most recent version.  CloudUpdater.exe
       is run on the client machine.  It inspects the file client.wyc to determine the current version of the app.  It then presents UI to the
       user and manages the download of a new version and the update to that version from the current version, even though that might involve
       several update steps.
 o Click Build updates
   . This will compress the files and build an update package.
   . It will also create some files.  Click "Open the containing folder" to see them.
     - cloud.all.to.1.1.1.1.wyu: The update package to go from scratch to V1.1.1.1.
     - wyserver.wys: Server file
 o Upload the updates and the server file to the update.  Use FileZilla for this.  Alternatively, you can use WyBuild if it is properly set up.
   . FileZilla procedure:
     - Download FileZilla from http://filezilla-project.org/download.php
     - Run FileZilla and set it up.
     - Connect to the update server (may be the same as the download server).
     - Note: This is a Unix server, so all directory and filenames are case-sensitive.  In particular, the "updates" directory must be lower-case.
     - Determine the proper updates directory.
     - Upload the files from win-client\WyUpdater\updates\ to the server updates directory.
 o Click the Build wyUpdate and Updates view.  CLick the "Build wyUpdate: Open the containing folder..." link.
 o Copy the client.wyc file there to the C:\Source\Projects\win-client\WyUpdater\Version1_1_1_1\ProgramFiles\ folder.
 o Now, the client version file (client.wyc) must be made a part of the downloadable installation package:
   . Make sure that the win-client\WyUpdater\wyUpdate\ folder contains the proper client.wyc file for this version.
   . In Visual Studio, select the "release" configuration and run "Build\Build Solution".  NOT "Rebuild Solution".  This should build only the CloudSetup project.
   . Uninstall Cloud from the Start menu on the development machine.
   . Reinstall Cloud by running CloudSetup.exe from C:\Source\Projects\win-client\CloudSetup\CloudSetup\Express\SingleImage\DiskImages\DISK1\.  Don't launch the Cloud.exe program.
   . Check that the c:\Program Files (x86)\Cloud.com\Cloud\ directory now has the proper client.wyc file.
   . Copy the installation package files as follows:
     - C:\Source\Projects\win-client\CloudSetup\CloudSetup\Express\SingleImage\DiskImages\DISK1\*.*  =====> C:\Source\Projects\win-client\WyUpdater\DownloadVersion1_1_1_1
   . Follow the instructions below ("Steps to require administrator on install and change CloudSetup.exe copyright metadata and file icon"):
     - Change the CloudSetup.exe copyright and file icon in C:\Source\Projects\win-client\WyUpdater\DownloadVersion1_1_1_1\CloudSetup.exe
   . Upload the installation package to the download server using FileZilla:
     - Connect to the download server (may be the same as the updates server).
     - Determine the proper download directory.
     - Upload the files from C:\Source\Projects\win-client\WyUpdater\DownloadVersion1_1_1_1\*.* to the server download directory.
 o Test Version 1.1.1.1:
   . Uninstall from the Start menu on the development machine.
   . Browse to web-edge.cloudburrito.com using the development machine.
   . Click the Download button and install Cloud.
   . Change to the c:\Program Files (x86)\Cloud.com\Cloud\ directory and run CloudUpdater.exe.  It should say the installation is current at version 1.1.1.1.
 o That completes the deployment of the base version.
 o @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 o Now make a new version 1.1.1.2 following the procedure below:
   . Uninstall Cloud via the Start menu on the development machine.
   . Change the build number of Cloud.exe.  The new version will be 1.1.1.2.
   . In Visual Studio, change the version in the win-client properties Application tab.  Click Assembly Information, and change both the Assembly version and File version to 1.1.1.2.
   . In Visual Studio, select the Release64 configuration and Rebuild Solution. 
   . In Visual Studio, select the Release configuration and Rebuild Solution. 
   . Run CloudSetup.exe from C:\Source\Projects\win-client\CloudSetup\CloudSetup\Express\SingleImage\DiskImages\DISK1 to install Cloud.  
     This will install to C:\Program Files (x86)\Cloud.Com\Cloud.   Don't launch the Cloud.exe program.
   . Delete the following files in the C:\Program Files (x86)\Common Files\Cloud.com\Cloud\ directory (if they exist).
     - Trace.log
     - client.wyc
   . Make new directories:
     - C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\ProgramFiles.
     - C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\CommonFiles32Bit
     - C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\CommonFiles64Bit
     - C:\Source\Projects\win-client\WyUpdater\DownloadVersion1_1_1_2.
   . Copy the installed files as follows:
     - C:\Program Files (x86)\Cloud.com\Cloud\*.* =====> C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\ProgramFiles\.
     - C:\Program Files (x86)\Common Files\Cloud.com\Cloud\*.*  =====> C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\CommonFiles32Bit\
     - C:\Program Files\Common Files\Cloud.com\Cloud\*.*  =====> C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\CommonFiles64Bit\
   . Run WyBuild and select the Update Information view.  Make a new version 1.1.1.2 by clicking on the "new tab".  Enter info about the new changes in this version.
   . In WyBuild, select the Files & Folders view.
   . In the C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\ProgramFiles\ folder, select all of the files and folders. Drag all the of the files to the WyBuild "Your program's folder".
     - Note: This doesn't copy the files.  It just makes a copy of the metadata which points to the original location of the files.
   . In the WyBuild Files & Folders view:
     - Right-click Program files, Common Files folder (32-bit)
     - Select New Folder.  Add folder "Cloud.com".
     - Right-click the new folder "Cloud.com".
     - Select New Folder.  Add folder "Cloud".
     - Perform the same above steps for the "Program files, Common Files folder (64-bit)" entry.
   . In the C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\CommonFiles64Bit\ folder, select all of the files and drag them to WyBuild "Program files, Common Files folder (64-bit)\Cloud.com\Cloud".
   . Select the Build wyUpdate & Updates view.
   . Click Build wyUpdate.
     - This will create two files.  Click "Open the containing folder" to see them.  One of the files will be added to the installer (later) to save on the client.
       o client.wyc
       o wyUpdate.exe (not used)
   . Click Build updates
     - This will compress the files and build an update package.
     - It will also create some files.  Click "Open the containing folder" to see them.
       o cloud.all.to.1.1.1.1.wyu: The update package to go from scratch to V1.1.1.1.
       o cloud.all.to.1.1.1.2.wyu: The update package to go from scratch to V1.1.1.2.
       o cloud.1.1.1.1.to.1.1.1.2.wyu: The update package to go from V1.1.1.1 to V1.1.1.2.
       o wyserver.wys: Server file to coordinate the above files.
   . Upload the updates and the server file to the update.  Use FileZilla for this.  Alternatively, you can use WyBuild if it is properly set up.
     - FileZilla procedure:
       o Download FileZilla from http://filezilla-project.org/download.php
       o Run FileZilla and set it up.
       o Connect to the update server (may be the same as the download server).
       o Note: This is a Unix server, so all directory and filenames are case-sensitive.  In particular, the "updates" directory must be lower-case.
       o Determine the proper updates directory.
       o Upload the files from win-client\WyUpdater\updates\ to the server updates directory.  "updates" must be lower case.
   . Click the Build wyUpdate and Updates view.  CLick the "Build wyUpdate: Open the containing folder..." link.
   . Copy the client.wyc file there to the C:\Source\Projects\win-client\WyUpdater\Version1_1_1_2\ProgramFiles\ folder.
   . In WyBuild, click File/Save to save the project file.
   . Now, the client version file (client.wyc) must be made a part of the downloadable installation package:
     - Make sure that the win-client\WyUpdater\wyUpdate\ folder contains the proper client.wyc file for this version.
     - NOTE: READ THIS ENTIRE LINE FIRST: In Visual Studio, select the "release" configuration and run "Build\Build Solution".  NOT "Rebuild Solution".  This should build only the CloudSetup project and include the client.wyc file.
     - Uninstall Cloud from the Start menu on the development machine.
     - Reinstall Cloud by running CloudSetup.exe from C:\Source\Projects\win-client\CloudSetup\CloudSetup\Express\SingleImage\DiskImages\DISK1\.  Don't launch the Cloud.exe program.
     - Check that the c:\Program Files (x86)\Cloud.com\Cloud\ directory now has the proper client.wyc file.
     - Copy the installation package files as follows:
       o C:\Source\Projects\win-client\CloudSetup\CloudSetup\Express\SingleImage\DiskImages\DISK1\*.*  =====> C:\Source\Projects\win-client\WyUpdater\DownloadVersion1_1_1_2
     - Follow the instructions below ("Steps to require administrator on install and change CloudSetup.exe copyright metadata and file icon"):
       o Change the CloudSetup.exe copyright and file icon in C:\Source\Projects\win-client\WyUpdater\DownloadVersion1_1_1_2\CloudSetup.exe
     - Upload the installation package to the download server using FileZilla:
       o Connect to the download server (may be the same as the updates server).
       o Determine the proper download directory.
       o Upload the files from C:\Source\Projects\win-client\WyUpdater\DownloadVersion1_1_1_2\*.* to the server download directory.
   . Test the upgrade:
     - Uninstall from the Start menu on the development machine.
     - Browse to web-edge.cloudburrito.com using the development machine.
     - Click the Download button and install Cloud.
     - Change to the c:\Program Files (x86)\Cloud.com\Cloud\ directory and run CloudUpdater.exe.  It should say the installation is current at version 1.1.1.2.
     - Uninstall Cloud from the development machine Start menu.
     - Reinstall Cloud from the C:\Source\Projects\win-client\WyUpdater\DownloadVersion1_1_1_1\CloudSetup.exe installation program.
     - Change to the c:\Program Files (x86)\Cloud.com\Cloud\ directory and run CloudUpdater.exe.  It should say that an upgrade is available from 1.1.1.1 to 1.1.1.2.
     - Perform the upgrade.
     - Run CloudUpdater again.  It should say the installation is at the current Version 1.1.1.2.
   . That completes the deployment of an update.
 o Steps to require administrator on install and change CloudSetup.exe copyright metadata and file icon:
   - Install reshack_setup.exe (Resource Hacker).  Download from http://www.angusj.com/resourcehacker/.
   - In Resource Hacker, open the unmodified CloudSetup.exe
   - Expand Icon Group and go into group 100
     o Right-click 0 and select Replace resource
     o Click Open file with new icon... and pick cloudForInstallShield.ico from Artwork then click Replace
   - Expand Version Info and go into 1	
     o Change the script inside for lines LegalCopyright and OriginalFilename (use "Copyright (C) Cloud.com. All Rights Reserved." and "", respectively) and then click Compile Script
   - Expand 24 and go into 1
     o Change the script inside for assembly -> trustInfo -> security -> requestedPrivileges -> requestedExecutionLevel and change attribute "level" from "asInvoker" to "requireAdministrator" and then click Compile Script
   - Click File/Save and exit ResourceHacker.
   - Delete the CloudSetup_Original.exe file.

WYAUTOMATICUPDATER INTEGRATE NEW RELEASE (10/4/12)
  o Integrate 2.6.18 (10/4/12)
  o Set the AutomaticUpdaterWPF4 project as the startup project.  Note the *WPF4, not *WPF.
  o Change Properties/Application/Target framework to ".NET Framework 4 Client Profile".
  o Change Properties/Application/Assembly Information file version to match the assembly version.
  o Change Properties/Application/Icon: to cloud.ico.
  o For debug configuration:
    - Change Properties/Build/Output path: "..\..\..\bin\Debug\"
  o For release configuration:
    - Change Properties/Build/Output path: "..\..\..\bin\Release\"
    - Change Properties/Build/XML documentation file:  "..\..\..\bin\Release\AutomaticUpdaterWPF.XML"
  o Disable signing (Properties/Signing/Sign the assembly).
  o Change all instances of "wyUpdate.exe" to "CloudUpdater.exe"

WYUPDATE RESET TO BASE VERSION:
  o Open wyBuild.
  o Select the Update Information view.
  o Position to the highest version tab.  Right-click and select "remove version".  Do this for highest version tab down to, but not including 
    Version 1.1.1.1 to remove all of the versions.
  o Select the version 1.1.1.1 tab.
  o Select the Files & Folders view.
  o Delete the folders under "Your program's folder", "Program files, Common FIles folder (32-bit)", and "Program files, Common Files folder (64-bit).
  o Click File, Save.
  o Exit wyBuild.
  o In your FtpRoot directory:
    - Delete all files under FtpRoot\updates.
    - Delete file \CloudSetup.exe
  o In the win-client\WyUpdater directory:
    - Delete all directories "DownloadVersion*"
    - Delete all directories "Version*"
    - Delete the contents of the WyUpdater\updates directory.
  o Run NewUpdate.vbs.
  o Enter "1.1.1.1" for the version.
  o Enter "No" to indicate that this is a replacement version.




ICONBADGE API (3/1/12)
  o (3/2/12) NOTE: Totally reworked.  See IconBadgeApiProtocol.h
  o Messages:
      - AddNamedBadgeFiles
          . Dictionary of named badge files:
              o Key: NSString: ID of the badge.
              o Value: NSString: Full path of the badge (icon) file.
          . Existing badges will be replaced by the new badge.  This is not an error.
          . New badges will be added.
          . Return: Dictionary of Keys vs. NSError objects.  If the dictionary is empty, there were no errors.  Otherwise, each
            of the errors is included in the return:  Key: ID of the badge that failed.  Value: NSError describing the error.
      - DeleteNamedBadgeFiles
          . Array of badge keys:
              o Key: NSString: ID of the badge.
          . Badges with valid matching keys will be deleted.
          . If a key is not recognized, it will be ignored.  This is not an error.
          . Return: Dictionary of Keys vs. NSError objects.  If the dictionary is empty, there were no errors.  Otherwise, each
            of the errors is included in the return:  Key: ID of the badge that failed.  Value: NSError describing the error.
      - AddFileStatus
          . Dictionary of files with status:
              o Key: NSString: Full path of the file.
              o Value: NSString: ID of the badge used to represent the current status of the file.
          . New file status objects will be added and modified.
          . Existing file status objects will be modified.  This is not an error.
          . If a status is modified (new or different), the corresponding badge will be applied to the file's Finder icons.
          . Return: Dictionary of Keys vs. NSError objects.  If the dictionary is empty, there were no errors.  Otherwise, each
            of the errors is included in the return:  Key: Full path of the file that failed.  Value: NSError describing the error.
      - DeleteFileStatus
          . Array of file keys:
              o Key: NSString: Full path of the file.
          . File status with valid matching keys will be deleted.  The badge will be removed from the file's Finder icons.
          . If a key does not currently exist, it will be ignored.  This is not an error.
          . Return: Dictionary of Keys vs. NSError objects.  If the dictionary is empty, there were no errors.  Otherwise, each
            of the errors is included in the return:  Key: Full path of the file that failed.  Value: NSError describing the error.

XCODE (3/26/12)
  o Keys:
     - Ctl-Shft-K: Clean
     - Ctl-B: Build

BASH
  o rm -rf  <dir>     <== remove directory recursively
  o find . -type f -perm +a=x -ls  <== find all regular files recursively that are executable by all and list them via "ls -l"
  o .bash_profile example: http://www.devdaily.com/blog/post/mac-os-x/sample-mac-osx-bashrc-terminal-startup-file
  o chown -v -R robertstevens:staff . <== Change ownership recursively.
  o chmod +a=w  <== Add write capability for all users.
  o Put shell scripts in /usr/local/bin.
  o Setting environment variables: Add to /etc/launchd.conf and reboot: http://stackoverflow.com/questions/135688/setting-environment-variables-in-os-x

TEAM MEMBERS:
  o Rion McCauley
  o Gus Pinto
  o Steve McFerrin
  o Phil Wiebe
  o Pete Llaguno
  o Michael Lopez
  o Scott McDonald
  o Chuck
  o Leo
  o David Bruck
  o Brian ? Design


SNIPS
  o Remove a trailing backslash:
    NSMutableString *pathWithoutTrailingSlash = [path mutableCopy];
    if ([pathWithoutTrailingSlash hasSuffix:@"/"]) {
        [pathWithoutTrailingSlash deleteCharactersInRange: NSMakeRange([pathWithoutTrailingSlash length]-1, 1)];
    }

GREP:
  - grep -rin --include=*.xib "processRegistration" *   (recursive, case-insensitive, line numbers), look for all *.xib files).

GIT (3/2/12)
  - cd ~
  - mkdir ~/.ssh
  - cat ~/.ssh/id_rsa.pub | ssh root@localhost "cat - >> ~/.ssh/authorized_keys"
  - ssh root@localhost
  - ssh-keygen -t rsa
  - cat ~/.ssh/id_rsa.pub | ssh root@localhost "cat - >> ~/.ssh/authorized_keys"
  - ssh root@localhost
  - cat ~/.ssh/id_rsa.pub | ssh root@localhost "cat - >> ~/.ssh/authorized_keys"
  - ssh root@localhost
  - /var/root/Library/Developer/Xcode/DerivedData/IconBadge-bxyvdekvflxfbsafbyyrdccuymxk/Build/Products/Development/IconBadge ; exit;
  - /Users/robertstevens/Source/Projects/IconBadge/README ; exit;
  - ssh-keygen
  - ssh-keygen -t rsa -C "robert@cloud.com"
  - cat /var/root/.ssh/id_rsa
  - cat /var/root/.ssh/id_rsa.pub
  - cd /Users/robertstevens/Source/Projects/Cloud.com/Development/Mac\ Client 
  - git clone git@github.com:CloudCom/mac-client.git
  - cd..
  - cd ..
  - cd /Users/robertstevens/Source/Projects/Cloud.com/Development
  - git clone git@github.com:CloudCom/mac-client.git
  - git status
  - cd mac-client
  - git add .
  - git status
  - git commit -m "Initial Commit for the shell integreation project that allows the Cloud app to add badges to Finder objects"
  - git pushcd /Users/robertstevens/Source/Projects/Cloud.com/Development/Mac-client
  - git status
  - git remove
  - git rm
  - git stash save "Badging large icons via Finder injection"
  - git stash list
  - git stash pop stash@{0}
  - git branch: http://book.git-scm.com/3_basic_branching_and_merging.html

MORE GIT (3/7/12)
  - Never pull or merge before committing.
  - Commit often.
  - Don't pull or merge with uncommitted actions.
  - One trick for saving debugging code:
    . git stash
    . git merge origin/master
    . git stash pop
  - git commit -a -m "Fixing git problems…."   <== Forces adds
  - git add  <== adds files, or if they were being tracked, re-stages the changes.
  - git checkout  <== reverts a file, but with some minor merging back to the working directory.
  - git rm  <== removes any staged changes for a file
  - git diff  <== show the diffs between the disk version and the repository.
  - git rm -f   <== forces the removal of the changes
  - git reset  <== Undoes the last commit, and upstages everything!
  - git reset --hard  <== Undoes the last commit, undoes all of the staged files, and pulls the repository to your working directory.  Like Perforce force?
  - Good tutorial on git reset: http://progit.org/2011/07/11/reset.html
  - sudo chmod -R -a "group:everyone deny delete" .  <== Fix permissions problem
  - (3/21/12) git mergetool  <== helps with merges that need to happen.
  - To sync with master:
    . git stash save "message"
    . git pull
    . Fix conflicts and mark as fixed.
    . git commit -m "message"
    . git push
  - Set default remote:
    . git branch --set-upstream master win-client/master
  - Removing many un-staged deleted files:
    . Use git bash
    . Change drives: cd /C
    . Then change to your directory.  cd ...
    . Then issue the following command:
                git diff --diff-filter=D --name-only -z | xargs -0 git rm  
  - Committing branch
    . git branch <branch>
    . git checkout <branch>
    . git commit...
    . git push origin <branch>
    . To delete.
      - git checkout master
      - git branch -D <branch>  (locally).
      - git push origin :<branch> (remote).
  - Checking out a remote branch and creating a new branch on this client:
         git remote show origin  (if the branch shows as new, then issue the next command)
	 git fetch
         git checkout -b newdesign origin/newdesign  
  - If overriding the GIT home directory (e.g.,, V:), set a HOME environment variable.  E.g: C:\Users\Username
  - I did a "git read-tree" by accident.  It really messed up the staging.  It seems that everything was deleted, then (maybe) re-added again.  I reset the index.
    . See: http://stackoverflow.com/questions/1115854/index-file-corrupt
    . $ rm -f .git/index
    . $ git reset
  - Pull master while working on a branch.
    . git stash
    . git pull --rebase origin master
    . git stash apply
  - Situation:
    . I forgot to make a branch, and I was working on master.
    . I realized that and made a branch at that point.
    . That branch was then clean (nothing to commit) and in sync with master at that point.
    . I then wanted to switch to master and sync it with the remote master.
    . My expectation was that master would be at the remote level, and my branch would be the current development state (at the point of making the branch from master).
    . Commands:
      o Make a copy of the directory in case something goes wrong.
      o git checkout master (ahead of origin/master by 1 commit).
      o git fetch origin
      o git reset --hard origin/master
          HEAD is now at 3bc8af8 Merge branch '20120827A1PushedBadgingSupportComplete'
      o I think that was the last thing I pushed.
    . Now check to see that I didn't lose anything.
    . Yes!  I didn't lose anything.
    . Now checkout Master and see that my recent changes are gone.
    . Yes!  They are gone.  That worked!
  - Delete branch
    . Remoteley: git push origin --delete 20120831A0PushedUiNewArtworkComplete
    . Localley git branch -d 20120831A0PushedUiNewArtworkComplete

WINDBG (8/30/12)
  - To debug CLR on an exeption:
    . .load C:\WINDOWS\Microsoft.NET\Framework64\v4.0.30319\SOS.dll (x64)
    . .load C:\Windows\Microsoft.NET\Framework\v4.0.30319\SOS.dll (x86)
    . sxe clr
    . sxe 0xe0434f4d  (breaks on first-chance exception)
    . From the menu, Debug, Restart, or if already loaded (g).
    . Hit the first chance exception.
    . .load C:\WINDOWS\Microsoft.NET\Framework64\v4.0.30319\SOS.dll
    . kpL (call stack)
    . !pe (to see the exception)
    . For more detailed info, see this page: http://blogs.msdn.com/b/alejacma/archive/2009/08/24/managed-debugging-with-windbg-breaking-on-an-exception-part-1.aspx
  - Stop at DLL load: http://debugbeyond.blogspot.com/2012/01/windbg-display-parameters-whenever.html
  - That command is bp kernel32!LoadLibraryW ".echo *****;du dwo(esp+4);k;"
  - I ran regsvr32 under depends and got the following more-detailed error:
      00:00:00.297: GetProcAddress(0x000007FF58AF0000 [c:\windows\system32\MSCTFIME.IME], "ImeGetImeMenuItems") called from "c:\windows\system32\IMM32.DLL" at address 0x000007FF7D51030E and returned NULL. Error: The specified procedure could not be found (127).
  - WinDbg .msi files are in: C:\Program Files\Microsoft SDKs\Windows\v7.1\Redist\Debugging Tools for Windows
  - Fixing mismatched CLR/SOS versions: http://stackoverflow.com/questions/7093494/windbg-x64-cannot-debug-a-crash-dump-failed-to-load-data-access-dll/7874862#7874862
  - ProcDump as JIT dumper:
		Windows Registry Editor Version 5.00
		[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AeDebug]
		"Debugger"="\"c:\\dumps\\procdump.exe\" -ma %ld c:\\dumps"
  - Cheat sheet: http://windbg.info/doc/1-common-cmds.html
  - List modules with symbols: lml
  - Symbol path: SRV*c:\symbols*http://msdl.microsoft.com/download/symbols
  - Mismatched SOS and CLR dlls:
    . Get sos, mscordacwks and clr dlls from the dump machine.
    . Rename the mscordacwks.dll to mscordacwks_x86_x86_4.0.30319.269.dll (using the proper platform and version info)
    . .exepath c:\trash\scott (path to the downloaded dlls)
    . .load c:\trash\scott\sos.dll
    . .cordll -ve -u -l ( for verbose load info)
    . !clrstack (to test it)



  

GDB (3/8/12)
  - info functions <== shows the functions
  - frame 3  <== change to frame 3
  - info frame  <== get info about a frame
  - info args
  - info locals
  - p/x $rsp  <== print value in stack register
  - x/3xg $sp  <== print 3 double words of the stack in hex.  RepeatCount: 3: number. Format: x: format.  UnitSize: g: double words, b: bytes, w: words, h: shorts.
  - show logging; set logging on; set logging off;  <== logs to gdb.txt
  - Adding a main menu item dynamically:
    . gdb
    . attach TextEdit
    . p (char)[[NSBundle bundleWithPath:@"/Library/Frameworks/FScript.framework"] load]
      . p (void)[FScriptMenuItem insertInMainMenu]
      . continue
  - Display register: po $rdi
  - 

GRAB (3/17/12)
  - Cmd+Ctrl+Shift+4, clip the image to the clipboard.


MAC OS X KEYS AND GESTURES (3/14/12)
  - Cmd-W <== Close window
  - Cmd-Opt-W  <==Close all windows
  - Start-up fix: Restart, holding Cmd-D with no devices attached or around (BlueTooth). Utilities menu. Terminal. resetpassword.

SNIPPING TOOL
  - Right-click in start menu, properties, shortcut tab.  Shortcut key.  Press a key.  Ctrl-Alt-key.
  - To snip a system tray context menu: With snipping tool running, press Esc.  Show the menu, then press Ctrl_PrtScn.

BUILD DIRECTORIES (9/10/12)
	Output directories
		bin
		x64
	Client dependency directories (do not build or output to here)
		x86
		amd64

TODO:
  x (3/1/12) Finder should host the API server.
  x Change the FinderOverride code to implement a new thread, and make that thread establish a full NSRunloop environment.
  x Write a test app that will test the API.
  x Design and document the API.
  x Test the API using non-admin users.  Also admin.  Also root.
  x Provide install and uninstall scripts.
  x Capture the current Finder node's full path so it can be compared against file status.
  x Wrap everything into a single bundle, and include it in the mac_client .xcode.
  x Write code at startup in the mac_client that will perform the IconBadge installation.
  x Add badges to the QuickLook preview images.
  x Remove or disable debug logging.  Or change the logging to use DTrace?
  x Try the injection on Mountain Lion.
  x Change the main IconBadge icon.
  x Inject finder from Cloud.app after installation.
  x Don't require authorization if already installed.
  x Injection breaks Finder's "Get Info".
  x Certain files in a listview window are not badged (*.pdf, *.icns, *.jpeg, *.png, etc.).
  x Change copyrights to cloud.com.
  x Use @try/@catch in all swizzled methods.
  x Write a separate test program to select a file and badge it with a particular status (icon).  Also support random timed changes for a particular file.
  x Make all internal functions static.
  x When file status is changed via the API, notify Finder to come back and repaint the icon so the badge will change to match the new status in real time.
  x (3/21/12) Use the common getCloudIconType* functions everywhere.
  x (3/22/12) The list view icons on the flow view are not properly redrawing.  The setNeedsDisplay deselects the item, and it doesn't draw until it is selected again.  Apple bug.
  x (3/23/12) Don't stop Finder.  Rerun the test app and show that it still badges.
  x (3/23/12) Rename IconBadge to ShellSupport?  Or other?
  x (3/29/12) Bug: Can't register from the Agent back to Cloud.app.
  x (3/29/12) When Finder crashes, or is restarted, automatically re-inject. Poll the finder PID.  When it goes away, poll for Finder and reinject.
  x (3/29/12) The random change test program doesn't show all of the changes.  Why so slow?
  x (3/29/12) When we inject to Finder, enumerate all of the Finder windows and refresh them so the badges paint.
  x (3/29/12) When searching for Finder, find the Finder process belonging to the current user.  In general, make sure multiple users work properly.
  x (3/29/12) Use thread operations for sending messages back to cloud.app.
  x (3/30/12) Integrate the GUI test into the Cloud app:
  x (4/2/12) Bug: If the agent is recycled, the next message to the agent fails with an exception.  Protect against the exception, and auto-reconnect via another thread.
  x (4/2/12) Bug: Crash in Cloud when stopping Finder.
  x (4/3/12) Remove getlogin_r() duplicate code.
  x (4/5/11) Finder injection fails, but Agent still sends a refreshToFinder message to the user.
  x (4/5/12) Use proper file for nosync_192.
  x (4/5/12) Dynamically calculate the particular size and position of an icon to use for the CALayer browser images.
  x (4/5/12) Change NSLog to ALog/DLog everywhere.
  x (4/6/12) Clear all of the Finder's badges upon Cloud connection to Finder in case this is a reconnection.
  x (4/7/12) Enumerate and badge the whole cloud folder when the refreshToFinder message occurs.  Enumerate to a collection.  Start badging on another thread.  As
     user-triggered badges occur, remove that file from the collection and badge the user's requests in real time.  Repeat this process until the folder is badged.
     The user's actions will take priority.
  x (4/7/12) Test with Mountain Lion.
  x (4/7/12) Make sure that all attempts to connect to a remote server are retried on a timer.
  x (4/7/12) Gus: No badging code anywhere?
  x (4/9/12) Update registerUserName to test the inbound user name and pid.  The user name should be the same as the agent's.  The pid should be for Cloud.app.
  x (4/9/12) Add tests:
    - Restart the Mac multiple times and make sure that all three processes initialize correctly and handle the race conditions.
    - Add "crash" messages to Finder and Agent, and have the tests crash one, the other, or both, and recover.
    - Add tests for Agent.  
  x (4/9/12) On a restart, there is a race condition because Cloud, CloudApp and Finder are all trying to start simultaneously.  The Agent connection to Finder fails.
  x (4/7/12) Add a state to Cloud connection to Finder.  Cloud should not attempt to connect to Finder before connecting to Agent and receiving the refresh to finder message.
  x (4/9/12) Implement SMJobBless and a new service for the privileged work?
  x (4/10/12) Is the Agent in the wheel group (really?)?  No, it is the standard user logon.
  x (4/10/12) Badging doesn't work on Gus' or Steve's machine.
  x (4/10/12) Make getpwuid thread-safe.  Use getpwuid_r() everywhere.
  x (4/10/12) Remove "set -x" in the shell scripts.
  x (4/10/12) Uncomment messages in CLAgentService.m:beginAgentServices.
  x (4/10/12) Test for memory leaks.
  x (4/10/12) Speed up installation.  Try not to affect the GUI performance.
  x (4/12/12) Use notification instead of KVO everywhere we can.
  x (4/11/12) Badges on folders are not refreshing.  Also, badges on file in the ListView/FlowView view are not refreshing.
  x (4/12/12) Remove TODO: duplicate code.
  x (4/12/12) Change the refresh logic to run it on the Finder main thread (to avoid threading issues).
  x (4/12/12) Inspect all retains for proper use.
  x (4/12/12) Use NSError instead of int return codes.
  x (4/12/12) Inspect all code for proper function prototypes.
  x (4/12/12) Remove duplicate code in CLAgentService.m:
                dp.isAgentSendConnectionAlive = NO;        // attempt to restart the connection to the agent
                dp.isUserRegisteredWithAgent = NO;         // attempt to reregister the user with the agent
  x (4/12/12) When the first Cloud dialog appears, the typing of the user email address is delayed.
  x (4/14/12) Don't queue resets every time we give back a MAX_BADGES_QUEUED error at setBadge.
  x (4/14/12) Rework compare and swap to use atomic increment/decrement. (not necessary)
  x (4/14/12) Remove the check on finder state at the badging API.  Queue up the badges.
  x (4/13/12) Prove that the refresh-window thread is actually the Finder main thread ID.
  x (4/13/12) Change the refresh logic to refresh a window only if the window is viewing some portion of the Cloud folder.  (Decided against this)
  x (4/16/12) Remove user chmod +s flag.  It doesn't do anything.
  x (4/15/12) Rework badgeCloudDirectoryAtPath.
  x (4/15/12) Replace KVO in IconBadgeServiceUser with NSNotificationQueue. (actually reworked it pretty seriously).
  x (4/16/12) Check that agent userName is inserted into the user object, and into the dictionary, as lower case, then eliminate all of the other lowercase transformations.
  x (4/16/12) When starting agent user object, check finder to see if it is already injected.
  x (4/16/12) Kill Finder:  Doesn't rebadge other icons.
  x (4/16/12) Crash in CloudApp (memory):
	Thread 3 Crashed:
	0   libobjc.A.dylib               		0x00007fff99511f7e objc_release + 14
	1   libobjc.A.dylib               		0x00007fff9951127c (anonymous namespace)::AutoreleasePoolPage::pop(void*) + 464
	2   com.apple.CoreFoundation      0x00007fff98ad4692 _CFAutoreleasePoolPop + 34
	3   com.apple.CoreFoundation      0x00007fff98ae96d7 __CFTSDFinalize + 119
	4   libsystem_c.dylib             	0x00007fff99185112 _pthread_tsd_cleanup + 240
	5   libsystem_c.dylib             	0x00007fff9917e6ca _pthread_exit + 146
	6   libsystem_c.dylib             	0x00007fff99180c1e _pthread_workq_return + 35
	7   libsystem_c.dylib             	0x00007fff991809db _pthread_wqthread + 412
	8   libsystem_c.dylib             	0x00007fff9916afb1 start_wqthread + 13
  x Recover the Windows 7 image in a VMWare VM.
  x (4/15/12) CloudApp:IconBadgeServiceUser:observeValueForKeyPath fires twice and sends refreshToFinder message to Cloud twice.  The double-take causes the second
     observeValueForKeyPath to see a successful Finder injection, even though it wasn't.
  x (4/16/12) When restarting Cloud, the registerUser works, but no refreshToFinder message is sent, so Cloud will do no badging.
  x (4/16/12) When Cloud crashes, should we detect that and unbadge everything?  Yes.
  x (4/16/12)  Release the proxy in agent for DO with Finder.
  x (4/16/12)  Add a refreshWindows message to the Finder API.  I will also need to put logic into the user to send a refreshWindows message some amount of time 
     after the last badging operation, if a new badging operation doesn't come in within that amount of time.  (didn't need to.  It was a bug.)
  x (4/17/12) Fix the agent user clean-up loop.
  x 4/17/12) CloudApp crashes at the end of unit testing.
  x (4/16/12) Agent user hasRegisterBeenRequested is messed up.
  x (4/17/12) Move retain from agent user to agent server.
  x (4/17/12) Add retains on the DO proxys.
  x (4/17/12) Refactor the way user objects are created in the agent.  Pass ownership of the user objects to the dictionary.
  x (4/17/12) Release objects after adding them to collection.
  x (4/17/12) The server handles unregisterUserName, but it should really be the user.  If the user is registered, pass this event to the user and let him clean up, kill all badges, and 
     schedule the unregisterUser back to the server.
  x (4/1812) If the user is already registered on a registerUser, send a refreshToFinder message.
  x 4/18/12) On an unregisterUserName, pass the user pid, and generate an error if the pid's don't match.  (decided against it, for now)
  x (4/18/12) The agent user is not taking timer events, at least on a reconnect.
  x (4/19/12) The agent crash on user kill is back, even after the refactor.
  x (4/19/12) Check the release of g_dictNamedBadgeFiles in IconBadge.  Also check syncFinderLock.
  x (4/19/12) Test multiple users.
  x (4/19/12) Change "daemon" to agent everywhere.
  x (4/20/12) Check whether proxies are retained when created.  e.g., proxyForUserServer.  Remove the retains and test.  I took out the retains and it works.
  x (4/20/12) Code review.
  x (4/20/12) Compile everything with the -w (ignore warnings) flag turned off.
  x (4/28/12) Tab out of empty field didn't invoke the property set.
  x (4/29/12) The text entered is grey.  Make it black.
  x (4/29/12) Passwords should be *'s.
  x (5/2/12) The SelectStorageSize dialog is being instantiated twice.  That causes messages to be subscribed twice, and displayed twice.  Make the view a singleton?
  x (5/3/12) Change CLSettings.cs to use real properties.
  x (5/3/12) The EMail textbox is not getting focus in the CreateNewAccount dialog.  I am using the Navigated_To event.
  x (5/3/12) The password is not showing as required.  Enter the dialog and click Continue.
  x (5/3/12) The 50GB and 500GB selections cause a never-ending dialog loop.
  x (5/4/12) Change the select storage size dialog to use back and continue keys.
  x (5/3/12) Fix the timing of control focus everywhere.
  x (5/4/12) Expand the radio button click-sensitive area everywhere.
  x (5/4/12) Increase the size of the font on the account setup form.
  x (5/4/12) Add unselected state 50% white screens to the unselected radio buttons.
  x (5/4/12) Remove "TextBlock" showing on the SetupSelector dialog.
  x (5/5/12) Implement the settings on the create new account page, except for the password.
  x (5/5/12) Implement OnNavigatedTo for the CreateNewAccount page.
  x (5/5/12) Expand the Hit area on the SetupSelector dialog.  Also use the white screen on the unselected option, like the SelectStorageSize dialog.
  x (5/5/12)The SelectStorageSize selected storage size didn't hold on navigation.
  x (5/5/12) Implement the settings for the main page.
  x (5/5/12) Implement OnNavigatedTo for the main page.
  x (5/5/12) Use NavigatedTo events to initiliaze dialog state everywhere.
  x (5/5/12) The 5GB selection is not getting selected when entering the StorageSelection dialog.
  x (5/5/12) The ConvertBack (null) function is broken on the StorageSizeSelection dialog.  This is OK (expected).
  x (5/7/12) Make a prettier dialog box.
  x (5/12/12) Give focus to the email field on the main screen.
  x (5/5/12) Implement default return key on every dialog.
  x (5/5/12) The string "user@c.com" failed the regex test (relaxed the test).
  x (5/6/12) Remove duplicate code: ForceValidation().
  x (5/9/12) Add a logging utility.
  x (5/11/12) Remove the unused SetupSelector_CloudSetupNotifyFolderLocationConflictResolved message.
  x (5/11/12) Bug: The default modal messagebox onclick handler happened twice.
  x (5/11/12) Push the changes on the current Mac client 20120419V1AfterPushingFileNameChanges branch.  I have checked them out.  They are committed and good.
  x (5/15/12) Remove navigation toolbar.
  x (5/23/12) Insert the real first name into "Greetings Gus, welcome to Cloud!".
  x (5/??/12) The Navigated event is not equivalent to the NavigatedTo event in SL.
  x (5/??/12) The SetupSelector Continue button is chopped at the bottom.  It also has a dotted-line selector, which isn't all bad.
  x (5/??/12) Now the first dialog paints a dotted rectangle in the upper left corner, same size as the dialog.
  x (5/??/12) Now I am fighting with a failure to navigate (SetupSelector navigating to PageTour1 after showing a couple of dialogs.
  x (5/??/12) PageTour5 has an artifact at the bottom.
  x (5/??/12) On the SelectCloudFolder dialog, change the left button (Back) to (Cancel).
  x (5/??/12) Add more space under dialog buttons, and increase the size of the separator vertically.
  x (5/??/12) Make sure that the buttons are all the same size on the dialogs.
  x (5/??/12) Enter C:\Users\BobLaptop in the SelectCloudFolder dialog.  It wants to use C:\Users instead.
  o (5/23/12) Exception from registration: Dialog "Email has already been taken.".  The button doesn't have a caption.
  x (5/23/12) Submit all of our tool source (MvvmLight, ExtendedWpfToolkit, etc.) to git.
  x (5/25/12) Remove PageInvisible.  (changed it to WindowInvisible, and used it for system tray support).
  x (5/27/12) The balloon tooltips stopped working! (time-waster: Rebooting Windows 7 fixed it.)
  x (5/26/12) Minimize the application to the system tray with a context menu.
  x (5/24/12) Implement the first-time logic.
  x (5/27/12) Pin the icon to the system tray bar. (No.  That is the user's choice.  Dropbox is not there either.)
  x (6/26/12, Gus implemented this) The Finder sidebar Cloud icon is not being painted properly.  Maybe There should be two different images.  One for normal mode, and one for the hightlighted mode?
  x (6/26/12) Remove all of the dead swizzles.
  x (6/26/12) Put __strong on "NSError **" parameters??
  x (6/26/12, Gus did this) Add 2x badge images to support Retina.
  x (6/26/12) On the security popup: Cloud wants to make changes.  Also add icon.
  x (6/26/12) Send Finder context menu click event to Cloud.app.
  x (6/26?/12) Add Cloud.com to the Finder toolbar share menu.
  x (7/11/12) Upon signing in from the main screen, minimize to the task bar.
  x (7/11/12) Implement CloudApiBridge.m?  NO.  That is old code.
  x (7/12/12) Fix CLSyncService line 1377: parse eid as a long.
  x (7/12/12) Fix CLSyncService line 3544 with opposite polarity.
  x (7/12/12) Set default paths to String.Empty.
  x (7/12/12) Normalize paths with "/" character to and from server.
  x (7/12/12) Replace the strings in Replace(string, string) with chars.
  x (7/12/12) Rework CLExtensionMethods:PathComponents to use String.Split.
  x (6/26?/12) A right-click does not select the item, so that item is not included as selected.  Select three items and right-click on one of them.  All three are shared.
        However, right-click an unselected item, and only the right-clicked item is shared.  So I need to rework the logic to match this behavior.  That will
        require identifying the right-clicked item (new research).
  x (6/26?/12) Select multiple items and right-click.  Only a single item is sent to Cloud.app when clicking the Cloud.com context menu item.
  x (6/26?/12) For Lion support: Add the Cloud.com context menu item to the primary context menu.  Lion doesn't support the Share menu item.
  x (6/26?/12) Fix bug: When the user clicks a context item, we lose the key window, and that is what I am using to find the
  x (6/26?/12) The first context menu click works, but subsequent clicks don't.  Minimize and restore the Finder window, then it
    works on the first click, but again, not on subsequent clicks.
    window origin and size.  The click is ignored.  Find another way to identify the window.
  x (6/26?/12) Determine the full path of the file associated with the Finder Share context menu click and send it to Cloud.app.
  x (6/26?/12) Mac client Finder sidebar custom icon.
  x (6/26?/12) Mac client Finder Share context menu support.
  x (6/26?/12) Fix FOFinderSwizzle.m to not require a single existing menu item to clone.
  x (David) Determine the DB architecture.
  x Exit the application on a system tray context menu click of the Exit menu item.
  x (7/12/12) Double backslash after C:\\.
  x (7/12/12) Send only the folder relative paths to the server.  Use only "/" and add "/" after directory entries.  e.g.: Pictures/
  x (7/12/12) When signing in from the main menu -> StorageSelector.  Don't show the Back button because it goes "back" to the CreateNewAccount page.
  x (7/12/12) Retest the cloud system tray toasts and context menu.  (It works).
  x (7/12/12) Cloud window appears as a blue dot when minimized to the tray.  (Added Visiblility = Visibility.Collapsed).
  x (7/16/12) Naming the downloaded file guid-Cloud.  Should be the filename.ext instead of cloud.
  x (7/17/12) Problem with EventId being ulong, vs. int, vs. string, vs. long.  Which is it.
  x (7/17/12) In FSM, establish a SimulatePushNotification event callback to sync.  Drive this event if no FSM events are created within a timeout period.
  x (7/17/12) App.xaml.cs, line 104.  Handle the IconOverlay error.
  x (7/18/12) Problem with server EventIds not being comparable to client EventIds.  It looks like we can only search by path, and there
    is no path in the FileChange.
  x (7/18/12 ) Start again in CLSptHttpConnectionOperation on the temp file path.
  x (7/18/12) Remove the test code &&&&&&&&&& for simulated notification in CLSyncService.
  x (7/18/12) Hook up push notification to the push server and see that it works.
  x (7/19/12) Get David's extension.
  x (7/19/12) Problem: The upload event is complete, and the event is being marked complete via PerformUpdateForSyncEvent and MarkItemForEvent_asPending.  There is no 
    previous sync point for this event in MarkEventAsCompletedOnPreviousSync.  
  x (7/19/12 redesigning...) Running the download twice.  The cloud path is doubled-up.
  x (????) The second fancy WPF pop-up throws an exception.
  x (7/23/12) Fix the IconOverlay exception on application exit.
  x (7/23/12) Move the system tray icon code from PageInvisible to NavigationWindow.
  x (7/23/12) In page invisible, fix the references to the containing window.
  x (7/23/12) The cloud icon doesn't appear in the system tray.
  x (7/23/12) On shutdown and unhandled exceptions, kill BadgeCom process.
  x (7/23/12) Implement the logic that detects that the Cloud folder is missing on startup and asks the user to Unlink or Relocate.  Clear the user settings on Unlink.
  x (7/24/12) Fix all of the MVVM Messenger messages to use the CLAppMessages helpers rather than explicit string constants.
  x (7/26/12) Should the modal dialog be modal to the entire window?  Yes.  It works.
  x (7/26/12) The modal dialog is bleeding into the outer page from the frame.
  x (7/25/12) Get rid of the code that unregisters the OnNavigated event.  Why is that there????
  x (7/25/12) Remove Silverlight code.
  x (7/25/12) Get rid of ugly duplicate code SendNavigationRequest, and change all of the strings used there to consts.
  x (7/28/12) Set the results back into preferences and persist them.
  x (7/29/12) Set and read the Settings into and out of CLPreferences via methods in ClPreferences.
  x (7/29/12) Gray the ineffective fields when No Proxy is selected.
  x (7/29/12) Register the messages on the Loaded event, rather than at construction time.
  x (7/29/12) Save the ServerPassword to Settings with encryption.
  x (7/29/12) Implement the secure password in the ServerPassword field of the proxies dialog.
  x (7/29/12) Validate the text box entries.
  x (7/29/12) Line up the controls.
  x (7/29/12) Don't persist the settings until the user clicks the outer dialog OK button.
  x (7/29/12) Make a blue border.
  x (7/29/12) Add tooltips.
  x (7/29/12) If a field has only white space, make it String.Empty.
  x (7/29/12) Add resources for the title and buttons.
  x (7/29/12) Change the preferences title as each subcategory is displayed.
  x (7/29/12) Password does not stay on OK and redrive.
  x (7/29/12) (Couldn't recreate this) Cancel until entire dialog disappears, then come back into proxies.  Both No Proxy and Auto-Detect are selected.
  x (7/30/12) Set the DialogPreferences ChildWindow properties (width, height, etc.) from the ViewModel properties.
  x (7/30/12) Bandwidth dialog: Radio buttons don't work.
  x (7/30/12) Bandwidth dialog: Upload disable and dimming don't work.
  x (7/30/12) Bandwidth dialog: Spinner conversion.  Remove the set to 0 on exception.  Make the user do it.
  x (7/30/12) Bandwidth dialog: Change the window size.
  x (7/30/12) Bandwidth dialog: Tooltips: Limit to a specific rate.
  x (7/30/12) Bandwidth dialog: Set the dialog title.
  x (7/30/12) Proxies dialog: Change the window size.
  x (7/30/12) Proxies dialog: Height and width reversed?  Ditto on the Bandwidth dialog.
  x (7/30/12) Proxies dialog: Disable the controls when No Proxy is set.
  x (7/30/12) Proxies dialog: Disable the proxy settings when Auto-Detect is selected.
  x (7/30/12) Proxies dialog: Port and server name are not dimmed when manual is not selected.
  x (7/30/12) Proxies dialog: User name and password TextBlocks are not dimmed with checkbox.
  x (7/30/12) Proxy Dialog: The Proxy type and Proxy server TextBlocks are not dimmed.
  x (7/30/12) Bandwidth dialog: Dim the text in the spinner textboxes.
  x (7/30/12) Add code to ignore F5 Refresh in all views.
  x (7/30/12) Pressing F5 on DialogPreferencesNetworkProxies kills the whole modal dialog.
  x (7/30/12) PagePreferencesGeneral language combobox cutting off descenders.
  x (7/30/12) Unlink this device dialog button placement.  Switch the order from No-Yes to Yes-No.  Fix the button sizes, and put them closer together.
  x (7/31/12) PagePreferencesAdvanced: Dismiss the modal dialog before sending a message to display the FolderBrowser.
  x (7/31/12) PagePreferencesAdvanced: Fix the \n in the Move Cloud Folder now dialog.
  x (7/31/12) PagePreferencesAdvanced: Shorten "Something happened while moving your Cloud folder." Header text.
  x (7/31/12) Set a margin on Advanced: Selective Sync: Left margin on the button.
  x (7/30/12) OK and cancel buttons are reversed.  Which is the proper order?????  Windows recommends OK-Cancel.  Change to that.
  x (7/31/12) DialogPreferencesNetworkBandwidth dialog buttons switched.
  x (7/31/12) DialogPreferencesNetworkProxies buttons switched.
  x (7/31/12) DialogPreferencesNetworkProxies Auto-detect, check requires password.  Set username and password.  Click OK.  Error.  Server name required.
  x (7/31/12) DialogPreferencesNetworkProxies OK button too small.
  x (7/31/12) FramePreferencesNetwork sync: Enable LAN Sync doesn't stick on OK.
  x (7/31/12) Change PagePreferences icon to cloud icon.
  x (7/31/12) FramePreferencesGeneral: Make backdrop slightly wider.
  x (7/31/12) DialogPreferencesNetworkBandwidth spinners go negative.
  x (7/31/12) FramePreferencesAbout: Slightly wider backdrop.
  x (7/31/12) FramePreferencesAbout: Remove cancel button, and move OK button to right.  No.  The OK and Cancel button are on the parent window.  Is this a problem?
  x (8/1/12) FramePreferencesGeneral: Make the backgdrop slightly wider.
  x (8/1/12) DialogPreferencesNetworkBandwidth/Proxies: Buttons reversed.
  x (8/1/12) DialogPreferencesNetworkProxies: No button captions.
  x (8/1/12) DialogPreferencesNetworkBandwidth/Proxies: Buttons show together. 
  x (8/1/12) Add right button Visibility properties to ViewModels?
  x (8/1/12) DialogPreferencesNetworkBandwidth: Cancel button too narrow.  The "unlink this device from your account" dialog has good buttons.
  x (8/1/12) DialogPreferencesNetworkProxies: Cancel button too narrow.
  x (8/1/12) What is: Sync: Enable LAN Sync checkbox?  Sync from users other devices directly if they are on the same LAN.
  x (8/1/12) Add the new CleanShutdown logic to every page.  During the startup wizard, actually shut down the app if the user says OK.  Otherwise, handle as a Cancel button click.
  x (8/2/12) Some of the pages are not setting the grid in the ViewModel.
  x (8/2/12) Take out the Interactivity.EventToCommand processing of the Closing event from all of the Pages.
  x (8/2/12) Add EventToCommand in all XAML to catch the Window.Close event.
  x (8/2/12) Hook up the "This will exit the Cloud application.  OK?  Yes/No" dialog.
  x (8/2/12) How do I tell git to include .dll and .pdb files in 3rdParty\bin\debug?
  x (8/2/12) When clicking the X on any of the startup windows, exit the application.
  x (8/3/12) While the dialog on dialog was active, the 'X' on the main window can be clicked.  The dialog's modality does not prevent the outer window from being closed.
  x (8/3/12) When the preferences dialog is minimized, it minimizes to the system tray and displays the cloud icon.  The right-click context menu is not active.
             Double-clicking the system tray icon restores the window, but there is no hint of that functionality.  Change the mode of the window into a regular
             window when it is not PageInvisible, and make it visible in the system tray.
  x (8/3/12) Change "I'm in the Tray!" to "Cloud" via resources.
  x (8/3/12) When clicking X on the preferences pages, that should mean minimize to the system tray, but ask the user if he wants to save his changes.  If there
             are no changes to save, just minimize to the system tray.
  x (8/3/12) Minimize minimizes to the system tray, and then the system tray icon is not active.  Change the Window style, etc.?
  x (8/5/12) Change all of the pages to allow the modal dialog to exit before calling RequestShutdown.
  x (8/5/12) Fix the animate-from location (from the system tray).
  x (8/5/12) When showing PagePreferences from the system tray, the window appears, but the content is black.
  x (8/5/12) Close while minimized on the taskbar.  Doesn't restore the app to see the modal dialog.
  x (8/5/12) Remove ShowMainWindow calls from the OnNavigated event.  Rely on the Loaded event.
  x (8/5/12) The main window appears briefly, disappears, and then appears at PageHome on startup.
  x (8/5/12) Animate the minimizing to the system tray.  Shrink the window and move it to the system tray as it disappears.  Capture an image of the visible window
             and make that the content of PageInvisible, then animate and shrink PageInvisible to the system tray.
  x (8/5/12) Put up a welcome tooltip when animation to the system tray is complete.  "Welcome to the Cloud!  Drag files here to share, and set Cloud options."
  x (8/5/12) Change to the MainDispatcher from CurrentDispatcher everywhere.  CurrentDispatcher is the thread's dispatcher.
  x (8/5/12) Remove the duplicate _trace = CLTrace.Instance instructions.  It was already set up statically in many modules.
  x (8/6/12) Add IsCancel bindings to the CloudMessageBox.
  x (8/7/12) In PageInvisible.OnLoadedCallback, the PageInvisible_NavigationRequest message is registered.  It was triggered, and it took an exception because this.NavigationService was null???
  x (8/7/12) hange the DialogPreferencesNetworkBandwidth/Proxies to use IsDefault/IsCancel buttons.
  x (8/7/12)The ChildWindow "modal" dialog doesn't hide keyboard accelerators!!!
  x (8/7/12)The modal dialogs are now full windows.  Make them DialogWindows?
  x (8/7/12)Multiple dialogs popping up to Select your Cloud folder location, and Merge cloud folder.
  x (8/7/12)Remove DialogPreferencesNetworkBandwidth _closing events in code behind.  Also proxies.
  x (8/7/12)Remove "RestoreIsDefaultAndIsCancelProperties" and related code.
  x (8/7/12)When maximized, the Preferences dialogs look horrible.  Can I enforce a maximum size?  Or just remove the maximize button on the window.  Or make it a non-sizeable window.
  x (8/7/12) Maximize a window with a modal dialog.  The child window gray modal area doesn't expand to make the entire window modal.  The other buttons become active.
    Disable the minimize button when modal?
  x (8/8/12) Unlink dialog: IsDefault clicked Yes to unlink the device.
  x (8/8/12) Check for updates dialog right button should have IsCancel too.  Same for "Get more space" dialog.
  x (8/8/12) Place the dialog centered over the existing window.
  x (8/8/12) Remove all DefaultHub references.
  x (8/8/12) Neither Enter key nor the Esc key are functional with the message box dialog.
  x (8/8/12) Reorganize PageHome.  The email address and password fields aren't labeled.  Group them with the SignIn button, and set the CreateAccount button off to the side, or somewhere.
  x (8/8/12) Use new dialog instead of the old code.  Search for "new DialogMessage", PageSelectStorageSizeViewModel.    
  x (8/8/12) Selected Merge button, and it returned DialogResult false to select a new cloud folder location.
  x (8/8/12) Remove "terribly" from messages.
  x (8/8/12) PageHome refuses to login when IsDefault (Enter) key is used.  Clicking the Sign In button works (the 2nd time).
  x (8/8/12) PageStorageSelector: 50 GB squeezed out.  Shows a dash.  "50 G\n-".
  x (8/8/12) PageStorageSelector: Click a radio button (to give it focus).  Now the Enter key doesn't work as IsDefault.
  x (8/8/12) PageTour(s): Esc button doesn't work.  It should prompt for whether the user wants to exit the app.
  x (8/8/12) PageSelectStorageSize page: Enter and Esc don't work.  Also PageSetupSelector.
  x (8/8/12) The Enter key is not functional on the PageHome page after a message box dialog has been shown.
  x (8/8/12) Delete the TrayIcon at application exit so there aren't many copies of it left in the system tray.
  x (8/8/12) The generated resource code has static lookup functions for the strings.  Use those everywhere instead of the strings.
  x (8/8/12) FramePreferencesAdvanced: Change... button should use "e" for accelerator. 			
  x (8/8/12) PagePreferences: The frame should not be a tab stop.
  x (8/8/12) Modal dialogs: Do you want to exit Cloud?  Both IsDefault and IsCancel should choose No.  Parameterize the initial focus to the No button.
  x (8/8/12) FramePreferencesAbout: Add an access key to the Twitter button.
  x (8/8/12) FramePreferencesNetwork: Access key on "S_ync:" 
  x (8/8/12) FramePreferencesAccount: "Get more s_pace..."
  x (8/8/12) DialogPreferencesNetworkBandwidth: Access keys.
  x (8/8/12) DialogPreferencesNetworkProxies: Access keys.
  x (8/9/12) Test the cloud folder missing "Unlink" path.
  x (8/9/12) Fix the Back button on PageFolderSelection to point to PageSetupSelector.
  x (8/9/12) PageFolderSelection Change... doesn't  bring up the folder browser.
  x (8/9/12) PageFolderSelection Change... Changed to Trash.  Couldn't find the original Cloud to move.
  x (8/9/12) PageFolderSelection: Continue button.  Save the checkbox settings.  Actually, do it instantly in the properties.
  x (8/9/12) Initialize the last page of the tour (and advanced) to show the check mark for (show cloud folder).
  x (8/9/12) Last page of tour: The "Open Cloud Folder" checkbox should actually open the cloud folder (launch Explorer).  Also the ending page of the Advanced setup path.
  x (8/9/12) Setup Advanced went to PageTour1 view, instead of the PageTourAdvancedEnd.
  x (8/9/12) PageFolderSelection: On continue, it should go straight to the ending tour page without the message.
  x (8/9/12) PageFolderSelection: Lauch is misspelled.
  x (8/9/12) New "You're all Set" dialog without the message ("The installation is not complete, and your tour has come to an end.".  Drive into this via the Advanced installation
             from the CLFolderSelection view.
  x (8/9//12) With Settings clear, "Add Cloud foder shortcut to Desktop" is false, and QuickLaunch is true.  Make them both true.
  x (8/9//12) Change "Remove" to "Unlink" to be consistent with Mac client.
  x (8/9//12) Don't validate the password on PageHome at signin. 
  x (8/9//12) New option on CLFolderSelection dialog: Add shortcut to Desktop.
  x (8/9//12) PageSetupSelector: Access keys for the radio buttons.
  x (8/9//12) PageSelectStorageSize: Access keys for the radio buttons.
  x (8/9//12) PageSelectStorageSize: 50 GB still to narrow.
  x (8/9//12) Fill out the rest of the keyboard accelerators.
  x (8/9//12) Fill in the PageSetupSelector "Advanced" option.
  x (8/9//12) The dialog OK button looks like "OK_".
  x (8/9//12) The full name? (like "Bob S(bob99@cloud.com)") appears in PageHome.  This isn't a valid user name.
  x (8/9//12) Change the Merge dialog buttons to use "..." if they result in another dialog.
  x (8/9//12) Sign in: First auth fails.  Second works.
  x (8/9//12) 500GB box image should be bigger image.  (fix when we redo the image assets).
  x (8/9//12) Hook up the Enter key to the OK buttons.
  x (8/9//12) Hook up the Esc key to the Cancel buttons.
  x (8/9//12) Merge dialog: Close it.
  x (8/9//12) Merge dialog: Polarity wrong.  Switch processing for buttons.
  x (8/9//12) Merge dialog: ...Select, ...Merge.   "..." should come after!  Didn't fix this. Just removed them.
  x (8/9//12) Merge dialog: Select a new location, key accelerator.
  x (8/9//12) The Skip Tour button goes straight to PageInvisible. (That seems to be what is required.)
  x (8/9//12) Specifying a new cloud folder location in \Trash didn't build a Cloud folder there.
  x (8/9//12) The full user name is still appearing in the PageHome email field.
  x (8/9//12) Change the DialogFolderSelectionSimpleView in PageSetupSelectorViewModel.cs to use the Vista-style FolderBrowser.  Also in PageFolderSelection.
  x (8/9//12) Remember Cloud app window location and size, etc.
  x (8/9//12) Implement keyboard accelerators everywhere.
  x (8/9//12) Remove the old system tray NotifyIcon support.  Gone?  Check this. (Checked.)
  x (8/9//12) Get rid of the ugly duplicate code in each of the view code-behind modules.
  x (8/9//12) Are you sure you want to quit Cloud.com application setup?
  x (8/9//12) o When a modal dialog is present, disable the "X" Close button. Clicks on that button should not exit the modal dialog. (Duplicate).
  x (8/9//12) The SelectStorageSize page did not have a selection when Settings did not exist for the user.
  x (8/9//12) PageHome: Use the busy indicator while signing in.
  x (8/9//12) Get the busy indicator working.  Use it especially when starting the index, and when communicating with the server.
  x (8/9//12) The PageHome dialog is not showing the busy indicator while trying to connect to the server to log in.
  x (8/12/12) In task manager, the program is called win-client.  Change it to Cloud.exe.
  x (8/12/12) On install, sometimes Cloud comes up under other windows.  Clicking it on the taskbar brings it into the foreground.
  x (8/12/12) Right-clicked on the systray cloud icon after a normal sign-in process.  The icon disappeared silently.  The Event viewer showed an unhandled exception in
              SQLIndexer while building the index.
  x (8/12/12) In the "All Programs" Windows button list, the program is called "Built".  Change it to Cloud.
  x (8/12/12) The RegisterCom program is throwing an exception. (Use Release64 build to get the 64-bit version of RegisterCom).
  x (8/12/12) Capitalize Cloud.Com in the Windows start menu.
  x (8/12/12) Sign-in, with existing Cloud folder.  Merge folders.  Goes not-responding for a long time on the PageSetupSelector page.  Use the BusyIndicator.
  x (8/14/12) Move the buttons to the right about 10 pixels.
  x (8/14/12) Fix the Updater window size.
  x (8/14/12) Set the icon for the CheckForUpdate window.
  x (8/14/12) Treat a click on the X on the CheckForUpdate window as a click on Done.
  x (8/14/12) Change CloudSetup static paths to relative paths.  Is this possible?
  x (8/14/12) Set the AutomaticUpdater GUID.
  x (8/14/12) Killing the application doesn't close it because of the new open CheckForUpdate window.  Close that window so the application can close.
  x (8/14/12) Remove the WindowWidth and WindowHeight from the CheckForUpdates ViewModel.
  x (8/14/12) Implement the CheckForUpdate button in FramePreferencesGeneral.
  x (8/14/12) View PageHome and try to sign in.  An error occurs the first time.  The error message appears, but there is a dotted focus border the same size as the
              error dialog in the upper-left corner of the page.  Giving focus to another window removes the focus dotted line, and giving focus back to the
              error dialog doesn't make the dotted focus border reappear.
  x (8/14/12) Research how update works with the installer.
  x (8/14/12) Clean up CLSptHttpConnectionOperation &&&&.
  x (8/14/12) Remove the "using win_client.Views" from the ViewModels.  ViewModels aren't supposed to know about Views.
  x (8/15/12) PageTour5 title is wrong.  Others?
  x (8/15/12) PageStorageSelector has the wrong title.
  x (8/15/12) Pull the open source version of wyUpdate into git and test it.
  x (8/16/12) During uninstall, unregister the BadgeCOM dll.  Can't do this using InstallShield without paying big bucks.  Do this later with WiX.
  x (8/16/12) On my Win7 64-bit machine, Cloud is being installed in the Program Files (x86) directory.  Shouldn't it be in Program Files?  (No).
  x (8/16/12) InstallShield actually killed Explorer and didn't restart it!  Maybe because BadgeCOM.dll was running or registered to Explorer?  Try unregistering it in a custom action
    at the beginning of install.  I tried that manually, and it is still asking to kill Explorer!  Never happened again.
  x (8/18/12) Determine if Cloud.exe is already running before launching it from the shell extension. (This is tested by attempting to connect to a named pipe end)
  x (8/19/12) Copy the selected files and folders to the Cloud directory.
  x (8/19/12) Change the context menu item's text to "Share to Cloud".
  x (8/22/12) IconOverlay:StartBadgeCOMPipes.  Wrap in try/catch.
  x (8/22/12) David: Line 619 FilePathDictionary: FilePath key already exists in collection.
  x (8/22/12) Talk with David about _trace vs. Logging.
  x (8/22/12) During startup, if user exits app before CompletedSetup, then unlink to kill the settings and authentication.  Also kill the Cloud folder if it is still virgin.
  x (8/22/12) In CLRegistration, the exceptions are creating error.errorDescription fields that are filled with JSON.  Pull out the error text only.
  x (8/22/12) When logging in or creating a new account, make sure that the proper error is displayed to the user (the error from the auth server).
  x (8/22/12) In BadgeCOM, dispose of the new named pipe (context menu).  pipeServerStreams.
  x (8/22/12) In BadgeCOM, change the badging named pipes to be qualified by the user's login name??
  x (8/22/12) The taskbar has the default icon for Cloud.exe!
  x (8/22/12) Change the code in IconOverlay from \CloudX back to \Cloud.
  x (8/22/12) Talk with David about NoRemove and ForceRemove.
  x (8/22/12) Talk with David about the exceptions when trying to sync.
  x (8/22/12) David: DefaultForType?
  x (8/27/12) Cloud folder itself not being badged.
  x (8/27/12) Still screwing up the .lnk FileType registry entry.  (Only happens on my home machine)
  x (8/27/12) Remove the BadgeType .None. (Leave it in.  It works).
  x (8/27/12) Test the expression equality in GenericHolder.
  x (8/27/12) Change name of installation file from Setup.exe to CloudSetup.exe. (Do that manually when FTPing to the download directory)
  x (8/27/12) Design and implement selective sync.
  x (8/27/12) Add logging to BadgeCOM.
  x (8/27/12) Wrap the badging shell extension functions in try/catch.
  x (8/27/12) Add the icon and keyboard accelerator to the context menu item.
  x (8/27/12) Dynamically pick a keyboard accelerator for the BadgeCom context menu item so it doesn't conflict with the others that are already in the menu. (no.  too hard to predict.  And it works anyway.  It just toggles back and forth with the other one).
  x (8/27/12) Change pipes to use user name to the name of the pipes to keep them unique to the user.
  x (8/27/12) After registering BadgeCOM, kill and restart Explorer.  Do that in RegisterCom.
  x (8/27/12) What is "Push Animation"?  Who knows?
  x (8/28/12) Does notifying the root notify all children? No.  It works fine.
  x (8/29//12) PageHome sign-in and create-new button tooltips.  Also tooltips for EMail and Password.
  x (8/29//12) Password field at 50% opacity.
  x (8/29//12) Set the size of NavigationWindow for setup or preferences, according to the page.
  x (8/29//12) Put back the PageHome busy indicator.
  x (8/29//12) Disable the PageHome sign-in button when EMail is blank or in error, or when Password is blank.
  x (8/29//12) PageHome email error message doesn't show.
  x (8/29//12) Add a margin to pagehome password watermark.
  x (8/29//12) PageSelectStorageSize. Align icons with text, no vertical separators. RB covering on 500GB doesn't work. Keyboard accelerators don't work.  50_0 key.		
  x (9/19/12) Rework CLShortcuts.cs to consolidate the code to use the primitive functions.  Also, pass the cloud folder path as a parameter.
  x (9/19/12) Change all "new URI()" calls to use the "/Cloud;component" syntax.
  x (9/19/12) Currently AddCloudFolderShortcuts(path) is used to modify the shortcuts as well.  Change this to use ModifyCloudFolderShortcuts(path) if there are UI issues (shortcut placement, etc.)
  x (9/19/12) Auto-start Cloud.exe at startup.
  x (9/19/12) Every time Cloud starts, check the shortcuts against the preferences.  If a shortcut is supposed to be there, check it for validity.  If it is there and wrong, remove it and
              replace it with a correct shortcut.  If it is not supposed to be there, remove it.
  x (9/19/12) Badging doesn't work.
  x (9/19/12) The taskbar icon is not the cloud, it is the Windows default.
  x (9/19/12) Use syntax "/Cloud;component/Artwork/file.png" in xaml everywhere.
  x (9/19/12) Uninstall should clear settings.
  x (9/19/12) David: An item is on the failure queue and is preventing app exit.  The
  x (9/19/12) The shortcut removal logic is actually creating the Cloud folder.
  x (9/19/12) Explorer was crashing on David's machine.
  x (9/19/12) Change the sign-in button to be the default if it is enabled.
  x (9/19/12) On an unlink, Cloud.exe does not exit.  The threads are stuck in a named pipe WaitForConnection.
  x (9/19/12) None of the changes are being synced to/from Mac.
  x (9/19/12) Start up.  This time all badges are synced.  Rename.  Drives badging rename.  Old path not found in dictionary.  Trace this error.
  x (9/19/12) F5-Refresh on the Cloud folder does not repaint all of the badges.  With trace on, I couldn't recreate it.
  x (9/19/12) At startup, the badges are "syncing", rather than "synced" on most of the items.
  x (9/19/12) Context menu does not copy the files.
  x (9/19/12) Add tracing to the BadgeCOM context menu, and to the BadgeNet side.
  x (9/19/12) Notify the shell to rebadge everything at startup.
  x (9/19/12) Installation didn't work on Chuck's virgin Win7-64 VM.
  x (9/19/12) Add Cloud folder to favorites during install or at init.
  x (9/19/12) Add demo animated status lines to the systray context menu.
  x (9/19/12) When changing the cloud folder, also change any other shortcut, specifically the Favorites shortcut.
  x (9/19/12) Add Cloud folder to Favorites.  Add a shortcut to c:\Users\UserName\Links.  e.g.: Downloads.lnk.
  x (9/19/12) Animate the CheckForUpdate window when it is appearing out of the system tray?
  x (9/19/12) Modify Index to automatically create the database file, and to look for DB update scripts in the program folder.  These will look like DbUpdate0001.sql, DbUpdate0002.sql, etc.  If not found,
              it will look for the database .MDF file and open it.  If no .MDF file is found, the base .MDF file will be created.  If update files are found, they will be applied in sequence.
  x (9/19/12) Research recycling Explorer to register COM objects without restarting Windows.
  x (9/19/12) Add a preference and setting for the animation to/from the system tray.
  x (9/19/12) Implement all of the context menu support within Explorer (COM objects).
  x (9/19/12) PagePreferences: For each Frame selected, give focus to the proper control in the frame.   
  x (9/19/12) Change the move_file event MDS server requirement to use revision instead of the file_hash parameter.
  x (9/19/12) Remove "Drag files here" in the welcome systray icon tooltip (for now).
  x (9/19/12) Do the animation to system tray just once on initial setup, then never again.
  x (9/19/12) Adjust the buttons on the Cloud Shortcut Preferences dialog (down the left).
  x (9/19/12) A bad password at login shows the wrong error message.
  x (9/19/12) The main screen password watermark does not show.
  x (9/19/12) The SetupSelector dimming rectangles are too wide, and the Advanced text goes over the edge.
  x (9/19/12) Main screen password watermark shows over the password text.
  x (9/19/12) PageStorageSelector top line blue, prices.
  x (9/19/12) The pagehome text fields are being chopped on the bottom.
  x (9/19/12) Don't show the password watermark if the password field has any characters.
  x (9/19/12) Remove double-click icon window.
  x (9/19/12) Dress up test slide-up notification.
  x (9/19/12) "Forgot password" on PageHome dialog should be active to some website.
  x (9/19/12) "Pricing terms" on SelectStorageSize dialog should be active to some website.
  x (9/19/12) Add Launch Cloud.com to the systray context menu.
  x (9/19/12) Replace the hyperlink buttons on PagePreferences.
  x (9/19/12) Advanced PageFolderSelection.  checkbox items don't fit vertically.  Explorer favorites list is the last one showing.  Shift it up.
  x (9/19/12) Put back the pagehome busy indicator.
  x (9/19/12) SetupSelector page.  BusyIndicator.
  x (9/19/12) Put back the create account busy indicator.
  x (9/19/12) Advanced PageFolderSelection. BusyIndicator.
  x (9/19/12) When Unlinking (Remove), use the busy indicator.
  x (9/19/12) The systray icon's left click still brings up the popup window.
  x (9/19/12) Change the context menu single-click to bring up the context menu.
  x (9/19/12) Use new cloud icon in context menu title, and make it bolder.
  x (9/19/12) PageFolderMissing (unlink) busy indicator is not activated.
  x (9/19/12) PageSetupSelector busy indicator is not activated.
  x (9/19/12) Left click on the systray icon should show the context menu.
  x (9/19/12) Take out the creation of the Public and Pictures folders.  The server does that now.
  x (9/20/12) Cloud.exe should show the cloud directory after copying files to it from the context menu shell extension named pipe.  That will give the user some feedback that it happened.
  x (9/24/12) Write a new program (CloudSendTo.exe) to be the target of Explorer SendTo menu item.  This will emulate the context menu code, and use the named pipe to send the info to Cloud (and start Cloud if necessary).  Change name in InstallShield.
  x (9/26/12) Add Start Cloud to the Cloud.com/Cloud Start menu.
  x (9/24/12) Force server trace on until release.
  x (9/27/12) In CloudClean.vbs, add a DeleteFolderWithRetry function that loops trying to delete a folder.  On XP-64, the Cloud folder delete got an error 70, apparently for no reason.
  x (9/27/12) Handle exceptions when receiving push notifications, and everywhere else we talk to the server.
  x (9/27/12) Implement the new end point device type "os_platform".
  x (9/27/12) Rework the logging in RegisterCom to use the same log file as the .vbs scripts.
  x (9/27/12) Add a users directory for git backup of info.
  x (9/27/12) Execute and test the deployment process (again, and again, ....)
  x (9/27/12) Installation support for all platforms.
  x (9/27/12) Work with Brian to update all of the UI design assets.
  x (9/27/12) Check for update fails.
  x (9/27/12) InstallShield installation shows the default icon on the taskbar.
  x (9/27/12) Check out the Dropbox Autoplay capability.
  x (9/27/12) Make all of the RegisterCom installation and uninstallation modules trace to a file in the user's temp directory, and leave the file there for debugging problems in the field.
  x (9/27/12) Test on XP64.  Cloud already running.  OK button doesn't exit.
  x (9/27/12) Check startcoreservices CLErrors and log.
  x (9/27/12) Crash in CreateTaskbarIcon when constructing TaskbarIcon.
  x (10/1/12) The InstallUpdates action is causing the "Do you wish to exit Cloud setup?" dialog.
  x (10/1/12) Exception: Unable to start CLoud application.  The invocation of the constructor on type "Hardcodet.Wpf.TaskbarNotification.TaskbarIcon' the mathes the specified binding constraints threw an exception.
  x (10/1/12) We need a local test download and update server.
  x (10/1/12) The title of CloudUpdater.exe is "wyUpdate".
  x (10/3/12) Automate the deployment of a new program updates.
  x (10/3/12) Change the way the update works: Schedule a self-destructing .vbs to wait until Cloud.exe has exited, then the .vbs will call CloudUpdater with a command line to install the update.  When the .vbs is scheduled, exit Cloud.
  x (10/3/12) Understand the wyBuild self update process.
  x (10/3/12) CloudUpdater only copies itself to temp when it has to update itself.  Move the kill-explorer and test for Cloud.exe code to wrap where it actually performs the update.
  x (10/3/12) If the user cancels an update in CloudUpdater, Cloud is not restarted.
  x (10/4/12) Take out the negative offset code.  It causes the Check for Updates dialog to appear at startup.
  x (10/4/12) An update is ready to install.  Click Install Now, but cripple CloudInstallUpdate.vbs to do nothing.  Or simply exit before clicking Install Now.
              Restart cloud.  CloudUpdater runs, but finds Cloud.exe busy.  Click Close Process, and the update installs normally.  Cloud.exe should not be found busy.
  x (10/4/12) Schedule an update and exit cloud.  Restart Cloud.  The installer will try to update cloud automatically with the ready update, but prevent it.  Uninstall Cloud.
              Reinstall Cloud.  Run Cloud.  The PageHome screen appears, but the installer also appears trying to install an update.  Uninstall should clean any pending updates.
  x (10/4/12) Uninstall Cloud with Cloud.exe still running.  Click Close Process.  An intermittent crash occurs.
  x (10//11/12) Add NotifyPropertyChanged snippet.
  x (10//11/12) The CloudUpdater still installs a new version on startup, and still complains about Cloud.exe still running.
  x (10//11/12) Use a BusyIndicator when the update dialog is checking for updates....
  x (10//11/12) Implement new status dialog.
  x (10//11/12) Installing registers BadgeCom.dll in win-client\Release??
  x (10//11/12) Launch Explorer to the proper directory during the CloudInstallUpdate script.
  x (10//11/12) Display current updater number in NewUpdate.vbs.
  x (10//11/12) The AutoUpdater check for updates just shows "Checking..." many times, without completing the action and giving the user a result.
  x (10//11/12) Don't automatically download program updates.  Let the user decide to do that. (No.  Continue to automatically download.)
  x (10//11/12) Test the actual upgrade to a new version (CloudUpdater and Cloud).
  x (10//11/12) Apply Brian's specs to the XAML.
  x (10//11/12) Test uninstall with Cloud.exe running.
  x (10//11/12) Growl when an update is available.
  x (10/11/12) Preferences, Unlink, OK.  Sorry, your cloud program is already running.  Launch a VBScript self-destruct script to wait for Cloud to exit.  Kill Cloud after 3 seconds, then restart cloud and self-destruct.
  x (10/11/12) Add our current version of wyBuild to git.
  x (10/11/12) Change the DependencyProperty references to use the proper classes in all of the Preferences dialogs.
  x (10/15/12) Disconnect net adapter when web sockets are connected results in unhandled exception loop.
  x (10/15/12) Add long-poll backup for WebSockets push notification.
  o Add ICleanup interface to all view models and call them when shutting down.  Note: Cleanup doesn't get called when the user clicks the 'X'????
  o The ViewModelLocator.Cleanup() function should call of the ViewModel.Cleanup functions.
  o Don't allow network or unmountable drives for the Cloud directory.
  o Finder: Test that Finder's badges disappear when killing the client.
  o Finder: Add localization resources for IconBadge and Finder.
  o Finder Lion: Multiple-selection and right-click doesn't add the Share item to the context menu. Unfortunately that will require additional swizzling on the Lion base.
  o Finder:  Check this.  Release the message from the hook to the server thread in the server thread.
  o Finder bug: Select files on Flowview then switch to column view and click the "DoThings" toolbar icon.  No paths appear, even though there are two files selected.
  o Finder bug: Alias files are always badged like their target files, whether either is in or out of the cloud folder.  Both files should only be badged when
    they physically reside inside the cloud folder.
  o Check all of the C# blocks for proper boxing of in/out data.
  o Generate a proper device-specific GUID in CLDevice; one that can be checked against the device.  Also check that ID when starting to see that it matches the device.
  o Implement code to handle case sensitive paths.
  W Implement long kernel paths. 
  o Change the CLDefinition public const strings to enums.
  o Protect the security tokens in memory some way.
  W Watch the cloud folder for a move/rename or a delete.  Warn the user and allow him to abort.  If the user says go ahead with the action, unlink or use the new location.
  o Set initial focus in the HandleNavigated event in each view code-behind.
  o Move the supported language list to CLDefinitions.
  o Add help buttons to the preferences dialogs and make them functional with some type of help system (web or application).
  o Bind all tooltips to localizable resources.
  o When exiting the dialogs, give focus back to the PagePreferences so the proper button will light up.
  o Make sure that only a single user is using the Cloud folder?
  o Should the cloud folder be restricted only to a user's home directory?
  o Prevent overlap of cloud folders between users. 
  o Change all RelayCommands to the new ICommand model.
  o On the Cloud folder merge dialog, clicking the X turns into a merge.  Not what the user expected.  Change this to somehow recognize the
    click on the X as a request to exit the app.
  o The CleanShutdown code may cause the Cloud app to prevent system shutdown.  Test that and correct it if needed.
  o In DialogCloudMessageBoxView, parameterize the focused button.
  o Make the animation to the system tray smoother with a shrinking image.
  o Change all resource string keys to enums or constant string references so we can search for their use.
  o Bind all strings in XAML to localizable resources.  Actually, all strings everywhere.
  o PagePreferences: Color the button that is active in the frame? Or draw a dashed rectangle around it?
  o Mac: New Preferences Check for Updates view CLPrefUpdateView 
  o Mac updated Preferences FramePreferencesGeneral view options.
  W Add Recently Changed file/folder support.
  W Full database encryption.  Data encryption vs. full-file encryption?
  W Add items to the systray context menu, Mac source CLAppController, menu: MainMenu.xib (Status Item)
    - (0.0% of 5.0GB used,, All files are up to date)
    - Recently changed files/folders ->
    - Get more space...
    - Help...
    - Launch Cloud.com...
    - Open Cloud folder
    - Toggle syncing (pause/resume syncing)
    - Failed files/folders ->
  W Add network reachability support, and test.
  W Add "close lid" support, and test.
  o Add Quick Launch shortcut support for XP.
  o Implement the Windows-equivalent of KeyChain (Windows Vault).
  W Reimplement the full installation to use WiX.
  . Test the automatic check for updates after some number of days.
  o Restore open folders and positions on a restart of Explorer.
  o If in the cloud directory, change the context menu item to read "Share..."?
  o Open Explorer window in Favorites/Recent Places.  Two context menu items are added.  The first seems to trace through the shortcut.  The 2nd is the shortcut.
  . Remove dead CLSyncService code after the new sync works.
  . Add a splash graphic while launching.
  o Implement status window.
  . Fix the badging trace definitions.
  . Uninstall hung waiting for Cloud to exit (with the "Close application" option selected) (just once).
  . MsConfig shows the Cloud.exe startup manufacturer as "Unknown".
  o When changing the cloud folder icon preference warn the user that a restart of Explorer is required.  Close all Explorer windows.  Restart Explorer on OK.
  o Restarting Explorer loses the systray icon.  How do we get it back?  We need to watch the systray for the icon and put it back if it is missing.
  o The fancy slide-up notification window gets stuck and does not fade away.
  o Add our shell extensions to the approved list.
  W Place the systray icon on the taskbar permanently.
  W There are continual problems with processes other than Explorer placing a lock on BadgeCom.dll.  Then the uninstall fails.  Then a subsequent installation fails.
  o Provide some dynamic way to turn trace on and off (special file in installation directory?)
  o Change all MVVMLight RaisePropertyChanged to David's NotifyPropertyChanged.
  o Fix the Busy Indicator to use a converter to set Visibility to Collapsed in design mode.
  o Fix error in trace on shutdown during an update operation from Cloud: 01:02:39.568 PM_2648_1_CLModalErrorDialog: DisplayModalMessageBox:  Message: Are you sure you want to quit the Cloud.com application setup?.
  o Remove the systray cloud icon on context menu click of Check for Updates?
  o In CloudUpdater, find a better way to wait for Explorer to be fully operational after restart (rather than just sleeping an arbitrary amount of time).
  o Move trace to appdata cloud dir.
  o Delete trace files older than 10 days.
  o Download, but don't allow install unless the user is an administrator.  Put up a message on Install Now.
  o CloudUpdater is not killing processes when asked to do so.  It just hangs.
  o Protect the DialogCheckForUpdates action with a dialog that indicates that Cloud (and possibly Explorer) will be closed.  Continue?  Yes, No.
  o Take shell integration out of RegisterCom?.
  o Vista, XP and Win7X86: The taskbar show-cloud-folder icon is not showing.
  o Change the NewUpdate script to ask the user to copy the entire CommonFiles\Cloud.com folder to WyBuild instead of manually making the directories in WyBuild.
  o In BadgeCom, identify ignored file types and immediately return "no badge".
    . File attributes:
      - Hidden
      - Offline
      - System
      - Temporary
      - SqlIndexer/Static/NativeMethods.
    . If file path is a shortcut, and if the target file is in the cloud folder, or is the cloud folder, then process the path as though it were the target path.
    . BadgeCom should also send the shortcut path, and BadgeNet should keep a dictionary of the shortcuts for the purpose of notifying Explorer using the
      shortcut path when the status
      has changed on the target file.  BadgeNet should also run a clean thread to watch the shortcut dictionary.  It will verify that the shortcut exists, and
      that the shortcut still points to a file in the cloud directory.  If not, the entry is deleted or modified (if the cloud relative path has changed) in the shortcut directory.
  o On Win7Sp1X86, the installer unpacks and then minimizes to the taskbar.  The user has to restore it to start the installation.  InstallShield problem?
  o Programmatically locate all applications that have BadgeCom.dll locked.  Use Restart Manager.
  o Before release, make sure all trace is turned off or managed in some way.

  o Modify the InstallShield artwork.
  o Alt-tab shows an extra window "Check for Updates", even when it is hidden.
  o UI to request a resync operation.
  o Check the cloud directory location to make sure it is acceptable.
  o Change the default badge state to "syncing".
  o Set and check tab order on all frames and dialogs .
  o Add keyboard accelerators for the email and password fields on PageHome.
  o Change the icons in the context menu.
  o Fix the PreferencesAbout background to be continuous?
  o Fix move Cloud folder while system is running.
  o On move Cloud folder, flag an operation to move it, then restart.  On restart, 1) Rename index for new path. (optimization)
  o On select new cloud folder while running Cloud, wipe index. Can do this for both cases.
  o Add Version.txt file with a fixed version format inside to identify the version installed.
  o When preferences UI is running, the taskbar has two cloud icons that look the same.
  o Store the device Udid received from the server in the link response.  That is the real Udid, not the GUID that we were generating???
  o Implement the device list with automatic updates via push, and a refresh button.
  o When using Autoupdater from Preferences, disable the button to show DialogCheckForUpdates if there are changes to preferences.
  o Completely relogo CloudUpdater.exe.
  o Implement Server Side Events as a fall-back for WebSockets.
  o Implement the Log, Errors and Save Log buttons on the detailed status window.
  o At shutdown, delete the new empty directories (new names). Documents, Pictures, Videos.
  o Sign in to Cloud.  The code never sets the CompletedSetup Settings flag.  Due to Udid processing?
  o When core services pause is implemented, the manual polling should synchronously do a SyncFrom and return exceptions that would be aggregated.  If all manual polls fail in a batch, then enter the paused state.
  o Imlement core services pause.
  o Implement a core services pause watcher thread.
  o Trace.cs: Line 1013.  LogCommunication: Use a regular expression to test for proper JSON serialization format, instead of causing an exception.
    Seen in JsonTextReader.cs, line 1348 Convert.ToInt64(number, CultureInfo.InvariantCulture).  Number is like "----C".
    Set in Sync.cs, line 2209.  e.g., "---Completed file download---";.   Fix in trace: regular expression to detect valid JSON before removing
    the authorization key.
  o Get quota information from the sync/to-cloud responsea:
		Quota information is now being returned in the sync/to_cloud response.  The data is:
		quota:{limit: <integer>, local:<integer>, shared:<integer>}
		Also, there is an MDS route, GET /user/usage that will return the same thing.
  o Remove all references to System.IO and replace it with Win32 calls.  Too many bugs?????
  o Make a single instance of the RateBar window.




  











